% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
  11pt,
]{krantz}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
  \setmainfont[]{Palatino}
  \setmonofont[Scale=0.8]{Source Code Pro}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={R Markdown Cookbook},
  pdfauthor={Yihui Xie, Christophe Dervieux, Emily Riederer},
  colorlinks=true,
  linkcolor=Maroon,
  filecolor=Maroon,
  citecolor=Blue,
  urlcolor=Blue,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.61,0.61,0.61}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.14,0.14,0.14}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.43,0.43,0.43}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf,singlelinecheck=off]{caption}

\setmainfont[UprightFeatures={SmallCapsFont=AlegreyaSC-Regular}]{Alegreya}

\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{248,248,248}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\ifxetex
  \usepackage{letltxmacro}
  \setlength{\XeTeXLinkMargin}{1pt}
  \LetLtxMacro\SavedIncludeGraphics\includegraphics
  \def\includegraphics#1#{% #1 catches optional stuff (star/opt. arg.)
    \IncludeGraphicsAux{#1}%
  }%
  \newcommand*{\IncludeGraphicsAux}[2]{%
    \XeTeXLinkBox{%
      \SavedIncludeGraphics#1{#2}%
    }%
  }%
\fi

\usepackage{makeidx}
\makeindex

\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
\usepackage{color}
\usepackage{framed}
\setlength{\fboxsep}{.8em}

\newenvironment{blackbox}{
  \definecolor{shadecolor}{rgb}{0, 0, 0}  % black
  \color{white}
  \begin{shaded}}
 {\end{shaded}}
\newenvironment{infobox}[1]
  {
  \begin{itemize}
  \renewcommand{\labelitemi}{
    \raisebox{-.7\height}[0pt][0pt]{
      {\setkeys{Gin}{width=3em,keepaspectratio}
        \includegraphics{images/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{blackbox}
  \item
  }
  {
  \end{blackbox}
  \end{itemize}
  }
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{R Markdown Cookbook}
\author{Yihui Xie, Christophe Dervieux, Emily Riederer}
\date{2020-07-03}

\begin{document}
\maketitle

\cleardoublepage\newpage\thispagestyle{empty}\null
\cleardoublepage\newpage\thispagestyle{empty}\null
%\cleardoublepage\newpage
\thispagestyle{empty}
\begin{center}
\Large{Dedication}

%\includegraphics{images/dedication.pdf}
\end{center}

\setlength{\abovedisplayskip}{-5pt}
\setlength{\abovedisplayshortskip}{-5pt}

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\listoftables
\listoffigures
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}


\begin{infobox}{caution}

This book is currently a draft. We plan to publish it around August 2020 with Chapman \& Hall/CRC. If you have any feedback, please feel free to \href{https://github.com/yihui/rmarkdown-cookbook/issues/new}{file an issue on GitHub}. Thank you!

\end{infobox}

R Markdown is a powerful tool for combining analysis and reporting into the same document. Since the birth of the \textbf{rmarkdown} package \citep{R-rmarkdown} in early 2014, R Markdown has grown substantially from a package that supports a few output formats, to an extensive and diverse ecosystem that supports the creation of books, blogs, scientific articles, websites, and even resumes.

There is a wealth of guidance that has been written over the past few years, and the book \href{https://bookdown.org/yihui/rmarkdown/}{\emph{R Markdown: The Definitive Guide}} \citep{rmarkdown2018} provides a detailed reference on the built-in R Markdown output formats of the \textbf{rmarkdown} package, as well as several other extension packages. However, we have received comments from our readers and publisher that it would be beneficial to provide more practical and relatively short examples to show the interesting and useful usage of R Markdown, because it can be daunting to find out how to achieve a certain task from the aforementioned reference book (put it another way, that book is too dry to read). As a result, this cookbook was born.

Despite of the existence of the official documentation, R Markdown users often seek for help on Stack Overflow, a popular Q\&A forum. At the time of writing, there are more than 6,000 questions with \href{https://stackoverflow.com/questions/tagged/r-markdown}{the \texttt{r-markdown} tag.} This huge number means that the use of the forum can be difficult if you do not have a specific problem to search for. Therefore, it may be hard for you to realize all possible things that you could do with R Markdown or how to do them. This book aims to draw together popular posts from Stack Overflow and other online resources (such as blog posts or tutorials) to provide up-to-date solutions for everyday queries that users commonly make. In fact, to help us make decisions on the potential topics to cover in this book, the second author of this book, Christophe, has built an R Markdown dashboard to scrape Stack Overflow daily for the most popular posts. Hopefully, our cookbook can become more useful by including recipes from these popular posts.

This book is designed to provide a range of examples of how to extend the functionality of your R Markdown documents. As a cookbook, this guide is recommended to new or intermediate R Markdown users who desire to enhance the efficiency of using R Markdown and also explore the power of R Markdown.

\hypertarget{how-to-read-this-book}{%
\section*{How to read this book}\label{how-to-read-this-book}}


It is recommended that readers have a basic understanding of R Markdown. \href{https://bookdown.org/yihui/rmarkdown/basics.html}{Chapter 2} of \href{https://bookdown.org/yihui/rmarkdown/}{\emph{R Markdown: The Definitive Guide}} \citep{rmarkdown2018} provides an overview of the basics of R Markdown and is recommended background reading for any new users of R Markdown. For example, we did not cover Markdown syntax in this book, and expect readers to learn Markdown elsewhere. In particular, we strongly recommend that you go through \href{https://pandoc.org/MANUAL.html}{the full manual of Pandoc} at least once. The manual is quite lengthy, but it is also a gold mine. You do not have to remember everything, but it will be very helpful if you are aware of the possible features of Markdown. \href{https://yihui.org/en/2018/11/hard-markdown/}{For countless times, I have seen} people fail to write verbatim code blocks that contain three backticks, or list items that contain child elements. Without fully reading the Markdown syntax in the manual, perhaps you will never know or understand the rule ``\texttt{N\ +\ 1} outer backticks for \texttt{N} inner backticks'' or ``indent to indicate child elements.''

We do not intend to provide a full technical reference for R Markdown in this cookbook. This cookbook aims to supplement, instead of replacing, the existing literature. Therefore readers may explore the following books if they want to seek further information:

\begin{itemize}
\item
  \emph{R Markdown: The Definitive guide} \citep{rmarkdown2018}, the technical reference for all R Markdown output formats in the \textbf{rmarkdown} package and several other extension packages.
\item
  Part V (``Communicate'') of \emph{R for Data Science} \citep{wickham2016}. This part is less technical than the above ``Definitive Guide'', hence may be a gentler introduction to R Markdown
\item
  \emph{Dynamic Documents with R and knitr} \citep{knitr2015} provides a thorough introduction to the \textbf{knitr} package \citep{R-knitr} (note that R Markdown is only one of the document formats that \textbf{knitr} supports). If you want to read a shorter version, you may find Karl Broman's minimal tutorial \href{https://kbroman.org/knitr_knutshell/}{``knitr in a knutshell''} helpful.
\item
  \emph{bookdown: Authoring Books and Technical Documents with R Markdown} \citep{bookdown2016}: a short book as the official documentation of the \textbf{bookdown} package \citep{R-bookdown}, which is designed to simplify the creation of long-format documents in R Markdown.
\item
  \emph{blogdown: Creating Websites with R Markdown} \citep{blogdown2017} introduces how to create websites in R Markdown with the \textbf{blogdown} package \citep{R-blogdown} package.
\end{itemize}

Where relevant, this book provides references to these existing resources. By the way, the official R Markdown website also contains a lot of resources that you may find helpful: \url{https://rmarkdown.rstudio.com}.

You do not need to read this book in a particular order. Later chapters are not necessarily more challenging than previous chapters. The chapters and sections that we consider to be more advanced than others are marked with an asterisk (\texttt{*}) in their titles. It may be most efficient to read this book when you have some specific tasks in mind that you want to do with R Markdown, otherwise you can thumb through the table of contents and see if you are interested in any particular parts. We have tried to make each section and example as self-contained as possible, so you do not have to go back and forth among different parts of this book. In some cases, cross-referencing is unavoidable, and we will refer you to the background knowledge required to understand a certain example.

If you want to try the examples by yourself, the full source code of this book and examples are freely provided on GitHub at \url{https://github.com/yihui/rmarkdown-cookbook}. If you are reading the electronical version of this book, you may also just copy and paste the examples from the pages and run them in your favorite editor.

\hypertarget{structure-of-the-book}{%
\section*{Structure of the book}\label{structure-of-the-book}}


The book is broken down into small ``recipes'' that aim to demonstrate a single concept at a time. Chapter \ref{installation} provides instructions on how to install the necessary software tools. Chapter \ref{basics} gives an overview of how R Markdown works, and how to convert between R Markdown documents and R scripts. Chapter \ref{document-elements} tells you how to generate certain document elements, such as page breaks, bibliographies, numbered figures, animations, and diagrams, etc. Chapter \ref{formatting} shows how to format the content, such as adjusting the figure size and alignment. Chapter \ref{latex-output} introduces tips and tricks to those who only want LaTeX/PDF output. Similarly, Chapter \ref{html-output} is for HTML users, and Chapter \ref{word} is for Word users. If you want to produce output documents of multiple output formats (which is often tricky), you may find Chapter \ref{multi-formats} useful. Chapter \ref{chunk-options} shows some applications of \textbf{knitr}'s chunk options that you may not know. Chapter \ref{output-hooks} and Chapter \ref{chunk-hooks} are a little advanced, but should also be very useful because they show you the great power of being able to control \textbf{knitr}'s output and behavior with custom hook functions. Chapter \ref{knitr-misc} introduces a variety of \textbf{knitr} tricks. Chapter \ref{tables} is, to be honest, my least favorite chapter, but I know a lot of users really want to learn how to produce tables. I'm not an expert on fancy tables, but hope you will at least find the list of packages there helpful. Chapter \ref{other-languages} shows examples of using other languages in R Markdown, so you know R Markdown is not only for R. It also teaches you how to make \textbf{knitr} work with a new language that has not been supported yet. Chapter \ref{managing-projects} introduces tips on managing projects related to R Markdown. Chapter \ref{workflow} presents some tips on enhancing your workflow.

The recipes in this book are usually independent to each other, so you can pick up any one to read if you do not have a specific goal in mind.

\hypertarget{software-info}{%
\section*{Software information and conventions}\label{software-info}}


The R session information used when compiling this book is as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{session_info}\NormalTok{(}\KeywordTok{c}\NormalTok{(}
  \StringTok{'bookdown'}\NormalTok{, }\StringTok{'knitr'}\NormalTok{, }\StringTok{'rmarkdown'}\NormalTok{, }\StringTok{'xfun'}
\NormalTok{), }\DataTypeTok{dependencies =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 3.6.1 (2019-07-05)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18362), RStudio 1.3.959
## 
## Locale:
##   LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252   
##   LC_MONETARY=English_United States.1252 LC_NUMERIC=C                          
##   LC_TIME=English_United States.1252    
## 
## Package version:
##   bookdown_0.20 knitr_1.29    rmarkdown_2.3 xfun_0.15    
## 
## Pandoc version: 2.7.3
\end{verbatim}

We do not add prompts (\texttt{\textgreater{}} and \texttt{+}) to R source code in this book, and we comment out the text output with two hashes \texttt{\#\#} by default, as you can see from the R session information above. This is for your convenience when you want to copy and run the code (the text output will be ignored since it is commented out). Package names are in bold text (e.g., \textbf{rmarkdown}), and inline code and filenames are formatted in a typewriter font (e.g., \texttt{knitr::knit(\textquotesingle{}foo.Rmd\textquotesingle{})}). Function names are followed by parentheses (e.g., \texttt{blogdown::serve\_site()}). The double-colon operator \texttt{::} means accessing an object from a package.

``Rmd'' is the filename extension of R Markdown files, and also an abbreviation of R Markdown in this book.

\hypertarget{acknowledgements}{%
\section*{Acknowledgements}\label{acknowledgements}}


As usual, first I want to thank my employer RStudio for giving me the freedom to work on this book. Since I started working on it, my weekly meeting time with my manager, Tareef Kawaf, was first reduced from 15 minutes to 5 minutes, and then the meetings were just canceled. I have heard from several friends that they have too many unbearable meetings in their institutions, which waste a lot of their time. In terms of managing distractions, one of them recently lamented, ``You may be able to mute Slack for five minutes, but can you possibly mute it for \emph{a whole day}?'' ``Of course, I can!'' I told her. I can probably mute it for a whole month if I like. Do not get me wrong---I do not mean Tareef or my colleagues are distractions. I only mean how much freedom they can offer me.

I came up with the idea of writing this cookbook after I published the \emph{R Markdown Definitive Guide}, but ideas are often cheap. It is the execution that is hard and expensive. If it were not for \href{http://mikeyharper.uk}{Michael Harper's} initial pushing, I would never start working on it seriously. Christophe Dervieux has always been around whenever I need help. He used his R and R Markdown skills to build a dashboard (with the \textbf{flexdashboard} package) to guide me to the potentially interesting and useful topics to write on. Meanwhile, he has also helped me in numerous other GitHub issues, so I could have more time for writing the book, instead of spending whole days on wrestling with bug reports that did not have minimal reproducible examples attached. Similarly, several people have been helping with answering R Markdown questions on Stack Overflow, including Martin Schmelzer, Marcel Schilling, and Ralf Stubner, etc. Perhaps their intention is not to save me time, but their effort did save me a lot of time. Recently Johannes Friedrich also came to my attention on Stack Overflow, after a few times when I opened a new Stack Overflow question only to find it already answered by him.

David Keyes saved my life in Section \ref{table-other}, since he had written \href{https://rfortherestofus.com/2019/11/how-to-make-beautiful-tables-in-r/}{a wonderful blog post} to introduce several R packages to create tables, with which I was not very familiar. Other online materials that have helped me a lot include: Holtz Yan's \href{https://holtzy.github.io/Pimp-my-rmd/}{post on some R Markdown tips,} Nicholas Tierney's book \href{https://rmd4sci.njtierney.com}{``R Markdown for Scientists'',} MaÃ«lle Salmon's \href{https://github.com/maelle/rmd_course_isglobal}{R Markdown course,} Jennifer Thompson's \href{https://github.com/jenniferthompson/RepResearchRMarkdown}{R Markdown course,} Emi Tanaka's \href{https://github.com/emitanaka/combine2019}{R Markdown workshop} Alison Hill's \href{https://arm.rbind.io}{R Markdown workshop} (co-taught with me), and Alison Hill and Emi Tanaka's \href{https://ysc-rmarkdown.netlify.app}{R Markdown workshop.}

Many people have made contributions in the GitHub repository of this book by either sending pull requests or filing issues, including Maria Bekker-Nielsen Dunbar, Nathan Eastwood, Johannes Friedrich, Xiangyun Huang, Florian Kohrt, Romain Lesur, Jiaxiang Li, Song Li, Ulrik Lyngs, Matt Small, Jake Stephen, Atsushi Yasumoto, Hao Zhu, and John Zobolas.

\begin{flushright}

Yihui Xie\\
Elkhorn, Nebraska

\end{flushright}

\hypertarget{author}{%
\chapter*{About the Authors}\label{author}}


Yihui typed out most of the words in this book, which is the only justification for him to be the ``first'' author. Christophe has made substantial contribution to this book by helping Yihui organize all the GitHub issues and occasionally writing a few sections. Emily was originally a reviewer of this book. Since Yihui was not patient enough to deal with her lengthy comments, he invited her to become a co-author of this book (out of revenge) to feel his pain of having to deal with so many additional things when he thought he was pretty much done! Just kidding\ldots{} No, he invited her out of full appreciation, because her comments were so helpful, yet Yihui lacked the time to do all the improvements that she suggested.

When you see the pronoun ``I'' in this book, it refers to Yihui. Using ``I'' instead of ``We'' does not mean the co-authors were forgotten, but Yihui wanted to express certain opinions completely of his own. He certainly wants to appear smart, but in case he is actually silly, he wants to be silly alone.

\hypertarget{yihui-xie}{%
\section*{Yihui Xie}\label{yihui-xie}}


Yihui Xie (\url{https://yihui.org}) is a software engineer at RStudio (\url{https://www.rstudio.com}). He earned his PhD from the Department of Statistics, Iowa State University. He is interested in interactive statistical graphics and statistical computing. As an active R user, he has authored several R packages, such as \textbf{knitr}, \textbf{bookdown}, \textbf{blogdown}, \textbf{xaringan}, \textbf{tinytex}, \textbf{rolldown}, \textbf{animation}, \textbf{DT}, \textbf{tufte}, \textbf{formatR}, \textbf{fun}, \textbf{xfun}, \textbf{testit}, \textbf{mime}, \textbf{highr}, \textbf{servr}, and \textbf{Rd2roxygen}, among which the \textbf{animation} package won the 2009 John M. Chambers Statistical Software Award (ASA). He also co-authored a few other R packages, including \textbf{shiny}, \textbf{rmarkdown}, \textbf{pagedown}, and \textbf{leaflet}.

He has authored two books, \emph{Dynamic Documents with knitr} \citep{knitr2015}, and \emph{bookdown: Authoring Books and Technical Documents with R Markdown} \citep{bookdown2016}, and co-authored two books, \emph{blogdown: Creating Websites with R Markdown} \citep{blogdown2017}, and \emph{R Markdown: The Definitive Guide} \citep{rmarkdown2018}.

In 2006, he founded the Capital of Statistics (\url{https://cosx.org}), which has grown into a large online community on statistics in China. He initiated the Chinese R conference in 2008, and has been involved in organizing R conferences in China since then. During his PhD training at Iowa State University, he won the Vince Sposito Statistical Computing Award (2011) and the Snedecor Award (2012) in the Department of Statistics.

He usually reads Twitter messages once a week (\url{https://twitter.com/xieyihui}), and most of the time you can find him on GitHub (\url{https://github.com/yihui}).

He has four hobbies: reading, writing, cooking, and playing badminton. He is actually more interested in cooking than eating, but he really loves eating spicy food. When being asked ``how spicy you want your food to be'' in the restaurant, he usually answers ``as spicy as your chef can make it to be.''

\hypertarget{christophe-dervieux}{%
\section*{Christophe Dervieux}\label{christophe-dervieux}}


Christophe Dervieux is an active member of the R community, currently living in France. With a Master's degree in Energy and Economics, he started working with R as an analyst doing economic studies about market designs, before becoming a developer advocate and R admin, promoting R and supporting R users where he works.

He is interested in helping others get the most from R, and you can find him wandering in RStudio Community as a sustainer, or on several GitHub issue boards for various R packages. In both places, you may better recognize him by his shorter handle ``cderv''.

As an R developer, he is a contributor to several R packages, such as \textbf{bookdown}, \textbf{rmarkdown}, and \textbf{knitr}. He has also co-authored the \textbf{crrri} package. His own projects can be found on GitHub (\url{https://github.com/cderv}), and sometimes he shares his ideas on Twitter (\url{https://twitter.com/chrisderv}).

He does not like spicy food, but he enjoys playing badminton every week.

\hypertarget{emily-riederer}{%
\section*{Emily Riederer}\label{emily-riederer}}


Emily Riederer works in data science for the consumer finance industry where she leads a team to build analysis tools in R and cultivate an open science culture in industry. Previously, she studied Mathematics and Statistics at the University of North Carolina at Chapel Hill.

Emily frequently discusses R on Twitter (\url{https://twitter.com/emilyriederer}) and her blog (\url{https://emilyriederer.netlify.app/}) and shared projects, including her \textbf{projmgr} R package, on GitHub (\url{https://github.com/emilyriederer}). She has also served as a package reviewer for rOpenSci and a founding co-organizer of the annual satRday Chicago R conference.

Emily's other interests include reading and weightlifting. She thinks she likes spicy food, but since she has only ever lived in the United States, she's been told that she does not really know what that actually means.

\mainmatter

\hypertarget{installation}{%
\chapter{Installation}\label{installation}}

To use R Markdown, you have to install R \citep{R-base} and the R package \textbf{rmarkdown} \citep{R-rmarkdown}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install the rmarkdown package from CRAN in R}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"rmarkdown"}\NormalTok{)}

\CommentTok{# or install from GitHub if you want to test the development version}
\ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{requireNamespace}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\NormalTok{remotes}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"rstudio/rmarkdown"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Unless you have a favorite editor or IDE (Integrated Development Environment), we recommend that you also install the RStudio IDE (\url{https://www.rstudio.com}). RStudio is not required, but it will make it easier for an average user to work with R Markdown because of the strong editor support. If you choose not to use the RStudio IDE, you will need to install Pandoc\index{Pandoc} (see Section \ref{install-pandoc}), which is the tool used by \textbf{rmarkdown} to convert Markdown to other document formats.

If you need to create PDF output, you may need to install LaTeX (Section \ref{install-latex}) and certain LaTeX packages (Section \ref{install-latex-pkgs}).

\hypertarget{install-pandoc}{%
\section{Use a Pandoc version not bundled with the RStudio IDE}\label{install-pandoc}}

The RStudio IDE has bundled a version of Pandoc, so you do not need to install Pandoc by yourself if you are using the RStudio IDE. However, the bundled version is often not the latest, or may not be the exact version that you want. You can choose to install a separate copy of Pandoc by yourself. Please keep in mind that the bundled version may be more thoroughly tested with R Markdown because most RStudio users may just use the bundled version. If you want to go with a different version (especially a higher version), you might run into problems that have not been discovered by other R Markdown users or developers.

There are detailed instructions on how to install Pandoc on different platforms on the Pandoc website at \url{https://pandoc.org/installing.html}. If you have installed Pandoc by yourself and want to use that specific version, you may inform the \textbf{rmarkdown} package by calling the function \texttt{rmarkdown::find\_pandoc()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# to find a specific version}
\NormalTok{rmarkdown}\OperatorTok{::}\KeywordTok{find_pandoc}\NormalTok{(}\DataTypeTok{version =} \StringTok{"2.9.1"}\NormalTok{)}

\CommentTok{# to find Pandoc under a specific directory}
\NormalTok{rmarkdown}\OperatorTok{::}\KeywordTok{find_pandoc}\NormalTok{(}\DataTypeTok{dir =} \StringTok{"~/Downloads/Pandoc"}\NormalTok{)}

\CommentTok{# ignore the previously found Pandoc and search again}
\NormalTok{rmarkdown}\OperatorTok{::}\KeywordTok{find_pandoc}\NormalTok{(}\DataTypeTok{cache =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

As you can see in the above code chunk, there are several ways to find a version of Pandoc. By default, \texttt{rmarkdown::find\_pandoc()} tries to find the highest version of Pandoc in your system. Once found, the version information is cached, and you can invalidate the cache with \texttt{cache\ =\ FALSE}. Please see the help page \texttt{?rmarkdown::find\_pandoc} for the potential directories under which the \texttt{pandoc} executable may be found.

This function can be called either inside or outside an Rmd document. If you want an Rmd document to be compiled by a specific version of Pandoc installed on your computer, you may call this function in any code chunk in the document, e.g., in a setup chunk:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, setup, include=FALSE\}}
\BaseNTok{rmarkdown::find_pandoc(version = '2.9.1')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{install-latex}{%
\section{Install LaTeX (TinyTeX) for PDF reports}\label{install-latex}}

If you would like to create PDF documents from R Markdown, you will need to have a LaTeX distribution installed. Although there are several traditional options including MiKTeX, MacTeX, and TeX Live, we recommend that R Markdown users install \href{https://yihui.org/tinytex/}{TinyTeX}.

TinyTeX is a custom LaTeX distribution based on TeX Live that is small in size (150Mb on macOS/Linux and 220Mb on Windows when installed) but functions well in most cases, especially for R users. Installing or running TinyTeX does not require sysadmin privileges.\footnote{Actually, we recommend that you \textbf{do not} use your root privilege (i.e., \texttt{sudo}) to install TinyTeX on Linux or macOS, if you are the only user of your system.} You can install TinyTeX with the R package \textbf{tinytex} \citep{R-tinytex}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{install_tinytex}\NormalTok{()}
\CommentTok{# to uninstall TinyTeX, run tinytex::uninstall_tinytex()}
\end{Highlighting}
\end{Shaded}

Please note that ``\textbf{tinytex}'' refers to the R package, and ``TinyTeX'' refers to the LaTeX distribution. There are two advantages of using TinyTeX:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  TinyTeX is lightweight (compared to other LaTeX distributions), cross-platform, and portable. For example, you can store a copy of TinyTeX on your USB drive or other portable devices, and use it on other computers with the same operating system.
\item
  When R Markdown is converted to PDF, Pandoc converts Markdown to an intermediate LaTeX document first. The R package \textbf{tinytex} has provided helper functions to compile LaTeX documents to PDF (the main function is \texttt{tinytex::latexmk()}). If you use TinyTeX and certain LaTeX packages are required but not installed, \textbf{tinytex} will try to automatically install them for you. It will also try to compile the LaTeX file for a sufficient number of times to make sure all cross-references are resolved.
\end{enumerate}

If you are interested in the technical details, you may check out the article \citet{tinytex2019} and the FAQ page at \url{https://yihui.org/tinytex/faq/}.

\hypertarget{install-latex-pkgs}{%
\section{Install missing LaTeX packages}\label{install-latex-pkgs}}

When you compile a document to PDF through LaTeX, you may run into errors like these:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{! LaTeX Error: File `ocgbase.sty' not found.}

\NormalTok{!pdfTeX error: pdflatex (file 8r.enc):}
\NormalTok{  cannot open encoding file for reading}

\NormalTok{!pdfTeX error: /usr/local/bin/pdflatex (file tcrm0700):}
\NormalTok{  Font tcrm0700 at 600 not found}
\end{Highlighting}
\end{Shaded}

If you are using TinyTeX as introduced in Section \ref{install-latex}, usually you do not need to deal with such errors since \textbf{tinytex} will automatically deal with them, but if you run into such errors anyway, it is still easy to install the missing LaTeX package(s) via \texttt{tinytex::parse\_install()}. This function takes the path of the LaTeX log file as the input, tries to figure out the missing packages automatically, and install them if they are found on CTAN (the Comprehensive TEX Archive Network, \url{https://ctan.org}). The LaTeX log file typically has the same base name as your input document, and has an extension \texttt{.log}. If you cannot find this log file, you can pass the error message to the \texttt{text} argument of this function. Both ways should work:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# if the log file is filename.log}
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{parse_install}\NormalTok{(}\StringTok{"filename.log"}\NormalTok{)}

\CommentTok{# or use the `text` argument}
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{parse_install}\NormalTok{(}
  \DataTypeTok{text =} \StringTok{"! LaTeX Error: File `ocgbase.sty' not found."}
\NormalTok{)}
\CommentTok{# it will install the "ocgx2" package}
\end{Highlighting}
\end{Shaded}

If you do not use TinyTeX, the R package \textbf{tinytex} can still help you figure out the LaTeX package names from the error log---use the function \texttt{tinytex::parse\_packages()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# if the log file is filename.log}
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{parse_packages}\NormalTok{(}\StringTok{"filename.log"}\NormalTok{)}

\CommentTok{# or use the `text` argument}
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{parse_packages}\NormalTok{(}
  \DataTypeTok{text =} \StringTok{"! LaTeX Error: File `ocgbase.sty' not found."}
\NormalTok{)}
\CommentTok{# it should return "ocgx2"}
\end{Highlighting}
\end{Shaded}

Once you know the package names, you can install them with the package manager of your LaTeX distribution.

If you are using MiKTeX instead, it can also install missing packages automatically. During the installation of MiKTeX, be sure to check the setting ``Always install missing packages on-the-fly''. If you have already install it without this setting, \href{https://github.com/rstudio/rmarkdown/issues/1285\#issuecomment-374340175}{you can still change it in the MiKTeX Console.}

\hypertarget{conceptual-overview}{%
\chapter{Conceptual Overview}\label{conceptual-overview}}

The goal of this text is to showcase many tips and tracks for getting the most value from R Markdown. The following chapters demonstrate techniques to write more efficient and succinct code and to customize your output. Before we begin, it may be helpful to understand just a bit more about how R Markdown works, to help you to understand, remember, apply, and ``remix'' these tricks. In this section, we provide a brief overview of the process of knitting a document and the key ``levers to pull'' to change the output. This material is not necessary to understand the subsequent chapters (so feel free to skip ahead!), but it may help you to build a richer mental model for how all the pieces fit together.

\hypertarget{rmarkdown-process}{%
\section{What happens when we render?}\label{rmarkdown-process}}

R Markdown combines several different processes together to create documents, and one of the main sources of confusion from R Markdown is how all the components work together.\footnote{Allison Horst has created an amusing artwork that describes the R Markdown process as wizardry: \url{https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/rmarkdown_wizards.png}.} Fortunately, as a user, it is not essential to understand all the inner workings of these processes to be able to create documents. However, as a user who may be seeking to alter the behavior of a document, it is important to understand which component is responsible for what. This makes it a lot easier to seek help as you can target your searches on the correct area.

The basic workflow structure for an R Markdown document is shown in Figure \ref{fig:rmdworkflow}, highlighting the steps (arrows) and the intermediate files that are created before producing the output. The whole process is implemented via the function \texttt{rmarkdown::render()}. Each stage is explained in further detail below.

\begin{figure}
\includegraphics[width=1\linewidth]{images/workflow} \caption{A diagram illustrating how an R Markdown document is converted to the final output document.}\label{fig:rmdworkflow}
\end{figure}

The \texttt{.Rmd} document is the original format of the document. It contains a combination of YAML (metadata), text (narratives), and code chunks.

First, the \texttt{knit()} function in \textbf{knitr} is used to execute all code embedded within the \texttt{.Rmd} file, and prepare the code output to be displayed within the output document. All these results are converted into the correct markup language to be contained within the temporary \texttt{.md} file.

Then the \texttt{.md} file is processed by \href{https://pandoc.org}{Pandoc}, a multipurpose tool designed to convert files from one markup language to another. It takes any parameters specified within the YAML frontmatter of the document (e.g., \texttt{title}, \texttt{author}, and \texttt{date}) to convert the document to the output format specified in the \texttt{output} parameter (such as \texttt{html\_document} for HTML output).

If the output format is PDF, there is an additional layer of processing, as Pandoc will convert the intermediate \texttt{.md} file into an intermediate \texttt{.tex} file. This file is then processed by \href{https://www.latex-project.org}{LaTeX} to form the final PDF document. As we mentioned in Section \ref{install-latex}, the \textbf{rmarkdown} package calls the \texttt{latexmk()} function in the \textbf{tinytex} package \citep{R-tinytex}, which in turn calls LaTeX to compile \texttt{.tex} to \texttt{.pdf}.

In short, \texttt{rmarkdown::render()} = \texttt{knitr::knit()} + Pandoc (+ LaTeX for PDF output only).

Robin Linacre has written a nice summary of the relationship between R Markdown, \textbf{knitr}, and Pandoc at \url{https://stackoverflow.com/q/40563479/559676}, which contains more technical details than the above overview.

Note that not all R Markdown documents are eventually compiled through Pandoc. The intermediate \texttt{.md} file could be compiled by other Markdown renderers. Below are two examples:

\begin{itemize}
\item
  The \textbf{xaringan} package \citep{R-xaringan} passes the \texttt{.md} output to a JavaScript library, which renders the Markdown content in the web browser.
\item
  The \textbf{blogdown} package \citep{R-blogdown} supports the \texttt{.Rmarkdown} document format, which is knitted to \texttt{.markdown}, and this Markdown document is usually rendered to HTML by an external site generator.
\end{itemize}

\hypertarget{rmarkdown-anatomy}{%
\section{R Markdown anatomy}\label{rmarkdown-anatomy}}

We can dig one level deeper by considering the different components of an RMarkdown. Specifically, let's look at when and how these are altered during the rendering workflow.

\hypertarget{yaml-metadata}{%
\subsection{YAML metadata}\label{yaml-metadata}}

The YAML metadata (also called the YAML header) is processed in many stages of the rendering process and can influence the final document in many different ways. It is read by each of Pandoc, \textbf{rmarkdown}, and \textbf{knitr}. Along the way, the information it contains can effect the code, content, and the rendering process.

A typical YAML header looks like this, containing basic metadata about the document and rendering instructions:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ My R Markdown Report}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ Yihui Xie}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_document}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

In this case, the \texttt{title} and \texttt{author} fields are processed by Pandoc to set the values of template variables. With the default template, the title and author information will appear at the beginning of the resulting document. More details on how Pandoc uses information from the YAML header are included in the Pandoc Manual's section on the \href{https://pandoc.org/MANUAL.html\#extension-yaml_metadata_block}{YAML metadata block.}

In contrast, the \texttt{output} field is used by \textbf{rmarkdown} to apply the function \texttt{rmarkdown::html\_document()} in the rendering process. We can further influence the rendering process by passing arguments to the rendering function that we are specifying in \texttt{output}. For example, writing:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{toc}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{    }\FunctionTok{toc_float}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\end{Highlighting}
\end{Shaded}

is the equivalent of telling \texttt{rmarkdown::render()} to apply the \texttt{rmarkdown::html\_document()} with the arguments to \texttt{toc} and \texttt{toc\_float} set to \texttt{TRUE}. To find out what these options do, and to learn about other possible options, you may run \texttt{?rmarkdown::html\_document} in your R console and read the help page. Note that \texttt{output:\ html\_document} is equivalent to \texttt{output:\ rmarkdown::html\_document}. When an output format does not have a qualifier like \texttt{rmarkdown::}, it is assumed that it is from the \textbf{rmarkdown} package, otherwise it must be prefixed with the R package name, e.g., \texttt{bookdown::html\_document2}.

The YAML header can also influence our content and code if we choose to use parameters in YAML, as described in Section \ref{parameterized-reports}. In short, we can include variables and R expressions in this header that can be referenced throughout our R Markdown document. For example, the following header defines \texttt{start\_date} and \texttt{end\_date} parameters, which will be reflected in a list called \texttt{params} later in the R Markdown document. Thus, if we want to use these values in our R code, we can access them via \texttt{params\$x} and \texttt{params\$y}.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ My RMarkdown}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ Yihui Xie}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_document}
\FunctionTok{params}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{start_date}\KeywordTok{:}\AttributeTok{ }\StringTok{'2020-01-01'}
\AttributeTok{  }\FunctionTok{end_date}\KeywordTok{:}\AttributeTok{ }\StringTok{'2020-06-01'}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\hypertarget{narrative}{%
\subsection{Narrative}\label{narrative}}

The narrative textual elements of R Markdown may be simpler to understand than the YAML metadata and code chunks. Typically, this will feel quite a bit like writing in a text editor. However, this Markdown content can be more powerful and interesting than simple text---both in how its content is made, and how the document structure is made from it.

While much of our narrative is human-written, many R Markdown documents will likely wish to reference the code and analysis being used. For this reason, Chapter \ref{document-elements} demonstrates the many ways that code can help generate parts of the text, such as combining words into a list (Section \ref{combine-words}) or writing a bibliography (Section \ref{bibliography}). This conversion is handled by \textbf{knitr} as we convert from \texttt{.Rmd} to \texttt{.md}.

Our Markdown text can also provide structure to the document. While we do not have enough space here to review the Markdown syntax,\footnote{Instead, for a review of the Markdown syntax, please see \url{https://bookdown.org/yihui/bookdown/markdown-syntax.html}.} one particularly relevant concept is section headers, which are denoted by one or more hashes (\texttt{\#}) corresponding to different levels, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# First-level header}

\FunctionTok{## Second-level header}

\FunctionTok{### Third-level header}
\end{Highlighting}
\end{Shaded}

These headers give structure to our entire document as \textbf{rmarkdown} converts the \texttt{.md} to our final output format. This structure is useful for referencing and formatting these sections by appending certain attributes to them. To create such references, Pandoc syntax allows us to provide a unique identifier by following the header notation with \texttt{\{\#id\}}, or attach one or more classes to a section with \texttt{\{.class-name\}}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{## Second-level header \{#introduction .important .large\}}
\end{Highlighting}
\end{Shaded}

We can them access this section with many of the tools that you will learn by referencing it by its ID or class. As examples, Section \ref{cross-ref} demonstrates how to use section ID to make cross-references throughout your document, and Section \ref{html-tabs} introduces the \texttt{.tabset} class to help reorganize subsections.

The final interesting type of content that we might find in the textual part of our R Markdown is raw content written specifically for our desired output format, e.g., raw LaTeX code for LaTeX output (\ref{raw-latex}), raw HTML code for HTML output, and so on (Section \ref{raw-content}). Raw content may help you achieve things that cannot be done with plain Markdown, but please keep in mind that it is usually ignored when the output format is a different format, e.g., raw LaTeX commands in Markdown will be ignored when the output format is HTML.

\hypertarget{code-chunks}{%
\subsection{Code chunks}\label{code-chunks}}

Code chunks are the beating heart of our R Markdown. The code in these chunks is run by \textbf{knitr}, and its output is translated to Markdown to dynamically keep our reports in-sync with our current scripts and data. Each code chunk consists of a language engine (Chapter \ref{other-languages}), an optional label, chunk options (Chapter \ref{chunk-options}), and code.

To understand some of the modifications that we can make to code chunks, it is worth understanding the \textbf{knitr} process in slightly more detail. For each chunk, a \textbf{knitr} language engine gets three pieces of input: the knitting environment (\texttt{knitr::knit\_global()}), the code input, and a list of chunk options. It returns the formatted representations of the code as well as its output. As a side-effect, the knitting environment may also be modified, e.g., new variables may have been created in this environment via the source code in the code chunk. This process is illustrated in Figure \ref{fig:knitr-workflow}.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{rmarkdown-cookbook_files/figure-latex/knitr-workflow-1} 

}

\caption{A flowchart of inputs and outputs to a language engine.}\label{fig:knitr-workflow}
\end{figure}

We can modify this process by:

\begin{itemize}
\item
  changing our language engine;
\item
  modifying chunk options, which can be global, local, or engine-specific;
\item
  and by using hooks (Chapter \ref{output-hooks} and Chapter \ref{chunk-hooks}) to further process the these inputs and outputs.
\end{itemize}

For example, in Section \ref{hook-hide}, you will learn how to add a hook to post-process the code output to redact certain lines in the source code.

Code chunks also have analogous concepts to the classes and unique identifiers that we explored for narratives in Section \ref{narrative}. A code chunk can specify an optional identifier (often called the ``chunk label'') immediately after its language engine. It can set classes for code and text output blocks in the output document via the chunk options \texttt{class.source} and \texttt{class.output}, respectively. For example, the chunk header \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\ summary-stats,\ class.output\ =\ \textquotesingle{}large-text\textquotesingle{}\}} gives this chunk a label \texttt{summary-stats}, and the class \texttt{large-text} for the text output blocks. A chunk can have only one label, but can have multiple classes.

\hypertarget{document-body}{%
\subsection{Document body}\label{document-body}}

One important thing to understand when authoring and modifying a document is how code and narrative pieces create different sections, or containers within the document. For example, suppose we have a document that looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Title}

\FunctionTok{## Section x}

\NormalTok{This is my introduction.}

\BaseNTok{```\{r chunk-x\}}
\BaseNTok{x <- 1}
\BaseNTok{print(x)}
\BaseNTok{```}

\FunctionTok{### Subsection 1}

\NormalTok{Here are some details.}

\FunctionTok{### Subsection 2}

\NormalTok{These are more details.}

\FunctionTok{## Section y}

\NormalTok{This is another section.}

\BaseNTok{```\{r chunk-y\}}
\BaseNTok{y <- 2}
\BaseNTok{print(y)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

When writing this document, we likely think of each piece as linear with independent sections of text and code following in a sequence one after the other. However, what we are actually doing is creating a set of nested containers which conceptually\footnote{In reality, there are many more containers than shown. For example, for a knitted code chunk, the code and output exist in separate containers which share a common parent.} looks more like Figure \ref{fig:rmd-containers}.

\begin{figure}

{\centering \includegraphics[width=0.5\linewidth]{rmarkdown-cookbook_files/figure-latex/rmd-containers-1} 

}

\caption{A simple R Markdown document illustrated as a set of nested containers.}\label{fig:rmd-containers}
\end{figure}

Two key features of this diagram are (1) every section of text or code is its own discrete container, and (2) containers can be nested within one another. This nesting is particularly apparent if you are authoring your R Markdown document in the RStudio IDE and expand the document outline.

Note that in Figure \ref{fig:rmd-containers}, headers of the same level represent containers at the same level of nesting. Lower-level headers exist inside of the container of higher-level headers. In this case, it is common to call the higher-level sections the ``parent'' and the minor sections the ``child.'' For example, a subsection is the child of a section. Besides headers, you can also create divisions in your text using \texttt{:::}, as demonstrated in Section \ref{multi-column}.

This structure has important implications as we attempt to apply some of the formatting and styling options that are described in this text. For example, we will see this nested structure when we learn about how Pandoc represents our document as an abstract syntax tree (Section \ref{lua-filters}), or when we use CSS selectors (Section \ref{html-css}, among others) to style our HTML output.

Formatting and styling can be applied to either containers of similar types (e.g., all code blocks), or all containers that exist inside of another container (e.g., everything under ``Section y''). Additionally, as explained in Section \ref{narrative}, we can apply the same classes to certain sections to designate them as being similar, and in this case, the common class names denote the common properties or intent of these sections.

As you read through this cookbook, it may be useful to quiz yourself and think about what sort of container the specific ``recipe'' is acting upon.

\hypertarget{what-to-change}{%
\section{What can we change to change the results?}\label{what-to-change}}

Let's summarize what we have seen so far and preview what is to come.

Rendering R Markdown documents with \textbf{rmarkdown} consists of converting \texttt{.Rmd} to \texttt{.md} with \textbf{knitr}, and then \texttt{.md} to our desired output with Pandoc (typically).

The \texttt{.Rmd} to \texttt{.md} step handles the execution and ``translation'' of all code within our report, so most changes to \emph{content} involve editing the \texttt{.Rmd} with code for \textbf{knitr} to translate. Tools that we have to control over these steps include \textbf{knitr} chunk options and hooks.

Our \texttt{.md} is a plain text file with no formatting. This is where Pandoc comes in to convert to the final output format such as HTML, PDF, or Word. Along the way, we add structure and style. A wide range of tools to help us in this process include style sheets (CSS), raw LaTeX or HTML code, Pandoc templates, and Lua filters. By understanding the nested structure of an R Markdown document, and by thoughtfully using identifiers and classes, we can apply some of these tools selectively to targeted parts of our output.

Finally, our YAML metadata may help us toggle any of these steps. Changing parameters can change how our code runs, changing metadata alters the text content, and changing output options provides the \texttt{render()} function with a different set of instructions.

Of course, these are all rough heuristics and should not be taken as absolute facts. Ultimately, there is not a completely clear division of labor. Throughout this book, you will see that there are often multiple valid paths to achieving many of the outcomes described in this book, and these may enter different stages of the pipeline. For example, for the simple task of inserting in image in your document, you may either use the R code \texttt{knitr::include\_graphics()}, which would execute in the \texttt{.Rmd} to \texttt{.md} stage, or directly use Markdown syntax (\texttt{!{[}{]}()}). This may seem confusing, and sometimes different approaches will have different advantages. However, do not be concerned---if anything, this often means there are many valid ways to solve your problem, and you can follow whichever approach that makes the most sense to you.

And that's that! In the rest of the book, you can now color in this rough sketch with many more concrete examples of ways to modify all of the components that we have discussed to get the most value out of R Markdown.

\hypertarget{basics}{%
\chapter{Basics}\label{basics}}

In this chapter, we present some key concepts about R Markdown. First, we introduce the basic components of an R Markdown document: the prose and code. Next, we show how to convert R Markdown documents to R scripts, and vice versa.

For those seeking lower-level basics, please read Chapter 2 of the R Markdown Definitive Guide \citep{rmarkdown2018}.

\hypertarget{r-code}{%
\section{Code chunks and inline R code}\label{r-code}}

An R Markdown document consists of intermingled prose (narratives) and code. There are two types of code in an Rmd document: code chunks, and inline R code. Below is a quick example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{x <- 5  # radius of a circle}
\BaseNTok{```}

\NormalTok{For a circle with the radius }\BaseNTok{`r x`}\NormalTok{,}
\NormalTok{its area is }\BaseNTok{`r pi * x^2`}\NormalTok{.}
\end{Highlighting}
\end{Shaded}

A code chunk usually starts with \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{\}} and ends with \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}}. You can write any number of lines of code in it. Inline R code is embedded in the narratives of the document using the syntax \texttt{\textasciigrave{}r\ \textasciigrave{}}. In the above example, we defined a variable \texttt{x} in a code chunk, which is the radius of a circle, and calculated its area in the next paragraph.

You can customize the behavior and output of code chunks through chunk options (provided inside the curly brackets \texttt{\{\}}). You will find several examples in Chapter \ref{chunk-options}. You may write code of other languages in code chunks, too (see Chapter \ref{other-languages}).

\hypertarget{remedy}{%
\section{Writing Markdown with the remedy package}\label{remedy}}

If you are not very familiar with Markdown yet, we recommend that you try the \textbf{remedy} package (\url{https://github.com/ThinkR-open/remedy}), which has provided a series of RStudio addins to help you write Markdown content by clicking the addins. A GIF animation is worth a thousand words. Please check out its homepage for many GIFs that quickly shows you what this package can do.

\hypertarget{spin}{%
\section{Render an R script to a report}\label{spin}}

Even if you are a long-time R Markdown user, you may have missed another possibility. Dean Attali called it \href{https://deanattali.com/2015/03/24/knitrs-best-hidden-gem-spin/}{``\textbf{knitr}'s best hidden gem''}. That is, you can render a pure R script to a report directly. If you use the RStudio IDE, the keyboard shortcut to render R scripts is the same as when you knit Rmd documents (\texttt{Ctrl\ /\ Cmd\ +\ Shift\ +\ K}).

When rendering an R script to a report, the function \texttt{knitr::spin()} is called to convert the R script to an Rmd file first. This function is what Dean Attali called \textbf{knitr}'s best hidden gem. You will see all text and graphical output in the report.

If you want granular control over the elements in the report, below are a few syntax rules to help you:

\begin{itemize}
\item
  Roxygen comments will be treated as normal text. A roxygen comment is an R comment that starts with \texttt{\#\textquotesingle{}}. This can help you write narratives in your report. You can use any Markdown syntax in the comments.
\item
  A comment starting with \texttt{\#+} is treated as the \textbf{knitr} chunk header. For example, \texttt{knitr::spin()} will translate the comment \texttt{\#+\ label,\ fig.width=5} to the chunk header \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\ label,\ fig.width=5\}} in R Markdown.
\item
  R code of the form \texttt{\{\{\ code\ \}\}} is translated to an inline R expression in R Markdown. Please note that \texttt{\{\{\ code\ \}\}} must be on its own line.
\item
  The YAML frontmatter can be written in the beginning of the R script in roxygen comments, too. Please watch out the indentation in YAML fields. It is very important. If you omit the indentation, the data structure expressed in your YAML will be different and incorrect. For example, the field \texttt{keep\_tex:\ true} should be indented for two more spaces under \texttt{pdf\_document} in the example below.
\item
  Any text between \texttt{/*} and \texttt{*/} will be ignored (i.e., they are treated as true comments).
\end{itemize}

Below is a full example illustrating the above rules:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' ---}
\CommentTok{#' title: "A report generted from a pure R script"}
\CommentTok{#' output:}
\CommentTok{#'   pdf_document:}
\CommentTok{#'     keep_tex: true}
\CommentTok{#' ---}
\CommentTok{#'}
\CommentTok{#' This is a report generated by `knitr::spin()`.}
\CommentTok{#'}
\CommentTok{#' Let's try some **knitr** options:}

\CommentTok{#+ echo=FALSE, fig.width=7}
\CommentTok{#  This is a normal R comment.}
\KeywordTok{plot}\NormalTok{(cars)}

\CommentTok{#' Now write an inline value. We know the value of $\textbackslash{}pi$ is}
\NormalTok{\{\{ pi \}\}}
\CommentTok{#' .}
\CommentTok{#'}
\CommentTok{#' Finally please note that all roxygen comments are}
\CommentTok{#' optional. You do not need chunk options, either,}
\CommentTok{#' unless you want more control over the output}
\CommentTok{#' elements such as the size of plots.}

\CommentTok{# /* Write comments between /* and */ like C comments:}
\KeywordTok{Sys.sleep}\NormalTok{(}\DecValTok{60}\NormalTok{)}
\CommentTok{# */}
\end{Highlighting}
\end{Shaded}

When this script is rendered to a report, \texttt{knitr::spin()} will convert it to R Markdown:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "A report generted from a pure R script"}
\NormalTok{output:}
\NormalTok{  pdf_document:}
\BaseNTok{    keep_tex: true}
\NormalTok{---}

\NormalTok{This is a report generated by }\BaseNTok{`knitr::spin()`}\NormalTok{.}

\NormalTok{Let's try some **knitr** options:}

\BaseNTok{```\{r echo=FALSE, fig.width=7\}}
\BaseNTok{#  This is a normal R comment.}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\NormalTok{Now write an inline value. We know the value of $\textbackslash{}pi$ is}
\NormalTok{`}\BaseNTok{`r  pi  `}\NormalTok{`}
\NormalTok{.}

\NormalTok{Finally please note that all roxygen comments are}
\NormalTok{optional. You do not need chunk options, either,}
\NormalTok{unless you want more control over the output}
\NormalTok{elements such as the size of plots.}
\end{Highlighting}
\end{Shaded}

This method of generating reports can be particularly useful when you primarily work with R scripts and do not need a lot of narratives. If the proportion of text is substantial in your report, R Markdown may be a better choice, because you do not need to put all text in roxygen comments.

\hypertarget{purl}{%
\section{Convert R Markdown to R script}\label{purl}}

When you want to extract all R code from an R Markdown document, you can call the function \texttt{knitr::purl()}. Below is a simple Rmd example with the filename \texttt{purl.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Use }\BaseNTok{`purl()`}\NormalTok{ to extract R code}
\NormalTok{---}

\NormalTok{The function }\BaseNTok{`knitr::purl()`}\NormalTok{ extracts R code chunks from}
\NormalTok{a **knitr** document and save the code to an R script.}

\NormalTok{Below is a simple chunk:}

\BaseNTok{```\{r, simple, echo=TRUE\}}
\BaseNTok{1 + 1}
\BaseNTok{```}

\NormalTok{Inline R expressions like }\BaseNTok{`r 2 * pi`}\NormalTok{ are ignored by default.}

\NormalTok{If you do not want certain code chunks to be extracted,}
\NormalTok{you can set the chunk option }\BaseNTok{`purl = FALSE`}\NormalTok{, e.g.,}

\BaseNTok{```\{r, ignored, purl=FALSE\}}
\BaseNTok{x = rnorm(1000)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

If we call \texttt{knitr::purl("purl.Rmd")}, it generates the following R script (with the filename \texttt{purl.R} by default):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## ---- simple, echo=TRUE------------------------------}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

The above R script contains the chunk options in a comment. If you want pure R code, you may call \texttt{knitr::purl()} with the argument \texttt{documentation\ =\ 0}, which will generate the R script below:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

If you want to retain all the text, you may use the argument \texttt{documentation\ =\ 2}, which generates the R script below:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' ---}
\CommentTok{#' title: Use `purl()` to extract R code}
\CommentTok{#' ---}
\CommentTok{#' }
\CommentTok{#' The function `knitr::purl()` extracts R code chunks from}
\CommentTok{#' a **knitr** document and save the code to an R script.}
\CommentTok{#' }
\CommentTok{#' Below is a simple chunk:}
\CommentTok{#' }
\CommentTok{## ---- simple, echo=TRUE------------------------------}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}

\CommentTok{#' }
\CommentTok{#' Inline R expressions like `r 2 * pi` are ignored by default.}
\CommentTok{#' }
\CommentTok{#' If you do not want certain code chunks to be extracted,}
\CommentTok{#' you can set the chunk option `purl = FALSE`, e.g.,}
\CommentTok{#' }
\end{Highlighting}
\end{Shaded}

Note that code chunks with the option \texttt{purl\ =\ FALSE} will be excluded in the R script.

Inline R expressions are ignored by default. If you want to include them in the R script, you need to set the global R option \texttt{options(knitr.purl.inline\ =\ TRUE)} before calling \texttt{knitr::purl()}.

\hypertarget{notebook}{%
\section{R Markdown Notebooks}\label{notebook}}

As mentioned in \href{https://bookdown.org/yihui/rmarkdown/compile.html}{Section 2.2} of the R Markdown Definitive Guide \citep{rmarkdown2018}, there are several ways to compile an Rmd document. One of them is to use R Markdown Notebooks, with the output format \texttt{html\_notebook}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ An R Markdown Notebook}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_notebook}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

When you use this output format in RStudio, the \texttt{Knit} button on the toolbar will become the \texttt{Preview} button.

The main advantage of using notebooks is that you can work on Rmd document \emph{iteratively in the same R session}. You can run one code chunk at a time by clicking the green arrow button on each chunk, and you will see the text or plot output in the editor. When you click the \texttt{Preview} button on the toolbar, it only renders the Rmd document to an HTML output document containing the output of all code chunks that you have already executed. The \texttt{Preview} button does not execute any code chunks. By comparison, when you use other output formats and hit the \texttt{Knit} button, RStudio launches a new R session to compile the whole document (hence all code chunks are executed at once), which usually takes more time.

If you do not like RStudio's default behavior of showing output of code chunks inline when you run them individually, you can uncheck the option ``Show output inline for all R Markdown documents'' from the menu \texttt{Tools\ -\textgreater{}\ Global\ Options\ -\textgreater{}\ R\ Markdown}. After that, when you run a code chunk, the output will be shown in the R console instead of inside the source editor. You can also set this option for an individual Rmd document in its YAML metadata:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{editor_options}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{chunk_output_type}\KeywordTok{:}\AttributeTok{ console}
\end{Highlighting}
\end{Shaded}

\hypertarget{document-elements}{%
\chapter{Document Elements}\label{document-elements}}

In this chapter, we introduce some tips and tricks that can be used to customize or generate the document elements of R Markdown, including page breaks, the YAML metadata, section headings, citations, cross-references, equations, animations, interactive plots, diagrams, and comments.

\hypertarget{pagebreaks}{%
\section{Insert page breaks}\label{pagebreaks}}

When you want to break a page, you can insert the command \texttt{\textbackslash{}newpage} in the document. It is a LaTeX command, but the \textbf{rmarkdown} package is able to recognize it for both LaTeX output formats and a few non-LaTeX output formats including HTML,\footnote{For HTML output, page breaks only make sense when you print the HTML page, otherwise you will not see the page breaks, because an HTML page is just a single continuous page.} Word, and ODT. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Breaking pages}
\NormalTok{output:}
\NormalTok{  pdf_document: default}
\NormalTok{  word_document: default}
\NormalTok{  html_document: default}
\NormalTok{  odt_document: default}
\NormalTok{---}

\FunctionTok{# The first section}

\NormalTok{\textbackslash{}newpage}

\FunctionTok{# The second section}
\end{Highlighting}
\end{Shaded}

This feature is based on Pandoc's Lua filters (see Section \ref{lua-filters}). For those who are interested in the technology, you may view this package vignette:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\StringTok{"lua-filters"}\NormalTok{, }\DataTypeTok{package =} \StringTok{"rmarkdown"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{dynamic-yaml}{%
\section{Set the document title dynamically}\label{dynamic-yaml}}

You can use inline R code (see Section \ref{r-code}) anywhere in an Rmd document, including the YAML metadata section. This means some YAML metadata can be dynamically generated with inline R code, such as the document title. For example:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"An analysis of `r nrow(mtcars)` cars"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

If your title depends on an R variable created later in the document, you may add the \texttt{title} field in a later YAML section, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{author: "Smart Analyst"}
\NormalTok{output: pdf_document}
\NormalTok{---}

\NormalTok{I just tried really hard to calculat our market share:}

\BaseNTok{```\{r\}}
\BaseNTok{share <- runif(1)}
\BaseNTok{```}

\NormalTok{---}
\NormalTok{title: "Our market share is }\BaseNTok{`r round(100 * share, 2)`}\NormalTok{% now!"}
\NormalTok{---}

\NormalTok{Apparently I feel }\BaseNTok{`r if(share > 0.8) "happy" else "sad"`}\NormalTok{ about it.}
\end{Highlighting}
\end{Shaded}

In the example above, we added the document title after we have created the variable \texttt{share}. The title works in this case because Pandoc can read any number of YAML sections in a document (and merge them).

You can also generate titles or any YAML fields dynamically from parameters in parameterized reports (see Section \ref{parameterized-reports}), e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"`r params$doc_title`"}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ }\StringTok{"Smart Analyst"}
\FunctionTok{params}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{doc_title}\KeywordTok{:}\AttributeTok{ }\StringTok{"The Default Title"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

With the title being a dynamic parameter, you can easily generate a batch of reports with different titles.

We used the title as the example in this section, but the idea can be applied to any metadata fields in the YAML section.

\hypertarget{document-metadata}{%
\section{Access the document metadata in R code}\label{document-metadata}}

When a Rmd document is compiled, all of its metadata in the YAML section will be stored in the list object \texttt{rmarkdown::metadata}. For example, \texttt{rmarkdown::metadata\$title} gives you the title of the document. You can use this \texttt{metadata} object in your R code, so that you do not need to hard-code information that has been provided in the YAML metadata. For example, when you send an email with \href{https://github.com/rich-iannone/blastula}{the \textbf{blastula} package} within an Rmd document, you may use the title of the document as the email subject, and get the sender information from the author field:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: An important report}
\NormalTok{author: John Doe}
\NormalTok{email: john@example.com}
\NormalTok{---}

\NormalTok{We have done an important analysis, and want to email}
\NormalTok{the results.}

\BaseNTok{```\{r\}}
\BaseNTok{library(rmarkdown)}
\BaseNTok{library(blastula)}
\BaseNTok{smtp_send(}
\BaseNTok{  ...,}
\BaseNTok{  from = setNames(metadata$email, metadata$author),}
\BaseNTok{  subject = metadata$title}
\BaseNTok{)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{unnumbered-sections}{%
\section{Unnumbered sections}\label{unnumbered-sections}}

Most output formats support an option \texttt{number\_sections}, which can be used to enable numbering sections if set to \texttt{true}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{number_sections}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{number_sections}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\end{Highlighting}
\end{Shaded}

If you want a certain section to be unnumbered when the option \texttt{number\_sections} is \texttt{true}, you may add \texttt{\{-\}} after the section heading, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# This section is unnumbered \{-\}}
\end{Highlighting}
\end{Shaded}

Equivalently, you may also use \texttt{\{.unnumbered\}}. You can also add other attributes to the heading, e.g., \texttt{\{.unnumbered\ \#section-id\}}. Please see \url{https://pandoc.org/MANUAL.html\#extension-header_attributes} for more information.

Unnumbered sections are often used for providing extra information about the writing. For example, for this book, the chapters ``Preface'' and ``About the Authors'' are unnumbered, since they do not belong to the body of this book. As you may see in Figure \ref{fig:unnumbered-sections}, the actual body starts after the two unnumbered chapters, and the chapters in the book body are numbered.

\begin{figure}
\centering
\includegraphics{images/unnumbered-sections.png}
\caption{\label{fig:unnumbered-sections}A screenshot of the table of contents of this book to show numbered and unnumbered chapters.}
\end{figure}

Section numbers are incremental. If you insert an unnumbered section after a numbered section, and then start another numbered section, the section number will resume incrementing.

\hypertarget{bibliography}{%
\section{Bibliographies and citations}\label{bibliography}}

For an overview of including bibliographies in your output document, you may see \href{https://bookdown.org/yihui/bookdown/citations.html}{Section 2.8} of \citet{bookdown2016}. The basic usage requires us to specify a bibliography file using the \texttt{bibliography} metadata field in YAML. For example:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_document}
\FunctionTok{bibliography}\KeywordTok{:}\AttributeTok{ references.bib  }
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

where the BibTeX database is a plain-text file with the \texttt{*.bib} extension that consists of bibliography entries like this:

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@Manual}\NormalTok{\{}\OtherTok{R}\NormalTok{-}\OtherTok{base}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{ = \{R: A Language and Environment for Statistical}
\NormalTok{           Computing\},}
  \DataTypeTok{author}\NormalTok{ = \{\{R Core Team\}\},}
  \DataTypeTok{organization}\NormalTok{ = \{R Foundation for Statistical Computing\},}
  \DataTypeTok{address}\NormalTok{ = \{Vienna, Austria\},}
  \DataTypeTok{year}\NormalTok{ = \{2019\},}
  \DataTypeTok{url}\NormalTok{ = \{https://www.R-project.org\},}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Items can be cited directly within the documentation using the syntax \texttt{@key} where \texttt{key} is the citation key in the first line of the entry, e.g., \texttt{@R-base}. To put citations in parentheses, use \texttt{{[}@key{]}}. To cite multiple entries, separate the keys by semicolons, e.g., \texttt{{[}@key-1;\ @key-2;\ @key-3{]}}. To suppress the mention of the author, add a minus sign before \texttt{@}, e.g., \texttt{{[}-@R-base{]}}.

\hypertarget{changing-citation-style}{%
\subsection{Changing citation style}\label{changing-citation-style}}

By default, Pandoc will use a Chicago author-date format for citations and references. To use another style, you will need to specify a CSL (Citation Style Language) style file in the \texttt{csl} metadata field, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_document}
\FunctionTok{bibliography}\KeywordTok{:}\AttributeTok{ references.bib}
\FunctionTok{csl}\KeywordTok{:}\AttributeTok{ biomed-central.csl}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

To find your required formats, we recommend using \href{https://www.zotero.org/styles}{the Zotero website}, which makes it easy to search for and download your desired style.

CSL files can be tweaked to meet custom formatting requirements. For example, we can change the number of authors required before ``et. al'' is used to abbreviate them. This can be simplified through the use of visual editors such as the one available at \url{http://editor.citationstyles.org}.

\hypertarget{add-an-item-to-bibliography-without-using-it}{%
\subsection{Add an item to bibliography without using it}\label{add-an-item-to-bibliography-without-using-it}}

By default, the bibliography will only display items that are directly referenced in the document. If you want to include items in the bibliography without actually citing them in the body text, you can define a dummy \texttt{nocite} metadata field and put the citations there.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{nocite}\KeywordTok{: }\CharTok{|}
\NormalTok{  @item1, @item2}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\hypertarget{add-all-items-to-bibliography}{%
\subsection{Add all items to bibliography}\label{add-all-items-to-bibliography}}

If we do not wish to explicitly state all of the items within the bibliography but would still like to show them in our references, we can use the following syntax:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{nocite}\KeywordTok{:}\AttributeTok{ }\StringTok{'@*'}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

This will force all items to be displayed in the bibliography.

\hypertarget{include-appendix-after-bibliography}{%
\subsection{Include appendix after bibliography (*)}\label{include-appendix-after-bibliography}}

By default, the bibliography appears at the very end of the document. However, there can be cases in which we want to place additional text after the references, most typically if we wish to include appendices in the document. We can force the position of the references by using \texttt{\textless{}div\ id="refs"\textgreater{}\textless{}/div\textgreater{}}, as shown below:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# References}

\NormalTok{<div id="refs"></div>}

\FunctionTok{# Appendix}
\end{Highlighting}
\end{Shaded}

Although \texttt{\textless{}div\textgreater{}} is an HTML tag, this method also works for other output formats such as PDF.

We can improve this further by using the \textbf{bookdown} package, which allows you to insert a \href{https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html\#special-headers}{special header} \texttt{\#\ (APPENDIX)\ Appendix\ \{-\}} before you start the appendix, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# References}

\NormalTok{<div id="refs"></div>}

\FunctionTok{# (APPENDIX) Appendix \{-\} }

\FunctionTok{# More information}

\NormalTok{This will be Appendix A.}

\FunctionTok{# One more thing}

\NormalTok{This will be Appendix B.}
\end{Highlighting}
\end{Shaded}

The numbering style of appendices will be automatically changed in LaTeX/PDF and HTML output (usually in the form A, A.1, A.2, B, B.1, and so on).

\hypertarget{write-bib}{%
\section{Generate R package citations}\label{write-bib}}

To cite an R package, you can use the function \texttt{citation()} from base R. If you want to generate a citation entry for BibTeX, you can pass the returned object of \texttt{citation()} to \texttt{toBibtex()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{toBibtex}\NormalTok{(}\KeywordTok{citation}\NormalTok{(}\StringTok{"xaringan"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@Manual}\NormalTok{\{,}
  \DataTypeTok{title}\NormalTok{ = \{xaringan: Presentation Ninja\},}
  \DataTypeTok{author}\NormalTok{ = \{Yihui Xie\},}
  \DataTypeTok{year}\NormalTok{ = \{2020\},}
  \DataTypeTok{note}\NormalTok{ = \{R package version 0.14\},}
  \DataTypeTok{url}\NormalTok{ = \{https://CRAN.R-project.org/package=xaringan\},}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

To use citation entries generated from \texttt{toBibtex()}, you have to copy the output to a \texttt{.bib} file, and add citation keys (e.g., change \texttt{@Manual\{,} to \texttt{@Manual\{R-xaringan,}). This can be automated via the function \texttt{knitr::write\_bib()}, which generates citation entries to a file and adds keys automatically, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{write_bib}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{.packages}\NormalTok{(), }\StringTok{"bookdown"}\NormalTok{), }\StringTok{"packages.bib"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The first argument should be a character vector of package names, and the second argument is the path to the \texttt{.bib} file. In the above example, \texttt{.packages()} returns the names of all packages loaded in the current R session. This makes sure all packages being used will have their citation entries written to the \texttt{.bib} file. When any of these packages are updated (e.g., the author, title, or year, or version of a package is changed), \texttt{write\_bib()} can automatically update the \texttt{.bib} file.

There are two possible types of citation entries. One type is those generated from the package's \texttt{DESCRIPTION} file, and the other type is generated from the package's \texttt{CITATION} file if provided. For the former type, the citation keys are of the form \texttt{R-pkgname}, where \texttt{pkgname} is the package name (e.g., \texttt{R-knitr}). For the latter type, the keys are created by concatenating the package name and the publication year (e.g., \texttt{knitr2015}). If there are multiple entries in the same year, a letter suffix will be added, e.g., \texttt{knitr2015a} and \texttt{knitr2015b}. The former type is often used to cite the package itself (i.e., the software), and the latter type often consists of publications related to the package, such as journal papers or books.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{write_bib}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"knitr"}\NormalTok{, }\StringTok{"rmarkdown"}\NormalTok{), }\DataTypeTok{width =} \DecValTok{60}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{@Manual}\NormalTok{\{}\OtherTok{R}\NormalTok{-}\OtherTok{knitr}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{ = \{knitr: A General-Purpose Package for Dynamic Report}
\NormalTok{    Generation in R\},}
  \DataTypeTok{author}\NormalTok{ = \{Yihui Xie\},}
  \DataTypeTok{year}\NormalTok{ = \{2020\},}
  \DataTypeTok{note}\NormalTok{ = \{R package version 1.29\},}
  \DataTypeTok{url}\NormalTok{ = \{https://CRAN.R-project.org/package=knitr\},}
\NormalTok{\}}

\VariableTok{@Manual}\NormalTok{\{}\OtherTok{R}\NormalTok{-}\OtherTok{rmarkdown}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{ = \{rmarkdown: Dynamic Documents for R\},}
  \DataTypeTok{author}\NormalTok{ = \{JJ Allaire and Yihui Xie and Jonathan McPherson}
\NormalTok{    and Javier Luraschi and Kevin Ushey and Aron Atkins and}
\NormalTok{    Hadley Wickham and Joe Cheng and Winston Chang and Richard}
\NormalTok{    Iannone\},}
  \DataTypeTok{year}\NormalTok{ = \{2020\},}
  \DataTypeTok{note}\NormalTok{ = \{R package version 2.3\},}
  \DataTypeTok{url}\NormalTok{ = \{https://CRAN.R-project.org/package=rmarkdown\},}
\NormalTok{\}}

\VariableTok{@Book}\NormalTok{\{}\OtherTok{knitr2015}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{ = \{Dynamic Documents with \{R\} and knitr\},}
  \DataTypeTok{author}\NormalTok{ = \{Yihui Xie\},}
  \DataTypeTok{publisher}\NormalTok{ = \{Chapman and Hall/CRC\},}
  \DataTypeTok{address}\NormalTok{ = \{Boca Raton, Florida\},}
  \DataTypeTok{year}\NormalTok{ = \{2015\},}
  \DataTypeTok{edition}\NormalTok{ = \{2nd\},}
  \DataTypeTok{note}\NormalTok{ = \{ISBN 978-1498716963\},}
  \DataTypeTok{url}\NormalTok{ = \{https://yihui.org/knitr/\},}
\NormalTok{\}}

\VariableTok{@InCollection}\NormalTok{\{}\OtherTok{knitr2014}\NormalTok{,}
  \DataTypeTok{booktitle}\NormalTok{ = \{Implementing Reproducible Computational}
\NormalTok{    Research\},}
  \DataTypeTok{editor}\NormalTok{ = \{Victoria Stodden and Friedrich Leisch and Roger D.}
\NormalTok{    Peng\},}
  \DataTypeTok{title}\NormalTok{ = \{knitr: A Comprehensive Tool for Reproducible}
\NormalTok{    Research in \{R\}\},}
  \DataTypeTok{author}\NormalTok{ = \{Yihui Xie\},}
  \DataTypeTok{publisher}\NormalTok{ = \{Chapman and Hall/CRC\},}
  \DataTypeTok{year}\NormalTok{ = \{2014\},}
  \DataTypeTok{note}\NormalTok{ = \{ISBN 978-1466561595\},}
  \DataTypeTok{url}\NormalTok{ = \{http://www.crcpress.com/product/isbn/9781466561595\},}
\NormalTok{\}}

\VariableTok{@Book}\NormalTok{\{}\OtherTok{rmarkdown2018}\NormalTok{,}
  \DataTypeTok{title}\NormalTok{ = \{R Markdown: The Definitive Guide\},}
  \DataTypeTok{author}\NormalTok{ = \{Yihui Xie and J.J. Allaire and Garrett Grolemund\},}
  \DataTypeTok{publisher}\NormalTok{ = \{Chapman and Hall/CRC\},}
  \DataTypeTok{address}\NormalTok{ = \{Boca Raton, Florida\},}
  \DataTypeTok{year}\NormalTok{ = \{2018\},}
  \DataTypeTok{note}\NormalTok{ = \{ISBN 9781138359338\},}
  \DataTypeTok{url}\NormalTok{ = \{https://bookdown.org/yihui/rmarkdown\},}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Without the file path argument, \texttt{knitr::write\_bib()} writes the citation entries to the R console, as you can see from the above example.

Note that \texttt{write\_bib()} is designed to overwrite the existing bibliography file. If you want to manually add any other entries to the bibliography, it is recommended that you create a second \texttt{.bib} file and refer to it in the YAML field \texttt{bibliography}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{bibliography: [packages.bib. references.bib]}
\NormalTok{---}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{knitr::write_bib(file = 'packages.bib')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

In the above example, \texttt{packages.bib} is automatically generated, and you should not manually change it. All other citation entries can be manually written to \texttt{references.bib}.

We only introduced one way to generate R package citations above. To dynamically generate citations for other types of literature, you may check out the \textbf{knitcitations} package at \url{https://github.com/cboettig/knitcitations}.

\hypertarget{cross-ref}{%
\section{Cross-referencing within documents}\label{cross-ref}}

Cross-referencing is a useful way of directing your readers through your document, and can be automatically done within R Markdown. While this has been explained in \href{https://bookdown.org/yihui/bookdown/components.html}{Chapter 2} from the \textbf{bookdown} book, we want to present a brief summary below.

To use cross-references, you will need:

\begin{itemize}
\item
  \textbf{A bookdown output format}: cross-referencing is not provided directly within the base \textbf{rmarkdown} package, but is provided as an extension in \textbf{bookdown}. We must therefore use an output format from \textbf{bookdown} (e.g., \texttt{html\_document2}, \texttt{pdf\_document2}, and \texttt{word\_document2}, etc.) in the YAML \texttt{output} field.
\item
  \textbf{A caption to your figure (or table)}: figures without a caption will be included directly as images and will therefore not be a numbered figure.
\item
  \textbf{A labeled code chunk}: this provides the identifier for referencing the figure generated by the chunk.
\end{itemize}

After these conditions are met, we can make cross-references within the text using the syntax \texttt{\textbackslash{}@ref(type:label)}, where \texttt{label} is the chunk label and \texttt{type} is the environment being referenced (e.g.~\texttt{tab}, \texttt{fig}, or \texttt{eqn}). An example is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Cross-referencing figures, tables, and equations}
\NormalTok{author: Generated by bookdown}
\NormalTok{output:}
\NormalTok{  bookdown::html_document2: default}
\NormalTok{  bookdown::pdf_document2: default}
\NormalTok{---}

\NormalTok{See Figure \textbackslash{}@ref(fig:cars-plot).}

\BaseNTok{```\{r cars-plot, fig.cap="The cars data.", echo=FALSE\}}
\BaseNTok{par(mar = c(4, 4, .2, .1))}
\BaseNTok{plot(cars)  # a scatterplot}
\BaseNTok{```}

\NormalTok{Also see Equation \textbackslash{}@ref(eq:mean).}

\NormalTok{\textbackslash{}begin\{equation\}}
\NormalTok{\textbackslash{}bar\{X\} = \textbackslash{}frac\{\textbackslash{}sum_\{i=1\}^n X_i\}\{n\} (\textbackslash{}#eq:mean)}
\NormalTok{\textbackslash{}end\{equation\}}

\NormalTok{And see Table \textbackslash{}@ref(tab:mtcars).}

\BaseNTok{```\{r mtcars, echo=FALSE\}}
\BaseNTok{knitr::kable(mtcars[1:5, 1:5], caption = "The mtcars data.")}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output of this document is shown in Figure \ref{fig:bookdown-ref}.

\begin{figure}

{\centering \includegraphics{images/bookdown-ref} 

}

\caption{Example of cross-referencing within an R Markdown document.}\label{fig:bookdown-ref}
\end{figure}

You can also cross-reference equations, theorems, and section headers. These types of references are explained further in Section 2.2 and Section 2.6 of the \textbf{bookdown} book.

\hypertarget{update-date}{%
\section{Update the date automatically}\label{update-date}}

If you want the date on which the Rmd document is compiled to be reflected in the output report, you can add an inline R expression to the \texttt{date} field in YAML, and use the \texttt{Sys.Date()} or \texttt{Sys.time()} function to obtain the current date, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{date}\KeywordTok{:}\AttributeTok{ }\StringTok{"`r Sys.Date()`"}
\end{Highlighting}
\end{Shaded}

You may want to specify the desired date or date-time format to make it more human-readable, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{date}\KeywordTok{:}\AttributeTok{ }\StringTok{"`r format(Sys.time(), '%d %B, %Y')`"}
\end{Highlighting}
\end{Shaded}

This will generate the date dynamically each time you knit your document, e.g., 03 July, 2020. If you wish to customize the format of the dates, you can alter the time format by providing your own format string. Here are some examples:

\begin{itemize}
\tightlist
\item
  \texttt{\%B\ \%Y}: July 2020
\item
  \texttt{\%d/\%m/\%y}: 03/07/20
\item
  \texttt{\%a/\%d/\%b}: Fri 03 Jul
\end{itemize}

A full table of POSIXct formats is shown in Table \ref{tab:date-format}.

\begin{table}
\caption{\label{tab:date-format} Date and time formats in R.}\tabularnewline
\begin{tabular}{llll}
\toprule
\begin{minipage}[b]{0.05\columnwidth}\raggedright
Code\strut
\end{minipage} & \begin{minipage}[b]{0.31\columnwidth}\raggedright
Meaning\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright
Code\strut
\end{minipage} & \begin{minipage}[b]{0.47\columnwidth}\raggedright
Meaning\strut
\end{minipage}\tabularnewline
\midrule

\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%a\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Abbreviated weekday\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%A\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Full weekday\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%b\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Abbreviated month\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%B\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Full month\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%c\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Locale-specific date and time\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%d\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Decimal date\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%H\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Decimal hours (24 hour)\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%I\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Decimal hours (12 hour)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%j\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Decimal day of the year\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%m\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Decimal month\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%M\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Decimal minute\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%p\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Locale-specific AM/PM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%S\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Decimal second\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%U\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Decimal week of the year (starting on Sunday)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%w\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Decimal Weekday (0=Sunday)\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%W\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Decimal week of the year (starting on Monday)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%x\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Locale-specific Date\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%X\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Locale-specific Time\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%y\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
2-digit year\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%Y\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
4-digit year\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright
\%z\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Offset from GMT\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright
\%Z\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Time zone (character)\strut
\end{minipage}\tabularnewline
\bottomrule
\end{tabular}
\end{table}

As a final note, you may also want to include some explanatory text along with the date. You can add any text such as ``Last compiled on'' before the R code as follows:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{date}\KeywordTok{:}\AttributeTok{ }\StringTok{"Last compiled on `r format(Sys.time(), '%d %B, %Y')`"}
\end{Highlighting}
\end{Shaded}

\hypertarget{multiple-authors}{%
\section{Multiple authors in a document}\label{multiple-authors}}

We can add multiple authors to an R Markdown document within the YAML frontmatter in a number of ways. If we simply want to list them on the same line, we can provide a single string to the document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"Untitled"}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ }\StringTok{"John Doe, Jane Doe"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Alternatively, if we wish for each entry to be on its own line, we can provide a list of entries to the YAML field. This can be useful if you wish to include further information about each author such as an Email address or institution, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{author}\KeywordTok{:}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ John Doe, Institution One}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ Jane Doe, Institution Two}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

We can make use of the Markdown syntax \texttt{\^{}{[}{]}} to add additional information as a footnote to the document. This may be more useful if you have extended information that you wish to include for each author, such as providing a contact Email and address. The exact behavior will depend on the output format:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{author}\KeywordTok{:}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ John Doe^[Institution One, john@example.org]}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ Jane Doe^[Institution Two, jane@example.org]}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Certain R Markdown templates will allow you to specify additional parameters directly within the YAML. For example, the \href{https://rstudio.github.io/distill/}{Distill} output format allows \texttt{url}, \texttt{affiliation}, and \texttt{affiliation\_url} to be specified. After you install the \textbf{distill} package:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"distill"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can use the Distill format with detailed author information, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"Distill for R Markdown"}
\FunctionTok{author}\KeywordTok{:}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ }\StringTok{"JJ Allaire"}
\AttributeTok{    }\FunctionTok{url}\KeywordTok{:}\AttributeTok{ https://github.com/jjallaire}
\AttributeTok{    }\FunctionTok{affiliation}\KeywordTok{:}\AttributeTok{ RStudio}
\AttributeTok{    }\FunctionTok{affiliation_url}\KeywordTok{:}\AttributeTok{ https://www.rstudio.com}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ distill::distill_article}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\hypertarget{figure-number}{%
\section{Numbered figure captions}\label{figure-number}}

We can use \textbf{bookdown} output formats to add figure numbers to their captions. Below is an example:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ bookdown::html_document2}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r cars, fig.cap = "An amazing plot"\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\BaseNTok{```\{r mtcars, fig.cap = "Another amazing plot"\}}
\BaseNTok{plot(mpg ~ hp, mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Section \ref{cross-ref} demonstrates how this works for other elements such as tables and equations, and how to cross-reference the numbered elements within the text. Besides \texttt{html\_document2}, there are several other similar functions for other output formats, such as \texttt{pdf\_document2} and \texttt{word\_document2}.

You can add this feature to R Markdown output formats outside \textbf{bookdown}, too. The key is to use those formats as the ``base formats'' of \textbf{bookdown} output formats. For example, to number and cross-reference figures in the \texttt{rticles::jss\_article} format, you can use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  bookdown:}\FunctionTok{:pdf_book}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{base_format}\KeywordTok{:}\AttributeTok{ rticles::jss_article}
\end{Highlighting}
\end{Shaded}

Please read the help pages of the \textbf{bookdown} output format functions to see if they have the \texttt{base\_format} argument (e.g., \texttt{?bookdown::html\_document2}).

\hypertarget{combine-words}{%
\section{Combine words into a comma-separated phrase}\label{combine-words}}

When you want to output a character vector for humans to read (e.g., \texttt{x\ \textless{}-\ c("apple",\ "banana",\ "cherry")}), you probably do not want something like \texttt{{[}1{]}\ "apple"\ "banana"\ "cherry"}, which is the normal way to print a vector in R. Instead, you may want a character string ``\texttt{apple,\ banana,\ and\ cherry}''. There is a base R function \texttt{paste()} that you can use to concatenate a character vector into a single string, e.g., \texttt{paste(x,\ collapse\ =\ \textquotesingle{},\ \textquotesingle{})}, and the output will be \texttt{"apple,\ banana,\ cherry"}. The problems are (1) the conjunction ``and'' is missing, and (2) when the vector only contains two elements, we should not use commas (e.g., the output should be \texttt{"apple\ and\ banana"} instead of \texttt{"apple,\ banana"}).

The function \texttt{knitr::combine\_words()} can be used to concatenate words into a phrase regardless of the length of the character vector. Basically, for a single word, it will just return this word; for two words A and B, it return \texttt{"A\ and\ B"}; for three or more words, it returns \texttt{"A,\ B,\ C,\ ...,\ Y,\ and\ Z"}. The function also has a few arguments that can customize the output. For example, if you want to output the words in pairs of backticks, you may use \texttt{knitr::combine\_words(x,\ before\ =\ \textquotesingle{}\textasciigrave{}\textquotesingle{})}. Below are more examples with different arguments, and please see the help page \texttt{?knitr::combine\_words} if the meaning of any argument is not clear from the output here:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"apple"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"cherry"}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v)}
\CommentTok{## apple, banana, and cherry}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v, }\DataTypeTok{before =} \StringTok{"`"}\NormalTok{, }\DataTypeTok{after =} \StringTok{"'"}\NormalTok{)}
\CommentTok{## `apple', `banana', and `cherry'}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v, }\DataTypeTok{and =} \StringTok{""}\NormalTok{)}
\CommentTok{## apple, banana, cherry}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v, }\DataTypeTok{sep =} \StringTok{" / "}\NormalTok{, }\DataTypeTok{and =} \StringTok{""}\NormalTok{)}
\CommentTok{## apple / banana / cherry}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v[}\DecValTok{1}\NormalTok{])  }\CommentTok{# a single word}
\CommentTok{## apple}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(v[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{])  }\CommentTok{# two words}
\CommentTok{## apple and banana}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{combine_words}\NormalTok{(LETTERS[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{])}
\CommentTok{## A, B, C, D, and E}
\end{Highlighting}
\end{Shaded}

This function can be particularly handy when it is used in an inline R expression, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{This morning we had }\BaseNTok{`r knitr::combine_words(v)`}\NormalTok{ for breakfast.}
\end{Highlighting}
\end{Shaded}

\hypertarget{linebreaks}{%
\section{Preserve a large number of linebreaks}\label{linebreaks}}

Markdown users may be surprised to realize that whitespaces (including linebreaks) are usually meaningless unless they are used in a verbatim environment (code blocks). Two or more spaces are the same as one space, and a linebreak is the same as a space. If you have used LaTeX or HTML before, you may not be surprised because the rule is the same in these languages.

In Markdown, we often use a blank line to separate elements such as paragraphs. To break a line without introducing a new paragraph, you have to use two trailing spaces. Sometimes you may want to break the lines for many times, especially when you write or quote poems or lyrics. Adding two spaces after each line manually is a tedious task. The function \texttt{blogdown:::quote\_poem()} can do this task automatically, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{blogdown}\OperatorTok{:::}\KeywordTok{quote_poem}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"This line"}\NormalTok{, }\StringTok{"should be"}\NormalTok{, }\StringTok{"broken."}\NormalTok{))}
\CommentTok{## [1] "> This line  \textbackslash{}nshould be  \textbackslash{}nbroken."}
\end{Highlighting}
\end{Shaded}

If you use the RStudio IDE and have installed the package \textbf{blogdown}, you can select the text in which you want to preserve the linebreaks, and click the RStudio addin ``Quote Poem'' in the drop-down menu ``Addins'' on the toolbar. For example, the text below (in a fenced code block) does not contain trailing spaces:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Like Barley Bending}

\NormalTok{Like barley bending}
\NormalTok{ãIn low fields by the sea,}
\NormalTok{Singing in hard wind}
\NormalTok{ãCeaselessly;}

\NormalTok{Like barley bending}
\NormalTok{ãAnd rising again,}
\NormalTok{So would I, unbroken,}
\NormalTok{ãRise from pain;}

\NormalTok{So would I softly,}
\NormalTok{ãDay long, night long,}
\NormalTok{Change my sorrow}
\NormalTok{ãInto song.}

\NormalTok{--- Sara Teasdale}
\end{Highlighting}
\end{Shaded}

After we select the above poem and click the RStudio addin ``Quote Poem'', the output will be:

\begin{quote}
Like Barley Bending

Like barley bending\\
ãIn low fields by the sea,\\
Singing in hard wind\\
ãCeaselessly;

Like barley bending\\
ãAnd rising again,\\
So would I, unbroken,\\
ãRise from pain;

So would I softly,\\
ãDay long, night long,\\
Change my sorrow\\
ãInto song.

\begin{flushright}

--- Sara Teasdale

\end{flushright}
\end{quote}

Some users may ask, ``Since the fenced code block preserves whitespaces, why not put poems in code blocks?'' Code could be poetic, but poems are not code. Please do not be too addicted to coding\ldots{}

\hypertarget{equatiomatic}{%
\section{Convert models to equations}\label{equatiomatic}}

The \textbf{equatiomatic} package (\url{https://github.com/datalorax/equatiomatic}) developed by Daniel Anderson et al.~provides a convenient and automatic way to show the equations corresponding to models fitted in R. At the time of writing, this package is still very new on GitHub and its API may change significantly before its possible future CRAN release, so we only show a few brief examples below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(mpg }\OperatorTok{~}\StringTok{ }\NormalTok{cyl }\OperatorTok{+}\StringTok{ }\NormalTok{disp, mtcars)}
\CommentTok{# show the theoretical model}
\NormalTok{equatiomatic}\OperatorTok{::}\KeywordTok{extract_eq}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\[
\text{mpg} = \alpha + \beta_{1}(\text{cyl}) + \beta_{2}(\text{disp}) + \epsilon
\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# display the actual coefficients}
\NormalTok{equatiomatic}\OperatorTok{::}\KeywordTok{extract_eq}\NormalTok{(fit, }\DataTypeTok{use_coefs =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\[
\text{mpg} = 34.66 - 1.59(\text{cyl}) - 0.02(\text{disp}) + \epsilon
\]

To display the actual math equations, you need the chunk option \texttt{results\ =\ "asis"} (see Section \ref{results-asis} for the meaning of this option), otherwise the equations will be displayed as normal text output.

Please read the documentation and follow the development of this package on GitHub if you are interested in knowing more about it.

\hypertarget{animation}{%
\section{Create an animation from multiple R plots}\label{animation}}

When you generate a series of plots in a code chunk, you can combine them into an animation. It is easy to do so if the output format is HTML---you only need to install the \textbf{gifski} package and set the chunk option \texttt{animation.hook\ =\ "gifski"}. Figure \ref{fig:pacman} shows a simple ``Pac-man'' animation created from the code chunk below:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, animation.hook="gifski"\}}
\BaseNTok{for (i in 1:2) \{}
\BaseNTok{  pie(c(i %% 2, 6), col = c('red', 'yellow'), labels = NA)}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\includegraphics[width=0.5\linewidth]{rmarkdown-cookbook_files/figure-latex/pacman-1} \includegraphics[width=0.5\linewidth]{rmarkdown-cookbook_files/figure-latex/pacman-2} \caption{A Pac-man animation.}\label{fig:pacman}
\end{figure}

The image format of the animation is GIF, which works well for HTML output, but it is not straightforward to support GIF in LaTeX. That is why you only see two static image frames if you are reading the PDF or printed version of this book in Figure \ref{fig:pacman}. If you read the online version of this book, you will see the actual animation.

Animations can work in PDF, but there are two prerequisites. First, you have to load the LaTeX package \href{https://ctan.org/pkg/animate}{\textbf{animate}} (see Section \ref{latex-extra} for how). Second, you can only use Acrobat Reader to view the animation. Then the chunk option \texttt{fig.show\ =\ "animate"} will use the \textbf{animate} package to create the animation. Below is an example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Animations in PDF}
\NormalTok{output:}
\NormalTok{  pdf_document:}
\BaseNTok{    extra_dependencies: animate}
\NormalTok{---}

\NormalTok{The animation below can only be viewed in Acrobat Reader.}

\BaseNTok{```\{r, fig.show='animate'\}}
\BaseNTok{for (i in 1:2) \{}
\BaseNTok{  pie(c(i %% 2, 6), col = c('red', 'yellow'), labels = NA)}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The time interval between image frames in the animation can be set by the chunk option \texttt{interval}. By default, \texttt{interval\ =\ 1} (i.e., one second).

The R package \textbf{animation} (\url{https://github.com/yihui/animation}) contains several animation examples to illustrate methods and ideas in statistical computing. The \textbf{gganimate} package (\url{https://github.com/thomasp85/gganimate}) allows us to create smooth animations based on \textbf{ggplot2}. Both packages work with R Markdown.

\hypertarget{diagrams}{%
\section{Create diagrams}\label{diagrams}}

There are many separate programs (e.g., Graphviz) that can be used to produce diagrams and flowcharts, but it can be easier to manage them directly inside R code chunks in Rmd documents.

While there are several different packages available for R, we will only briefly introduce the package \textbf{DiagrammeR} \citep{R-DiagrammeR}, and mention other packages at the end. You can find the full documentation of \textbf{DiagrammeR} at \url{https://rich-iannone.github.io/DiagrammeR/}. In this section, we will introduce the basic usages and also how to use R code in diagrams.

\hypertarget{basic-diagrams}{%
\subsection{Basic diagrams}\label{basic-diagrams}}

\textbf{DiagrammeR} provides methods to build graphs for a number of different graphing languages. We will present a Graphviz example in this section,\footnote{Depending on your background, this section may be a biased introduction to \textbf{DiagrammeR}. Please see its official documentation if you are interested in this package.} but you can also use pure R code to create graphs and diagrams with \textbf{DiagrammeR}.

The RStudio IDE provides native support for Graphviz (\texttt{.gv}) and mermaid (\texttt{.mmd}) files. Editing these types of files in RStudio has the advantage of syntax highlighting, RStudio also allows you to preview the diagrams by clicking the ``Preview'' button on the toolbar. Figure \ref{fig:diagram-profit} is a simple flowchart example that has four rectangles representing four steps, generated by the code below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DiagrammeR}\OperatorTok{::}\KeywordTok{grViz}\NormalTok{(}\StringTok{"digraph \{}
\StringTok{  graph [layout = dot, rankdir = TB]}
\StringTok{  }
\StringTok{  node [shape = rectangle]        }
\StringTok{  rec1 [label = 'Step 1. Wake up']}
\StringTok{  rec2 [label = 'Step 2. Write code']}
\StringTok{  rec3 [label =  'Step 3. ???']}
\StringTok{  rec4 [label = 'Step 4. PROFIT']}
\StringTok{  }
\StringTok{  # edge definitions with the node IDs}
\StringTok{  rec1 -> rec2 -> rec3 -> rec4}
\StringTok{  \}"}\NormalTok{, }
  \DataTypeTok{height =} \DecValTok{500}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{rmarkdown-cookbook_files/figure-latex/diagram-profit-1} 

}

\caption{A diagram showing a programmer's daydream.}\label{fig:diagram-profit}
\end{figure}

There are extensive controls that can be used to define the shape of nodes, colors, line types, and add additional parameters.

\hypertarget{adding-parameters-to-plots}{%
\subsection{Adding parameters to plots}\label{adding-parameters-to-plots}}

Graphviz substitution allows for mixing in R expressions into a Graphviz graph specification without sacrificing readability. If you specify a substitution with \texttt{@@}, you must ensure there is a valid R expression for that substitution. The expressions are placed as footnotes and their evaluations must result in an R vector object. The \texttt{@@} notation is immediately followed by a number, and that number should correspond to the number of the R expression footnote. Figure \ref{fig:diagram-params} shows an example of embedding and evaluating R code in the diagram.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DiagrammeR}\OperatorTok{::}\KeywordTok{grViz}\NormalTok{(}\StringTok{"}
\StringTok{  digraph graph2 \{}
\StringTok{  }
\StringTok{  graph [layout = dot, rankdir = LR]}
\StringTok{  }
\StringTok{  # node definitions with substituted label text}
\StringTok{  node [shape = oval]}
\StringTok{  a [label = '@@1']}
\StringTok{  b [label = '@@2']}
\StringTok{  c [label = '@@3']}
\StringTok{  d [label = '@@4']}
\StringTok{  }
\StringTok{  a -> b -> c -> d}
\StringTok{  \}}
\StringTok{  }
\StringTok{  [1]: names(iris)[1]}
\StringTok{  [2]: names(iris)[2]}
\StringTok{  [3]: names(iris)[3]}
\StringTok{  [4]: names(iris)[4]}
\StringTok{  "}\NormalTok{, }
  \DataTypeTok{height =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\includegraphics[width=1\linewidth]{rmarkdown-cookbook_files/figure-latex/diagram-params-1} \caption{A diagram using parameters input from R.}\label{fig:diagram-params}
\end{figure}

\hypertarget{other-packages-for-making-diagrams}{%
\subsection{Other packages for making diagrams}\label{other-packages-for-making-diagrams}}

You may also check out these packages for creating diagrams: \textbf{nomnoml} (\url{https://github.com/javierluraschi/nomnoml}), \textbf{diagram} (\url{https://cran.r-project.org/package=diagram}), \textbf{dagitty} (\url{https://cran.r-project.org/package=dagitty}), \textbf{ggdag} (\url{https://github.com/malcolmbarrett/ggdag}), and \textbf{plantuml} (\url{https://github.com/rkrug/plantuml}).

\hypertarget{special-chars}{%
\section{Escape special characters}\label{special-chars}}

Some characters have special meanings in the Markdown syntax. If you want these characters verbatim, you have to escape them. For example, a pair of underscores surrounding text usually make the text italic, and you need to escape the underscores if you want verbatim underscores instead of italic text. The way to escape a special character is to add a backslash before it, e.g., \texttt{I\ do\ not\ want\ \textbackslash{}\_italic\ text\textbackslash{}\_\ here}. Similarly, if \texttt{\#} does not indicate a section heading, you may write \texttt{\textbackslash{}\#\ This\ is\ not\ a\ heading}.

\hypertarget{comments}{%
\section{Comment out text}\label{comments}}

It is useful to comment out text in the source document, which will not be displayed in the final output document. We can use the HTML syntax \texttt{\textless{}!-\/-\ your\ comment\ -\/-\textgreater{}}. The comments will not be displayed in any output format.

Comments can span either a single line or multiple lines. This may be useful for you to write draft content.

If you use RStudio, you can use the keyboard shortcut \texttt{Ctrl\ +\ Shift\ +\ C} (\texttt{Command\ +\ Shift\ +\ C} on macOS) to comment out a line of text.

\hypertarget{toc-unlisted}{%
\section{Omit a heading in the table of contents}\label{toc-unlisted}}

If you do not want certain section headings to be included in the table of contents, you can add two classes to the heading: \texttt{unlisted} and \texttt{unnumbered}. For example:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Section heading \{.unlisted .unnumbered\}}
\end{Highlighting}
\end{Shaded}

Note that this feature requires at least Pandoc 2.9. You may check your Pandoc version via \texttt{rmarkdown::pandoc\_version()}. If the version is lower than 2.9, you may install a newer version (see Section \ref{install-pandoc}).

\hypertarget{code-appendix}{%
\section{Put together all code in the appendix (*)}\label{code-appendix}}

Unless the target readers are highly interested in the computational details while they read a report, you may not want to show the source code blocks in the report, but set the chunk option \texttt{echo\ =\ FALSE} to hide the source code instead, so readers will not be distracted by the program code for computing. However, the source code is still important for the sake of reproducible research. Sometimes readers may want to verify the computational correctness after they have finished reading the report. In this case, it can be a good idea to hold all code blocks in the body of the report, and display them at the end of a document (e.g., in an appendix).

There is a simple method of extracting all code chunks in a document and put them together in a single code chunk using the chunk option \texttt{ref.label} and the function \texttt{knitr::all\_labels()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Appendix: All code for this report}

\BaseNTok{```\{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Please read Section \ref{ref-label} if you are not familiar with the chunk option \texttt{ref.label}.

The function \texttt{knitr::all\_labels()} returns a vector of all chunk labels in the document, so \texttt{ref.label\ =\ knitr::all\_labels()} means retrieving all source code chunks to this code chunk. With the chunk options \texttt{echo\ =\ TRUE} (display the code) and \texttt{eval\ =\ FALSE} (do not evaluate this particular code chunk because all code has been executed before), you can show a copy of all your source code in one code chunk.

Since \texttt{ref.label} can be a character vector of arbitrary chunk labels, you can certainly filter the labels to decide a subset of code chunks to display in the code appendix. Below is an example (credits to \href{https://yihui.org/en/2018/09/code-appendix/}{Ariel Muldoon}) of excluding the labels \texttt{setup} and \texttt{get-labels}:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r get-labels, echo = FALSE\}}
\BaseNTok{labs = knitr::all_labels()}
\BaseNTok{labs = setdiff(labs, c("setup", "get-labels"))}
\BaseNTok{```}

\BaseNTok{```\{r all-code, ref.label=labs, eval=FALSE\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can also filter code chunks using the arguments of \texttt{knitr::all\_labels()}. For example, you may use \texttt{knitr::all\_labels(engine\ ==\ "Rcpp",\ echo\ ==\ FALSE)} to obtain all your code chunks that use the \texttt{Rcpp} engine (\texttt{engine\ ==\ "Rcpp"}) and are not displayed in the document (\texttt{echo\ =\ FALSE}). If you want precise control over which code chunks to display in the appendix, you may use a special chunk option \texttt{appendix\ =\ TRUE} on certain code chunks, and \texttt{ref.label\ =\ knitr::all\_labels(appendix\ ==\ TRUE)} to obtain the labels of these code chunks.

\hypertarget{lua-filters}{%
\section{Manipulate Markdown via Pandoc Lua filters (*)}\label{lua-filters}}

Technically, this section may be a little advanced, but once you learn the Pandoc abstract syntax tree (AST), you will have the power of manipulating any Markdown elements with the programming language called Lua.

Basically, when Pandoc reads a Markdown file, the content will be parsed into an AST. Pandoc allows you to modify this AST with Lua scripts. We use the following simple Markdown file (named \texttt{ast.md}) to show what the AST means:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{## Section One}

\NormalTok{Hello world!}
\end{Highlighting}
\end{Shaded}

The file contains a header and a paragraph. It may be easier for R users to understand the AST if we convert the file to the JSON format:

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pandoc}\NormalTok{ -f markdown -t json -o ast.json ast.md}
\end{Highlighting}
\end{Shaded}

Then read the JSON file into R, and print out the data structure:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{:::}\KeywordTok{tree}\NormalTok{(}
\NormalTok{  jsonlite}\OperatorTok{::}\KeywordTok{fromJSON}\NormalTok{(}\StringTok{'ast.json'}\NormalTok{, }\DataTypeTok{simplifyVector =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
List of 3
 |-blocks            :List of 2
 |  |-:List of 2
 |  |  |-t: chr "Header"
 |  |  |-c:List of 3
 |  |     |-: int 2
 |  |     |-:List of 3
 |  |     |  |-: chr "section-one"
 |  |     |  |-: list()
 |  |     |  |-: list()
 |  |     |-:List of 3
 |  |        |-:List of 2
 |  |        |  |-t: chr "Str"
 |  |        |  |-c: chr "Section"
 |  |        |-:List of 1
 |  |        |  |-t: chr "Space"
 |  |        |-:List of 2
 |  |           |-t: chr "Str"
 |  |           |-c: chr "One"
 |  |-:List of 2
 |     |-t: chr "Para"
 |     |-c:List of 3
 |        |-:List of 2
 |        |  |-t: chr "Str"
 |        |  |-c: chr "Hello"
 |        |-:List of 1
 |        |  |-t: chr "Space"
 |        |-:List of 2
 |           |-t: chr "Str"
 |           |-c: chr "world!"
 |-pandoc-api-version:List of 4
 |  |-: int 1
 |  |-: int 17
 |  |-: int 5
 |  |-: int 1
 |-meta              : Named list()
\end{verbatim}

You can see that the Markdown content is represented in a recursive list. The label \texttt{t} stands for ``type'', and \texttt{c} stands for ``content.'' Take the header for example. Its type is ``Header'', and its content has three sub-elements: the header level (\texttt{2}), the attributes (e.g., the ID is \texttt{section-one}), and the text content.

After you are aware of the AST, you can modify it with the Lua programming language. Pandoc has a built-in Lua interpreter, so you do not need to install additional tools. The Lua scripts are called ``Lua filters'' for Pandoc. Next we give a quick example of raising the levels of headers by one, e.g., convert level-3 headers to level-2 headers. This may be useful when the top-level headers of your document are level-2 headers, but you want to start with level-1 headers instead.

First, we create a Lua script file named \texttt{raise-header.lua}, which contains a function named \texttt{Header}, indicating that we want to modify elements of the type ``Header'' (in general, you can use the type name as the function name to process elements of a certain type):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{function}\NormalTok{ Header}\OperatorTok{(}\NormalTok{el}\OperatorTok{)}
  \CommentTok{-- The header level can be accessed via the attribute 'level'}
  \CommentTok{-- of the element. See the Pandoc documentation later.}
  \ControlFlowTok{if} \OperatorTok{(}\NormalTok{el}\OperatorTok{.}\NormalTok{level }\OperatorTok{<=} \DecValTok{1}\OperatorTok{)} \ControlFlowTok{then}
    \FunctionTok{error}\OperatorTok{(}\StringTok{"I don't know how to raise the level of h1"}\OperatorTok{)}
  \ControlFlowTok{end}
\NormalTok{  el}\OperatorTok{.}\NormalTok{level }\OperatorTok{=}\NormalTok{ el}\OperatorTok{.}\NormalTok{level }\OperatorTok{-} \DecValTok{1}
  \ControlFlowTok{return}\NormalTok{ el}
\ControlFlowTok{end}
\end{Highlighting}
\end{Shaded}

Then we can pass this script to Pandoc via the argument \texttt{-\/-lua-filter}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pandoc}\NormalTok{ -t markdown --atx-headers \textbackslash{}}
\NormalTok{  --lua-filter=raise-header.lua ast.md}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# Section One

Hello world!
\end{verbatim}

You can see that we have successfully converted \texttt{\#\#\ Section\ One} to \texttt{\#\ Section\ One}. You may feel this example is trivial, and wonder why not simply replacing \texttt{\#\#} with \texttt{\#} with a regular expression like:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{gsub}\NormalTok{(}\StringTok{"^##"}\NormalTok{, }\StringTok{"#"}\NormalTok{, }\KeywordTok{readLines}\NormalTok{(}\StringTok{"ast.md"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Usually it is not robust to manipulate a structured document with regular expressions, because there are almost always exceptions, e.g., what if \texttt{\#\#} means a comment in R code? The AST gives you the structured data, so you know for sure that you are modifying the expected elements.

Pandoc has extensive documentation on Lua filters at \url{https://pandoc.org/lua-filters.html}, where you can find a large number of examples. You can also find some filters written by the community in the GitHub repository at \url{https://github.com/pandoc/lua-filters}.

In the R Markdown world, below is an incomplete list of packages that have made use of Lua filters (usually they are in the \texttt{inst/} directory):

\begin{itemize}
\item
  The \textbf{rmarkdown} package (\url{https://github.com/rstudio/rmarkdown}) contains filters that insert page breaks (see Section \ref{pagebreaks}) and generate custom blocks (see Section \ref{custom-blocks}).
\item
  The \textbf{pagedown} package (\url{https://github.com/rstudio/pagedown}) contains filters that help implement footnotes and the list of figures on HTML pages.
\item
  The \textbf{govdown} package (\url{https://github.com/ukgovdatascience/govdown}) contains filters to convert Pandoc's fenced \texttt{Div}s to appropriate HTML tags.
\end{itemize}

You can also find an example in Section \ref{lua-color} in this book, which shows you how to change the text color with a Lua filter.

For R Markdown users who do not want to create R packages to ship the Lua filters (like the above packages), you may store these Lua scripts anywhere on your computer, and apply them through the \texttt{pandoc\_args} option of an R Markdown output format, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{pandoc_args}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{-}\AttributeTok{ --lua-filter=raise-header.lua}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\hypertarget{formatting}{%
\chapter{Formatting}\label{formatting}}

The greatest strength of the Markdown language is that its simplicity makes it very easy to read and write even to newcomers. This is its key design principle, as outlined by the creator of the original Markdown language:

\begin{quote}
A Markdown-formatted document should be publishable as-is, as plain text, without looking like it's been marked up with tags or formatting instructions.

\begin{flushright}

--- \href{http://daringfireball.net/projects/markdown/syntax\#philosophy}{John Gruber}

\end{flushright}
\end{quote}

However, this comes at a cost of customization. Many features of typical word processors are not directly available in Markdown, e.g.,

\begin{itemize}
\item
  Changing the font size of a piece of text;
\item
  Changing the font color of certain words;
\item
  Specifying text alignment.
\end{itemize}

We leave it to you to decide whether such features are worth your effort. To some degree, Markdown reflects the philosophy of Stoicism: the ``natural world'' consists of plain text, and you should not be \emph{controlled} by the desire for (visual) pleasure. Anyway, this chapter offers some tips on how you can customize the appearance and styling of elements in an R Markdown document.

If you need a reminder in the basics of the Markdown language, the R Markdown cheatsheet at \url{https://www.rstudio.com/resources/cheatsheets/} provides a good overview of the basic syntax.

\hypertarget{font-color}{%
\section{Font color}\label{font-color}}

The Markdown syntax has no built-in method for changing text colors. We can use HTML and LaTeX syntax to change the formatting of words:

\begin{itemize}
\item
  For HTML, we can wrap the text in the \texttt{\textless{}span\textgreater{}} tag and set color with CSS, e.g., \texttt{\textless{}span\ style="color:\ red;"\textgreater{}text\textless{}/span\textgreater{}}.
\item
  For PDF, we can use the LaTeX command \texttt{\textbackslash{}textcolor\{\}\{\}}. This requires the LaTeX package \textbf{xcolor}, which is included in Pandoc's default LaTeX template.
\end{itemize}

As an example of changing the color in PDF text:

\begin{verbatim}
---
output: pdf_document
---

Roses are \textcolor{red}{red}, violets are \textcolor{blue}{blue}.
\end{verbatim}

If you want to design an R Markdown document for multiple output formats, you should not embed raw HTML or LaTeX code in your document, because they will be ignored in the other output formats (e.g., LaTeX code will be ignored in HTML output, and HTML tags will be lost in LaTeX output). Next, we provide two possible methods to deal with this issue.

\hypertarget{using-an-r-function-to-write-raw-html-or-latex-code}{%
\subsection{Using an R function to write raw HTML or LaTeX code}\label{using-an-r-function-to-write-raw-html-or-latex-code}}

We can write a custom R function to insert the correct syntax depending on the output format using the \texttt{is\_latex\_output()} and \texttt{is\_html\_output()} functions in \textbf{knitr} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{colorize <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, color) \{}
  \ControlFlowTok{if}\NormalTok{ (knitr}\OperatorTok{::}\KeywordTok{is_latex_output}\NormalTok{()) \{}
    \KeywordTok{sprintf}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{textcolor\{%s\}\{%s\}"}\NormalTok{, color, x)}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (knitr}\OperatorTok{::}\KeywordTok{is_html_output}\NormalTok{()) \{}
    \KeywordTok{sprintf}\NormalTok{(}\StringTok{"<span style='color: %s;'>%s</span>"}\NormalTok{, color, x)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ x}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

We can then use the code in an inline R expression \texttt{\textasciigrave{}r\ colorize("some\ words\ in\ red",\ "red")\textasciigrave{}}, which will create \textcolor{red}{some words in red} (you will not see the red color if you are reading this book printed in black and white).

\hypertarget{lua-color}{%
\subsection{Using a Pandoc Lua filter (*)}\label{lua-color}}

This method may be a little advanced for R users because it involves another programming language, Lua, but it is extremely powerful---you can programmatically modify Markdown elements via Pandoc's Lua filters (see Section \ref{lua-filters}). Below is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Color text with a Lua filter"}
\NormalTok{output: }
\NormalTok{  html_document: }
\BaseNTok{    pandoc_args: ["--lua-filter=color-text.lua"]}
\NormalTok{  pdf_document: }
\BaseNTok{    pandoc_args: ["--lua-filter=color-text.lua"]}
\BaseNTok{    keep_tex: true}
\NormalTok{---}

\NormalTok{First, we define a Lua filter and write it to}
\NormalTok{the file }\BaseNTok{`color-text.lua`}\NormalTok{.}

\BaseNTok{```\{cat, engine.opts = list(file = "color-text.lua")\}}
\BaseNTok{Span = function(el)}
\BaseNTok{  color = el.attributes['color']}
\BaseNTok{  -- if no color attribute, return unchange}
\BaseNTok{  if color == nil then return el end}
\BaseNTok{  }
\BaseNTok{  -- tranform to <span style="color: red;"></span>}
\BaseNTok{  if FORMAT:match 'html' then}
\BaseNTok{    -- remove color attributes}
\BaseNTok{    el.attributes['color'] = nil}
\BaseNTok{    -- use style attribute instead}
\BaseNTok{    el.attributes['style'] = 'color: ' .. color .. ';'}
\BaseNTok{    -- return full span element}
\BaseNTok{    return el}
\BaseNTok{  elseif FORMAT:match 'latex' then}
\BaseNTok{    -- remove color attributes}
\BaseNTok{    el.attributes['color'] = nil}
\BaseNTok{    -- encapsulate in latex code}
\BaseNTok{    table.insert(}
\BaseNTok{      el.content, 1,}
\BaseNTok{      pandoc.RawInline('latex', '\textbackslash{}\textbackslash{}textcolor\{'..color..'\}\{')}
\BaseNTok{    )}
\BaseNTok{    table.insert(}
\BaseNTok{      el.content,}
\BaseNTok{      pandoc.RawInline('latex', '\}')}
\BaseNTok{    )}
\BaseNTok{    -- returns only span content}
\BaseNTok{    return el.content}
\BaseNTok{  else}
\BaseNTok{    -- for other format return unchanged}
\BaseNTok{    return el}
\BaseNTok{  end}
\BaseNTok{end}
\BaseNTok{```}

\NormalTok{Now we can test the filter with some text in brackets with}
\NormalTok{the }\BaseNTok{`color`}\NormalTok{ attribute, e.g.,}

\NormalTok{>}\DataTypeTok{ Roses are [red and **bold**]\{color="red"\} and}
\DataTypeTok{> violets are [blue]\{color="blue"\}.}
\end{Highlighting}
\end{Shaded}

In this example, we implicitly used a Pandoc Markdown extension named \texttt{bracketed\_spans}, which allows us to write text with attributes, e.g., \texttt{{[}text{]}\{.class\ attribute="value"\}}. The Lua filter defined in the \texttt{cat} code chunk\footnote{If you are not familiar with \texttt{cat} code chunks, please see Section \ref{eng-cat}. We used this engine here to conveniently write out a chunk to a \texttt{.lua} file, so we do not have to manage the Lua script in a separate file \texttt{color-text.lua}. You do not want to use the \texttt{cat} engine, you can definitely copy the Lua code and save it to a separate file, instead of embedding the Lua code in a code chunk.} puts text in \texttt{\textless{}span\ style="color:\ ..."\textgreater{}\textless{}/span\textgreater{}} if the output format is HTML, and in \texttt{\textbackslash{}textcolor\{...\}\{\}} if the output format is LaTeX. The Lua filter is written to a file \texttt{color-text.lua}, and enabled through the command-line option \texttt{-\/-lua-filter} passed to Pandoc via the \texttt{pandoc\_args} option of the output formats.

Compared to the previous method, the advantage of using the Lua filter is that you can still use Markdown syntax inside the brackets, whereas using the R function \texttt{colorize()} in the previous section does not allow Markdown syntax (e.g., \texttt{colorize(\textquotesingle{}**bold**\textquotesingle{})} will not be bold).

\hypertarget{indent-text}{%
\section{Indent text}\label{indent-text}}

As mentioned in Section \ref{linebreaks}, whitespaces are often meaningless in Markdown. Markdown will also ignore spaces used for indentation by default. However, we may want to keep the indentation in certain cases, e.g., in verses and addresses. In these situations, we can use line blocks by starting the line with a vertical bar (\texttt{\textbar{}}). The linebreaks and any leading spaces will be preserved in the output. For example:\footnote{This is a limerick written by Claus EkstrÃ¸m: \url{https://yihui.org/en/2018/06/xaringan-math-limerick/}.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{| When dollars appear it's a sign}
\NormalTok{|   that your code does not quite align  }
\NormalTok{| Ensure that your math  }
\NormalTok{|   in xaringan hath  }
\NormalTok{|   been placed on a single long line}
\end{Highlighting}
\end{Shaded}

The output is:

\begin{quote}
When dollars appear it's a sign\\
\hspace*{0.333em}\hspace*{0.333em}that your code does not quite align\\
Ensure that your math\\
\hspace*{0.333em}\hspace*{0.333em}in xaringan hath\\
\hspace*{0.333em}\hspace*{0.333em}been placed on a single long line
\end{quote}

The lines can be hard-wrapped in the Markdown source. If the continuation line begins with a space, the previous linebreak and the leading spaces on this line will be ignored as usual. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{| Hiring Manager}
\NormalTok{| School of Ninja,}
\NormalTok{  Hacker's University}
\NormalTok{| 404 Not Found Road,}
\NormalTok{  Undefined 0x1234, NA}
\end{Highlighting}
\end{Shaded}

The output is:

\begin{quote}
Hiring Manager\\
School of Ninja, Hacker's University\\
404 Not Found Road, Undefined 0x1234, NA
\end{quote}

You can see that the linebreak after ``School of Ninja'' was ignored.

\hypertarget{text-width}{%
\section{Control the width of text output}\label{text-width}}

Sometimes the text output printed from R code may be too wide. If the output document has a fixed page width (e.g., PDF documents), the text output may exceed the page margin. See Figure \ref{fig:wrap-text-1} for an example.

The R global option \texttt{width} can be used to control the width of printed text output from some R functions, and you may try a smaller value if the default is too large. This option typically indicates a rough number of characters per line (except East Asian languages). For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{The output is too wide in this chunk:}

\BaseNTok{```\{r\}}
\BaseNTok{options(width = 300)}
\BaseNTok{matrix(runif(100), ncol = 20)}
\BaseNTok{```}

\NormalTok{The output of this chunk looks better:}

\BaseNTok{```\{r\}}
\BaseNTok{options(width = 60)}
\BaseNTok{matrix(runif(100), ncol = 20)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Not all R functions respect the \texttt{width} option. If this option does not work, your only choice may be to wrap the long lines of text. This is actually the default behavior of the \texttt{html\_document} output format. If the HTML output format that you are using does not wrap the long lines, you may apply the CSS code below (see Section \ref{html-css} for how):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pre code \{}
  \KeywordTok{white-space}\NormalTok{: }\DecValTok{pre-wrap}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

For PDF output, it is trickier to wrap the lines. One solution is to use the LaTeX package \textbf{listings}, which can be enabled via the Pandoc argument \texttt{-\/-listings}. Then you have to set an option for this package, and the setup code can be included from an external LaTeX file (see Section \ref{latex-preamble} for how), e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{pandoc_args}\KeywordTok{:}\AttributeTok{ --listings}
\AttributeTok{    }\FunctionTok{includes}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{in_header}\KeywordTok{:}\AttributeTok{ preamble.tex}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

In \texttt{preamble.tex}, we set an option of the \textbf{listings} package:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\textbackslash{}lstset}\NormalTok{\{}
\NormalTok{  breaklines=true}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If you do not like the appearance of code blocks with \textbf{listings}, you can set up other \textbf{listings} options in \texttt{\textbackslash{}lstset\{\}}, e.g., you may change the font family with \texttt{basicstyle=\textbackslash{}ttfamily}. You can find more information about this package in its documentation: \url{https://ctan.org/pkg/listings}.

Figure \ref{fig:wrap-text-1} shows the default \texttt{pdf\_document} output that contains wide text, which exceeds the page margin. Figure \ref{fig:wrap-text-2} shows the PDF output when we use the \textbf{listings} package to wrap the text.

\begin{figure}
\includegraphics[width=1\linewidth]{images/wrap-none} \caption{Normal text output that is too wide.}\label{fig:wrap-text-1}
\end{figure}
\begin{figure}
\includegraphics[width=1\linewidth]{images/wrap-listings} \caption{Text output wrapped with the listings package.}\label{fig:wrap-text-2}
\end{figure}

\hypertarget{figure-size}{%
\section{Control the size of plots/images}\label{figure-size}}

The size of plots made in R can be controlled by the chunk option \texttt{fig.width} and \texttt{fig.height} (in inches). Equivalently, you can use the \texttt{fig.dim} option to specify the width and height in a numeric vector of length 2, e.g., \texttt{fig.dim\ =\ c(8,\ 6)} means \texttt{fig.width\ =\ 8} and \texttt{fig.height\ =\ 6}. These options set the physical size of plots, and you can choose to display a different size in the output using chunk options \texttt{out.width} and \texttt{out.height}, e.g., \texttt{out.width\ =\ "50\%"}.

If a plot or an image is not generated from an R code chunk, you can include it in two ways:

\begin{itemize}
\item
  Use the Markdown syntax \texttt{!{[}caption{]}(path/to/image)}. In this case, you can set the size of the image using the \texttt{width} and/or \texttt{height} attributes, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{We include an image in the next paragraph:}

\AlertTok{![A nice image.](foo/bar.png)}\NormalTok{\{width=50%\}}
\end{Highlighting}
\end{Shaded}
\item
  Use the \textbf{knitr} function \texttt{knitr::include\_graphics()} in a code chunk. You can use chunk options such as \texttt{out.width} and \texttt{out.height} for this chunk, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{We include an external image with the R function:}

\BaseNTok{```\{r, echo=FALSE, out.width="50%", fig.cap="A nice image."\}}
\BaseNTok{knitr::include_graphics("foo/bar.png")}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}
\end{itemize}

We used the width \texttt{50\%} in the above examples, which means half of the width of the image container (if the image is directly contained by a page instead of a child element of the page, that means half of the page width). If you know that you only want to generate the image for a specific output format, you can use a specific unit. For example, you may use \texttt{300px} if the output format is HTML.

\hypertarget{fig-align}{%
\section{Figure alignment}\label{fig-align}}

The chunk option \texttt{fig.align} specifies the alignment of figures. For example, you can center images with \texttt{fig.align\ =\ \textquotesingle{}center\textquotesingle{}}, or right-align images with \texttt{fig.align\ =\ \textquotesingle{}right\textquotesingle{}}. This option works for both HTML and LaTeX output, but may not work for other output formats (such as Word, unfortunately). It works for both plots drawn from R code chunks and external images included via \texttt{knitr::include\_graphics()}.

\hypertarget{verbatim-code-chunks}{%
\section{Verbatim code chunks}\label{verbatim-code-chunks}}

Typically we write code chunks and inline expressions that we want to be parsed and evaluated by \textbf{knitr}. However, if you are trying to write a tutorial on using \textbf{knitr}, you may need to generate verbatim code chunk or inline expression that is \emph{not} parsed by \textbf{knitr}, and we want to display the content of the chunk header.

Unfortunately, we cannot wrap the code chunk in another layer of backticks, but instead we must make the code chunk invalid within the source code by inserting \texttt{\textasciigrave{}r\ \textquotesingle{}\textquotesingle{}\textasciigrave{}} to the chunk header. This will be evaluated as an inline expression to \emph{an empty string} by \textbf{knitr}. For this example, the following ``code chunk'' in the source document:

\begin{verbatim}
```{r, eval=TRUE}`r ''`
1 + 1
```
\end{verbatim}

will be rendered as:

\begin{verbatim}
```{r, eval=TRUE}
1 + 1
```
\end{verbatim}

in the output. The inline expression is gone because it is substituted by an empty string. However, that is only the first step. To show something verbatim in the output, the syntax in Markdown is to wrap it in a code block (indent by four spaces or use backtick fences). This will be the actual source if you want to see the output above:

\begin{verbatim}
````
```{r, eval=TRUE}`r ''`
1 + 1
```
````
\end{verbatim}

Why four backticks? That is because you have to use at least N+1 backticks to wrap up N backticks.

\hypertarget{show-a-verbatim-inline-expression}{%
\subsection{Show a verbatim inline expression}\label{show-a-verbatim-inline-expression}}

There are multiple ways to show a verbatim inline expression. The first way is to break the inline expression after \texttt{\textasciigrave{}r}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{This will show a verbatim inline R expression `}\BaseNTok{` `}\NormalTok{r}
\NormalTok{1+1}\BaseNTok{` `}\NormalTok{` in the output.}
\end{Highlighting}
\end{Shaded}

The trick works due to two reasons (1) a single line break is often the same as a space to Markdown parsers (by comparison, two consecutive line breaks means starting a new paragraph); (2) \textbf{knitr} requires a space after \texttt{\textasciigrave{}r} to parse it; if the space is missing, it will not be treated as an inline expression. In the output document, you should see:

\begin{quote}
This will show a verbatim inline R expression \texttt{\textasciigrave{}r\ 1+1\textasciigrave{}} in the output.
\end{quote}

Another way to show a verbatim inline R expression is to wrap the R code in \texttt{knitr::inline\_expr()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{This will show a verbatim inline R expression}
\NormalTok{`}\BaseNTok{` `}\NormalTok{r knitr::inline_expr("1+1")}\BaseNTok{` `}\NormalTok{` in the output.}
\end{Highlighting}
\end{Shaded}

I'd recommend the second way, because the first way is more or less a hack taking advantage of the Markdown syntax and \textbf{knitr}'s parser.

\hypertarget{number-lines}{%
\section{Line numbers for code blocks (*)}\label{number-lines}}

You can add line numbers to either source code blocks via the chunk option \texttt{attr.source\ =\ ".numberLines"} or text output blocks via \texttt{attr.output\ =\ ".numberLines"}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, attr.source='.numberLines'\}}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  x <- 1:10}
\BaseNTok{  x + 1}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output is:

\begin{Shaded}
\begin{Highlighting}[numbers=left,,]
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Note that for HTML output, you have to choose a syntax highlighting theme provided by Pandoc, which means the \texttt{highlight} option of the output format should not be \texttt{default} or \texttt{textmate}. You can use other values for this option listed on the help page \texttt{?rmarkdown::html\_document}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{highlight}\KeywordTok{:}\AttributeTok{ tango}
\end{Highlighting}
\end{Shaded}

For \textbf{bookdown}'s \texttt{gitbook} output format, you may need to adjust the CSS a little bit for the line numbers to be displayed properly on the left side of the code. Below is what we used for this book (if you find the line numbers too close to the left margin, increase the \texttt{left} value to, say, \texttt{-0.2em}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pre}\FunctionTok{.numberSource}\NormalTok{ code }\OperatorTok{>}\NormalTok{ span }\OperatorTok{>}\NormalTok{ a}\InformationTok{:first-child::before}\NormalTok{ \{}
  \KeywordTok{left}\NormalTok{: }\DecValTok{-0.3}\DataTypeTok{em}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

For \textbf{revealjs}'s \texttt{revealjs\_presentation} output format, you may also need to adjust the CSS.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.reveal}\NormalTok{ pre code \{}
  \KeywordTok{overflow}\NormalTok{: }\DecValTok{visible}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

See Section \ref{html-css} if you do not know how to apply custom CSS styles to HTML output.

You can also specify the starting number via the \texttt{startFrom} attribute, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, attr.source='.numberLines startFrom="5"'\}}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  1:10}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Line numbers are not supported for Word output at the moment.

\hypertarget{multi-column}{%
\section{Multi-column layout (*)}\label{multi-column}}

Pandoc's Markdown supports the multi-column layout for slides but not other types of documents. In this recipe, we show how to use the multi-column layout in normal HTML documents and LaTeX documents. This recipe was inspired by Atsushi Yasumoto's solutions to the \textbf{knitr} issue \url{https://github.com/yihui/knitr/issues/1743}.

The recipe will be much simpler if you only need to consider HTML output, because arranging HTML elements side by side is relatively simple via CSS. It will be even simpler if you only need to arrange the text output of a code chunk side by side. Below is the first example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{output: html_document}
\NormalTok{---}

\BaseNTok{```\{r attr.source="style='display:inline-block;'", collapse=TRUE\}}
\BaseNTok{1:10  # a sequence from 1 to 10}
\BaseNTok{10:1  # in the reverse order}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The CSS attribute \texttt{display:\ inline-block;} means the output code blocks (i.e., the \texttt{\textless{}pre\textgreater{}} tags in HTML) should be displayed as inline elements. By default, these blocks are displayed as block-level elements (i.e., \texttt{display:\ block;}) and will occupy whole rows. The chunk option \texttt{collapse\ =\ TRUE} means the text output will be merged into the R source code block, so both the source and its text output will be placed in the same \texttt{\textless{}pre\textgreater{}} block.

If you want to arrange arbitrary content side by side in HTML output, you can use Pandoc's \href{https://pandoc.org/MANUAL.html\#divs-and-spans}{fenced \texttt{Div}.} The name ``Div'' comes from the HTML tag \texttt{\textless{}div\textgreater{}}, but you can interpret it as an arbitrary block or container. A \texttt{Div} starts and ends with three or more colons (e.g., \texttt{:::}). A \texttt{Div} with more colons can contain \texttt{Div}s with fewer colons. An important and useful feature of the fenced \texttt{Div} is that you can attach attributes to it. For example, you can apply the CSS attribute \texttt{display:\ flex;} to an outside container, so that the inside containers will be placed side by side:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{:::: \{style="display: flex;"\}}

\NormalTok{::: \{\}}
\NormalTok{Here is the **first** Div.}

\BaseNTok{```\{r\}}
\BaseNTok{str(iris)}
\BaseNTok{```}
\NormalTok{:::}

\NormalTok{::: \{\}}
\NormalTok{And this block will be put on the right:}

\BaseNTok{```\{r\}}
\BaseNTok{plot(iris[, -5])}
\BaseNTok{```}
\NormalTok{:::}

\NormalTok{::::}
\end{Highlighting}
\end{Shaded}

In the above example, the outside \texttt{Div} (\texttt{::::}) contains two \texttt{Div}s (\texttt{:::}). You can certainly add more \texttt{Div}s inside. To learn more about the very powerful CSS attribute \texttt{display:\ flex;} (CSS Flexbox), you may read the guide at \url{https://css-tricks.com/snippets/css/a-guide-to-flexbox/}. The CSS Grid (\texttt{display:\ grid;}) is also very powerful and can be used in the above example, too. If you want to try it, you may change \texttt{display:\ flex;} to \texttt{display:\ grid;\ grid-template-columns:\ 1fr\ 1fr;\ grid-column-gap:\ 10px;}. See the guide at \url{https://css-tricks.com/snippets/css/complete-guide-grid/} if you want to learn more about the grid layout.

It is trickier if you want the layout to work for both HTML and LaTeX output. We show a full example below that works for HTML document, LaTeX document, and Beamer presentation output:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{output:}
\NormalTok{  html_document: }
\BaseNTok{    css: columns.css}
\NormalTok{  pdf_document: }
\BaseNTok{    keep_tex: true}
\BaseNTok{    includes:}
\BaseNTok{      in_header: columns.tex}
\NormalTok{  beamer_presentation: }
\BaseNTok{    keep_tex: true}
\BaseNTok{    includes:}
\BaseNTok{      in_header: columns.tex}
\NormalTok{---}

\FunctionTok{# Two columns}

\NormalTok{Below is a Div containing three child Divs side by side. The Div}
\NormalTok{in the middle is empty, just to add more space between the left}
\NormalTok{and right Divs.}

\NormalTok{:::::: \{.cols data-latex=""\}}

\NormalTok{::: \{.col data-latex="\{0.55\textbackslash{}textwidth\}"\}}
\BaseNTok{```\{r, echo=FALSE, fig.width=5, fig.height=4\}}
\BaseNTok{par(mar = c(4, 4, .2, .1))}
\BaseNTok{plot(cars, pch = 19)}
\BaseNTok{```}
\NormalTok{:::}

\NormalTok{::: \{.col data-latex="\{0.05\textbackslash{}textwidth\}"\}}
\NormalTok{\textbackslash{} }
\NormalTok{<!--}\CommentTok{ an empty Div (with a white space), serving as}
\CommentTok{a column separator -->}
\NormalTok{:::}

\NormalTok{::: \{.col data-latex="\{0.4\textbackslash{}textwidth\}"\}}
\NormalTok{The figure on the left-hand side shows the }\BaseNTok{`cars`}\NormalTok{ data.}

\NormalTok{Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do}
\NormalTok{eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut}
\NormalTok{enim ad minim veniam, quis nostrud exercitation ullamco laboris}
\NormalTok{nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor}
\NormalTok{in reprehenderit in voluptate velit esse cillum dolore eu fugiat}
\NormalTok{nulla pariatur.}
\NormalTok{:::}
\NormalTok{::::::}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\includegraphics[width=1\linewidth]{images/multicol} \caption{A two-column layout that works for HTML, LaTeX, and Beamer output.}\label{fig:multicol}
\end{figure}

Figure \ref{fig:multicol} shows the output. In this example, we used an outside \texttt{Div} with the class \texttt{.cols} and three inside \texttt{Div}s with the class \texttt{.col}. For HTML output, we introduced an external CSS file \texttt{columns.css}, in which we applied the Flexbox layout to the outside \texttt{Div} so the inside \texttt{Div}s can be placed side by side:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.cols}\NormalTok{ \{}\KeywordTok{display}\NormalTok{: flex}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

For LaTeX output (\texttt{pdf\_document}), we have to introduce some dirty hacks stored in \texttt{columns.tex} to the LaTeX preamble to define the LaTeX environments \texttt{cols} and \texttt{col}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\textbackslash{}newenvironment}\NormalTok{\{cols\}[1][]\{\}\{\}}

\FunctionTok{\textbackslash{}newenvironment}\NormalTok{\{col\}[1]\{}\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{minipage}\NormalTok{\}\{#1\}}\FunctionTok{\textbackslash{}ignorespaces}\NormalTok{\}\{}\CommentTok{%}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{minipage}\NormalTok{\}}
\FunctionTok{\textbackslash{}ifhmode\textbackslash{}unskip\textbackslash{}fi}
\FunctionTok{\textbackslash{}aftergroup\textbackslash{}useignorespacesandallpars}\NormalTok{\}}

\FunctionTok{\textbackslash{}def}\NormalTok{\textbackslash{}useignorespacesandallpars#1\textbackslash{}ignorespaces\textbackslash{}fi\{}\CommentTok{%}
\NormalTok{#1\textbackslash{}fi\textbackslash{}ignorespacesandallpars\}}

\FunctionTok{\textbackslash{}makeatletter}
\FunctionTok{\textbackslash{}def}\NormalTok{\textbackslash{}ignorespacesandallpars\{}\CommentTok{%}
\NormalTok{  \textbackslash{}@ifnextchar\textbackslash{}par}
\NormalTok{    \{\textbackslash{}expandafter\textbackslash{}ignorespacesandallpars\textbackslash{}@gobble\}}\CommentTok{%}
\NormalTok{    \{\}}\CommentTok{%}
\NormalTok{\}}
\FunctionTok{\textbackslash{}makeatother}
\end{Highlighting}
\end{Shaded}

The \texttt{col} environment is particularly complicated mainly because Pandoc starts a new paragraph for each \texttt{Div} in LaTeX output, and we have to remove these new paragraphs, otherwise the \texttt{Div}s cannot be placed side by side. The hacks were borrowed from \url{https://tex.stackexchange.com/q/179016/9128}.

For Beamer output, we apply the same hacks in \texttt{columns.tex}. Please note that Pandoc has provided some special \texttt{Div}'s for \href{https://pandoc.org/MANUAL.html\#producing-slide-shows-with-pandoc}{slide shows,} such as \texttt{:::\ \{.columns\}}, \texttt{:::\ \{.column\}}, and \texttt{:::\ \{.incremental\}}. They have their special meanings. You have to be careful \emph{not} to use these types of \texttt{Div}'s if you intend to convert a \texttt{Div} to a LaTeX environment in the way mentioned in this section. That is why we did not use the \texttt{Div} types \texttt{columns} or \texttt{column}, but chose to use \texttt{cols} and \texttt{col} instead.

For more information about fenced \texttt{Div}'s, please refer to Section \ref{custom-blocks}.

\hypertarget{latex-output}{%
\chapter{LaTeX Output}\label{latex-output}}

For many authors, the main output of their work will be the PDF report, in which case they can utilize the powerful styling of LaTeX. In this chapter, we discuss approaches that can be used to customize PDF reports, such as including LaTeX code or packages in the preamble, using custom LaTeX templates, adding headers and footers, generating sub-figures, and writing raw LaTeX code in the document body.

We want to offer a note of caution before we start, however. One benefit of R Markdown is the fact that a single source document can create documents with multiple formats. By tailoring your work to a single output format, you may improve the appearance and performance of a single output format but at the expense of this transferability. This problem is not unique to LaTeX, but all other output formats.

\hypertarget{latex-preamble}{%
\section{Add LaTeX code to the preamble}\label{latex-preamble}}

The general structure of a LaTeX document is like this:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}documentclass}\NormalTok{\{}\ExtensionTok{article}\NormalTok{\}}
\CommentTok{% preamble}
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}
\CommentTok{% body}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

That is, you declare the document class in \texttt{\textbackslash{}documentclass\{\}}, load certain LaTeX packages and set certain options if necessary in the preamble, and start writing the body of your document after \texttt{\textbackslash{}begin\{document\}}. A Markdown document is mostly the body of the document. If you want to add anything to the preamble, you have to use the \texttt{includes} option of \texttt{pdf\_document}. This option has three sub-options: \texttt{in\_header}, \texttt{before\_body}, and \texttt{after\_body}. Each of them takes one or multiple file paths. The file(s) specified in \texttt{in\_header} will be added to the preamble. The files specified in \texttt{before\_body} and \texttt{after\_body} are added before and after the document body, respectively.

For example, below is a trick that turns hyperlinks on text into footnotes. This trick is useful when the PDF output document is printed on paper, because readers will not be able to click the links (generated from \texttt{\textbackslash{}href\{URL\}\{text\}}) on paper but can see the URLs in footnotes. This trick displays both the text and URL.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{% you may want to save a copy of \textbackslash{}href before redefining it}
\CommentTok{% \textbackslash{}let\textbackslash{}oldhref\textbackslash{}href}
\FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}href}\NormalTok{\}[2]\{#2}\FunctionTok{\textbackslash{}footnote}\NormalTok{\{}\FunctionTok{\textbackslash{}url}\NormalTok{\{#1\}\}\}}
\end{Highlighting}
\end{Shaded}

You can save the above code in a file with an arbitrary filename, e.g., \texttt{preamble.tex}. Then include it in the preamble through:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{includes}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{in_header}\KeywordTok{:}\AttributeTok{ }\StringTok{"preamble.tex"}
\end{Highlighting}
\end{Shaded}

For this particular trick, you do not really have to implement it by yourself, but can simply set the YAML option \texttt{links-as-notes} to \texttt{true} because it is a built-in feature of Pandoc's default LaTeX template (see Section \ref{latex-variables}).

Another way to add code to the preamble is to use the \texttt{header-includes} field in the YAML frontmatter. We will show an example in Section \ref{latex-logo}. The advantage of using \texttt{header-includes} is that you can keep everything in one R Markdown document. However, if your report is to be generated into multiple output formats, we still recommend that you use the \texttt{includes} method, because the \texttt{header-includes} field is unconditional, and will be included in non-LaTeX output documents, too. By comparison, the \texttt{includes} option is only applied to the \texttt{pdf\_document} format.

\hypertarget{latex-variables}{%
\section{Pandoc options for LaTeX output}\label{latex-variables}}

If you are using the default Pandoc template for LaTeX output, there are several options that you may set to adjust the appearance of the PDF output document. We list a few example options below, and you may see \url{https://pandoc.org/MANUAL.html\#variables-for-latex} for a full list.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{documentclass}\KeywordTok{:}\AttributeTok{ book}
\FunctionTok{classoption}\KeywordTok{:}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ twocolumn}
\AttributeTok{  }\KeywordTok{-}\AttributeTok{ landscape}
\FunctionTok{papersize}\KeywordTok{:}\AttributeTok{ a5}
\FunctionTok{linestretch}\KeywordTok{:}\AttributeTok{ }\FloatTok{1.5}
\FunctionTok{fontsize}\KeywordTok{:}\AttributeTok{ 12pt}
\FunctionTok{links-as-notes}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\end{Highlighting}
\end{Shaded}

The meanings of these options should be clear if you have some knowledge about LaTeX. The \texttt{documentclass} option sets the document class, e.g., \texttt{article}, \texttt{book}, and \texttt{report}, etc. The \texttt{classoption} is a list of options to be passed to the document class, e.g., you can create a two-column document with the \texttt{twocolumn} option,\footnote{This option changes the layout of the whole document, but if you want to switch back to the one-column mode from a certain point, you may insert a command \texttt{\textbackslash{}onecolumn} at that point. If you want to continue the two-column mode, insert \texttt{\textbackslash{}twocolumn}.} or the landscape layout with the \texttt{landscape} option (the default is the portrait layout). The \texttt{papersize} option sets the paper size, e.g., \texttt{a4}, \texttt{paper}, or \texttt{a5}. The \texttt{linestretch} option sets the line spacing. The \texttt{fontsize} option sets the font size, e.g., \texttt{10pt}, \texttt{11pt}, or \texttt{12pt}. The \texttt{links-as-notes} option turns links on text to footnotes, which is useful when the PDF is printed on paper, because readers will not be able to click the links on paper but can see the URLs in footnotes.

Changing fonts can be a little trickier. It depends on which LaTeX engine you are using. If you are using \texttt{pdflatex}, which is usually the default engine for most LaTeX-based output formats, you may use the \texttt{fontfamily} option to select a LaTeX font package to be loaded in your document to change the font, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fontfamily}\KeywordTok{:}\AttributeTok{ accanthis}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{    }\FunctionTok{latex_engine}\KeywordTok{:}\AttributeTok{ pdflatex}
\end{Highlighting}
\end{Shaded}

Then the document will use the font \href{https://tug.org/FontCatalogue/accanthis/}{``Accanthis''}. You may see \url{https://tug.org/FontCatalogue/} for a list of many other LaTeX font packages. If your LaTeX distribution is TinyTeX, the font packages should be automatically installed if they have not been installed (see Section \ref{install-latex}).

If you use the LaTeX engine \texttt{xelatex} or \texttt{lualatex}, you will be able to select fonts that are available on your local computer, and do not have to install additional LaTeX packages. YAML options like \texttt{mainfont}, \texttt{sansfont}, and \texttt{monofont} can be used to specify the main font, sans serif font, and typewriter font, respectively, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mainfont}\KeywordTok{:}\AttributeTok{ Arial}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{    }\FunctionTok{latex_engine}\KeywordTok{:}\AttributeTok{ xelatex}
\end{Highlighting}
\end{Shaded}

You can also use some of those LaTeX options when you generate Beamer slides, because a Beamer document is a LaTeX document, too. In addition, Pandoc has provided a few more options for Beamer slides, which can be found at \url{https://pandoc.org/MANUAL.html\#variables-for-beamer-slides}. For example, you can specify the author affiliation via the \texttt{institute} option:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ beamer_presentation}
\FunctionTok{institute}\KeywordTok{:}\AttributeTok{ }\StringTok{"University of Hackers"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\hypertarget{latex-logo}{%
\section{Add logo to title page}\label{latex-logo}}

We can use the \textbf{titling} LaTeX package to alter our title block to include an image. Below is a full example that shows how to add the R logo (\texttt{logo.jpg}) to the title page. The image can be of any format that LaTeX supports (e.g., \texttt{jpg}, \texttt{png}, or \texttt{pdf}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Adding a Logo to LaTeX Title}
\NormalTok{author: Michael Harper}
\NormalTok{date: December 7th, 2018}
\NormalTok{output: pdf_document}
\NormalTok{header-includes:}
\NormalTok{  - \textbackslash{}usepackage\{titling\}}
\NormalTok{  - \textbackslash{}pretitle\{\textbackslash{}begin\{center\}}
\BaseNTok{    \textbackslash{}includegraphics[width=2in,height=2in]\{logo.jpg\}\textbackslash{}LARGE\textbackslash{}\textbackslash{}\}}
\NormalTok{  - \textbackslash{}posttitle\{\textbackslash{}end\{center\}\}}
\NormalTok{---}

\NormalTok{<!--}\CommentTok{ Optionally include a page break. This will force the start}
\CommentTok{of the document to the second page -->}

\NormalTok{\textbackslash{}newpage}

\NormalTok{This is your report.}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{# copy the R logo to the current directory}
\BaseNTok{file.copy(file.path(R.home("doc"), "html", "logo.jpg"), '.')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

An example output is shown in Figure \ref{fig:latex-logo}.

\begin{figure}

{\centering \includegraphics{images/latex-logo} 

}

\caption{A logo on a LaTeX title page.}\label{fig:latex-logo}
\end{figure}

An alternative method that does not require a special LaTeX package (\textbf{titling}) is to just insert the image to the \texttt{title} field using the Markdown syntax. For example:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{title}\KeywordTok{: }\CharTok{|}
\NormalTok{  ![](logo.jpg)\{width=1in\}  }
\NormalTok{  Adding a Logo to LaTeX Title}
\end{Highlighting}
\end{Shaded}

In this case, you will not need the \texttt{header-includes} field in the YAML frontmatter in the first example. Please note that although you cannot see them, there are two trailing spaces after \texttt{!{[}{]}(logo.jpg)\{width=1in\}}, which means a line break in Markdown (see Section \ref{linebreaks}). Without the line break, the image and the title would be on the same line, which may not be what you desire.

\hypertarget{latex-extra}{%
\section{Include additional LaTeX packages}\label{latex-extra}}

The use of additional LaTeX packages can allow for extensive customization of document styling. In addition, several packages such as \textbf{kableExtra} \citep{R-kableExtra} may have LaTeX dependencies for the R package to function. Much like R, we need to load packages within the R Markdown document before we are able to use their functions.

\hypertarget{loading-latex-packages}{%
\subsection{Loading LaTeX packages}\label{loading-latex-packages}}

We can load additional LaTeX packages using the \texttt{extra\_dependencies} option within the \texttt{pdf\_document} YAML settings. This allows us to provide a list of LaTeX packages to be loaded in the intermediate LaTeX output document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"Using more LaTeX packages"}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\StringTok{"bbm"}\KeywordTok{,}\AttributeTok{ }\StringTok{"threeparttable"}\KeywordTok{]}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

If you need to specify options when loading the package, you can add a second-level to the list and provide the options as a list, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{caption}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\StringTok{"labelfont=\{bf\}"}\KeywordTok{]}
\AttributeTok{      }\FunctionTok{hyperref}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\StringTok{"unicode=true"}\KeywordTok{,}\AttributeTok{ }\StringTok{"breaklinks=true"}\KeywordTok{]}
\AttributeTok{      }\FunctionTok{lmodern}\KeywordTok{:}\AttributeTok{ }\CharTok{null}
\end{Highlighting}
\end{Shaded}

For those familiar with LaTeX, this is equivalent to the following LaTeX code:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{[labelfont=\{bf\}]\{}\ExtensionTok{caption}\NormalTok{\} }
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{[unicode=true, breaklinks=true]\{}\ExtensionTok{hyperref}\NormalTok{\}}
\FunctionTok{\textbackslash{}userpackage}\NormalTok{\{lmodern\}}
\end{Highlighting}
\end{Shaded}

The advantage of using the \texttt{extra\_dependencies} argument over the \texttt{includes} argument introduced in Section \ref{latex-preamble} is that you do not need to include an external file, so your Rmd document can be self-contained.

\hypertarget{example-packages}{%
\subsection{Example packages}\label{example-packages}}

There is an extensive community for LaTeX, and there are over 4,000 packages available through the \href{https://ctan.org}{Comprehensive TeX Archive Network} (CTAN). As some examples of LaTeX packages you could consider using within your report:

\begin{itemize}
\tightlist
\item
  \href{https://ctan.org/pkg/pdfpages}{pdfpages}: include full PDF pages from an external PDF document within your document.
\item
  \href{https://ctan.org/pkg/caption}{caption}: change the appearance of caption subtitles. For example, you can make the figure title italic or bold.
\item
  \href{https://ctan.org/pkg/fancyhdr}{fancyhdr}: change the style of running headers of all pages.
\end{itemize}

\hypertarget{figure-placement}{%
\section{Control the placement of figures}\label{figure-placement}}

One common frustration with LaTeX is the placement of figures and tables. Unlike in a word processor like Microsoft Word, in which figures are placed directly where the user specifies, LaTeX will attempt to place a figure in a position that does not violate certain typographic rules. In doing so, it can result in figures floating away from where they are referenced in the text. This section will explain some background information on how floating environments (such as figures) work, before providing several options for how to customize their behavior for your work.

\hypertarget{floating-environments}{%
\subsection{Floating environments}\label{floating-environments}}

By default, figures with captions are generated with the \texttt{figure} environment in LaTeX. For example, Pandoc will convert the following Markdown code that contains an image

\begin{Shaded}
\begin{Highlighting}[]
\AlertTok{![This is a figure.](images/cool.jpg)}
\end{Highlighting}
\end{Shaded}

to the LaTeX code:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{figure}\NormalTok{\}}
  \BuiltInTok{\textbackslash{}includegraphics}\NormalTok{\{}\ExtensionTok{images/cool.jpg}\NormalTok{\}}
  \FunctionTok{\textbackslash{}caption}\NormalTok{\{This is a figure.\}}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{figure}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The \texttt{figure} environment is a floating environment. You can read a detailed description of floats at \url{https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions}. In summary, floats are used as containers for things that cannot be broken over a page, such as tables and figures. If the figure or table can not be contained in the space left on the current page, LaTeX will try to place it at the top of the next page. If the figure is tall enough, it may occupy the whole next page, even if there is still space left for a few lines of text. The behavior can be controlled by different placement specifiers in square brackets after \texttt{\textbackslash{}begin\{figure\}}, e.g., \texttt{\textbackslash{}begin\{figure\}{[}b{]}}. Below is a list of possible specifiers:

\begin{itemize}
\tightlist
\item
  \texttt{h}: Place the float \emph{here}, i.e., approximately at the same point it occurs in the source text.
\item
  \texttt{t}: Position at the \emph{top} of the page.
\item
  \texttt{b}: Position at the \emph{bottom} of the page.
\item
  \texttt{p}: Put on a special \emph{page} for floats only.
\item
  \texttt{!}: Override internal parameters LaTeX uses for determining ``good'' float positions.
\item
  \texttt{H}: Place the float at precisely the location in the LaTeX code. This requires the \textbf{float} package (\texttt{\textbackslash{}usepackage\{float\}}).
\end{itemize}

These specifiers can be used in conjunction, e.g., \texttt{!b} forces LaTeX to place the figure at the bottom of a page. The default behavior is \texttt{tbp}. That is, LaTeX will try to position the figure at the top of the page, then at the bottom, and then on a separate page.

\hypertarget{prevent-figures-from-floating}{%
\subsection{Prevent figures from floating}\label{prevent-figures-from-floating}}

Many users will initially want to prevent figures from floating in their document, replicating the behavior of a traditional word processor. To do this, we must firstly load the LaTeX package \textbf{float}. This can be done by including the following line in the YAML:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\StringTok{"float"}\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

We can use the chunk option \texttt{fig.pos} to control the float behavior, and the use of \texttt{!H} will prevent any floating within the document. We can set the default behavior for the document so that all chunks have this setting by including the following line in the first code chunk in your R Markdown document:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_chunk}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{fig.pos =} \StringTok{"!H"}\NormalTok{, }\DataTypeTok{out.extra =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In general, we do not recommend that users force LaTeX to stop floating figures. This solution was included in this book by popular demand,\footnote{The related Stack Overflow question has been viewed for over 45,000 times: \url{https://stackoverflow.com/q/16626462/559676}.} but there could be some serious side-effects when LaTeX is unable to float figures.

\hypertarget{force-floats-forwards}{%
\subsection{Force floats forwards}\label{force-floats-forwards}}

An alternative to forcing all floats to be held is to force floating forwards in the text. This can remove a common issue, where a figure is shown at the top of the page before the relevant text comes. This can break the reading flow of a report. We can force it so that the figure always appears after the text by using the \textbf{flafter} LaTeX package as follows:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ }
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\StringTok{"flafter"}\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\hypertarget{adjust-latex-placement-rules}{%
\subsection{Adjust LaTeX placement rules (*)}\label{adjust-latex-placement-rules}}

LaTeX's own float placement parameters could prevent placements that seem entirely ``reasonable'' to you---they are notoriously rather conservative. These defaults are displayed in Table \ref{tab:float-default}.

\begin{table}

\caption{\label{tab:float-default}Default LaTeX float settings.}
\centering
\begin{tabular}[t]{l|l|l}
\hline
Command & Description & Default\\
\hline
topfraction & max fraction of page for floats at top & 0.7\\
\hline
bottomfraction & max fraction of page for floats at bottom & 0.3\\
\hline
textfraction & min fraction of page for text & 0.2\\
\hline
floatpagefraction & min fraction of page that should have floats & 0.5\\
\hline
topnumber & max number of floats at top of page & 2\\
\hline
bottomnumber & max number of floats at bottom of page & 1\\
\hline
totalnumber & max number of floats on a page & 3\\
\hline
\end{tabular}
\end{table}

To encourage LaTeX not to move your figures, we can alter these default settings. We could include the following in our LaTeX preamble file, reducing the minimum amount of text required on a page and allow more room for floats:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}topfraction}\NormalTok{\}\{.85\}}
\FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}bottomfraction}\NormalTok{\}\{.7\}}
\FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}textfraction}\NormalTok{\}\{.15\}}
\FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}floatpagefraction}\NormalTok{\}\{.66\}}
\FunctionTok{\textbackslash{}setcounter}\NormalTok{\{topnumber\}\{3\}}
\FunctionTok{\textbackslash{}setcounter}\NormalTok{\{bottomnumber\}\{3\}}
\FunctionTok{\textbackslash{}setcounter}\NormalTok{\{totalnumber\}\{4\}}
\end{Highlighting}
\end{Shaded}

If we have added these lines to a \texttt{.tex} file, we could include this file in the preamble of the LaTeX document using the method introduced in Section \ref{latex-preamble}.

\hypertarget{latex-subfigure}{%
\section{LaTeX sub-figures}\label{latex-subfigure}}

Sometimes you may want to include multiple images in a single figure environment. Sub-figures allow us to achieve this by arranging multiple images within a single environment and providing each with their own sub-caption.

Sub-figures require the LaTeX package \textbf{subfig}. We can load it via the \texttt{extra\_dependencies} YAML option within the \texttt{pdf\_document} output. For example:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}\AttributeTok{ }\StringTok{"subfig"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

To arrange all plots from a code chunk in sub-figures, you have to use the chunk options \texttt{fig.cap} (the caption for the whole figure environment) and \texttt{fig.subcap} (a character vector of the captions for sub-figures). For best output, you can also use the following options:

\begin{itemize}
\item
  \texttt{fig.ncol}: The number of columns of sub-figures. By default, all plots are arranged in a single row. You can break them into multiple rows.
\item
  \texttt{out.width}: The output width of individual plots. You will normally set this to \texttt{100\%} divided by the number of columns. For example, if you have two plots, the \texttt{out.width} option should be equal to or less than \texttt{50\%}, otherwise the plots may exceed the page margin.
\end{itemize}

Below is an illustrative example:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{extra_dependencies}\KeywordTok{:}\AttributeTok{ }\StringTok{"subfig"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, fig.cap='Figure 1', fig.subcap=c('(a)', '(b)', '(c)')\}}
\BaseNTok{plot(1:10)}
\BaseNTok{plot(cars, pch = 19)}
\BaseNTok{boxplot(Sepal.Width ~ Species, data = iris)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output is shown in Figure \ref{fig:latex-subfig}. For the sake of simplicity, we omitted a few chunk options in the chunk header of the above example, including \texttt{fig.ncol\ =\ 2}, \texttt{out.width\ =\ "50\%"}, \texttt{fig.align\ =\ "center"}, and the actual long captions.

\begin{figure}
\centering
\includegraphics{images/latex-subfig.png}
\caption{\label{fig:latex-subfig}An example of one figure environment containing multiple sub-figures.}
\end{figure}

\hypertarget{latex-unicode}{%
\section{Render documents containing Unicode characters}\label{latex-unicode}}

If you run into an error like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{! Package inputenc Error:}
\NormalTok{  Unicode char }\FunctionTok{\textbackslash{}u}\NormalTok{8: not set up for use with LaTeX.}
\end{Highlighting}
\end{Shaded}

it probably means that you are using the default LaTeX engine, \texttt{pdflatex}, to render the (intermediate \texttt{.tex}) document to PDF, which was unable to process certain Unicode characters in your document. If that is the case, you may switch to \texttt{xelatex} or \texttt{lualatex}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{latex_engine}\KeywordTok{:}\AttributeTok{ xelatex}
\end{Highlighting}
\end{Shaded}

You may also change the LaTeX engine for other document output formats, especially those based on \texttt{pdf\_document}, such as \texttt{bookdown::pdf\_document2} and \texttt{tufte::tufte\_handout}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  bookdown:}\FunctionTok{:pdf_document2}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{latex_engine}\KeywordTok{:}\AttributeTok{ lualatex}
\AttributeTok{  tufte:}\FunctionTok{:tufte_handout}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{latex_engine}\KeywordTok{:}\AttributeTok{ xelatex}
\end{Highlighting}
\end{Shaded}

\hypertarget{latex-fragment}{%
\section{Generate a LaTeX fragment}\label{latex-fragment}}

If you work with pure LaTeX documents primarily, you may still find R Markdown useful, because sometimes it may be more convenient to write in R Markdown and convert the document to a LaTeX fragment, which can be included into other LaTeX documents.

When you render an Rmd document to LaTeX, it generates a full LaTeX document that includes the \texttt{\textbackslash{}documentclass\{\}}, \texttt{\textbackslash{}begin\{body\}}, and \texttt{\textbackslash{}end\{body\}}. A LaTeX fragment is basically the body of a full LaTeX document. To render a LaTeX fragment, you may use the \texttt{latex\_fragment} output format, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ latex_fragment}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

This will render a \texttt{.tex} file, e.g., \texttt{foo.Rmd} will render \texttt{foo.tex}, and you can use \texttt{\textbackslash{}input\{foo.tex\}} to include this fragment into another LaTeX document.

\hypertarget{latex-header}{%
\section{Add custom headers and footers (*)}\label{latex-header}}

The LaTeX package \textbf{fancyhdr} has provided several commands to customize the header and footer lines of your document. For a more complete guide, please refer to the full documentation at \url{https://ctan.org/pkg/fancyhdr}. To begin with, we must load the package. Then we can change the header style, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{\{}\ExtensionTok{fancyhdr}\NormalTok{\}}
\FunctionTok{\textbackslash{}pagestyle}\NormalTok{\{fancy\}}
\end{Highlighting}
\end{Shaded}

The package offers three different interfaces, but we will use the commands \texttt{\textbackslash{}fancyhead} and \texttt{\textbackslash{}fancyfoot}. The syntax for the formatting is \texttt{\textbackslash{}fancyhead{[}selectors{]}\{output\ text\}}, whereby the selectors state the part of the header that we wish to customize. We can use the following selectors for the page locators:

\begin{itemize}
\tightlist
\item
  \textbf{E} for even pages
\item
  \textbf{O} for odd pages
\item
  \textbf{L} for the left side
\item
  \textbf{C} for the center
\item
  \textbf{R} for the right side
\end{itemize}

For example, \texttt{\textbackslash{}fancyhead{[}LE,RO{]}\{Your\ Name\}} will print the text ``Your Name'' on the left side of the header for even pages, and the right side for odd pages. We can combine this with additional LaTeX commands to extract details from our document for each page:

\begin{itemize}
\tightlist
\item
  \texttt{\textbackslash{}thepage}: the number of the current page.
\item
  \texttt{\textbackslash{}thechapter}: the number of the current chapter.
\item
  \texttt{\textbackslash{}thesection}: the number of the current section.
\item
  \texttt{\textbackslash{}chaptername}: the the word ``Chapter'' in English, or its equivalent in the current language, or the text that the author specified by redefining this command.
\item
  \texttt{\textbackslash{}leftmark}: the name and number of the current top-level structure in uppercase letters.
\item
  \texttt{\textbackslash{}rightmark}: the name and number of the current next to top-level structure in uppercase letters.
\end{itemize}

Below is some example LaTeX code that you can add to the preamble using the methods introduced in Section \ref{latex-preamble}:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{\{}\ExtensionTok{fancyhdr}\NormalTok{\}}
\FunctionTok{\textbackslash{}pagestyle}\NormalTok{\{fancy\}}
\CommentTok{% center of header}
\FunctionTok{\textbackslash{}fancyhead}\NormalTok{[CO,CE]\{Your Document Header\}}
\CommentTok{% center of footer}
\FunctionTok{\textbackslash{}fancyfoot}\NormalTok{[CO,CE]\{And this is a fancy footer\}}
\CommentTok{% page number on the left of even pages and right of odd pages}
\FunctionTok{\textbackslash{}fancyfoot}\NormalTok{[LE,RO]\{}\FunctionTok{\textbackslash{}thepage}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

By default, headers and footers will not be displayed on the first page of your PDF document. If we wish to show our footer on the front page, we must include an additional line \texttt{\textbackslash{}fancypagestyle\{plain\}\{\textbackslash{}pagestyle\{fancy\}\}}.

\hypertarget{latex-template}{%
\section{Use a custom Pandoc LaTeX template (*)}\label{latex-template}}

Pandoc converts Markdown to LaTeX through a template. The template is a LaTeX file containing Pandoc variables, and Pandoc will replace these variables with their values. Below is a simple template that only contains a single variable \texttt{\$body\$}:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}documentclass}\NormalTok{\{}\ExtensionTok{article}\NormalTok{\}}
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}
\SpecialStringTok{$body$}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The value of \texttt{\$body\$} is the LaTeX code generated from the body of the Markdown document. For example, if the body text is \texttt{Hello\ **world**!} in Markdown, the value of \texttt{\$body\$} will be \texttt{Hello\ \textbackslash{}textbf\{world\}!}.

If the LaTeX customization methods in Sections \ref{latex-preamble}, \ref{latex-variables}, and \ref{latex-extra} are not enough for you, you may try to use a custom template instead. A template allows you to use arbitrary LaTeX code in it, hence is much more flexible. To use a template, include the path of the template in the \texttt{template} option of \texttt{pdf\_document}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{template}\KeywordTok{:}\AttributeTok{ my-template.tex}
\end{Highlighting}
\end{Shaded}

The default LaTeX template of Pandoc can be found at \url{https://github.com/jgm/pandoc/tree/master/data/templates} (named \texttt{default.latex}). If you want to create your own template, you may want to start with this template.

For the full list of Pandoc variables and their meanings (such as \texttt{\$body\$} and \texttt{\$title\$}), see Pandoc's manual at \url{https://pandoc.org/MANUAL.html\#templates}. You can also use arbitrary custom variables, which are typically passed to the template from the YAML metadata. If you want to learn by examples, you may take a look the \textbf{MonashEBSTemplates} package (\url{https://github.com/robjhyndman/MonashEBSTemplates}), which has provided several custom LaTeX templates. These templates are under the \texttt{inst/rmarkdown/templates/*/resources/} directories. For example, the template for the output format \texttt{MonashEBSTemplates::memo} allows you to use a variable \texttt{branding} in the YAML metadata to control whether to include the brand logo of Monash University. This is achieved by an \texttt{if} statement in the template that looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\SpecialStringTok{$if(branding)$}\CommentTok{%}
\BuiltInTok{\textbackslash{}includegraphics}\NormalTok{[height=1.5cm]\{}\ExtensionTok{monash2}\NormalTok{\}}
\FunctionTok{\textbackslash{}vspace}\NormalTok{*\{-0.6cm\}}
\SpecialStringTok{$else$}
\FunctionTok{\textbackslash{}vspace}\NormalTok{*\{-1cm\}}
\SpecialStringTok{$endif$}
\end{Highlighting}
\end{Shaded}

\hypertarget{raw-latex}{%
\section{Write raw LaTeX code}\label{raw-latex}}

By default, Pandoc will preserve raw LaTeX code in Markdown documents when converting the document to LaTeX, so you can use LaTeX commands or environments in Markdown. However, sometimes your LaTeX code might be too complex for Pandoc to parse, in which case Pandoc will treat the content as normal Markdown. The consequence is that special LaTeX characters may be escaped, e.g., Pandoc may convert a backslash \texttt{\textbackslash{}} to \texttt{\textbackslash{}textbackslash\{\}}.

To make sure that Pandoc does not touch the raw LaTeX code in your Markdown document, you may wrap the code in a fenced code block with the attribute \texttt{=latex}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{=latex\}}
\BaseNTok{\textbackslash{}begin\{tabular\}\{ll\}}
\BaseNTok{A & B \textbackslash{}\textbackslash{}}
\BaseNTok{A & B \textbackslash{}\textbackslash{}}
\BaseNTok{\textbackslash{}end\{tabular\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Do not forget the equal sign before \texttt{latex}, i.e., it is \texttt{=latex} instead of \texttt{latex}. This feature requires a Pandoc version higher than 2.0 (check \texttt{rmarkdown::pandoc\_version()}).

\hypertarget{latex-hardcore}{%
\section{For hardcore LaTeX users (*)}\label{latex-hardcore}}

R Markdown is certainly not the best possible document format for authoring or typesetting documents. Simplicity is both its advantage and disadvantage. LaTeX is much more powerful than Markdown in terms of typesetting at the price of more commands to be typed. If typesetting is of much higher priority to you and you are comfortable with using all kinds of LaTeX commands and environments, you can just use pure LaTeX code instead of Markdown to write the whole document.

The \textbf{knitr} package supports a variety of source document formats, including but not limited to R Markdown. Below is an example of intermingling R code with pure LaTeX code:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}documentclass}\NormalTok{\{}\ExtensionTok{article}\NormalTok{\}}
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{[T1]\{}\ExtensionTok{fontenc}\NormalTok{\}}

\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}

\NormalTok{Here is a code chunk.}

\NormalTok{<<foo, fig.height=4>>=}
\NormalTok{1 + 1}
\NormalTok{par(mar = c(4, 4, .2, .2))}
\NormalTok{plot(rnorm(100))}
\NormalTok{@}

\NormalTok{You can also write inline expressions, e.g. }\SpecialStringTok{$}\SpecialCharTok{\textbackslash{}pi}\SpecialStringTok{=}\SpecialCharTok{\textbackslash{}Sexpr}\SpecialStringTok{\{pi\}$}\NormalTok{,}
\NormalTok{and }\FunctionTok{\textbackslash{}Sexpr}\NormalTok{\{1.9910214e28\} is a big number.}

\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{document}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The filename usually has the extension \texttt{.Rnw}, e.g., the above file is \texttt{latex.Rnw}. The idea is the same but the syntax for writing R code chunks and inline R expressions is different. An R code chunk starts with \texttt{\textless{}\textless{}\textgreater{}\textgreater{}=} (with optional chunk options inside the angle brackets) and ends with \texttt{@}. An inline R expression is written in \texttt{\textbackslash{}Sexpr\{\}}.

The function \texttt{knitr::knit()} can compile an \texttt{Rnw} documents to a LaTeX (\texttt{.tex}) output file, which can be further compiled to PDF through your LaTeX tools such as \texttt{pdflatex}. You can also use \texttt{knitr::knit2pdf()} to compile \texttt{Rnw} to PDF in one step. If you use RStudio, you can hit the \texttt{Compile\ PDF} button on the toolbar. Please note that the default method to compile Rnw documents is through Sweave, and you may want to change it to \textbf{knitr} (see the post \url{http://stackoverflow.com/q/27592837/559676} for how to do that).

An \texttt{Rnw} document gives you the full power of LaTeX. This could be your last resort if there are typesetting problems that are really difficult to solve in Markdown. However, before you drop Markdown, we would like to remind you of the fact that a custom Pandoc LaTeX template may also be helpful (see Section \ref{latex-template}).

\hypertarget{html-output}{%
\chapter{HTML Output}\label{html-output}}

Compared to LaTeX, HTML may be a little weak in typesetting for paged output, but it is much more powerful in presenting results, especially when combined with CSS and JavaScript. For example, you can embed interactive applications in HTML, and dynamically modify the appearance and even the content of an HTML page. Some useful yet simple CSS and JavaScript tricks for HTML output are very difficult (and often impossible) to reproduce in LaTeX output.

In this chapter, we introduce techniques to enhance your HTML output from R Markdown, including how to apply custom CSS rules, use custom HTML templates, style or fold code blocks, arrange content in tabs, and embed files on HTML pages.

\hypertarget{html-css}{%
\section{Apply custom CSS}\label{html-css}}

We strongly recommend that you learn some CSS and JavaScript if you wish to customize the appearance of HTML documents. The \href{https://bookdown.org/yihui/blogdown/website-basics.html}{Appendix B} of the \textbf{blogdown} book \citep{blogdown2017} contains short tutorials on HTML, CSS, and JavaScript.

For beginners, it is extremely important to understand selectors and precedence of rules in CSS, otherwise you may be confused why your custom CSS rules do not work as expected (they may not have enough precedence).

To include one or multiple custom stylesheets in an Rmd document, you can use the \texttt{css} option, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{css}\KeywordTok{:}\AttributeTok{ }\StringTok{"style.css"}
\CommentTok{    # or multiple sheets in an array}
\CommentTok{    # css: ["style-1.css", "style-2.css"]}
\end{Highlighting}
\end{Shaded}

Alternatively, you can use a \texttt{css} code chunk to embed the CSS rules directly in your Rmd document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{We embed a }\BaseNTok{`css`}\NormalTok{ code chunk here.}

\BaseNTok{```\{css, echo=FALSE\}}
\BaseNTok{p \{}
\BaseNTok{  font-size: 32px;}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The chunk option \texttt{echo\ =\ FALSE} means the CSS code will not be displayed verbatim in the output, but a \texttt{\textless{}style\textgreater{}} tag containing the CSS code will be generated to the HTML output file.

\hypertarget{center-heading}{%
\section{Center section headings}\label{center-heading}}

As an application of the methods mentioned in Section \ref{html-css}, we can use CSS to adjust the alignment of headings. For example, you may center section headings of level 1, 2, and 3 with the CSS code below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{h1}\OperatorTok{,}\NormalTok{ h2}\OperatorTok{,}\NormalTok{ h3 \{}
  \KeywordTok{text-align}\NormalTok{: }\DecValTok{center}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Please see Section \ref{html-css} on how to apply the CSS to your Rmd document.

\hypertarget{chunk-styling}{%
\section{Style code blocks and text output}\label{chunk-styling}}

We can customize the style of code chunks and their text output using the chunk options \texttt{class.source} and \texttt{class.output}, respectively. These options take character vectors of class names. For example, when \texttt{class.source\ =\ "important"}, the HTML element containing the code chunk in the output will have a class \texttt{important}. Then you can define CSS rules for this class. This can be useful when you want to highlight a certain code chunk or its text output.

By default, the HTML output of R Markdown includes the Bootstrap framework, which makes it easy for you to change the appearance of your code and output, because Bootstrap has predefined some \href{https://getbootstrap.com/docs/3.4/css/\#helper-classes}{CSS classes for backgrounds:}: \texttt{"bg-primary"}, \texttt{"bg-success"}, \texttt{"bg-info"}, \texttt{"bg-warning"}, and \texttt{"bg-danger"}.

Below is an example using the chunk options \texttt{class.source\ =\ "bg-danger"} and \texttt{class.output\ =\ "bg-warning"}, and you can see its output in Figure \ref{fig:chunk-bg}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Change the chunk style}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{When you subset a data frame, it does not necessarily return}
\NormalTok{a data frame. For example, if you subset two columns, you get}
\NormalTok{a data frame, but when you try to subset one column, you get}
\NormalTok{a vector:}

\BaseNTok{```\{r class.source="bg-danger", class.output="bg-warning"\}}
\BaseNTok{mtcars[1:5, "mpg"]}
\BaseNTok{```}

\NormalTok{To make sure that we always get a data frame, we have to use}
\NormalTok{the argument }\BaseNTok{`drop = FALSE`}\NormalTok{. Now we use the chunk option}
\BaseNTok{`class.source = "bg-success"`}\NormalTok{.}

\BaseNTok{```\{r df-drop-ok, class.source="bg-success"\}}
\BaseNTok{mtcars[1:5, "mpg", drop = FALSE]}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{images/chunk-bg.png}
\caption{\label{fig:chunk-bg}A code chunk and its text output with background colors defined by Bootstrap.}
\end{figure}

You can also use arbitrary class names and define CSS rules accordingly. In this case, you will have to include your custom CSS rules using the methods mentioned in Section \ref{html-css}. Below is an example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Assign custom classes to chunks}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{First we define some CSS rules for a class }\BaseNTok{`watch-out`}\NormalTok{.}

\BaseNTok{```\{css, echo=FALSE\}}
\BaseNTok{.watch-out \{}
\BaseNTok{  background-color: lightpink;}
\BaseNTok{  border: 3px solid red;}
\BaseNTok{  font-weight: bold;}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{Then we assign a class }\BaseNTok{`watch-out`}\NormalTok{ to the code chunk via the}
\NormalTok{chunk option }\BaseNTok{`class.source`}\NormalTok{.}

\BaseNTok{```\{r class.source="watch-out"\}}
\BaseNTok{mtcars[1:5, "mpg"]}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output style is shown in Figure \ref{fig:chunk-border}.

\begin{figure}
\centering
\includegraphics{images/chunk-border.png}
\caption{\label{fig:chunk-border}A code chunk with a light pink background color and a thick red border.}
\end{figure}

If you want all code blocks in the document to use the custom style, you can set \texttt{class.source} in the global \textbf{knitr} options, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_chunk}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{class.source =} \StringTok{"watch-out"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can apply multiple classes to the code blocks. For example, with \texttt{class.source\ =\ c("important",\ "warning")}, the code block will have two classes, ``important'' and ``warning.''

If you want to decorate individual elements in code blocks instead of the whole blocks, you may consider using the \textbf{flair} package: \url{https://github.com/kbodwin/flair}. With this package, you can highlight different parts of your code (such as fixed strings, function names, and arguments) with custom styles (e.g., color, font size, and/or font weight).

\hypertarget{html-scroll}{%
\section{Scrollable code blocks (*)}\label{html-scroll}}

When you have large amounts of code and/or verbatim text output to display on an HTML page, it may be desirable to limit their heights, otherwise the page may look overwhelmingly lengthy, which will make it difficult for those who do not want to read the details in the code or its text output to skip these parts. There are multiple ways to solve this problem. One solution is to use the \texttt{code\_fold} option in the \texttt{html\_document} format, which will fold code blocks in the output and readers can unfold them by clicking a button.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{code_fold}\KeywordTok{:}\AttributeTok{ hide}
\end{Highlighting}
\end{Shaded}

The other possible solution is to make the code blocks scrollable within a fixed height when they are too long. This can be achieved by the CSS properties \texttt{max-height} and \texttt{overflow-y}. Below is a full example with the output in Figure \ref{fig:html-scroll}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Scrollable code blocks}
\NormalTok{output: html_document}
\NormalTok{---}

\BaseNTok{```\{css, echo=FALSE\}}
\BaseNTok{pre \{}
\BaseNTok{  max-height: 300px;}
\BaseNTok{  overflow-y: auto;}
\BaseNTok{\}}

\BaseNTok{pre[class] \{}
\BaseNTok{  max-height: 100px;}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{We have defined some CSS rules to limit the height of}
\NormalTok{code blocks. Now we can test if these rules work on code}
\NormalTok{blocks and text output:}

\BaseNTok{```\{r\}}
\BaseNTok{# pretend that we have a lot of code in this chunk}
\BaseNTok{if (1 + 1 == 2) \{}
\BaseNTok{  # of course that is true}
\BaseNTok{  print(mtcars)}
\BaseNTok{  # we just printed a lengthy data set}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{Next we add rules for a new class }\BaseNTok{`scroll-100`}\NormalTok{ to limit}
\NormalTok{the height to 100px, and add the class to the output of}
\NormalTok{a code chunk via the chunk option }\BaseNTok{`class.output`}\NormalTok{:}

\BaseNTok{```\{css, echo=FALSE\}}
\BaseNTok{.scroll-100 \{}
\BaseNTok{  max-height: 100px;}
\BaseNTok{  overflow-y: auto;}
\BaseNTok{  background-color: inherit;}
\BaseNTok{\}}
\BaseNTok{```}

\BaseNTok{```\{r, class.output="scroll-100"\}}
\BaseNTok{print(mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{images/html-scroll.png}
\caption{\label{fig:html-scroll}Scrollable code blocks using custom CSS.}
\end{figure}

In the above example, we defined a global maximum height of 300px for all code blocks. Remember that code blocks are placed in \texttt{\textless{}pre\textgreater{}} tags in the HTML output. Then we limited the height of \texttt{\textless{}pre\textgreater{}} blocks with \texttt{class} attributes to 100px. That is what the CSS selector \texttt{pre{[}class{]}} means. By default, text output will be contained in \texttt{\textless{}pre\textgreater{}\ \textless{}/pre\textgreater{}}, and R code blocks are contained in \texttt{\textless{}pre\ class="r"\textgreater{}\ \textless{}/pre\textgreater{}} (note that the \texttt{\textless{}pre\textgreater{}} tag has a \texttt{class} attribute here).

The height of the text output from the second R code chunk is also 100px. That is because we assigned a custom class name \texttt{scroll-100} to the output, and defined the maximum height to be 100px.

If you want to specify different maximum heights for individual code blocks, you may see the example in Section \ref{hook-scroll}.

\hypertarget{fold-show}{%
\section{Fold all code blocks but show some initially}\label{fold-show}}

If code blocks in the output document are potentially distracting to readers, you may choose to fold them initially, and readers can choose to display them by clicking the fold buttons:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{code_fold}\KeywordTok{:}\AttributeTok{ hide}
\end{Highlighting}
\end{Shaded}

You can also choose to unfold all code blocks initially (so readers can choose to fold them later):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{code_fold}\KeywordTok{:}\AttributeTok{ show}
\end{Highlighting}
\end{Shaded}

If you fold all code blocks initially, you can specify certain blocks to be unfolded initially with the chunk option \texttt{class.source\ =\ "fold-show"}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Hide all code blocks and show some initially}
\NormalTok{output:}
\NormalTok{  html_document:}
\BaseNTok{    code_folding: hide}
\NormalTok{---}

\BaseNTok{```\{r\}}
\BaseNTok{1  # code is hidden initially}
\BaseNTok{```}

\BaseNTok{```\{r class.source = 'fold-show'\}}
\BaseNTok{2  # code is shown initially}
\BaseNTok{```}

\BaseNTok{```\{r\}}
\BaseNTok{3  # also hidden}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can also do it the other way around, i.e., show all code blocks but hide some of them initially. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{output:}
\NormalTok{  html_document:}
\BaseNTok{    code_folding: show}
\NormalTok{---}

\BaseNTok{```\{r\}}
\BaseNTok{1  # code is shown initially}
\BaseNTok{```}

\BaseNTok{```\{r class.source = 'fold-hide'\}}
\BaseNTok{2  # code is hidden initially}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{html-tabs}{%
\section{Put content in tabs}\label{html-tabs}}

One natural way of organizing parallel sections in an HTML report is to use tabsets. This allows readers to view the content of different sections by clicking the tab titles instead of scrolling back and forth on the page.

To turn sections into tabs, you can add a class attribute \texttt{.tabset} to the upper-level section header. Below is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Use tabs to organize content}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{You can turn parallel sections to tabs in }\BaseNTok{`html_document`}\NormalTok{ output.}

\FunctionTok{## Results \{.tabset\}}

\FunctionTok{### Plots}

\NormalTok{We show a scatter plot in this section.}

\BaseNTok{```\{r, fig.dim=c(5, 3)\}}
\BaseNTok{par(mar = c(4, 4, .5, .1))}
\BaseNTok{plot(mpg ~ hp, data = mtcars, pch = 19)}
\BaseNTok{```}

\FunctionTok{### Tables}

\NormalTok{We show the data in this tab.}

\BaseNTok{```\{r\}}
\BaseNTok{head(mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output is shown in Figure \ref{fig:html-tabs}. Note that you can only see one tab at a time in reality. In this figure, we actually concatenated two screenshots for you to see both tabs.

\begin{figure}
\centering
\includegraphics{images/html-tabs.png}
\caption{\label{fig:html-tabs}Turn sections into tabs.}
\end{figure}

You can add another attribute \texttt{.tabset-pills} to the upper-level section header to add a ``pill'' effect to the tab, and the tab will have a dark blue background.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{## Results \{.tabset .tabset-pills\}}
\end{Highlighting}
\end{Shaded}

By default, the first tab is active (i.e., displayed). If you want a different tab to be displayed initially, you may add the attribute \texttt{.active} to it.

To end the tabset, you need to start a new section header of the upper level. The new section header can be empty, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{## Results \{.tabset\}}

\FunctionTok{### Tab One}

\FunctionTok{### Tab Two}

\FunctionTok{## \{-\}}

\NormalTok{With the above unnumbered (}\BaseNTok{`\{-\}`}\NormalTok{) and empty section header,}
\NormalTok{we can end the tabset and continue to write more paragraphs.}
\end{Highlighting}
\end{Shaded}

\hypertarget{embed-rmd}{%
\section{Embed the Rmd source file in the HTML output file}\label{embed-rmd}}

When you share an HTML output page with others, they may want the Rmd source file, too. For example, they may want to change the Rmd source and compile the report by themselves. You can use the option \texttt{code\_download} to embed a copy of the Rmd source file in the HTML output file:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{code_download}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\end{Highlighting}
\end{Shaded}

After the option is turned on, the HTML output page will contain a download button, and readers of the page can hit the button to download the Rmd source file.

\hypertarget{embed-file}{%
\section{Embed arbitrary files in the HTML output file}\label{embed-file}}

As mentioned in Section \ref{embed-rmd}, we can embed a copy of the Rmd source document in the HTML output file. Sometimes the Rmd source file alone may not be enough to reproduce the report. For example, the report may need an external data file. There is a series of functions in the \textbf{xfun} package that enable you to embed arbitrary files in the HTML output file. To use these functions, make sure you have the following R packages available:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{pkg_load2}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"base64enc"}\NormalTok{, }\StringTok{"htmltools"}\NormalTok{, }\StringTok{"mime"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Then you can use one of the functions \texttt{xfun::embed\_file()}, \texttt{xfun::embed\_dir()}, or \texttt{xfun::embed\_files()} in an R code chunk to embed one or multiple files or an entire directory in the HTML output, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r echo=FALSE\}}
\BaseNTok{# a single file}
\BaseNTok{xfun::embed_file('source.Rmd')}

\BaseNTok{# multiple files}
\BaseNTok{xfun::embed_files(c('source.Rmd', 'data.csv'))}

\BaseNTok{# a directory}
\BaseNTok{xfun::embed_dir('data/', text = 'Download full data')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can also provide the list of files programmatically, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# embed all Rmd and csv files}
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{embed_files}\NormalTok{(}\KeywordTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\StringTok{"[.](Rmd|csv)$"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

For multiple files, they are first compressed to a zip file, and the zip file will be embedded. These functions return a link, which a reader can click on the HTML page to download the embedded file.

You can learn more technical details behind these functions from the help page \texttt{?xfun::embed\_file} or the blog post at \url{https://yihui.org/en/2018/07/embed-file/}. Based on the same idea, the \textbf{downloadthis} package (\url{https://github.com/fmmattioni/downloadthis}) has implemented download buttons, so that users can click buttons to download files instead of links. If you prefer using buttons, you may consider using this package.

\hypertarget{html-template}{%
\section{Use a custom HTML template (*)}\label{html-template}}

We mentioned LaTeX templates in Section \ref{latex-template}. You can also specify a custom HTML template for Pandoc to convert Markdown to HTML. Below is a brief example template:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<html>}
  \KeywordTok{<head>}
    \KeywordTok{<title>}\NormalTok{$title$}\KeywordTok{</title>}
\NormalTok{    $for(css)$}
    \KeywordTok{<link}\OtherTok{ rel=}\StringTok{"stylesheet"}\OtherTok{ href=}\StringTok{"$css$"}\OtherTok{ type=}\StringTok{"text/css"} \KeywordTok{/>}
\NormalTok{    $endfor$}
  \KeywordTok{</head>}
  \KeywordTok{<body>}
\NormalTok{  $body$}
  \KeywordTok{</body>}
\KeywordTok{</html>}
\end{Highlighting}
\end{Shaded}

You can see that the template contains a few variables such as \texttt{\$title\$} and \texttt{\$body\$}. You can find the full list of Pandoc variables and their meanings at \url{https://pandoc.org/MANUAL.html\#templates}.

The template gives you the ultimate power to customize the HTML output. For example, you can include arbitrary CSS stylesheets or JavaScript code or libraries in the \texttt{\textless{}head\textgreater{}} area. For example, we could use a Boolean variable \texttt{draft} to indicate whether the document is a draft or a final version:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<head>}
\KeywordTok{<style}\OtherTok{ type=}\StringTok{"text/css"}\KeywordTok{>}
\FunctionTok{.logo}\NormalTok{ \{}
  \KeywordTok{float}\NormalTok{: }\DecValTok{right}\OperatorTok{;}
\NormalTok{\}}
\KeywordTok{</style>}
\KeywordTok{</head>}

\KeywordTok{<body>}
\KeywordTok{<div}\OtherTok{ class=}\StringTok{"logo"}\KeywordTok{>}
\NormalTok{$if(draft)$}
\CommentTok{<!-- use draft.png to show that this is a draft -->}
\KeywordTok{<img}\OtherTok{ src=}\StringTok{"images/draft.png"}\OtherTok{ alt=}\StringTok{"Draft mode"} \KeywordTok{/>}
\NormalTok{$else$}
\CommentTok{<!-- insert the formal logo if this is final -->}
\KeywordTok{<img}\OtherTok{ src=}\StringTok{"images/logo.png"}\OtherTok{ alt=}\StringTok{"Final version"} \KeywordTok{/>}
\NormalTok{$endif$}
\KeywordTok{</div>}

\NormalTok{$body$}
\KeywordTok{</body>}
\end{Highlighting}
\end{Shaded}

Then we can set the variable \texttt{draft} to \texttt{true} or \texttt{false} in the YAML metadata of the Rmd document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"An Important Report"}
\FunctionTok{draft}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

To apply a template to an Rmd document, you can save the template to a file, and pass the file path to the \texttt{template} option of \texttt{html\_document}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_output}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{template}\KeywordTok{:}\AttributeTok{ my-template.html}
\end{Highlighting}
\end{Shaded}

The \textbf{rmarkdown} package uses a custom HTML template shipped with the package, which is different from Pandoc's default template. To use the latter, you can specify \texttt{template:\ null}.

\hypertarget{include-html}{%
\section{Include the content of an existing HTML file (*)}\label{include-html}}

With the \texttt{includes} option of the \texttt{html\_document} format (or any other formats that support this option), you can include the content of an existing HTML file into the HTML output document in three possible places: the \texttt{\textless{}head\textgreater{}} area, the beginning of \texttt{\textless{}body\textgreater{}}, and the end of \texttt{\textless{}/body\textgreater{}}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{includes}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{in_header}\KeywordTok{:}\AttributeTok{ header.html}
\AttributeTok{      }\FunctionTok{before_body}\KeywordTok{:}\AttributeTok{ before.html}
\AttributeTok{      }\FunctionTok{after_body}\KeywordTok{:}\AttributeTok{ after.html}
\end{Highlighting}
\end{Shaded}

If you are not familiar with HTML, Section \ref{html-template} may help you better understand these options.

With the \texttt{in\_header} option, you can inject CSS and JavaScript code into the \texttt{\textless{}head\textgreater{}} tag. With \texttt{before\_body}, you may include a header that shows a banner or logo. With \texttt{after\_body}, you can include a footer, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<div}\OtherTok{ class=}\StringTok{"footer"}\KeywordTok{>}\NormalTok{Copyright }\DecValTok{&copy;}\NormalTok{ John Doe 2020}\KeywordTok{</div>}
\end{Highlighting}
\end{Shaded}

Sometimes you may want to include the content of an external HTML file in an arbitrary place of the body, which can be done with \texttt{htmltools::includeHTML()}. You pass the path of the HTML file to this function. It will read the file, and write its content to the output document. You may also use the technique in Section \ref{raw-content}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{````\{=html\}}
\BaseNTok{```\{r, echo=FALSE, results='asis'\}}
\BaseNTok{xfun::file_string('file.html')}
\BaseNTok{```}
\BaseNTok{````}
\end{Highlighting}
\end{Shaded}

Please note that you must not include the content of a full HTML file into another HTML file, but can only include an HTML fragment. A full HTML file contains the \texttt{\textless{}html\textgreater{}} tag, which cannot be embedded in another \texttt{\textless{}html\textgreater{}} tag. Below is an invalid HTML document when a full HTML document is included in another HTML document:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<html>}
  \KeywordTok{<head>}  \KeywordTok{</head>}

  \KeywordTok{<body>}
\NormalTok{  Parent HTML file.}
  
  \CommentTok{<!-- htmltools::includeHTML() below -->}
    \KeywordTok{<html>}
      \KeywordTok{<head>}  \KeywordTok{</head>}
      \KeywordTok{<body>}
\NormalTok{      Child HTML file.}
      \KeywordTok{</body>}
    \KeywordTok{</html>}
  \CommentTok{<!-- included above -->}

  \KeywordTok{</body>}
\KeywordTok{</html>}
\end{Highlighting}
\end{Shaded}

If you run into problems when including an HTML file in an HTML output document, you may check if the HTML file contains the \texttt{\textless{}html\textgreater{}} tag.

There is an output format \texttt{html\_fragment} in the \textbf{rmarkdown} package, which generates an HTML fragment instead of a full HTML document. If you want to include the compiled results of an Rmd document in another Rmd document, the former Rmd document may use the \texttt{html\_fragment} format instead of the usual \texttt{html\_document}.

If you want to include an Rmd or Markdown document instead of an HTML file, you may use child documents introduced in Section \ref{child-document}.

\hypertarget{details-tag}{%
\section{\texorpdfstring{Use the \texttt{\textless{}details\textgreater{}} disclosure element}{Use the \textless details\textgreater{} disclosure element}}\label{details-tag}}

As mentioned in Section \ref{html-scroll}, we can fold source code chunks via the option \texttt{code\_fold:\ true} in the \texttt{html\_document} format. Currently it is not possible to fold output blocks, but we can use some JavaScript tricks to make output foldable, too. This can be useful especially when the output is relatively long but not very important, so we fold it initially. If the reader is interested, they can unfold it to view the content. Figure \ref{fig:details-tag} shows an example: you may click on the ``Details'' button to unfold the output.

\begin{figure}
\includegraphics[width=1\linewidth]{images/details-closed} \includegraphics[width=1\linewidth]{images/details-open} \caption{Wrap text output in the details element.}\label{fig:details-tag}
\end{figure}

If you are viewing the HTML version of this book, you can actually see it in action below. If you are reading the PDF or printed version, such an interaction (clicking the ``Details'' button) is certainly not possible.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\OperatorTok{:}\DecValTok{100}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27
##  [28]  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
##  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81
##  [82]  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100
\end{verbatim}

Below is the full source Rmd document that includes the JavaScript code to find output blocks, and wrap them into the \texttt{\textless{}details\textgreater{}} tags.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Use the }\BaseNTok{`<details>`}\NormalTok{ disclosure element}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{We show text output inside the }\BaseNTok{`<details>`}\NormalTok{ tags in this}
\NormalTok{example. We used JavaScript to wrap text output blocks}
\NormalTok{in }\BaseNTok{`<details></details>`}\NormalTok{. The JavaScript code needs to}
\NormalTok{be executed at the end of this document, so it is placed}
\NormalTok{at the end. Below is a testing code chunk:}

\BaseNTok{```\{r\}}
\BaseNTok{1:100}
\BaseNTok{```}

\NormalTok{The actual JavaScript code is below.}

\BaseNTok{```\{js, echo=FALSE\}}
\BaseNTok{(function() \{}
\BaseNTok{  var codes = document.querySelectorAll('pre:not([class])');}
\BaseNTok{  var code, i, d, s, p;}
\BaseNTok{  for (i = 0; i < codes.length; i++) \{}
\BaseNTok{    code = codes[i];}
\BaseNTok{    p = code.parentNode;}
\BaseNTok{    d = document.createElement('details');}
\BaseNTok{    s = document.createElement('summary');}
\BaseNTok{    s.innerText = 'Details';}
\BaseNTok{    // <details><summary>Details</summary></details>}
\BaseNTok{    d.appendChild(s);}
\BaseNTok{    // move the code into <details>}
\BaseNTok{    p.replaceChild(d, code);}
\BaseNTok{    d.appendChild(code);}
\BaseNTok{  \}}
\BaseNTok{\})();}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You may try to adapt the JavaScript code above to your own need. The key is to find out the elements to be wrapped into \texttt{\textless{}details\textgreater{}}:

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{document}\NormalTok{.}\AttributeTok{querySelectorAll}\NormalTok{(}\StringTok{'pre:not([class])'}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

The CSS selector \texttt{pre:not({[}class{]})} means all \texttt{\textless{}pre\textgreater{}} elements without the \texttt{class} attribute. You can also select other types of elements. For more about CSS selectors, see \url{https://www.w3schools.com/css/css_selectors.asp}. For more about the HTML tags \texttt{\textless{}details\textgreater{}} and \texttt{\textless{}summary\textgreater{}}, see \url{https://www.w3schools.com/tags/tag_details.asp}.

\hypertarget{favicon}{%
\section{Add a custom browser icon}\label{favicon}}

Section \ref{include-html} demonstrates that we can inject additional code into the HTML head, body, or footer with the \texttt{includes} option of the \texttt{html\_document} format. This technique can be used to add a custom browser icon, called a favicon, to your HTML output.

Favicons are the website logos that are displayed in your browser's address bar, tab title, history, and bookmarks. For example, if you visit the CRAN website (\url{https://cran.r-project.org}) in Google Chrome, and look at the browser tab, you will see a small R logo. On mobile devices, favicons are also used in place of an App icon for websites that are pinned to the home screen.

To add a favicon to your HTML document, add the following line of code to a custom header file (such as the file \texttt{header.html} mentioned in Section \ref{include-html}):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<link}\OtherTok{ rel=}\StringTok{"shortcut icon"}\OtherTok{ href=}\StringTok{"\{path to favicon file\}"} \KeywordTok{/>}
\end{Highlighting}
\end{Shaded}

Recall that this file can be injected into the document \texttt{\textless{}head\textgreater{}} area using the YAML metadata:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{includes}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{in_header}\KeywordTok{:}\AttributeTok{ header.html}
\end{Highlighting}
\end{Shaded}

The path you provide to the \texttt{href} attribute in \texttt{\textless{}link\textgreater{}} should assume the same relative path structure as you would use to reference any other asset (e.g., an image or dataset). For the image itself, most small, square PNG files will work reasonably well. Bear in mind that a typical web browser will often display the image in a 16 x 16 pixel box, so simple designs are better.

If you want to ensure that each browser or platform on which your document is viewed uses a version of your icon with optimal resolution for its specific layout, you may use a service such as \url{https://realfavicongenerator.net} to generate a set of favicons and a slightly more complex version of the header HTML code. This service is currently used by the \textbf{pkgdown} package's \texttt{pkgdown::build\_favicon()} function to make a set of favicons out of R package logos.

\hypertarget{html-share}{%
\section{Sharing HTML output on the web}\label{html-share}}

One appealing aspect of rendering R Markdown to HTML files is that it is very easy to host these files on the Internet and share them just as one shares any other website. This section briefly summarizes numerous options for sharing the HTML documents that you have created.

\hypertarget{r-specific-services}{%
\subsection{R-specific services}\label{r-specific-services}}

RStudio offers a number of services for publishing various types of content created in R Markdown to the Internet. These services make it particularly easy to publish content by using the RStudio IDE or the \textbf{rsconnect} package.

\begin{itemize}
\item
  \href{https://rpubs.com}{\textbf{RPubs}} enables free hosting of static single-file R Markdown content. It is easy to publish via the \texttt{Publish} button in the RStudio IDE or the \texttt{rsconnect::rpubsUpload()} function. Please see the ``Getting Started'' page (\url{https://rpubs.com/about/getting-started}) for more details.
\item
  \href{https://www.shinyapps.io}{\textbf{ShinyApps.io}} allows for hosting dynamic content that requires a server to run R. For example, one can host interactive R Markdown documents that include Shiny components.\footnote{You may include Shiny components in an R Markdown document by setting the option \texttt{runtime:\ shiny} or \texttt{runtime:\ shiny\_prerendered} in the YAML metadata. You will no longer be able to render your document to an HTML document as before; instead, you run your document with \texttt{rmarkdown::run()}. To learn more, please refer to \citet{rmarkdown2018} (Chapter 19: \url{https://bookdown.org/yihui/rmarkdown/shiny-documents.html}).} ShinyApps.io is an analog to RPubs for Shiny applications. Apps and interactive R Markdown documents can be published using the push-button in the RStudio IDE or the \texttt{rsconnect::deployApp()} function. See the user guide (\url{https://docs.rstudio.com/shinyapps.io/}) for more details.
\item
  \href{https://bookdown.org/home/about/}{\textbf{bookdown.org}} offers free hosting specifically for books written with the \textbf{bookdown} package. You may easily publish static output files of your book using the \texttt{bookdown::publish\_book()} function.
\item
  \href{https://rstudio.com/products/connect/}{\textbf{RStudio Connect}} is an enterprise product that organizations may run on their own servers. It can host a wide variety of content created in R (such as R Markdown documents, Shiny apps, and APIs) in a secured environment with document-level access controls, viewership history, and more. Content can be published to RStudio Connect using manual upload, the \textbf{rsconnect} package, or with GIT-based deployment.
\end{itemize}

\hypertarget{static-website-services}{%
\subsection{Static website services}\label{static-website-services}}

In a few words, a simple static website is composed of any number of HTML files (typically containing an \texttt{index.html}, which is the homepage), JavaScript, CSS files, and additional content such as images. This collection of files can be hosted as-is on a web server and rendered in a web browser.

When R Markdown is rendered to the HTML output format, the result may be treated as a static website. Websites can range in complexity from a single, standalone HTML file (which is what we get when we use the default \texttt{self\_contained:\ true} option), a set of files, or a sophisticated project like a website based on \textbf{blogdown} (which relies upon a static website generator). For more details, see \href{https://bookdown.org/yihui/blogdown/static-sites.html}{Section 2.1 on Static Sites} of the \textbf{blogdown} book \citep{blogdown2017}.

As a result, in addition to R-specific services, you may host your HTML document on many freely available static website hosting services. Commonly used options in the R community are:

\begin{itemize}
\item
  \href{https://pages.github.com}{\textbf{GitHub Pages}} makes is particularly easy to publish Markdown and HTML content straight from a GitHub repository. You may specify whether to host content from either the main branch's root, a \texttt{docs/} directory on the main branch, or a specific \texttt{gh-pages} branch. Publishing new content can be as simple as pushing new HTML files to your repository via GIT.
\item
  \href{https://docs.gitlab.com/ce/user/project/pages/}{\textbf{GitLab Pages}} offers similar functionality to GitHub Pages for GitLab repositories. GitLab deploys content stores in the \texttt{public/} directory of a repository. To build and publish content, you must provide a YAML file, \texttt{.gitlab-ci.yml} with instructions, but GitLab provides many helpful templates. For an example of hosting rendered HTML content, please see \url{https://gitlab.com/pages/plain-html/-/tree/master}.
\item
  \href{https://www.netlify.com}{\textbf{Netlify}} is a platform to build and deploy static website content. It is a popular choice for web content created by the \textbf{blogdown} and \textbf{pkgdown} packages, but it can host all kinds of HTML files. There are many different publishing options including drag-and-drop, command line, or automated publishing from GitHub and GitLab repositories. Additionally, Netlify offers many helpful features such as website previews in pull requests. See the Netlify documentation (\url{https://docs.netlify.com}) or the RStudio webinar \href{https://rstudio.com/resources/webinars/sharing-on-short-notice-how-to-get-your-materials-online-with-r-markdown/}{``Sharing on Short Notice''} for more details.
\end{itemize}

\hypertarget{html-hardcore}{%
\section{For hardcore HTML users (*)}\label{html-hardcore}}

In Section \ref{latex-hardcore}, we mentioned that if you feel the constraint of Markdown (due to its simplicity) is too strong, you can embed code chunks in a pure LaTeX document instead of Markdown. Similarly, if you are familiar and comfortable with writing raw HTML code, you can intermingle code chunks with HTML, too. Such documents have the conventional filename extension \texttt{.Rhtml}.

In an \texttt{Rhtml} document, code chunks are embedded between \texttt{\textless{}!-\/-begin.rcode} and \texttt{end.rcode-\/-\textgreater{}}, and inline R expressions are embedded in \texttt{\textless{}!-\/-rinline\ -\/-\textgreater{}}. Below is a full \texttt{Rhtml} example. You can save it to a file named \texttt{test.Rhtml}, and use \texttt{knitr::knit("test.Rhtml")} to compile it. The output will be an HTML (\texttt{.html}) file. In RStudio, you can also hit the \texttt{Knit} button on the toolbar to compile the document.

\begin{Shaded}
\begin{Highlighting}[]
\DataTypeTok{<!DOCTYPE }\NormalTok{html}\DataTypeTok{>}
\KeywordTok{<html>}
\KeywordTok{<head>}
  \KeywordTok{<title>}\NormalTok{A minimal knitr example in HTML}\KeywordTok{</title>}
\KeywordTok{</head>}
\KeywordTok{<body>}
\CommentTok{<!--begin.rcode}
\CommentTok{  knitr::opts_chunk$set(fig.width=5, fig.height=5)}
\CommentTok{  end.rcode-->}

  \KeywordTok{<p>}\NormalTok{This is a minimal example that shows}
\NormalTok{  how }\KeywordTok{<strong>}\NormalTok{knitr}\KeywordTok{</strong>}\NormalTok{ works with pure HTML}
\NormalTok{  pages.}\KeywordTok{</p>}

  \KeywordTok{<p>}\NormalTok{Boring stuff as usual:}\KeywordTok{</p>}

\CommentTok{<!--begin.rcode}
\CommentTok{    # a simple calculator}
\CommentTok{    1 + 1}
\CommentTok{    # boring random numbers}
\CommentTok{    set.seed(123)}
\CommentTok{    rnorm(5)}
\CommentTok{    end.rcode-->}

  \KeywordTok{<p>}\NormalTok{We can also produce plots (centered by the}
\NormalTok{  option }\KeywordTok{<code>}\NormalTok{fig.align='center'}\KeywordTok{</code>}\NormalTok{):}\KeywordTok{</p>}

\CommentTok{<!--begin.rcode cars-scatter, fig.align='center'}
\CommentTok{    plot(mpg ~ hp, data = mtcars)}
\CommentTok{    end.rcode-->}

  \KeywordTok{<p>}\NormalTok{Errors, messages and warnings can be put into}
  \KeywordTok{<code>}\NormalTok{div}\KeywordTok{</code>}\NormalTok{s with different }\KeywordTok{<code>}\NormalTok{class}\KeywordTok{</code>}\NormalTok{es:}\KeywordTok{</p>}

\CommentTok{<!--begin.rcode}
\CommentTok{    sqrt(-1)  # warning}
\CommentTok{    message('knitr says hello to HTML!')}
\CommentTok{    1 + 'a'  # mission impossible}
\CommentTok{    end.rcode-->}

  \KeywordTok{<p>}\NormalTok{Well, everything seems to be working. Let's ask R what is}
\NormalTok{  the value of }\DecValTok{&pi;}\NormalTok{? Of course it is }\CommentTok{<!--rinline pi -->}\NormalTok{.}\KeywordTok{</p>}

\KeywordTok{</body>}
\KeywordTok{</html>}
\end{Highlighting}
\end{Shaded}

\hypertarget{word}{%
\chapter{Word}\label{word}}

To generate a Word document from R Markdown, you can use the output format \texttt{word\_document}. If you want to include cross-references in the document, you may consider the output format \texttt{bookdown::word\_document2}, as mentioned in Section \ref{cross-ref}.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{word_document}\KeywordTok{:}\AttributeTok{ default}
\AttributeTok{  bookdown:}\FunctionTok{:word_document2}\KeywordTok{:}\AttributeTok{ default}\CommentTok{  # for cross-references}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

From our experience, the most frequently asked questions about Word output are:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  How to apply a custom Word template to the document?
\item
  How to incorporate changes made in Word into the original R Markdown document?
\item
  How to style individual document elements?
\end{enumerate}

We will address these questions in this chapter.

\hypertarget{word-template}{%
\section{Custom Word templates}\label{word-template}}

You can apply the styles defined in a Word template document to new Word documents generated from R Markdown. Such a template document is also called a ``style reference document''. The key is that you have to create this template document from Pandoc first, and change the style definitions in it later. Then pass the path of this template to the \texttt{reference\_docx} option of \texttt{word\_document}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{word_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{reference_docx}\KeywordTok{:}\AttributeTok{ }\StringTok{"template.docx"}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

As we just mentioned, the document \texttt{template.docx} has to be generated from Pandoc. You can create this template from an arbitrary R Markdown document with the \texttt{word\_document} output format (the actual content of this document does not matter, but it should contain the type of elements of which you want to style). Then open the \texttt{.docx} file, and edit the styles.

\begin{figure}
\includegraphics[width=1\linewidth]{images/word-template-1} \caption{Find the styles of a specific document element.}\label{fig:word-template-1}
\end{figure}

Figure \ref{fig:word-template-1} shows that you can open the ``Styles'' window from the ``HOME'' tab in Word. When you move the cursor to a specific element in the document, an item in the styles list will be highlighted. If you want to modify the styles of this type of elements, you can click the dropdown menu on the highlighted item, and you will see a dialog box like Figure \ref{fig:word-template-2}.

\begin{figure}
\includegraphics[width=1\linewidth]{images/word-template-2} \caption{Modify the styles of an element in a Word document.}\label{fig:word-template-2}
\end{figure}

After you finish modifying the styles, you can save the document (with a filename that will not be accidentally overwritten), and use it as the template for future Word documents. When Pandoc renders a new Word document with a reference document (template), it will read the styles in the template and apply them to the new document.

You may watch a short video at \url{https://vimeo.com/110804387}, or read the article at \url{https://rmarkdown.rstudio.com/articles_docx.html} for more detailed instructions on how to create a Word template with custom styles.

Sometimes it may not be straightforward to find the style name for an element, because there may be multiple styles applied to the same element, and you will only see one of them highlighted in the list of styles. It may require some guesswork and online searching to figure out the actual style that you want to modify. For example, you have to click the ``Manage Styles'' button (the third button from left to right at the bottom of the style list in Figure \ref{fig:word-template-1}), and scroll through a large number of style names before you find the ``Table'' style (see Figure \ref{fig:word-table}). Then you can modify this style for your tables (e.g., add borders).

\begin{figure}
\includegraphics[width=1\linewidth]{images/word-table} \caption{Modify the styles of tables in a Word document.}\label{fig:word-table}
\end{figure}

\hypertarget{word-redoc}{%
\section{The two-way workflow between R Markdown and Word}\label{word-redoc}}

While it is easy to generate a Word document from R Markdown, things can be particularly painful when someone else edits the Word document and you have to manually port the changes back to the original R Markdown document. Luckily, Noam Ross has provided a promising solution to this problem. The \textbf{redoc} package (\url{https://github.com/noamross/redoc}) allows you to generate a Word document, revise the Word document, and convert the revised Word document back to R Markdown. Please note that as of this writing (June 2020), the \textbf{redoc} package is still experimental, and more unfortunately, its author has suspended the development. Anyway, if you want to try it out, you can install the package from GitHub:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{remotes}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"noamross/redoc"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once the package is installed, you may use the output format \texttt{redoc::redoc}:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ redoc::redoc}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

This output format generates a Word document that actually stores the original Rmd document, so the Word document can be converted back to Rmd. Text written with the CriticMarkup syntax (\url{http://criticmarkup.com}) will be converted to tracked changes in Word, e.g., \texttt{\{++\ important\ ++\}} means you want to insert a word ``important'' in the text.

You can convert the Word document generated by \texttt{redoc::redoc} to Rmd via the function \texttt{redoc::dedoc()}, e.g., \texttt{redoc::dedoc("file.docx")} will generate \texttt{file.Rmd}. In this process, you can decide how to deal with tracked changes in Word via the \texttt{track\_changes} argument, e.g., you may accept or reject changes, or convert tracked changes to CriticMarkup. We recommend that you use \texttt{track\_changes\ =\ \textquotesingle{}criticmarkup\textquotesingle{}} to avoid the permanent loss of tracked changes.

When editing the Word document, you are expected to edit the parts that are \emph{not} automatically generated by code chunks or inline R expressions in R Markdown. For example, you must not edit a table if it is automatically generated by \texttt{knitr::kable()} in a code chunk, because such changes will be lost when you convert Word to Rmd via \texttt{dedoc()}. To avoid accidentally editing the automatic results from code chunks, you may set the option \texttt{highlight\_outputs} to \texttt{true} in the \texttt{redoc::redoc} format, which means the automatic output will be highlighted in Word (with a background color). You should tell your collaborator that they should not touch these highlighted parts in the Word document.

Again, the \textbf{redoc} package is still experimental and its future is unclear at the moment, so the introduction here is intentionally brief. When in doubt, we recommend that you read its documentation on GitHub.

\hypertarget{word-officedown}{%
\section{Style individual elements}\label{word-officedown}}

Due to the simplicity of Markdown, you can apply some global styles to the Word document (see Section \ref{word-template}), but it is not straightforward to style individual elements, such as changing the color of a word, or centering a paragraph.

Continuing his effort on making it easier to work with Office documents in R, David Gohel started to develop the \textbf{officedown} package (\url{https://github.com/davidgohel/officedown}) in 2018, which aims to bring some \textbf{officer} (\url{https://github.com/davidgohel/officer}) features into R Markdown. As of this writing, this package is still experimental, although its initial version has been published on CRAN. You may either install it from CRAN or GitHub:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install from CRAN}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"officedown"}\NormalTok{)}

\CommentTok{# or GitHub}
\NormalTok{remotes}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"davidgohel/officedown"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After the package is installed, you need to load it in your R Markdown document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, setup, include=FALSE\}}
\BaseNTok{library(officedown)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

There is an output format \texttt{rdocx\_document} in the \textbf{officedown} package, which is based on \texttt{rmarkdown::word\_document} by default, and has several other features such as styling tables and plots.

The \textbf{officedown} package allows you to style specific Word elements via the \textbf{officer} package. For example, you can create a style via the function \texttt{officer::fp\_text()}, and apply the style to a piece of text via \texttt{ftext()} an inline R expression:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Style text with officedown}
\NormalTok{output:}
\NormalTok{  officedown::rdocx_document: default}
\NormalTok{---}

\BaseNTok{```\{r\}}
\BaseNTok{library(officedown)}
\BaseNTok{library(officer)}
\BaseNTok{ft <- fp_text(color = 'red', bold = TRUE)}
\BaseNTok{```}

\FunctionTok{# Test}

\NormalTok{The **officedown** package is}
\BaseNTok{`r ftext('awesome', ft)`}\NormalTok{!}
\end{Highlighting}
\end{Shaded}

Besides functions in \textbf{officer}, \textbf{officedown} also allows you to use some special HTML comments to perform \textbf{officer} tasks. For example, the function \texttt{officer::block\_pour\_docx()} can be used to import an external Word document into the current document, and alternatively, you can use the HTML comment in R Markdown:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{<!---BLOCK_POUR_DOCX\{file: 'my-file.docx'\}--->}
\end{Highlighting}
\end{Shaded}

That is equivalent to the inline R expression:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{`r block_pour_docx(file = 'my-file.docx')`}
\end{Highlighting}
\end{Shaded}

Other things you may do with \textbf{officedown} and \textbf{officer} include:

\begin{itemize}
\item
  Insert page breaks.
\item
  Put content in a multi-column layout.
\item
  Change paragraph settings.
\item
  Insert a table of contents.
\item
  Change the orientation of a section (landscape or portrait).
\end{itemize}

To learn more about \textbf{officedown}, please check out its documentation at \url{https://davidgohel.github.io/officedown/}.

\hypertarget{multi-formats}{%
\chapter{Multiple Output Formats}\label{multi-formats}}

One main advantage of R Markdown is that it can create multiple output formats from a single source, which could be one or multiple Rmd documents. For example, this book was written in R Markdown, and compiled to two formats: PDF for printing, and HTML for the online version.

Sometimes it can be challenging to make an output element of a code chunk work for all output formats. For example, it is extremely simple to create a rounded and circular image in HTML output with a single CSS rule (\texttt{img\ \{\ border-radius:\ 50\%;\ \}}), but not so straightforward in LaTeX output (typically it will involve TikZ graphics).

Sometimes it is just impossible for an output element to work for all output formats. For example, you can easily create a GIF animation with the \textbf{gifski} package (see Section \ref{animation}), and it will work perfectly for HTML output, but embedding such an animation in LaTeX output is not possible without extra steps of processing the GIF file and using extra LaTeX packages.

This chapter provides a few examples that can work for multiple formats. If a certain feature is only available to a specific output format, we will show you how to conditionally enable or disable it based on the output format.

\hypertarget{latex-html}{%
\section{LaTeX or HTML output}\label{latex-html}}

LaTeX and HTML are two commonly used output formats. The function \texttt{knitr::is\_latex\_output()} tells you if the output format is LaTeX (including Pandoc output formats \texttt{latex} and \texttt{beamer}). Similarly, the function \texttt{knitr::is\_html\_output} tells you if the output format is HTML. By default, these Pandoc output formats are considered HTML formats: \texttt{markdown}, \texttt{epub}, \texttt{html}, \texttt{html4}, \texttt{html5}, \texttt{revealjs}, \texttt{s5}, \texttt{slideous}, and \texttt{slidy}. If you do not think a certain Pandoc format is HTML, you may use the \texttt{excludes} argument to exclude it, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# do not treat markdown as an HTML format}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{is_html_output}\NormalTok{(}\DataTypeTok{excludes =} \StringTok{"markdown"}\NormalTok{)}
\CommentTok{## [1] FALSE}
\end{Highlighting}
\end{Shaded}

If a certain output element can only be generated in LaTeX or HTML, you can use these functions to conditionally generate it. For example, when a table is too big on a PDF page, you may include the table in an environment of a smaller font size, but such a LaTeX environment certainly will not work for HTML output, so it should not be included in HTML output (if you want to tweak the font size for HTML output, you may use CSS). Below is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Render a table in a tiny environment}
\NormalTok{output:}
\NormalTok{  pdf_document: default}
\NormalTok{  html_document: default}
\NormalTok{---}

\BaseNTok{```\{r, setup, include=FALSE\}}
\BaseNTok{knitr::opts_chunk$set(echo = FALSE)}
\BaseNTok{options(knitr.table.format = function() \{}
\BaseNTok{  if (knitr::is_latex_output()) 'latex' else 'pandoc'}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{The LaTeX environment }\BaseNTok{`tiny`}\NormalTok{ is only generated for LaTeX output.}

\BaseNTok{```\{r, include=knitr::is_latex_output()\}}
\BaseNTok{knitr::asis_output('\textbackslash{}n\textbackslash{}n\textbackslash{}\textbackslash{}begin\{tiny\}')}
\BaseNTok{```}

\BaseNTok{```\{r\}}
\BaseNTok{knitr::kable(mtcars)}
\BaseNTok{```}

\BaseNTok{```\{r, include=knitr::is_latex_output()\}}
\BaseNTok{knitr::asis_output('\textbackslash{}\textbackslash{}end\{tiny\}\textbackslash{}n\textbackslash{}n')}
\BaseNTok{```}

\NormalTok{By comparison, below is the table with the normal font size.}

\BaseNTok{```\{r\}}
\BaseNTok{knitr::kable(mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The key in the above example is the chunk option \texttt{include\ =\ knitr::is\_latex\_output()}. That is, the environment \texttt{\textbackslash{}begin\{tiny\}\ \textbackslash{}end\{tiny\}} is only included when the output format is LaTeX. The two tables in the example will look identical when the output format is not LaTeX.

In Section \ref{font-color}, we used these functions to change the text color for HTML and LaTeX output. In Section \ref{animation}, we showed an animation example, which also used this trick. The code chunk that generated the animation for HTML output and static images for LaTeX output is like this:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r animation.hook=if (knitr::is_html_output()) 'gifski'\}}
\BaseNTok{for (i in 1:2) \{}
\BaseNTok{  pie(c(i %% 2, 6), col = c('red', 'yellow'), labels = NA)}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

These conditional functions can be used anywhere. You can use them in other chunk options (e.g., \texttt{eval} for conditional evaluation of the chunk), or in your R code, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, eval=knitr::is_html_output(), echo=FALSE\}}
\BaseNTok{cat('You will only see me in HTML output.')}
\BaseNTok{```}

\BaseNTok{```\{r\}}
\BaseNTok{if (knitr::is_latex_output()) \{}
\BaseNTok{  knitr::asis_output('\textbackslash{}n\textbackslash{}n\textbackslash{}\textbackslash{}begin\{tiny\}')}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{html-widgets}{%
\section{Display HTML widgets}\label{html-widgets}}

HTML widgets (\url{https://htmlwidgets.org}) are typically interactive JavaScript applications, which only work in HTML output. If you knit an Rmd document containing HTML widgets to a non-HTML format such as PDF or Word, you may get an error message like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Error: Functions that produce HTML output found in document}
\NormalTok{targeting X output. Please change the output type of this}
\NormalTok{document to HTML. Alternatively, you can allow HTML output in}
\NormalTok{non-HTML formats by adding this option to the YAML front-matter}
\NormalTok{of your rmarkdown file:}

\NormalTok{  always_allow_html: yes}

\NormalTok{Note however that the HTML output will not be visible in}
\NormalTok{non-HTML formats.}
\end{Highlighting}
\end{Shaded}

There is actually a better solution than the one mentioned in the above error message, but it involves extra packages. You can install the \textbf{webshot} package in R and also install PhantomJS:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"webshot"}\NormalTok{)}
\NormalTok{webshot}\OperatorTok{::}\KeywordTok{install_phantomjs}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Then if you knit an Rmd document with HTML widgets to a non-HTML format, the HTML widgets will be displayed as static screenshots. The screenshots are automatically taken in \textbf{knitr}. \href{https://bookdown.org/yihui/bookdown/html-widgets.html}{Section 2.10} of the \textbf{bookdown} book contains more information on finer control over the screenshots.

\hypertarget{include-url}{%
\section{Embed a web page}\label{include-url}}

If you have \textbf{webshot} and PhantomJS installed (see Section \ref{html-widgets}), you can embed any web page in the output document through \texttt{knitr::include\_url()}. When you pass a URL of a web page to this function in a code chunk, it will generate an \texttt{\textless{}iframe\textgreater{}} (inline frame) if the output format is HTML, and a screenshot of the web page for other output formats. You can view the actual page in the inline frame. For example, Figure \ref{fig:include-url} should show you my homepage if you are reading the online version of this book, otherwise you will see a static screenshot instead.

\let\ooldhref\href
\let\href\oldhref

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{include_url}\NormalTok{(}\StringTok{"https://yihui.org"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\oldhref{https://yihui.org}{\includegraphics[width=1\linewidth]{rmarkdown-cookbook_files/figure-latex/include-url-1} }\caption{Embed Yihui's homepage as an iframe or screenshot.}\label{fig:include-url}
\end{figure}

\let\href\ooldhref

Most chunk options related to figures also work for \texttt{knitr::include\_url()}, such as \texttt{out.width} and \texttt{fig.cap}.

If you have published a Shiny app publicly on a server, you can use \texttt{knitr::include\_app()} to include it, which works in the same way as \texttt{include\_url()}. \href{https://bookdown.org/yihui/bookdown/web-pages-and-shiny-apps.html}{Section 2.11} of the \textbf{bookdown} book \citep{bookdown2016} contains more details about \texttt{include\_app()} and \texttt{include\_url()}.

\hypertarget{figures-side}{%
\section{Multiple figures side-by-side}\label{figures-side}}

You can place multiple figures side-by-side using the \texttt{fig.show="hold"} along with the \texttt{out.width} option. In the example below, we have set \texttt{out.width="50\%"} (see Figure \ref{fig:figures-side} for the output):

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, figures-side, fig.show="hold", out.width="50%"\}}
\BaseNTok{par(mar = c(4, 4, .1, .1))}
\BaseNTok{plot(cars)}
\BaseNTok{plot(mpg ~ hp, data = mtcars, pch = 19)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\includegraphics[width=0.5\linewidth]{rmarkdown-cookbook_files/figure-latex/figures-side-1} \includegraphics[width=0.5\linewidth]{rmarkdown-cookbook_files/figure-latex/figures-side-2} \caption{Side-by-side figures.}\label{fig:figures-side}
\end{figure}

This simple approach works for both PDF and HTML output.

If you want to use sub-figures when there are multiple plots in a figure, you may see Section \ref{latex-subfigure}, but please note that sub-figures are only supported in LaTeX output.

\hypertarget{raw-content}{%
\section{Write raw content (*)}\label{raw-content}}

The technique introduced in Section \ref{raw-latex} is actually a general technique. You can protect any complex raw content in Markdown by specifying the content as ``raw''. For example, if you want to write raw HTML content, you can use the attribute \texttt{=html}:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{=html\}}
\BaseNTok{<p>Any <strong>raw</strong> HTML content works here.}
\BaseNTok{For example, here is a Youtube video:</p>}

\BaseNTok{<iframe width="100%" height="400"}
\BaseNTok{  src="https://www.youtube.com/embed/s3JldKoA0zw?rel=0"}
\BaseNTok{  frameborder="0" allow="autoplay; encrypted-media"}
\BaseNTok{  allowfullscreen></iframe>}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The attribute name is the Pandoc output format name. If you want to know the output format name, you may check the output of the code chunk below inside an Rmd document:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{knitr:::pandoc_to()}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Please note that raw content is only visible to a specific output format. For example, raw LaTeX content will be ignored when the output format is HTML.

\hypertarget{custom-blocks}{%
\section{Custom blocks (*)}\label{custom-blocks}}

\href{https://bookdown.org/yihui/bookdown/custom-blocks.html}{Section 2.7} of the \textbf{bookdown} book mentioned how we can use custom blocks in R Markdown to customize the appearance of blocks of content. This can be a useful way to make some content stand out from your report or book, to make sure that your readers take away the key points from your work. Examples of how these blocks could be used include:

\begin{itemize}
\item
  Display a warning message to make sure users are using up-to-date packages before running your analysis;
\item
  Add a link at the beginning of your document to your GitHub repository containing the source;
\item
  Highlight key results and findings from your analysis.
\end{itemize}

In this section, we will explain how to create your own custom blocks for both PDF and HTML output. They can both use the same formatting syntax in the R Markdown document, but require different configurations.

\hypertarget{block-syntax}{%
\subsection{Syntax}\label{block-syntax}}

The syntax for custom blocks is based on Pandoc's \href{https://pandoc.org/MANUAL.html\#divs-and-spans}{fenced \texttt{Div} blocks.} \texttt{Div} blocks are very powerful, but there is a problem at the moment: they mainly work for HTML output and do not work for LaTeX output.

Since the version 1.16 of the \textbf{rmarkdown} package, it has been possible to convert \texttt{Div} blocks to both HTML and LaTeX. For HTML output, all attributes of the block will become attributes of the \texttt{\textless{}div\textgreater{}} tag. For example, a \texttt{Div} can have an ID (after \texttt{\#}), one or multiple classes (class names are written after \texttt{.}), and other attributes. The following \texttt{Div} block

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{::: \{#hello .greeting .message width="40%"\}}
\NormalTok{Hello **world**!}
\NormalTok{:::}
\end{Highlighting}
\end{Shaded}

will be converted to the HTML code below:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<div}\OtherTok{ id=}\StringTok{"hello"}\OtherTok{ class=}\StringTok{"greeting message"}\OtherTok{ width=}\StringTok{"40%"}\KeywordTok{>}
\NormalTok{  Hello }\KeywordTok{<strong>}\NormalTok{world}\KeywordTok{</strong>}\NormalTok{!}
\KeywordTok{</div>}
\end{Highlighting}
\end{Shaded}

For LaTeX output, the first class name will be used as the LaTeX environment name, and you should provide an attribute named \texttt{data-latex} in the \texttt{Div} block, which will be the arguments of the environment. This attribute can be an empty string if the environment does not need arguments. We show two simple examples below. The first example uses the \texttt{verbatim} environment in LaTeX, which does not have any arguments:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{::: \{.verbatim data-latex=""\}}
\NormalTok{We show some _verbatim_ text here.}
\NormalTok{:::}
\end{Highlighting}
\end{Shaded}

Its LaTeX output will be:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{verbatim}\NormalTok{\}}
\VerbatimStringTok{We show some \textbackslash{}emph\{verbatim\} text here.}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{verbatim}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

When the block is converted to HTML, the HTML code will be:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<div}\OtherTok{ class=}\StringTok{"verbatim"}\KeywordTok{>}
\NormalTok{We show some }\KeywordTok{<em>}\NormalTok{verbatim}\KeywordTok{</em>}\NormalTok{ text here.}
\KeywordTok{</div>}
\end{Highlighting}
\end{Shaded}

The second example uses the \texttt{center} and \texttt{minipage} environments to display some text in a centered box of half of the page width.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{:::: \{.center data-latex=""\}}

\NormalTok{::: \{.minipage data-latex="\{.5\textbackslash{}linewidth\}"\}}
\NormalTok{This paragraph will be centered on the page, and}
\NormalTok{its width is 50% of the width of its parent element.}
\NormalTok{:::}

\NormalTok{::::}
\end{Highlighting}
\end{Shaded}

Note that we nested the \texttt{minipage} block in the \texttt{center} block. You need more colons for a parent block to include a child block. In the above example, we used four colons (you can use five or more) for the \texttt{center} block. The two blocks will be converted to LaTeX code below:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{center}\NormalTok{\}}
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{minipage}\NormalTok{\}\{.5}\FunctionTok{\textbackslash{}linewidth}\NormalTok{\}}
\NormalTok{This paragraph will be centered on the page, and}
\NormalTok{its width is 50}\FunctionTok{\textbackslash{}%}\NormalTok{ of the width of its parent element.}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{minipage}\NormalTok{\}}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{center}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

It is up to the user to define the appearance of their \texttt{\textless{}div\textgreater{}} blocks via CSS for the HTML output. Similarly, for LaTeX output, you may use the command \texttt{\textbackslash{}newenvironment} to define the environment if it has not been defined, or \texttt{\textbackslash{}renewenvironment} to redefine an existing environment in LaTeX. In the LaTeX definitions, you can decide the appearance of these blocks in PDF. These customizations will normally be contained in their own files such as \texttt{style.css} or \texttt{preamble.tex}, and then included within the YAML options:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{css}\KeywordTok{:}\AttributeTok{ style.css}
\AttributeTok{  }\FunctionTok{pdf_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{includes}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{in_header}\KeywordTok{:}\AttributeTok{ preamble.tex}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Next we will demonstrate a few more advanced custom blocks that use custom CSS rules and LaTeX environments. You may find an additional example in Section \ref{multi-column}, in which we arranged multiple blocks in a multi-column layout.

\hypertarget{block-shaded}{%
\subsection{Adding a shaded box}\label{block-shaded}}

First, we show how to include content in a shaded box. The box has a black background with an orange frame with rounded corners. The text in the box is in white.

For HTML output, we define these rules in a CSS file. If you are unfamiliar with CSS, there are plenty of free online tutorials, e.g., \url{https://www.w3schools.com/css/}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.blackbox}\NormalTok{ \{}
  \KeywordTok{padding}\NormalTok{: }\DecValTok{1}\DataTypeTok{em}\OperatorTok{;}
  \KeywordTok{background}\NormalTok{: }\ConstantTok{black}\OperatorTok{;}
  \KeywordTok{color}\NormalTok{: }\ConstantTok{white}\OperatorTok{;}
  \KeywordTok{border}\NormalTok{: }\DecValTok{2}\DataTypeTok{px} \DecValTok{solid} \ConstantTok{orange}\OperatorTok{;}
  \KeywordTok{border-radius}\NormalTok{: }\DecValTok{10}\DataTypeTok{px}\OperatorTok{;}
\NormalTok{\}}
\FunctionTok{.center}\NormalTok{ \{}
  \KeywordTok{text-align}\NormalTok{: }\DecValTok{center}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

For LaTeX output, we create a new environment named \texttt{blackbox} and based on the LaTeX package \textbf{framed}, with a black background and white text:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{\{}\ExtensionTok{color}\NormalTok{\}}
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{\{}\ExtensionTok{framed}\NormalTok{\}}
\FunctionTok{\textbackslash{}setlength}\NormalTok{\{}\FunctionTok{\textbackslash{}fboxsep}\NormalTok{\}\{.8em\}}

\FunctionTok{\textbackslash{}newenvironment}\NormalTok{\{blackbox\}\{}
  \FunctionTok{\textbackslash{}definecolor}\NormalTok{\{shadecolor\}\{rgb\}\{0, 0, 0\}  }\CommentTok{% black}
  \FunctionTok{\textbackslash{}color}\NormalTok{\{white\}}
  \KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{shaded}\NormalTok{\}\}}
\NormalTok{ \{}\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{shaded}\NormalTok{\}\}}
\end{Highlighting}
\end{Shaded}

We used the \textbf{framed} package in this book because it is fairly lightweight, but it is not possible to draw a colored frame with rounded corners with this package. To achieve the latter, you will need more sophisticated LaTeX packages such as \textbf{tcolorbox} (\url{https://ctan.org/pkg/tcolorbox}), which offers a set of very flexible options for creating shaded boxes. You can find many examples in its documentation. The LaTeX environment below will create a shaded box of the similar appearance as the above CSS example:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{\textbackslash{}usepackage}\NormalTok{\{}\ExtensionTok{tcolorbox}\NormalTok{\}}

\FunctionTok{\textbackslash{}newtcolorbox}\NormalTok{\{blackbox\}\{}
\NormalTok{  colback=black,}
\NormalTok{  colframe=orange,}
\NormalTok{  coltext=white,}
\NormalTok{  boxsep=5pt,}
\NormalTok{  arc=4pt\}}
\end{Highlighting}
\end{Shaded}

Now we can use our custom box in both PDF and HTML output formats. The source code of the box is:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{:::: \{.blackbox data-latex=""\}}
\NormalTok{::: \{.center data-latex=""\}}
\NormalTok{**NOTICE!**}
\NormalTok{:::}

\NormalTok{Thank you for noticing this **new notice**! Your noticing it has}
\NormalTok{been noted, and _will be reported to the authorities_!}
\NormalTok{::::}
\end{Highlighting}
\end{Shaded}

The output is:

\begin{blackbox}

\begin{center}

\textbf{NOTICE!}

\end{center}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{blackbox}

\hypertarget{block-image}{%
\subsection{Including icons}\label{block-image}}

We can make custom blocks even more visually appealing by including images in them, and it can be an effective way to convey the content of the block. For the following example, we assume that we are working within a directory structure below, which is a simplified version of what is used to build this book:

\begin{verbatim}
directory/
âââ your-report.Rmd
âââ style.css
âââ preamble.tex
âââ images/ 
      âââ âââ important.png
          âââ note.png
          âââ caution.png
\end{verbatim}

We show the source code and output of the example before we explain how everything works:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{::: \{.infobox .caution data-latex="\{caution\}"\}}
\NormalTok{**NOTICE!**}

\NormalTok{Thank you for noticing this **new notice**! Your noticing it has}
\NormalTok{been noted, and _will be reported to the authorities_!}
\NormalTok{:::}
\end{Highlighting}
\end{Shaded}

The output is:

\begin{infobox}{caution}

\textbf{NOTICE!}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{infobox}

For the HTML output, we can add an image to the box through the \texttt{background-image} property in CSS. We insert the image into the background, and add enough padding on the left-hand side to avoid the text overlapping with this image. If you are using local images, the file path to the images is provided relative to the CSS file. For example:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.infobox}\NormalTok{ \{}
  \KeywordTok{padding}\NormalTok{: }\DecValTok{1}\DataTypeTok{em} \DecValTok{1}\DataTypeTok{em} \DecValTok{1}\DataTypeTok{em} \DecValTok{4}\DataTypeTok{em}\OperatorTok{;}
  \KeywordTok{margin-bottom}\NormalTok{: }\DecValTok{10}\DataTypeTok{px}\OperatorTok{;}
  \KeywordTok{border}\NormalTok{: }\DecValTok{2}\DataTypeTok{px} \DecValTok{solid} \ConstantTok{orange}\OperatorTok{;}
  \KeywordTok{border-radius}\NormalTok{: }\DecValTok{10}\DataTypeTok{px}\OperatorTok{;}
  \KeywordTok{background}\NormalTok{: }\ConstantTok{#f5f5f5} \DecValTok{5}\DataTypeTok{px} \DecValTok{center}\NormalTok{/}\DecValTok{3}\DataTypeTok{em} \DecValTok{no-repeat}\OperatorTok{;}
\NormalTok{\}}

\FunctionTok{.caution}\NormalTok{ \{}
  \KeywordTok{background-image}\NormalTok{: }\FunctionTok{url(}\StringTok{"images/caution.png"}\FunctionTok{)}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Note that we used two class names, \texttt{.infobox} and \texttt{.caution}, on the outer block. The \texttt{infobox} class will be used to define the shaded box with a colored border, and the \texttt{caution} class will be used to include the image. The advantage of using two classes is that we can define more blocks with different icons without repeating the setup of the shaded box. For example, if we need a \texttt{warning} box, we only need to define the CSS rule without repeating rules in \texttt{.infobox}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.warning}\NormalTok{ \{}
  \KeywordTok{background-image}\NormalTok{: }\FunctionTok{url(}\StringTok{"images/warning.png"}\FunctionTok{)}\OperatorTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Then you can create a \texttt{warning} box with the Markdown source code below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{:::: \{.infobox .warning data-latex="warning"\}}

\NormalTok{Include the actual content here.}

\NormalTok{::::}
\end{Highlighting}
\end{Shaded}

For the PDF output, we can create an \texttt{infobox} environment based on the \texttt{blackbox} environment defined in the previous example, and add the icon to the left side of the box. There are multiple ways of including images in a LaTeX environment, and here is only one of them (it does not precisely reproduce the box style defined in CSS above):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\textbackslash{}newenvironment}\NormalTok{\{infobox\}[1]}
\NormalTok{  \{}
  \KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{itemize}\NormalTok{\}}
  \FunctionTok{\textbackslash{}renewcommand}\NormalTok{\{}\ExtensionTok{\textbackslash{}labelitemi}\NormalTok{\}\{}
    \FunctionTok{\textbackslash{}raisebox}\NormalTok{\{-.7}\FunctionTok{\textbackslash{}height}\NormalTok{\}[0pt][0pt]\{}
\NormalTok{      \{}\FunctionTok{\textbackslash{}setkeys}\NormalTok{\{Gin\}\{width=3em,keepaspectratio\}}
        \BuiltInTok{\textbackslash{}includegraphics}\NormalTok{\{}\ExtensionTok{images/#1}\NormalTok{\}\}}
\NormalTok{    \}}
\NormalTok{  \}}
  \FunctionTok{\textbackslash{}setlength}\NormalTok{\{}\FunctionTok{\textbackslash{}fboxsep}\NormalTok{\}\{1em\}}
  \KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{blackbox}\NormalTok{\}}
  \FunctionTok{\textbackslash{}item}
\NormalTok{  \}}
\NormalTok{  \{}
  \KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{blackbox}\NormalTok{\}}
  \KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{itemize}\NormalTok{\}}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

Below we show more example blocks with different icons:

\begin{infobox}{warning}

\textbf{NOTICE!}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{infobox}

\begin{infobox}{note}

\textbf{NOTICE!}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{infobox}

\begin{infobox}{important}

\textbf{NOTICE!}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{infobox}

\begin{infobox}{tip}

\textbf{NOTICE!}

Thank you for noticing this \textbf{new notice}! Your noticing it has been noted, and \emph{will be reported to the authorities}!

\end{infobox}

\hypertarget{tables}{%
\chapter{Tables}\label{tables}}

Tables are one of the primary ways in which we can communicate results in a report. You may often desire to tweak their appearance to suit your particular needs. In this chapter, we will introduce techniques that can be used to customize tables. This chapter aims to:

\begin{itemize}
\item
  Show all features of the table-generating function \texttt{knitr::kable()}.
\item
  Highlight more advanced customization of tables using the the \textbf{kableExtra} package.
\item
  Provide a list of other packages that produce tables.
\end{itemize}

\hypertarget{kable}{%
\section{\texorpdfstring{The function \texttt{knitr::kable()}}{The function knitr::kable()}}\label{kable}}

The \texttt{kable()} function in \textbf{knitr} is a very simple table generator, and is simple by design. It only generates tables for strictly rectangular data such as matrices and data frames. You cannot heavily format the table cells or merge cells. However, this function does have a large number of arguments for you to customize the appearance of tables:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(x, format, }\DataTypeTok{digits =} \KeywordTok{getOption}\NormalTok{(}\StringTok{"digits"}\NormalTok{), }\DataTypeTok{row.names =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{col.names =} \OtherTok{NA}\NormalTok{, align, }\DataTypeTok{caption =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{label =} \OtherTok{NULL}\NormalTok{, }
  \DataTypeTok{format.args =} \KeywordTok{list}\NormalTok{(), }\DataTypeTok{escape =} \OtherTok{TRUE}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\hypertarget{kable-formats}{%
\subsection{Supported table formats}\label{kable-formats}}

In most cases, \texttt{knitr::kable(x)} may be enough if you only need a simple table for the data object \texttt{x}. The \texttt{format} argument is automatically set according to the \textbf{knitr} source document format. Its possible values are \texttt{pipe} (tables with columns separated by pipes), \texttt{simple} (Pandoc's simple tables), \texttt{latex} (LaTeX tables), \texttt{html} (HTML tables), and \texttt{rst} (reStructuredText tables). For R Markdown documents, \texttt{kable()} uses the \texttt{pipe} format for tables by default, which looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(mtcars[, }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{]), }\StringTok{"pipe"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{|                  |  mpg| cyl| disp|  hp|}
\NormalTok{|:-----------------|----:|---:|----:|---:|}
\NormalTok{|Mazda RX4         | 21.0|   6|  160| 110|}
\NormalTok{|Mazda RX4 Wag     | 21.0|   6|  160| 110|}
\NormalTok{|Datsun 710        | 22.8|   4|  108|  93|}
\NormalTok{|Hornet 4 Drive    | 21.4|   6|  258| 110|}
\NormalTok{|Hornet Sportabout | 18.7|   8|  360| 175|}
\NormalTok{|Valiant           | 18.1|   6|  225| 105|}
\end{Highlighting}
\end{Shaded}

You can also generate simple tables, or tables in HTML, LaTeX, and reStructuredText:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(mtcars[, }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{]), }\StringTok{"simple"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{                      mpg   cyl   disp    hp}
\NormalTok{------------------  -----  ----  -----  ----}
\NormalTok{Mazda RX4            21.0     6    160   110}
\NormalTok{Mazda RX4 Wag        21.0     6    160   110}
\NormalTok{Datsun 710           22.8     4    108    93}
\NormalTok{Hornet 4 Drive       21.4     6    258   110}
\NormalTok{Hornet Sportabout    18.7     8    360   175}
\NormalTok{Valiant              18.1     6    225   105}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(mtcars[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\StringTok{"html"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<table>}
 \KeywordTok{<thead>}
  \KeywordTok{<tr>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}   \KeywordTok{</th>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ mpg }\KeywordTok{</th>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ cyl }\KeywordTok{</th>}
  \KeywordTok{</tr>}
 \KeywordTok{</thead>}
\KeywordTok{<tbody>}
  \KeywordTok{<tr>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}\NormalTok{ Mazda RX4 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 21 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 6 }\KeywordTok{</td>}
  \KeywordTok{</tr>}
  \KeywordTok{<tr>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}\NormalTok{ Mazda RX4 Wag }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 21 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 6 }\KeywordTok{</td>}
  \KeywordTok{</tr>}
\KeywordTok{</tbody>}
\KeywordTok{</table>}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(mtcars[, }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{]), }\StringTok{"latex"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}\{l|r|r|r|r\}}
\FunctionTok{\textbackslash{}hline}
  \OperatorTok{&}\NormalTok{ mpg }\OperatorTok{&}\NormalTok{ cyl }\OperatorTok{&}\NormalTok{ disp }\OperatorTok{&}\NormalTok{ hp}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Mazda RX4 }\OperatorTok{&}\NormalTok{ 21.0 }\OperatorTok{&}\NormalTok{ 6 }\OperatorTok{&}\NormalTok{ 160 }\OperatorTok{&}\NormalTok{ 110}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Mazda RX4 Wag }\OperatorTok{&}\NormalTok{ 21.0 }\OperatorTok{&}\NormalTok{ 6 }\OperatorTok{&}\NormalTok{ 160 }\OperatorTok{&}\NormalTok{ 110}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Datsun 710 }\OperatorTok{&}\NormalTok{ 22.8 }\OperatorTok{&}\NormalTok{ 4 }\OperatorTok{&}\NormalTok{ 108 }\OperatorTok{&}\NormalTok{ 93}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Hornet 4 Drive }\OperatorTok{&}\NormalTok{ 21.4 }\OperatorTok{&}\NormalTok{ 6 }\OperatorTok{&}\NormalTok{ 258 }\OperatorTok{&}\NormalTok{ 110}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Hornet Sportabout }\OperatorTok{&}\NormalTok{ 18.7 }\OperatorTok{&}\NormalTok{ 8 }\OperatorTok{&}\NormalTok{ 360 }\OperatorTok{&}\NormalTok{ 175}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{Valiant }\OperatorTok{&}\NormalTok{ 18.1 }\OperatorTok{&}\NormalTok{ 6 }\OperatorTok{&}\NormalTok{ 225 }\OperatorTok{&}\NormalTok{ 105}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(mtcars[, }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{]), }\StringTok{"rst"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{=================  ====  ===  ====  ===}
\NormalTok{\textbackslash{}                   mpg  cyl  disp   hp}
\NormalTok{=================  ====  ===  ====  ===}
\NormalTok{Mazda RX4          21.0    6   160  110}
\NormalTok{Mazda RX4 Wag      21.0    6   160  110}
\NormalTok{Datsun 710         22.8    4   108   93}
\NormalTok{Hornet 4 Drive     21.4    6   258  110}
\NormalTok{Hornet Sportabout  18.7    8   360  175}
\NormalTok{Valiant            18.1    6   225  105}
\NormalTok{=================  ====  ===  ====  ===}
\end{Highlighting}
\end{Shaded}

Please note that only the formats \texttt{pipe} and \texttt{simple} are portable, i.e., they work for any output document formats. Other table formats only work for specific output formats, e.g., \texttt{format\ =\ \textquotesingle{}latex\textquotesingle{}} only works for LaTeX output documents. Using a specific table format will give you more control, at the price of sacrificing portability.

If you only need one table format that is not the default format for a document, you can set the global R option \texttt{knitr.table.format}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{knitr.table.format =} \StringTok{"latex"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This option can also be a function that returns the format string or \texttt{NULL}. In the case of \texttt{NULL}, \textbf{knitr} will try to automatically decide the appropriate format. For example, we can use the \texttt{latex} format only when the output format is LaTeX:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{knitr.table.format =} \ControlFlowTok{function}\NormalTok{() \{}
  \ControlFlowTok{if}\NormalTok{ (knitr}\OperatorTok{::}\KeywordTok{is_latex_output}\NormalTok{()) }
    \StringTok{"latex"} \ControlFlowTok{else} \StringTok{"pipe"}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{change-column-names}{%
\subsection{Change column names}\label{change-column-names}}

The names of columns in a data frame may not be the same as what we want to display to readers. In R, the column names of data often do not use spaces to separate words but dots or underscores instead, which may not feel natural when we read them in a table. We can use the the \texttt{col.names} argument to replace the column names with a vector of new names. For example, we substitute the dots with spaces in the column names of the \texttt{iris} data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris2 <-}\StringTok{ }\KeywordTok{head}\NormalTok{(iris)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{col.names =} \KeywordTok{gsub}\NormalTok{(}\StringTok{"[.]"}\NormalTok{, }\StringTok{" "}\NormalTok{, }\KeywordTok{names}\NormalTok{(iris)))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r|r|l}
\hline
Sepal Length & Sepal Width & Petal Length & Petal Width & Species\\
\hline
5.1 & 3.5 & 1.4 & 0.2 & setosa\\
\hline
4.9 & 3.0 & 1.4 & 0.2 & setosa\\
\hline
4.7 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
4.6 & 3.1 & 1.5 & 0.2 & setosa\\
\hline
5.0 & 3.6 & 1.4 & 0.2 & setosa\\
\hline
5.4 & 3.9 & 1.7 & 0.4 & setosa\\
\hline
\end{tabular}

The \texttt{col.names} argument can take an arbitrary character vector (not necessarily the modified column names via functions like \texttt{gsub()}), as long as the length of the vector is equal to the number of columns of the data object, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}
\NormalTok{  iris,}
  \DataTypeTok{col.names =} \KeywordTok{c}\NormalTok{(}\StringTok{'We'}\NormalTok{, }\StringTok{'Need'}\NormalTok{, }\StringTok{'Five'}\NormalTok{, }\StringTok{'Names'}\NormalTok{, }\StringTok{'Here'}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{specify-column-alignment}{%
\subsection{Specify column alignment}\label{specify-column-alignment}}

To change the alignment of the table columns, you can use either a vector of values consisting of characters \texttt{l} (left), \texttt{c} (center), and \texttt{r} (right) or a single multi-character string for alignment, so \texttt{kable(...,\ align\ =\ c(\textquotesingle{}c\textquotesingle{},\ \textquotesingle{}l\textquotesingle{}))} can be shortened to \texttt{kable(...,\ align\ =\ \textquotesingle{}cl\textquotesingle{})}. By default, numeric columns are right-aligned, and other columns are left-aligned. Here is an example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# left, center, center, right, right}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{align =} \StringTok{"lccrr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|c|c|r|r}
\hline
Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
\hline
5.1 & 3.5 & 1.4 & 0.2 & setosa\\
\hline
4.9 & 3.0 & 1.4 & 0.2 & setosa\\
\hline
4.7 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
4.6 & 3.1 & 1.5 & 0.2 & setosa\\
\hline
5.0 & 3.6 & 1.4 & 0.2 & setosa\\
\hline
5.4 & 3.9 & 1.7 & 0.4 & setosa\\
\hline
\end{tabular}

\hypertarget{kable-caption}{%
\subsection{Add a table caption}\label{kable-caption}}

You can add a caption to the table via the \texttt{caption} argument, e.g.~(see Table \ref{tab:kable-cap} for the output),

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{caption =} \StringTok{"An example table caption."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:kable-cap}An example table caption.}
\centering
\begin{tabular}[t]{r|r|r|r|l}
\hline
Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
\hline
5.1 & 3.5 & 1.4 & 0.2 & setosa\\
\hline
4.9 & 3.0 & 1.4 & 0.2 & setosa\\
\hline
4.7 & 3.2 & 1.3 & 0.2 & setosa\\
\hline
4.6 & 3.1 & 1.5 & 0.2 & setosa\\
\hline
5.0 & 3.6 & 1.4 & 0.2 & setosa\\
\hline
5.4 & 3.9 & 1.7 & 0.4 & setosa\\
\hline
\end{tabular}
\end{table}

As we mentioned in Section \ref{cross-ref}, a table can be cross-referenced when it has a caption and the output format is from \textbf{bookdown}.

\hypertarget{format-numeric-columns}{%
\subsection{Format numeric columns}\label{format-numeric-columns}}

You can set the maximum number of decimal places via the \texttt{digits} argument (which will be passed to the \texttt{round()} function), and other formatting arguments via \texttt{format.args} (to be passed to the \texttt{format()} function in base R). First we show a few simple examples of \texttt{round()} and \texttt{format()} so you will understand how the arguments work later in \texttt{kable()}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round}\NormalTok{(}\FloatTok{1.234567}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\CommentTok{## [1] 1}
\KeywordTok{round}\NormalTok{(}\FloatTok{1.234567}\NormalTok{, }\DataTypeTok{digits =} \DecValTok{1}\NormalTok{)}
\CommentTok{## [1] 1.2}
\KeywordTok{round}\NormalTok{(}\FloatTok{1.234567}\NormalTok{, }\DataTypeTok{digits =} \DecValTok{3}\NormalTok{)}
\CommentTok{## [1] 1.235}
\KeywordTok{format}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\DataTypeTok{scientific =} \OtherTok{TRUE}\NormalTok{)}
\CommentTok{## [1] "1e+03"}
\KeywordTok{format}\NormalTok{(}\FloatTok{10000.123}\NormalTok{, }\DataTypeTok{big.mark =} \StringTok{","}\NormalTok{)}
\CommentTok{## [1] "10,000"}
\end{Highlighting}
\end{Shaded}

Then we round and format numbers in a table:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\DataTypeTok{X1 =} \KeywordTok{runif}\NormalTok{(}\DecValTok{3}\NormalTok{), }\DataTypeTok{X2 =} \DecValTok{10}\OperatorTok{^}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{7}\NormalTok{), }\DataTypeTok{X3 =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1000}\NormalTok{))}
\CommentTok{# at most 4 decimal places}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
0.6050 & 1e+03 & -1817.3166\\
\hline
0.0414 & 1e+05 & 1014.9516\\
\hline
0.3273 & 1e+07 & 472.4048\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# round columns separately}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{digits =} \KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
0.60503 & 1e+03 & -1817.32\\
\hline
0.04136 & 1e+05 & 1014.95\\
\hline
0.32729 & 1e+07 & 472.40\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# do not use the scientific notation}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{digits =} \DecValTok{3}\NormalTok{, }\DataTypeTok{format.args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{scientific =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
0.605 & 1000 & -1817.317\\
\hline
0.041 & 100000 & 1014.952\\
\hline
0.327 & 10000000 & 472.405\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add commas to big numbers}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{digits =} \DecValTok{3}\NormalTok{, }\DataTypeTok{format.args =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{big.mark =} \StringTok{","}\NormalTok{, }\DataTypeTok{scientific =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
0.605 & 1,000 & -1,817.317\\
\hline
0.041 & 100,000 & 1,014.952\\
\hline
0.327 & 10,000,000 & 472.405\\
\hline
\end{tabular}

\hypertarget{display-missing-values}{%
\subsection{Display missing values}\label{display-missing-values}}

By default, missing values (i.e., \texttt{NA}) are displayed as the character string \texttt{NA} in the table. You can replace it with other values or choose not to display anything (i.e., leave the \texttt{NA} cells empty) with the global R option \texttt{knitr.kable.NA}, e.g., we make \texttt{NA} cells empty in the second table and display \texttt{**} in the third table below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d[}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{), }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{))] <-}\StringTok{ }\OtherTok{NA}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d)  }\CommentTok{# NA is displayed by default}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
NA & 1e+03 & -1817.3\\
\hline
0.0414 & 1e+05 & NA\\
\hline
0.3273 & NA & 472.4\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# replace NA with empty strings}
\NormalTok{opts <-}\StringTok{ }\KeywordTok{options}\NormalTok{(}\DataTypeTok{knitr.kable.NA =} \StringTok{""}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
 & 1e+03 & -1817.3\\
\hline
0.0414 & 1e+05 & \\
\hline
0.3273 &  & 472.4\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{knitr.kable.NA =} \StringTok{"**"}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
X1 & X2 & X3\\
\hline
** & 1e+03 & -1817.3\\
\hline
0.0414 & 1e+05 & **\\
\hline
0.3273 & ** & 472.4\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(opts)  }\CommentTok{# restore global R options}
\end{Highlighting}
\end{Shaded}

\hypertarget{escape-special-characters}{%
\subsection{Escape special characters}\label{escape-special-characters}}

If you are familiar with HTML or LaTeX, you know that there are a few special characters in these languages. To generate safe output, \texttt{kable()} will escape these special characters by default via the argument \texttt{escape\ =\ TRUE}, which means all characters will be generated verbatim, and special characters lose their special meanings. For example, \texttt{\textgreater{}} will be substituted with \texttt{\&gt;} for HTML tables, and \texttt{\_} will be escaped as \texttt{\textbackslash{}\_} for LaTeX tables. If you are an expert and know how to use special characters properly, you may disable this argument via \texttt{escape\ =\ FALSE}. In the second table below, we include a few LaTeX math expressions that contain special characters \texttt{\$}, \texttt{\textbackslash{}}, and \texttt{\_}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{m <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(dist }\OperatorTok{~}\StringTok{ }\NormalTok{speed, }\DataTypeTok{data =}\NormalTok{ cars)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{coef}\NormalTok{(}\KeywordTok{summary}\NormalTok{(m))}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|r|r|r|r}
\hline
  & Estimate & Std. Error & t value & Pr(>|t|)\\
\hline
(Intercept) & -17.579 & 6.7584 & -2.601 & 0.0123\\
\hline
speed & 3.932 & 0.4155 & 9.464 & 0.0000\\
\hline
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add a few math expressions to row and column names}
\KeywordTok{rownames}\NormalTok{(d) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{beta_0$"}\NormalTok{, }\StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{beta_1$"}\NormalTok{)}
\KeywordTok{colnames}\NormalTok{(d)[}\DecValTok{4}\NormalTok{] <-}\StringTok{ "$P(T > |t|)$"}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{escape =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|r|r|r|r}
\hline
  & Estimate & Std. Error & t value & $P(T > |t|)$\\
\hline
$\beta_0$ & -17.579 & 6.7584 & -2.601 & 0.0123\\
\hline
$\beta_1$ & 3.932 & 0.4155 & 9.464 & 0.0000\\
\hline
\end{tabular}

Without \texttt{escape\ =\ FALSE}, special characters will be either escaped or substituted. For example, \texttt{\$} is escaped as \texttt{\textbackslash{}\$}, \texttt{\_} is escaped as \texttt{\textbackslash{}\_}, and \texttt{\textbackslash{}} is substituted with \texttt{\textbackslash{}textbackslash\{\}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d, }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{escape =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}\{l|r|r|r|r\}}
\FunctionTok{\textbackslash{}hline}
  \OperatorTok{&}\NormalTok{ Estimate }\OperatorTok{&}\NormalTok{ Std. Error }\OperatorTok{&}\NormalTok{ t value }\OperatorTok{&} \FunctionTok{\textbackslash{}$}\NormalTok{P(T > |t|)}\FunctionTok{\textbackslash{}$\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\FunctionTok{\textbackslash{}$\textbackslash{}textbackslash}\NormalTok{\{\}beta}\FunctionTok{\textbackslash{}_}\NormalTok{0}\FunctionTok{\textbackslash{}$} \OperatorTok{&}\NormalTok{ -17.579 }\OperatorTok{&}\NormalTok{ 6.7584 }\OperatorTok{&}\NormalTok{ -2.601 }\OperatorTok{&}\NormalTok{ 0.0123}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\FunctionTok{\textbackslash{}$\textbackslash{}textbackslash}\NormalTok{\{\}beta}\FunctionTok{\textbackslash{}_}\NormalTok{1}\FunctionTok{\textbackslash{}$} \OperatorTok{&}\NormalTok{ 3.932 }\OperatorTok{&}\NormalTok{ 0.4155 }\OperatorTok{&}\NormalTok{ 9.464 }\OperatorTok{&}\NormalTok{ 0.0000}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Other common special LaTeX characters include \texttt{\#}, \texttt{\%}, \texttt{\&}, \texttt{\{}, and \texttt{\}}. Common special HTML characters include \texttt{\&}, \texttt{\textless{}}, \texttt{\textgreater{}}, and \texttt{"}. You need to be cautious when generating tables with \texttt{escape\ =\ FALSE}, and make sure you are using the special characters in the right way. It is a very common mistake to use \texttt{escape\ =\ FALSE} and include \texttt{\%} or \texttt{\_} in column names or the caption of a LaTeX table without realizing that they are special.

If you are not sure how to properly escape special characters, there are two internal helper functions in \textbf{knitr}. Below are some examples:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{:::}\KeywordTok{escape_latex}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"100%"}\NormalTok{, }\StringTok{"# a comment"}\NormalTok{, }\StringTok{"column_name"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "100\\%"        "\\# a comment" "column\\_name"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{:::}\KeywordTok{escape_html}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"<address>"}\NormalTok{, }\StringTok{"x = }\CharTok{\textbackslash{}"}\StringTok{character}\CharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, }\StringTok{"a & b"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "&lt;address&gt;"           "x = &quot;character&quot;" "a &amp; b"
\end{verbatim}

\hypertarget{multiple-tables-side-by-side}{%
\subsection{Multiple tables side by side}\label{multiple-tables-side-by-side}}

You can pass a list of data frames or matrices to \texttt{kable()} to generate multiple tables side by side. For example, Table \ref{tab:two-tables} contains two tables generated from the code below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d1 <-}\StringTok{ }\KeywordTok{head}\NormalTok{(cars, }\DecValTok{3}\NormalTok{)}
\NormalTok{d2 <-}\StringTok{ }\KeywordTok{head}\NormalTok{(mtcars[, }\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{], }\DecValTok{5}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}
  \KeywordTok{list}\NormalTok{(d1, d2),}
  \DataTypeTok{caption =} \StringTok{'Two tables placed side by side.'}\NormalTok{,}
  \DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{valign =} \StringTok{'t'}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\caption{\label{tab:two-tables}Two tables placed side by side.}

\centering
\begin{tabular}[t]{rr}
\toprule
speed & dist\\
\midrule
4 & 2\\
4 & 10\\
7 & 4\\
\bottomrule
\end{tabular}
\centering
\begin{tabular}[t]{lrrr}
\toprule
  & mpg & cyl & disp\\
\midrule
Mazda RX4 & 21.0 & 6 & 160\\
Mazda RX4 Wag & 21.0 & 6 & 160\\
Datsun 710 & 22.8 & 4 & 108\\
Hornet 4 Drive & 21.4 & 6 & 258\\
Hornet Sportabout & 18.7 & 8 & 360\\
\bottomrule
\end{tabular}
\end{table}

Please note that this feature only works for HTML and PDF output.

If you want to be able to customize each table individually when placing them side by side, you may use the \texttt{kables()} function (the plural form of \texttt{kable()}), and pass a list of \texttt{kable()} objects to it. For example, we change the column names in the left table and set the number of decimal places to zero in the right table in Table \ref{tab:kables}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# data objects d1 and d2 are from the previous code chunk}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kables}\NormalTok{(}
  \KeywordTok{list}\NormalTok{(}
    \CommentTok{# the first kable() to change column names}
\NormalTok{    knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}
\NormalTok{      d1, }\DataTypeTok{col.names =} \KeywordTok{c}\NormalTok{(}\StringTok{'SPEED'}\NormalTok{, }\StringTok{'DISTANCE'}\NormalTok{), }\DataTypeTok{valign =} \StringTok{'t'}
\NormalTok{    ),}
    \CommentTok{# the second kable() to set the digits option}
\NormalTok{    knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(d2, }\DataTypeTok{digits =} \DecValTok{0}\NormalTok{, }\DataTypeTok{valign =} \StringTok{'t'}\NormalTok{)}
\NormalTok{  ),}
  \DataTypeTok{caption =} \StringTok{'Two tables created by knitr::kables().'}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\caption{\label{tab:kables}Two tables created by knitr::kables().}

\begin{tabular}[t]{r|r}
\hline
SPEED & DISTANCE\\
\hline
4 & 2\\
\hline
4 & 10\\
\hline
7 & 4\\
\hline
\end{tabular}
\begin{tabular}[t]{l|r|r|r}
\hline
  & mpg & cyl & disp\\
\hline
Mazda RX4 & 21 & 6 & 160\\
\hline
Mazda RX4 Wag & 21 & 6 & 160\\
\hline
Datsun 710 & 23 & 4 & 108\\
\hline
Hornet 4 Drive & 21 & 6 & 258\\
\hline
Hornet Sportabout & 19 & 8 & 360\\
\hline
\end{tabular}
\end{table}

\hypertarget{generate-multiple-tables-from-a-for-loop}{%
\subsection{\texorpdfstring{Generate multiple tables from a \texttt{for}-loop (*)}{Generate multiple tables from a for-loop (*)}}\label{generate-multiple-tables-from-a-for-loop}}

One common confusion about \texttt{kable()} is that it does not work inside \texttt{for}-loops. This problem is not specific to \texttt{kable()} but exists in many other packages, too. The reason is a little complicated. In case you are interested in the technicality, it has been explained in the blog post \href{https://yihui.org/en/2017/06/top-level-r-expressions/}{``The Ghost Printer Behind Top-level R Expressions''.}

You may expect the following code chunk to generate three tables, but it will not:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{for (i in 1:3) \{}
\BaseNTok{  knitr::kable(head(iris))}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You have to explicitly print the \texttt{kable()} results, and apply the chunk option \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, results='asis'\}}
\BaseNTok{for (i in 1:3) \{}
\BaseNTok{  print(knitr::kable(head(iris)))}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

In general, when you generate output from a \texttt{for}-loop, we recommend that you add a few line breaks (\texttt{\textbackslash{}n}) or an HTML comment (\texttt{\textless{}!-\/-\ -\/-\textgreater{}}) after each output element to clearly separate all output elements, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, results='asis'\}}
\BaseNTok{for (i in 1:3) \{}
\BaseNTok{  print(knitr::kable(head(iris), caption = 'A caption.'))}
\BaseNTok{  cat('\textbackslash{}n\textbackslash{}n<!-- -->\textbackslash{}n\textbackslash{}n')}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Without the separators, Pandoc may be fail to detect the individual elements. For example, when a plot is followed immediately by a table, the table will not be recognized:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{![](logo.png)}
\BaseNTok{                      mpg   cyl   disp    hp}
\NormalTok{------------------  -----  ----  -----  ----}
\NormalTok{Mazda RX4            21.0     6    160   110}
\NormalTok{Mazda RX4 Wag        21.0     6    160   110}
\end{Highlighting}
\end{Shaded}

But it will be if there is a clear separation like (note that we added an empty line below the image):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{![](logo.png)}

\BaseNTok{                      mpg   cyl   disp    hp}
\NormalTok{------------------  -----  ----  -----  ----}
\NormalTok{Mazda RX4            21.0     6    160   110}
\NormalTok{Mazda RX4 Wag        21.0     6    160   110}
\end{Highlighting}
\end{Shaded}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{![](logo.png)}

\NormalTok{<!--}\CommentTok{ -->}

\BaseNTok{                      mpg   cyl   disp    hp}
\NormalTok{------------------  -----  ----  -----  ----}
\NormalTok{Mazda RX4            21.0     6    160   110}
\NormalTok{Mazda RX4 Wag        21.0     6    160   110}
\end{Highlighting}
\end{Shaded}

\hypertarget{customize-latex-tables}{%
\subsection{Customize LaTeX tables (*)}\label{customize-latex-tables}}

If the only output format you need is LaTeX, there are a few extra options you can use in \texttt{kable()}. Note that these options will be ignored in other types of output such as HTML. Unless you have set the table format option globally (see Section \ref{kable-formats}), you will have to use the \texttt{format} argument of \texttt{kable()} explicitly in the examples of this section, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

When you assign a caption to a table (see Section \ref{kable-caption}), \texttt{kable()} will use the \texttt{table} environment to include the table, i.e.,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{table}\NormalTok{\}}
\CommentTok{% the table body (usually the tabular environment)}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{table}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

You can change this environment via the \texttt{table.envir} argument, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(cars[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, ], }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{table.envir =} \StringTok{"figure"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{figure}\NormalTok{\}}
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}\{r|r\}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{speed }\OperatorTok{&}\NormalTok{ dist}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{4 }\OperatorTok{&}\NormalTok{ 2}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{4 }\OperatorTok{&}\NormalTok{ 10}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{figure}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The floating position of the table is controlled by the argument \texttt{position}. For example, we can try to force a table to float to the bottom of a page via \texttt{position\ =\ "!b"}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(cars[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, ], }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{table.envir =} \StringTok{"table"}\NormalTok{, }\DataTypeTok{position =} \StringTok{"!b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{table}\NormalTok{\}[!b]}
\KeywordTok{\textbackslash{}begin}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}\{r|r\}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{speed }\OperatorTok{&}\NormalTok{ dist}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{4 }\OperatorTok{&}\NormalTok{ 2}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\NormalTok{4 }\OperatorTok{&}\NormalTok{ 10}\FunctionTok{\textbackslash{}\textbackslash{}}
\FunctionTok{\textbackslash{}hline}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{tabular}\NormalTok{\}}
\KeywordTok{\textbackslash{}end}\NormalTok{\{}\ExtensionTok{table}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

When a table has a caption, you can also assign a short caption to it via the \texttt{caption.short} argument, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{caption =} \StringTok{"A long long long caption!"}\NormalTok{, }\DataTypeTok{caption.short =} \StringTok{"A short one."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The short caption goes into the square brackets of the \texttt{\textbackslash{}caption{[}{]}\{\}} command in LaTeX, and is often used in the List of Tables of the PDF output document (if the short caption is not provided, the full caption is displayed there).

If you are familiar with the LaTeX package \href{https://ctan.org/pkg/booktabs}{\textbf{booktabs}} for publication quality tables, you can set \texttt{booktabs\ =\ TRUE}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris3 <-}\StringTok{ }\KeywordTok{head}\NormalTok{(iris, }\DecValTok{10}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris3, }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{rrrrl}
\toprule
Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
\midrule
5.1 & 3.5 & 1.4 & 0.2 & setosa\\
4.9 & 3.0 & 1.4 & 0.2 & setosa\\
4.7 & 3.2 & 1.3 & 0.2 & setosa\\
4.6 & 3.1 & 1.5 & 0.2 & setosa\\
5.0 & 3.6 & 1.4 & 0.2 & setosa\\
\addlinespace
5.4 & 3.9 & 1.7 & 0.4 & setosa\\
4.6 & 3.4 & 1.4 & 0.3 & setosa\\
5.0 & 3.4 & 1.5 & 0.2 & setosa\\
4.4 & 2.9 & 1.4 & 0.2 & setosa\\
4.9 & 3.1 & 1.5 & 0.1 & setosa\\
\bottomrule
\end{tabular}

Please note that when you need additional LaTeX packages such as \textbf{booktabs} for an R Markdown document, you have to declare these packages in YAML (see Section \ref{latex-extra} for how).

Depending on whether the argument \texttt{booktabs} is \texttt{TRUE} or \texttt{FALSE} (default), the table appearance is different. For \texttt{booktabs\ =\ FALSE}:

\begin{itemize}
\item
  Table columns are separated by vertical lines. You can explicitly remove the vertical lines via the \texttt{vline} argument, e.g., \texttt{knitr::kable(iris,\ vline\ =\ "")} (the default is \texttt{vline\ =\ "\textbar{}"}). You can set this option as a global R option so you do not need to set it for every single table, e.g., \texttt{options(knitr.table.vline\ =\ "")}.
\item
  The horizontal lines can be defined via arguments \texttt{toprule}, \texttt{midrule}, \texttt{linesep}, and \texttt{bottomrule}. Their default values are all \texttt{\textbackslash{}hline}.
\end{itemize}

For \texttt{booktabs\ =\ TRUE}:

\begin{itemize}
\item
  There are no vertical lines in the table, but you can add these lines via the \texttt{vline} argument.
\item
  The table only has horizontal lines for the table header and the bottom row. The default argument values are \texttt{toprule\ =\ "\textbackslash{}\textbackslash{}toprule"}, \texttt{midrule\ =\ "\textbackslash{}\textbackslash{}midrule"}, and \texttt{bottomrule\ =\ "\textbackslash{}\textbackslash{}bottomrule"}. A line space is added to every five rows by default. This is controlled by the argument \texttt{linesep}, which defaults to \texttt{c("",\ "",\ "",\ "",\ "\textbackslash{}\textbackslash{}addlinespace")}. If you want to add a space to every three rows, you can do this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(iris3, }\DataTypeTok{format =} \StringTok{"latex"}\NormalTok{, }\DataTypeTok{linesep =} \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{addlinespace"}\NormalTok{), }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

  \begin{tabular}{rrrrl}
  \toprule
  Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
  \midrule
  5.1 & 3.5 & 1.4 & 0.2 & setosa\\
  4.9 & 3.0 & 1.4 & 0.2 & setosa\\
  4.7 & 3.2 & 1.3 & 0.2 & setosa\\
  \addlinespace
  4.6 & 3.1 & 1.5 & 0.2 & setosa\\
  5.0 & 3.6 & 1.4 & 0.2 & setosa\\
  5.4 & 3.9 & 1.7 & 0.4 & setosa\\
  \addlinespace
  4.6 & 3.4 & 1.4 & 0.3 & setosa\\
  5.0 & 3.4 & 1.5 & 0.2 & setosa\\
  4.4 & 2.9 & 1.4 & 0.2 & setosa\\
  \addlinespace
  4.9 & 3.1 & 1.5 & 0.1 & setosa\\
  \bottomrule
  \end{tabular}

  If you want to remove the line spaces altogether, you may use \texttt{linesep\ =\ \textquotesingle{}\textquotesingle{}}.
\end{itemize}

Sometimes your table may be longer than a page. In this case, you can use the argument \texttt{longtable\ =\ TRUE}, which uses the LaTeX package \href{https://ctan.org/pkg/longtable}{\textbf{longtable}} to span your table to multiple pages.

Tables are center-aligned by default when they are included in a table environment (i.e., when the table has a caption). If you do not want to center a table, use the argument \texttt{centering\ =\ FALSE}.

\hypertarget{customize-html-tables}{%
\subsection{Customize HTML tables (*)}\label{customize-html-tables}}

If you want to customize tables generated via \texttt{knitr::kable(format\ =\ "html")}, there is only one extra argument besides the common arguments mentioned in previous sections: \texttt{table.attr}. This argument allows you to add arbitrary attributes to the \texttt{\textless{}table\textgreater{}} tag. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(mtcars[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\DataTypeTok{table.attr =} \StringTok{"class=}\CharTok{\textbackslash{}"}\StringTok{striped}\CharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, }\DataTypeTok{format =} \StringTok{"html"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<table}\OtherTok{ class=}\StringTok{"striped"}\KeywordTok{>}
 \KeywordTok{<thead>}
  \KeywordTok{<tr>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}   \KeywordTok{</th>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ mpg }\KeywordTok{</th>}
   \KeywordTok{<th}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ cyl }\KeywordTok{</th>}
  \KeywordTok{</tr>}
 \KeywordTok{</thead>}
\KeywordTok{<tbody>}
  \KeywordTok{<tr>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}\NormalTok{ Mazda RX4 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 21 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 6 }\KeywordTok{</td>}
  \KeywordTok{</tr>}
  \KeywordTok{<tr>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:left;"}\KeywordTok{>}\NormalTok{ Mazda RX4 Wag }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 21 }\KeywordTok{</td>}
   \KeywordTok{<td}\OtherTok{ style=}\StringTok{"text-align:right;"}\KeywordTok{>}\NormalTok{ 6 }\KeywordTok{</td>}
  \KeywordTok{</tr>}
\KeywordTok{</tbody>}
\KeywordTok{</table>}
\end{Highlighting}
\end{Shaded}

We added a class \texttt{striped} to the table. However, a class name is not enough to change the appearance of a table. You have to define CSS rules for the class. For example, to make a striped table that has different colors for odd and even rows, you can add a lightgray background to even or odd rows:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.striped}\NormalTok{ tr}\InformationTok{:nth-child(even)}\NormalTok{ \{ }\KeywordTok{background}\NormalTok{: }\ConstantTok{#eee}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

The above CSS rule means all rows (i.e., the \texttt{\textless{}tr\textgreater{}} tags) with even row numbers (\texttt{:nth-child(even)}) that are children of an element with the \texttt{striped} class will have a background color \texttt{\#eee}.

A little bit CSS can make a plain HTML table look decent. Figure \ref{fig:striped-table} is a screenshot of an HTML table to which the following CSS rules are applied:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{table \{}
  \KeywordTok{margin}\NormalTok{: }\BuiltInTok{auto}\OperatorTok{;}
  \KeywordTok{border-top}\NormalTok{: }\DecValTok{1}\DataTypeTok{px} \DecValTok{solid} \ConstantTok{#666}\OperatorTok{;}
  \KeywordTok{border-bottom}\NormalTok{: }\DecValTok{1}\DataTypeTok{px} \DecValTok{solid} \ConstantTok{#666}\OperatorTok{;}
\NormalTok{\}}
\NormalTok{table thead th \{ }\KeywordTok{border-bottom}\NormalTok{: }\DecValTok{1}\DataTypeTok{px} \DecValTok{solid} \ConstantTok{#ddd}\OperatorTok{;}\NormalTok{ \}}
\NormalTok{th}\OperatorTok{,}\NormalTok{ td \{ }\KeywordTok{padding}\NormalTok{: }\DecValTok{5}\DataTypeTok{px}\OperatorTok{;}\NormalTok{ \}}
\NormalTok{thead}\OperatorTok{,}\NormalTok{ tfoot}\OperatorTok{,}\NormalTok{ tr}\InformationTok{:nth-child(even)}\NormalTok{ \{ }\KeywordTok{background}\NormalTok{: }\ConstantTok{#eee}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.7\linewidth]{images/striped-table} 

}

\caption{A striped table created with HTML and CSS.}\label{fig:striped-table}
\end{figure}

\hypertarget{kableextra}{%
\section{\texorpdfstring{The \textbf{kableExtra} package}{The kableExtra package}}\label{kableextra}}

The \textbf{kableExtra} package \citep{R-kableExtra} is designed to extend the basic functionality of tables produced using \texttt{knitr::kable()} (see Section \ref{kable}). Since \texttt{knitr::kable()} is simple by design (please feel free to read this as ``Yihui is lazy''), it definitely has a lot of missing features that are commonly seen in other packages, and \textbf{kableExtra} has filled the gap perfectly. The most amazing thing about \textbf{kableExtra} is that most of its table features work for both HTML and PDF formats (e.g., making striped tables like the one in Figure \ref{fig:striped-table}).

This package can be installed from CRAN as usual, or you may try the development version on GitHub (\url{https://github.com/haozhu233/kableExtra}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install from CRAN}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"kableExtra"}\NormalTok{)}

\CommentTok{# install the development version}
\NormalTok{remotes}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"haozhu233/kableExtra"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

It has extensive documentation at \url{https://haozhu233.github.io/kableExtra/}, which provides a lot of examples on how the \texttt{kable()} output can be customized for either HTML or LaTeX output. We recommend that you read its documentation by yourself, and will only present a handful of examples in this section.

The \textbf{kableExtra} package features the pipe operator, \texttt{\%\textgreater{}\%}. You can pipe the \texttt{kable()} output to the styling functions of \textbf{kableExtra}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(knitr)}
\KeywordTok{library}\NormalTok{(kableExtra)}
\KeywordTok{kable}\NormalTok{(iris) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{(}\DataTypeTok{latex_options =} \StringTok{"striped"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{set-the-font-size}{%
\subsection{Set the font size}\label{set-the-font-size}}

The function \texttt{kable\_styling()} in \textbf{kableExtra} allows you to style the whole table. For example, you can specify the alignment of the table on the page, the width, and the font size of the table. Below is an example of using a smaller font size:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(iris, }\DecValTok{5}\NormalTok{), }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{(}\DataTypeTok{font_size =} \DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering\begingroup\fontsize{8}{10}\selectfont

\begin{tabular}{rrrrl}
\toprule
Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
\midrule
5.1 & 3.5 & 1.4 & 0.2 & setosa\\
4.9 & 3.0 & 1.4 & 0.2 & setosa\\
4.7 & 3.2 & 1.3 & 0.2 & setosa\\
4.6 & 3.1 & 1.5 & 0.2 & setosa\\
5.0 & 3.6 & 1.4 & 0.2 & setosa\\
\bottomrule
\end{tabular}
\endgroup{}
\end{table}

\hypertarget{style-specific-rowscolumns}{%
\subsection{Style specific rows/columns}\label{style-specific-rowscolumns}}

The functions \texttt{row\_spec()} and \texttt{column\_spec()} can be used to style individual rows and columns, respectively. In the example below, we make the first row bold and italic, add a black background to the second and third rows while changing the font color to white, underline the fourth row and change its typeface, rotate the fifth row, and strike out the fifth column:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(iris, }\DecValTok{5}\NormalTok{), }\DataTypeTok{align =} \StringTok{'c'}\NormalTok{, }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{row_spec}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{bold =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{italic =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{row_spec}\NormalTok{(}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{, }\DataTypeTok{color =} \StringTok{'white'}\NormalTok{, }\DataTypeTok{background =} \StringTok{'black'}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{row_spec}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DataTypeTok{underline =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{monospace =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{row_spec}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DataTypeTok{angle =} \DecValTok{45}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{column_spec}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DataTypeTok{strikeout =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{cccc>{\sout}c}
\toprule
Sepal.Length & Sepal.Width & Petal.Length & Petal.Width & Species\\
\midrule
\em{\textbf{5.1}} & \em{\textbf{3.5}} & \em{\textbf{1.4}} & \em{\textbf{0.2}} & \em{\textbf{setosa}}\\
\rowcolor{black}  \textcolor{white}{4.9} & \textcolor{white}{3.0} & \textcolor{white}{1.4} & \textcolor{white}{0.2} & \textcolor{white}{setosa}\\
\rowcolor{black}  \textcolor{white}{4.7} & \textcolor{white}{3.2} & \textcolor{white}{1.3} & \textcolor{white}{0.2} & \textcolor{white}{setosa}\\
\underline{\ttfamily{4.6}} & \underline{\ttfamily{3.1}} & \underline{\ttfamily{1.5}} & \underline{\ttfamily{0.2}} & \underline{\ttfamily{setosa}}\\
\rotatebox{45}{5.0} & \rotatebox{45}{3.6} & \rotatebox{45}{1.4} & \rotatebox{45}{0.2} & \rotatebox{45}{setosa}\\
\bottomrule
\end{tabular}

Similarly, you can style individual cells with the \texttt{cell\_spec()} function.

\hypertarget{group-rowscolumns}{%
\subsection{Group rows/columns}\label{group-rowscolumns}}

Rows and columns can be grouped via the functions \texttt{pack\_rows()} and \texttt{add\_header\_above()}, respectively. You can also collapse rows via \texttt{collapse\_rows()}, so one cell can span multiple rows. Below is an example that shows a custom table header with grouped columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris2 <-}\StringTok{ }\NormalTok{iris[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(iris2) <-}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{'[.].+'}\NormalTok{, }\StringTok{''}\NormalTok{, }\KeywordTok{names}\NormalTok{(iris2))}
\KeywordTok{kable}\NormalTok{(iris2, }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{add_header_above}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"Length"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{, }\StringTok{"Width"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{, }\StringTok{" "}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{add_header_above}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"Measurements"}\NormalTok{ =}\StringTok{ }\DecValTok{4}\NormalTok{, }\StringTok{"More attributes"}\NormalTok{ =}\StringTok{ }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{rrrrl}
\toprule
\multicolumn{4}{c}{Measurements} & \multicolumn{1}{c}{More attributes} \\
\cmidrule(l{3pt}r{3pt}){1-4} \cmidrule(l{3pt}r{3pt}){5-5}
\multicolumn{2}{c}{Length} & \multicolumn{2}{c}{Width} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){1-2} \cmidrule(l{3pt}r{3pt}){3-4}
Sepal & Petal & Sepal & Petal & Species\\
\midrule
5.1 & 1.4 & 3.5 & 0.2 & setosa\\
4.9 & 1.4 & 3.0 & 0.2 & setosa\\
4.7 & 1.3 & 3.2 & 0.2 & setosa\\
4.6 & 1.5 & 3.1 & 0.2 & setosa\\
5.0 & 1.4 & 3.6 & 0.2 & setosa\\
\bottomrule
\end{tabular}

For the named vector in \texttt{add\_header\_above()}, the names are the text to be shown in the table header, and the integer values of the vector indicate how many columns a name should span, e.g., \texttt{"Length"\ =\ 2} means \texttt{Length} should span two columns.

Below is an example of \texttt{pack\_rows()}. The meaning of its \texttt{index} argument is similar to the argument of \texttt{add\_header\_above()} as we just explained before.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris3 <-}\StringTok{ }\NormalTok{iris[}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DecValTok{51}\OperatorTok{:}\DecValTok{54}\NormalTok{, }\DecValTok{101}\OperatorTok{:}\DecValTok{103}\NormalTok{), ]}
\KeywordTok{kable}\NormalTok{(iris3[, }\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{], }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{pack_rows}\NormalTok{(}
  \DataTypeTok{index =} \KeywordTok{c}\NormalTok{(}\StringTok{"setosa"}\NormalTok{ =}\StringTok{ }\DecValTok{2}\NormalTok{, }\StringTok{"versicolor"}\NormalTok{ =}\StringTok{ }\DecValTok{4}\NormalTok{, }\StringTok{"virginica"}\NormalTok{ =}\StringTok{ }\DecValTok{3}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{lrrrr}
\toprule
  & Sepal.Length & Sepal.Width & Petal.Length & Petal.Width\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{\textbf{setosa}}\\
\hspace{1em}1 & 5.1 & 3.5 & 1.4 & 0.2\\
\hspace{1em}2 & 4.9 & 3.0 & 1.4 & 0.2\\
\addlinespace[0.3em]
\multicolumn{5}{l}{\textbf{versicolor}}\\
\hspace{1em}51 & 7.0 & 3.2 & 4.7 & 1.4\\
\hspace{1em}52 & 6.4 & 3.2 & 4.5 & 1.5\\
\hspace{1em}53 & 6.9 & 3.1 & 4.9 & 1.5\\
\hspace{1em}54 & 5.5 & 2.3 & 4.0 & 1.3\\
\addlinespace[0.3em]
\multicolumn{5}{l}{\textbf{virginica}}\\
\hspace{1em}101 & 6.3 & 3.3 & 6.0 & 2.5\\
\hspace{1em}102 & 5.8 & 2.7 & 5.1 & 1.9\\
\hspace{1em}103 & 7.1 & 3.0 & 5.9 & 2.1\\
\bottomrule
\end{tabular}

\hypertarget{scaling-down-wide-tables-in-latex}{%
\subsection{Scaling down wide tables in LaTeX}\label{scaling-down-wide-tables-in-latex}}

There are a few features that are specific to the HTML or LaTeX output format. For example, landscape pages only make sense in LaTeX, so the \texttt{landscape()} function in \textbf{kableExtra} only works for LaTeX output. Below we show an example to scale down a table to fit the page (otherwise it would be too wide):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab <-}\StringTok{ }\KeywordTok{kable}\NormalTok{(}\KeywordTok{tail}\NormalTok{(mtcars, }\DecValTok{5}\NormalTok{), }\DataTypeTok{booktabs =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{tab  }\CommentTok{# original table (too wide)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{lrrrrrrrrrrr}
\toprule
  & mpg & cyl & disp & hp & drat & wt & qsec & vs & am & gear & carb\\
\midrule
Lotus Europa & 30.4 & 4 & 95.1 & 113 & 3.77 & 1.513 & 16.9 & 1 & 1 & 5 & 2\\
Ford Pantera L & 15.8 & 8 & 351.0 & 264 & 4.22 & 3.170 & 14.5 & 0 & 1 & 5 & 4\\
Ferrari Dino & 19.7 & 6 & 145.0 & 175 & 3.62 & 2.770 & 15.5 & 0 & 1 & 5 & 6\\
Maserati Bora & 15.0 & 8 & 301.0 & 335 & 3.54 & 3.570 & 14.6 & 0 & 1 & 5 & 8\\
Volvo 142E & 21.4 & 4 & 121.0 & 109 & 4.11 & 2.780 & 18.6 & 1 & 1 & 4 & 2\\
\bottomrule
\end{tabular}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{(}\DataTypeTok{latex_options =} \StringTok{"scale_down"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{lrrrrrrrrrrr}
\toprule
  & mpg & cyl & disp & hp & drat & wt & qsec & vs & am & gear & carb\\
\midrule
Lotus Europa & 30.4 & 4 & 95.1 & 113 & 3.77 & 1.513 & 16.9 & 1 & 1 & 5 & 2\\
Ford Pantera L & 15.8 & 8 & 351.0 & 264 & 4.22 & 3.170 & 14.5 & 0 & 1 & 5 & 4\\
Ferrari Dino & 19.7 & 6 & 145.0 & 175 & 3.62 & 2.770 & 15.5 & 0 & 1 & 5 & 6\\
Maserati Bora & 15.0 & 8 & 301.0 & 335 & 3.54 & 3.570 & 14.6 & 0 & 1 & 5 & 8\\
Volvo 142E & 21.4 & 4 & 121.0 & 109 & 4.11 & 2.780 & 18.6 & 1 & 1 & 4 & 2\\
\bottomrule
\end{tabular}}
\end{table}

You will not see any differences in the above two tables if you are viewing the HTML version.

\hypertarget{table-other}{%
\section{Other packages for creating tables}\label{table-other}}

There are many other R packages that can be used to generated tables. The main reason that I introduced \texttt{kable()} (Section \ref{kable}) and \textbf{kableExtra} (Section \ref{kableextra}) is not that they are better than other packages, but because I'm familiar with only them.\footnote{Frankly speaking, I rarely use tables by myself, so I'm not highly motivated to learn how to create sophisticated tables.} Next I will list the packages that I'm aware of but not very familiar with. You can check them out by yourself, and decide which one fits your purpose best.

\begin{itemize}
\item
  \textbf{flextable} and \textbf{huxtable}: If you are looking for a table package that supports the widest range of output formats, \textbf{flextable} and \textbf{huxtable} are probably the two best choices. They all support HTML, LaTeX, and Office formats, and contain most common table features (e.g., conditional formatting). More information about \textbf{flextable} can be found at \url{https://davidgohel.github.io/flextable/}, and the documentation of \textbf{huxtable} is at \url{https://hughjonesd.github.io/huxtable/}.
\item
  \textbf{gt}: Allows you to compose a table by putting together different parts of the table, such as the table header (title and subtitle), the column labels, the table body, row group labels, and the table footer. Some parts are optional. You can also format numbers and add background shading to cells. Currently \textbf{gt} mainly supports HTML output.\footnote{If you need the support for other output formats such as LaTeX and Word, the \textbf{gtsummary} package has made some extensions based on \textbf{gt} that look very promising: \url{https://github.com/ddsjoberg/gtsummary}.} You can find more information about it at \url{https://gt.rstudio.com}.
\item
  \textbf{formattable}: Provides some utility functions to format numbers (e.g., \texttt{percent()} and \texttt{accounting()}), and also functions to style table columns (e.g., format the text, annotate numbers with background shading or color bars, or add icons in cells). Like \textbf{gt}, this package also primarily supports the HTML format. You can find more information about it from its GitHub project at \url{https://github.com/renkun-ken/formattable}.
\item
  \textbf{DT}: As its author, I think I'm familiar with this package, but I did not introduce it in a separate section because it only supports the HTML format. \textbf{DT} is built on top of the JavaScript library \textbf{DataTables}, which can turn a static table into an interactive table on an HTML page. You may sort, search, and paginate the table. \textbf{DT} also supports formatting the cells, works with Shiny to build interactive applications, and has included a large number of \textbf{DataTables} extensions (e.g., you may export the table to Excel, or interactively reorder columns). See the package repository for more information: \url{https://github.com/rstudio/DT}.
\item
  \textbf{reactable}: Similar to \textbf{DT} (also creates interactive tables based on a JavaScript library), but frankly speaking, it looks better than \textbf{DT} in several aspects in my eyes (such as row grouping and aggregation, and embedding HTML widgets). Had \textbf{reactable} existed in 2015, I would not have developed \textbf{DT}. That said, \textbf{reactable} does not contain all the features of \textbf{DT}, so you may read its documentation and see which one fits your purpose better: \url{https://glin.github.io/reactable/}.
\item
  \textbf{rhandsontable}: Also similar to \textbf{DT}, and has an Excel feel (e.g., you can edit data directly in the table). Visit \url{https://jrowen.github.io/rhandsontable/} to know more about it.
\item
  \textbf{pixiedust}: Features creating tables for models (such as linear models) converted through the \textbf{broom} package. It supports Markdown, HTML, and LaTeX output formats. Its repository is at \url{https://github.com/nutterb/pixiedust}.
\item
  \textbf{stargazer}: Features formatting regressions models and summary statistics tables. The package is available on CRAN at \url{https://cran.r-project.org/package=stargazer}.
\item
  \textbf{xtable}: Perhaps the oldest package for creating tables---the first release was made in 2000. It supports both LaTeX and HTML formats. The package is available on CRAN at \url{https://cran.r-project.org/package=xtable}.
\end{itemize}

I'm not going to introduce the rest of packages, but will just list them here: \textbf{tables} (\url{https://cran.r-project.org/package=tables}), \textbf{pander} (\url{http://rapporter.github.io/pander/}), \textbf{tangram} (\url{https://github.com/spgarbet/tangram}), \textbf{ztable} (\url{https://github.com/cardiomoon/ztable}), and \textbf{condformat} (\url{https://github.com/zeehio/condformat}).

\hypertarget{chunk-options}{%
\chapter{Chunk Options}\label{chunk-options}}

As illustrated in Figure \ref{fig:rmdworkflow}, the R package \textbf{knitr} plays a critical role in R Markdown. In this chapter and the next three chapters, we show some recipes related to \textbf{knitr}.

There are more than 50 chunk options that can be used to fine-tune the behavior of \textbf{knitr} when processing R chunks. \href{https://bookdown.org/yihui/rmarkdown/r-code.html}{Section 2.8} of the R Markdown Definitive Guide \citep{rmarkdown2018} provides a subset of these options, while the full list is available at \url{https://yihui.org/knitr/options/}.

In the following sections, we only show examples of applying chunk options to individual code chunks. However, please be aware of the fact that any chunk options can also be applied globally to a whole document, so you do not have to repeat the options in every single code chunk. To set chunk options globally, call \texttt{knitr::opts\_chunk\$set()} in a code chunk (usually the first one in the document), e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{knitr::opts_chunk$set(}
\BaseNTok{  comment = "#>", echo = FALSE, fig.width = 6}
\BaseNTok{)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{chunk-variable}{%
\section{Use variables in chunk options}\label{chunk-variable}}

Usually chunk options take constant values (e.g., \texttt{fig.width\ =\ 6}), but they can actually take values from arbitrary R expressions, no matter how simple or complicated the expressions are. A special case is a variable passed to a chunk option (note that a variable is also an R expression). For example, you can define a figure width in a variable in the beginning of a document, and use it later in other code chunks, so you will be able to easily change the width in the future:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{my_width <- 7}
\BaseNTok{```}

\BaseNTok{```\{r, fig.width=my_width\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Below is an example of using an \texttt{if-else} statement in a chunk option:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{fig_small <- FALSE  # change to TRUE for larger figures}
\BaseNTok{width_small <- 4}
\BaseNTok{width_large <- 8}
\BaseNTok{```}

\BaseNTok{```\{r, fig.width=if (fig_small) width_small else width_large\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

And we have one more example below in which we evaluate (i.e., execute) a code chunk only if a required package is available:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, eval=require('leaflet')\}}
\BaseNTok{library(leaflet)}
\BaseNTok{leaflet() %>% addTiles()}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

In case you do not know it, \texttt{require(\textquotesingle{}package\textquotesingle{})} returns \texttt{TRUE} if the package is available (and \texttt{FALSE} if not).

\hypertarget{opts-error}{%
\section{Do not stop on error}\label{opts-error}}

Sometimes you may want to show errors on purpose (e.g., in an R tutorial). By default, errors in the code chunks of an Rmd document will halt R. If you want to show the errors without stopping R, you may use the chunk option \texttt{error\ =\ TRUE}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, error=TRUE\}}
\BaseNTok{1 + "a"}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

And you will see the error message in the output document after you compile the Rmd document:

\begin{verbatim}
Error in 1 + "a": non-numeric argument to binary operator
\end{verbatim}

In R Markdown, \texttt{error\ =\ FALSE} is the default, which means R should stop on error when running the code chunks.

\hypertarget{dev-vector}{%
\section{Multiple graphical output formats for the same plot}\label{dev-vector}}

In most cases, you may want one image format for one plot, such as \texttt{png} or \texttt{pdf}. The image format is controlled by the chunk option \texttt{dev} (i.e., the graphical device to render the plots). This option can take a vector of device names, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, dev=c('png', 'pdf', 'svg', 'tiff')\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Only the first format is used in the output document, but the images corresponding to the rest of formats are also generated. This can be useful when you are required to submit figures of different formats additionally (e.g., you have shown a \texttt{png} figure in the report but the \texttt{tiff} format of the same figure is also required).

Note that by default, plot files are typically deleted after the output document is rendered. To preserve these files, please see Section \ref{keep-files}.

\hypertarget{cache}{%
\section{Cache time-consuming code chunks}\label{cache}}

When a code chunk is time-consuming to run, you may consider caching it via the chunk option \texttt{cache\ =\ TRUE}. When the cache is turned on, \textbf{knitr} will skip the execution of this code chunk if it has been executed before and nothing in the code chunk has changed since then. When you modify the code chunk (e.g., revise the code or the chunk options), the previous cache will be automatically invalidated, and \textbf{knitr} will cache the chunk again.

For a cached code chunk, its output and objects will be automatically loaded from the previous run, as if the chunk were executed again. Caching is often helpful when loading results is much faster than computing the results. However, there is no free lunch. Depending on your use case, you may need to learn more about how caching (especially \href{https://yihui.org/en/2018/06/cache-invalidation/}{cache invalidation}) works, so you can take the full advantage of it without confusing yourself why sometimes \textbf{knitr} invalidates your cache too often and sometimes there is not enough invalidation.

The most appropriate use case of caching is to save and reload R objects that take too long to compute in a code chunk, and the code does not have any side-effects, such as changing global R options via \texttt{options()} (such changes will not be cached). If a code chunk has side-effects, we recommend that you do not cache it.

As we briefly mentioned earlier, the cache depends on chunk options. If you change any chunk options (except the option \texttt{include}), the cache will be invalidated. This feature can be used to solve a common problem. That is, when you read an external data file, you may want to invalidate the cache when the data file is updated. Simply using \texttt{cache\ =\ TRUE} is not enough:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r import-data, cache=TRUE\}}
\BaseNTok{d <- read.csv('my-precious.csv')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You have to let \textbf{knitr} know if the data file has been changed. One way to do it is to add another chunk option \texttt{cache.extra\ =\ file.mtime(\textquotesingle{}my-precious.csv\textquotesingle{})} or more rigorously, \texttt{cache.extra\ =\ tools::md5sum(\textquotesingle{}my-precious.csv\textquotesingle{})}. The former means if the modification time of the file has been changed, we need to invalidate the cache. The latter means if the content of the file has been modified, we update the cache. Note that \texttt{cache.extra} is not a built-in \textbf{knitr} chunk option. You can use any other name for this option, as long as it does not conflict with built-in option names.

Similarly, you can associate the cache with other information such as the R version (\texttt{cache.extra\ =\ getRversion()}), the date (\texttt{cache.extra\ =\ Sys.Date()}), or your operating system (\texttt{cache.extra\ =\ Sys.info(){[}{[}\textquotesingle{}sysname\textquotesingle{}{]}{]}}), so the cache can be properly invalidated when these conditions change.

We do not recommend that you set the chunk option \texttt{cache\ =\ TRUE} globally in a document. Caching can be fairly tricky. Instead, we recommend that you enable caching only on individual code chunks that are surely time-consuming and do not have side-effects.

If you are not happy with \textbf{knitr}'s design for caching, you can certainly cache objects by yourself. Below is a quick example:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{file.exists}\NormalTok{(}\StringTok{"results.rds"}\NormalTok{)) \{}
\NormalTok{  res <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"results.rds"}\NormalTok{)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  res <-}\StringTok{ }\KeywordTok{compute_it}\NormalTok{()  }\CommentTok{# a time-consuming function}
  \KeywordTok{saveRDS}\NormalTok{(res, }\StringTok{"results.rds"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In this case, the only (and also simple) way to invalidate the cache is to delete the file \texttt{results.rds}. If you like this simple caching mechanism, you may use the function \texttt{xfun::cache\_rds()} introduced in Section \ref{cache-rds}.

\hypertarget{cache-path}{%
\section{Cache a code chunk for multiple output formats}\label{cache-path}}

When caching is turned on via the chunk option \texttt{cache\ =\ TRUE}, \textbf{knitr} will write R objects generated in a code chunk to a cache database, so they can be reloaded the next time. The path to the cache database is determined by the chunk option \texttt{cache.path}. By default, R Markdown uses different cache paths for different output formats, which means a time-consuming code chunk will be fully executed for each output format. This may be inconvenient, but there is a reason for this default behavior: the output of a code chunk can be dependent on the specific output format. For example, when you generate a plot, the output for the plot could be Markdown code like \texttt{!{[}text{]}(path/to/image.png)} when the output format is \texttt{word\_document}, or HTML code like \texttt{\textless{}img\ src="path/to/image.png"\ /\textgreater{}} when the output format is \texttt{html\_document}.

When a code chunk does not have any side-effects (such as plots), it is safe to use the same cache database for all output formats, which can save you time. For example, when you read a large data object or run a time-consuming model, the result does not depend on the output format, so you can use the same cache database. You can specify the path to the database via the chunk option \texttt{cache.path} on a code chunk, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r important-computing, cache=TRUE, cache.path="cache/"\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

By default, \texttt{cache.path\ =\ "INPUT\_cache/FORMAT/"} in R Markdown, where \texttt{INPUT} is the input filename, and \texttt{FORMAT} is the output format name (e.g., \texttt{html}, \texttt{latex}, or \texttt{docx}).

\hypertarget{cache-lazy}{%
\section{Cache large objects}\label{cache-lazy}}

When the chunk option \texttt{cache\ =\ TRUE}, cached objects will be lazy-loaded into the R session, which means an object will not be read from the cache database until it is actually used in the code. This can save you some memory when not all objects are used later in the document. For example, you may have read a large data but only used a subset in the subsequent analysis, and the original data object will not be loaded from the cache database:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, read-data, cache=TRUE\}}
\BaseNTok{full <- read.csv("HUGE.csv")}
\BaseNTok{rows <- subset(full, price > 100)}
\BaseNTok{# next we only use `rows`}
\BaseNTok{```}

\BaseNTok{```\{r\}}
\BaseNTok{plot(rows)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

However, when an object is too large, you may run into an error like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Error }\ControlFlowTok{in} \KeywordTok{lazyLoadDBinsertVariable}\NormalTok{(vars[i], ... }
\NormalTok{  long vectors not supported yet}\OperatorTok{:}\StringTok{ }\NormalTok{...}
\NormalTok{Execution halted}
\end{Highlighting}
\end{Shaded}

If this problem occurs, you can try to turn off the lazy-loading via the chunk option \texttt{cache.lazy\ =\ FALSE}. All objects in this chunk will be immediately loaded into memory.

\hypertarget{hide-one}{%
\section{Hide code, text output, messages, or plots}\label{hide-one}}

By default, \textbf{knitr} displays all possible output from a code chunk, including the source code, text output, messages, warnings, and plots. You can hide them individually using the corresponding chunk options.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Hide source code:}

\BaseNTok{```\{r, echo=FALSE\}}
\BaseNTok{1 + 1}
\BaseNTok{```}

\NormalTok{Hide text output (you can also use }\BaseNTok{`results = FALSE`}\NormalTok{):}

\BaseNTok{```\{r, results='hide'\}}
\BaseNTok{print("You will not see the text output.")}
\BaseNTok{```}

\NormalTok{Hide messages:}

\BaseNTok{```\{r, message=FALSE\}}
\BaseNTok{message("You will not see the message.")}
\BaseNTok{```}

\NormalTok{Hide warning messages:}

\BaseNTok{```\{r, warning=FALSE\}}
\BaseNTok{# this will generate a warning but it will be suppressed}
\BaseNTok{1:2 + 1:3}
\BaseNTok{```}

\NormalTok{Hide plots:}

\BaseNTok{```\{r, fig.show='hide'\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\NormalTok{Note that the plot will be generated in the above chunk. It is}
\NormalTok{just not displayed in the output.}
\end{Highlighting}
\end{Shaded}

One frequently asked question about \textbf{knitr} is how to hide package loading messages. For example, when you \texttt{library(tidyverse)} or \texttt{library(ggplot2)}, you may see some loading messages. Such messages can also be suppressed by the chunk option \texttt{message\ =\ FALSE}.

You can also selectively show or hide these elements by indexing them. In the following example, we only show the fourth and fifth expressions of the R source code (note that a comment counts as one expression), the first two messages, and the second and third warnings:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, echo=c(4, 5), message=c(1, 2), warning=2:3\}}
\BaseNTok{# one way to generate random N(0, 1) numbers}
\BaseNTok{x <- qnorm(runif(10))}
\BaseNTok{# but we can just use rnorm() in practice}
\BaseNTok{x <- rnorm(10)}
\BaseNTok{x}

\BaseNTok{for (i in 1:5) message('Here is the message ', i)}

\BaseNTok{for (i in 1:5) warning('Here is the warning ', i)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can use negative indices, too. For example, \texttt{echo\ =\ -2} means to exclude the second expression of the source code in the output.

Similarly, you can choose which plots to show or hide by using indices for the \texttt{fig.keep} option. For example, \texttt{fig.keep\ =\ 1:2} means to keep the first two plots. There are a few shortcuts for this option: \texttt{fig.keep\ =\ "first"} will only keep the first plot, \texttt{fig.keep\ =\ "last"} only keeps the last plot, and \texttt{fig.keep\ =\ "none"} discards all plots. Note that the two options \texttt{fig.keep\ =\ "none"} and \texttt{fig.show\ =\ "hide"} are different: the latter will generate plots but only hide them, and the former will not generate plot files at all.

For source code blocks in the \texttt{html\_document} output, if you do not want to completely omit them (\texttt{echo\ =\ FALSE}), you may see Section \ref{fold-show} for how to fold them on the page, and allow users to unfold them by clicking the unfolding buttons.

\hypertarget{hide-all}{%
\section{Hide everything from a chunk}\label{hide-all}}

Sometimes we may want to execute a code chunk without showing any output at all. Instead of using separate options mentioned in Section \ref{hide-one}, we can suppress the entire output of the code chunk using a single option \texttt{include\ =\ FALSE}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{# any R code here}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

With \texttt{include=FALSE}, the code chunk will be evaluated (unless \texttt{eval=FALSE}), but the output will be completely suppressed---you will not see any code, text output, messages, or plots.

\hypertarget{opts-collapse}{%
\section{Collapse text output blocks into source blocks}\label{opts-collapse}}

If you feel there is too much spacing between text output blocks and source code blocks in the output, you may consider collapsing the text output into the source blocks with the chunk option \texttt{collapse\ =\ TRUE}. This what the output looks like when \texttt{collapse\ =\ TRUE}:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\CommentTok{## [1] 2}
\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\CommentTok{##  [1]  1  2  3  4  5  6  7  8  9 10}
\end{Highlighting}
\end{Shaded}

Below is the same chunk but it does not have the option \texttt{collapse\ =\ TRUE} (the default is \texttt{FALSE}):

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\hypertarget{opts-tidy}{%
\section{Reformat R source code}\label{opts-tidy}}

When you set the chunk option \texttt{tidy\ =\ TRUE}, the R source code will be reformatted by the \texttt{tidy\_source()} function in the \textbf{formatR} package \citep{R-formatR}. The \texttt{tidy\_source()} can reformat the code in several aspects, such as adding spaces around most operators, indenting the code properly, and replacing the assignment operator \texttt{=} with \texttt{\textless{}-}. The chunk option \texttt{tidy.opts} can be a list of arguments to be passed to \texttt{formatR::tidy\_source()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, tidy=TRUE, tidy.opts=list(arrow=TRUE, indent=2)\}}
\BaseNTok{# messy R code...}
\BaseNTok{1+            1}
\BaseNTok{x=1:10#some users prefer '<-' as the assignment operator}
\BaseNTok{if(TRUE)\{}
\BaseNTok{print('Hello world!') # indent by 2 spaces}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# messy R code...}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}  \CommentTok{#some users prefer '<-' as the assignment operator}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{}
  \KeywordTok{print}\NormalTok{(}\StringTok{"Hello world!"}\NormalTok{)  }\CommentTok{# indent by 2 spaces}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In Section \ref{text-width}, we mentioned how to control the width of text output. If you want to control the width of the source code, you may try the \texttt{width.cutoff} argument when \texttt{tidy\ =\ TRUE}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, tidy=TRUE, tidy.opts=list(width.cutoff=50)\}}
\BaseNTok{# a long expression}
\BaseNTok{1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+}
\BaseNTok{1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# a long expression}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }
\StringTok{  }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }
\StringTok{  }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }
\StringTok{  }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

Please read the help page \texttt{?formatR::tidy\_source} to know the possible arguments, and also see \url{https://yihui.org/formatR/} for examples and limitations of this function.

Alternatively, you may use the \textbf{styler} package (\url{https://styler.r-lib.org}) to reformat your R code if you set the chunk option \texttt{tidy\ =\ \textquotesingle{}styler\textquotesingle{}}. The R code will be formatted with the function \texttt{styler::style\_text()}. The \textbf{styler} package has richer features than \textbf{formatR}. For example, it can align function arguments and works with the pipe operator \texttt{\%\textgreater{}\%}. The chunk option \texttt{tidy.opts} can also be used to pass additional arguments to \texttt{styler::style\_text()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, tidy='styler', tidy.opts=list(strict=FALSE)\}}
\BaseNTok{# align the assignment operators}
\BaseNTok{a   <- 1#one variable}
\BaseNTok{abc <- 2#another variable}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

By default, \texttt{tidy\ =\ FALSE} and your R code will not be reformatted.

\hypertarget{results-asis}{%
\section{Output text as raw Markdown content (*)}\label{results-asis}}

By default, text output from code chunks will be written out verbatim with two leading hashes (see Section \ref{opts-comment}). The text is verbatim because \textbf{knitr} puts it in fenced code blocks. For example, the raw output of the code \texttt{1:5} from \textbf{knitr} is:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```}
\BaseNTok{## [1] 1 2 3 4 5}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Sometimes you may not want verbatim text output, but treat text output as Markdown content instead. For example, you may want to write out a section header with \texttt{cat(\textquotesingle{}\#\ This\ is\ a\ header\textquotesingle{})}, but the raw output is:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```}
\BaseNTok{## # This is a header}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You do not want the text to be in a fenced code block (or the leading hashes). That is, you want the raw output to be exactly the character string passed to \texttt{cat()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# This is a header}
\end{Highlighting}
\end{Shaded}

The solution to this problem is the chunk option \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}}. This option tells \textbf{knitr} not to wrap your text output in verbatim code blocks, but treat it ``as is''. This can be particularly useful when you want to generate content dynamically from R code. For example, you may generate the list of column names of the \texttt{iris} data from the code chunk below with the option \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"- `"}\NormalTok{, }\KeywordTok{names}\NormalTok{(iris), }\StringTok{"`"}\NormalTok{), }\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{Sepal.Length}
\item
  \texttt{Sepal.Width}
\item
  \texttt{Petal.Length}
\item
  \texttt{Petal.Width}
\item
  \texttt{Species}
\end{itemize}

The hyphen \texttt{-} is the syntax for unordered lists in Markdown. The backticks are optional. You can see the verbatim output of the above chunk without the \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}} option:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"- `"}\NormalTok{, }\KeywordTok{names}\NormalTok{(iris), }\StringTok{"`"}\NormalTok{), }\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
- `Sepal.Length`
- `Sepal.Width`
- `Petal.Length`
- `Petal.Width`
- `Species`
\end{verbatim}

Below is a full example that shows how you can generate section headers, paragraphs, and plots in a \texttt{for}-loop for all columns of the \texttt{mtcars} data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Generate content programmatically}
\NormalTok{---}

\NormalTok{With the chunk option }\BaseNTok{`results = 'asis'`}\NormalTok{, you can}
\NormalTok{write out text as raw Markdown content, which can}
\NormalTok{also be mixed with plots.}

\BaseNTok{```\{r, mtcars-plots, results='asis'\}}
\BaseNTok{for (i in names(mtcars)) \{}
\BaseNTok{  cat('\textbackslash{}n\textbackslash{}n# Summary of the variable `', i, '`\textbackslash{}n\textbackslash{}n')}
\BaseNTok{  x <- mtcars[, i]}
\BaseNTok{  if (length(unique(x)) <= 6) \{}
\BaseNTok{    cat('`', i, '` is a categorical variable.\textbackslash{}n\textbackslash{}n')}
\BaseNTok{    plot(table(x), xlab = i, ylab = 'Frequency', lwd = 10)}
\BaseNTok{  \} else \{}
\BaseNTok{    cat('Histogram for the continuous variable `', i, '`.\textbackslash{}n\textbackslash{}n')}
\BaseNTok{    hist(x, xlab = i, main = '')}
\BaseNTok{  \}}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Please note that we added line breaks (\texttt{\textbackslash{}n}) excessively in the code. That is because we want different elements to be separated clearly in the Markdown content. It is harmless to use an excessive number of line breaks between different elements, whereas it can be problematic if there are not enough line breaks. For example, there is much ambiguity in the Markdown text below:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Is this a header?}
\NormalTok{Is this a paragraph or a part of the header?}
\AlertTok{![How about this image?](foo.png)}
\FunctionTok{# How about this line?}
\end{Highlighting}
\end{Shaded}

With more empty lines (which could be generated by \texttt{cat(\textquotesingle{}\textbackslash{}n\textquotesingle{})}), the ambiguity will be gone:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Yes, a header!}

\NormalTok{And definitely a paragraph.}

\AlertTok{![An image here.](foo.png)}

\FunctionTok{# Absolutely another header}
\end{Highlighting}
\end{Shaded}

The \texttt{cat()} function is not the only function that can generate text output. Another commonly used function is \texttt{print()}. Please note that \texttt{print()} is often \emph{implicitly} called to print objects, which is why you see output after typing out an object or value in the R console. For example, when you type \texttt{1:5} in the R console and hit the \texttt{Enter} key, you see the output because R actually called \texttt{print(1:5)} implicitly. This can be highly confusing when you fail to generate output inside an expression (such as a \texttt{for}-loop) with objects or values that would otherwise be correctly printed if they were typed in the R console. This topic is quite technical, and I have written \href{https://yihui.org/en/2017/06/top-level-r-expressions/}{a blog post} to explain it. If you are not interested in the technical details, just remember this rule: if you do not see output from a \texttt{for}-loop, you should probably print objects explicitly with the \texttt{print()} function.

\hypertarget{opts-comment}{%
\section{Remove leading hashes in text output}\label{opts-comment}}

By default, R code output will have two hashes \texttt{\#\#} inserted in front of the text output. We can alter this behavior through the \texttt{comment} chunk option, which defaults to a character string \texttt{"\#\#"}. We can use an empty string if we want to remove the hashes. For example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, comment=""\}}
\BaseNTok{1:100}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Of course, you can use any other character values, e.g., \texttt{comment\ =\ "\#\textgreater{}"}. Why does the \texttt{comment} option default to hashes? That is because \texttt{\#} indicates comments in R. When the text output is commented out, it will be easier for you to copy all the code from a code chunk in a report and run it by yourself, without worrying about the fact that text output is not R code. For example, in the code chunk below, you can copy all four lines of text and run them safely as R code:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\CommentTok{## [1] 2}
\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{2}
\CommentTok{## [1] 4}
\end{Highlighting}
\end{Shaded}

If you remove the hashes via \texttt{comment\ =\ ""}, it will not be easy for you to run all the code, because if you copy the four lines, you will have to manually remove the second and fourth line:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\DecValTok{2}
\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{2}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\DecValTok{4}
\end{Highlighting}
\end{Shaded}

One argument in favor of \texttt{comment\ =\ ""} is that it makes the text output look familiar to R console users. In the R console, you do not see hashes in the beginning of lines of text output. If you want to truly mimic the behavior of the R console, you can actually use \texttt{comment\ =\ ""} in conjunction with \texttt{prompt\ =\ TRUE}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, comment="", prompt=TRUE\}}
\BaseNTok{1 + 1}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  2 + 2}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The output should look fairly familiar to you if you have ever typed and run code in the R console, since the source code contains the prompt character \texttt{\textgreater{}} and the continuation character \texttt{+}:

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{>}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\DecValTok{2}
\OperatorTok{>}\StringTok{ }\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{}
\OperatorTok{+}\StringTok{   }\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{2}
\OperatorTok{+}\StringTok{ }\NormalTok{\}}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\DecValTok{4}
\end{Highlighting}
\end{Shaded}

\hypertarget{attr-output}{%
\section{Add attributes to text output blocks (*)}\label{attr-output}}

TODO

The \texttt{attr.*} options, and the special case, \texttt{class.*} options.

\hypertarget{fig-process}{%
\section{Post-process plots (*)}\label{fig-process}}

After a plot is generated from a code chunk, you can post-process the plot file via the chunk option \texttt{fig.process}, which should be a function that takes the file path as the input argument and returns a path to the processed plot file. This function can have an optional second argument \texttt{options}, which is a list of the current chunk options.

Below we show an example of adding an R logo to a plot using the extremely powerful \textbf{magick} package \citep{R-magick}. If you are not familiar with this package, we recommend that you read its online documentation or package vignette, which contains lots of examples. First, we define a function \texttt{add\_logo()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{add_logo <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(path, options) \{}
  \CommentTok{# the plot created from the code chunk}
\NormalTok{  img <-}\StringTok{ }\NormalTok{magick}\OperatorTok{::}\KeywordTok{image_read}\NormalTok{(path)}
  \CommentTok{# the R logo}
\NormalTok{  logo <-}\StringTok{ }\KeywordTok{file.path}\NormalTok{(}\KeywordTok{R.home}\NormalTok{(}\StringTok{"doc"}\NormalTok{), }\StringTok{"html"}\NormalTok{, }\StringTok{"logo.jpg"}\NormalTok{)}
\NormalTok{  logo <-}\StringTok{ }\NormalTok{magick}\OperatorTok{::}\KeywordTok{image_read}\NormalTok{(logo)}
  \CommentTok{# the default gravity is northwest, and users can change it via the chunk option magick.gravity}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{is.null}\NormalTok{(g <-}\StringTok{ }\NormalTok{options}\OperatorTok{$}\NormalTok{magick.gravity)) }
\NormalTok{    g <-}\StringTok{ "northwest"}
  \CommentTok{# add the logo to the plot}
\NormalTok{  img <-}\StringTok{ }\NormalTok{magick}\OperatorTok{::}\KeywordTok{image_composite}\NormalTok{(img, logo, }\DataTypeTok{gravity =}\NormalTok{ g)}
  \CommentTok{# write out the new image}
\NormalTok{  magick}\OperatorTok{::}\KeywordTok{image_write}\NormalTok{(img, path)}
\NormalTok{  path}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Basically the function takes the path of an R plot, adds an R logo to it, and saves the new plot to the original path. By default, the logo is added to the upper-left corner (northwest) of the plot, but users can customize the location via the custom chunk option \texttt{magick.gravity} (this option name can be arbitrary).

Now we apply the above processing function to the code chunk below with chunk options \texttt{fig.process\ =\ add\_logo} and \texttt{magick.gravity\ =\ "northeast"}, so the logo is added to the upper-right corner. See Figure \ref{fig:magick-logo} for the actual output.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.1}\NormalTok{))}
\KeywordTok{hist}\NormalTok{(faithful}\OperatorTok{$}\NormalTok{eruptions, }\DataTypeTok{breaks =} \DecValTok{30}\NormalTok{, }\DataTypeTok{main =} \StringTok{""}\NormalTok{, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{, }\DataTypeTok{border =} \StringTok{"white"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{rmarkdown-cookbook_files/figure-latex/magick-logo-1.png}
\caption{\label{fig:magick-logo}Add the R logo to a plot via the chunk option fig.process.}
\end{figure}

After you get more familiar with the \textbf{magick} package, you may come up with more creative and useful ideas to post-process your R plots.

Last we show one more application of the \texttt{fig.process} option. The \texttt{pdf2png()} function below convert a PDF image to PNG. In Section \ref{graphical-device}, we have an example of using the \texttt{tikz} graphical device to generate plots. The problem is that this device generates PDF plots, which will not work for non-LaTeX output documents. With the chunk options \texttt{dev\ =\ "tikz"} and \texttt{fig.process\ =\ pdf2png}, we can show the PNG version of the plot in Figure \ref{fig:dev-tikz}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdf2png <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(path) \{}
  \CommentTok{# only do the conversion for non-LaTeX output}
  \ControlFlowTok{if}\NormalTok{ (knitr}\OperatorTok{::}\KeywordTok{is_latex_output}\NormalTok{()) }
    \KeywordTok{return}\NormalTok{(path)}
\NormalTok{  path2 <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{with_ext}\NormalTok{(path, }\StringTok{"png"}\NormalTok{)}
\NormalTok{  img <-}\StringTok{ }\NormalTok{magick}\OperatorTok{::}\KeywordTok{image_read_pdf}\NormalTok{(path)}
\NormalTok{  magick}\OperatorTok{::}\KeywordTok{image_write}\NormalTok{(img, path2, }\DataTypeTok{format =} \StringTok{"png"}\NormalTok{)}
\NormalTok{  path2}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{graphical-device}{%
\section{High-quality graphics (*)}\label{graphical-device}}

The \textbf{rmarkdown} package has set reasonable default graphical devices for different output formats. For example, HTML output formats use the \texttt{png()} device, so \textbf{knitr} will generate PNG plot files, and PDF output formats use the \texttt{pdf()} device, etc. If you are not satisfied by the quality of the default graphical devices, you can change them via the chunk option \texttt{dev}. All possible devices supported by \textbf{knitr} are: \texttt{"bmp"}, \texttt{"postscript"}, \texttt{"pdf"}, \texttt{"png"}, \texttt{"svg"}, \texttt{"jpeg"}, \texttt{"pictex"}, \texttt{"tiff"}, \texttt{"win.metafile"}, \texttt{"cairo\_pdf"}, \texttt{"cairo\_ps"}, \texttt{"quartz\_pdf"}, \texttt{"quartz\_png"}, \texttt{"quartz\_jpeg"}, \texttt{"quartz\_tiff"}, \texttt{"quartz\_gif"}, \texttt{"quartz\_psd"}, \texttt{"quartz\_bmp"}, \texttt{"CairoJPEG"}, \texttt{"CairoPNG"}, \texttt{"CairoPS"}, \texttt{"CairoPDF"}, \texttt{"CairoSVG"}, \texttt{"CairoTIFF"}, \texttt{"Cairo\_pdf"}, \texttt{"Cairo\_png"}, \texttt{"Cairo\_ps"}, \texttt{"Cairo\_svg"}, \texttt{"svglite"}, \texttt{"ragg\_png"}, and \texttt{"tikz"}.

Usually a graphical device name is also a function name. If you want to know more about a device, you can read the R help page. For example, you can type \texttt{?svg} in the R console to know the details about the \texttt{svg} device, which is included in base R. Note that the \texttt{quartz\_XXX} devices are based on the \texttt{quartz()} function, and they are only available on macOS. The \texttt{CairoXXX} devices are from the add-on R package \textbf{Cairo}, the \texttt{Cairo\_XXX} devices are from the \textbf{cairoDevice} package, the \texttt{svglite} device is from the \textbf{svglite} package, and \texttt{tikz} is a device in the \textbf{tikzDevice} package. If you want to use devices from an add-on package, you have to install the package first.

Usually vector graphics have higher quality than raster graphics, and you can scale vector graphics without loss of quality. For HTML output, you may consider using \texttt{dev\ =\ "svg"} or \texttt{dev\ =\ "svglite"} for SVG plots. Note that SVG is a vector graphics format, and the default \texttt{png} device produces a raster graphics format.

For PDF output, if you are really picky about the typeface in your plots, you may use \texttt{dev\ =\ "tikz"}, because it offers native support for LaTeX, which means all elements in a plot, including text and symbols, are rendered in high quality through LaTeX. Figure \ref{fig:dev-tikz} shows an example of writing LaTeX math expressions in an R plot rendered with the chunk option \texttt{dev\ =\ "tikz"}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{, }\FloatTok{.1}\NormalTok{))}
\KeywordTok{curve}\NormalTok{(dnorm, }\DecValTok{-3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'$x$'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{phi(x)$'}\NormalTok{,}
      \DataTypeTok{main =} \StringTok{'The density function of $N(0, 1)$'}\NormalTok{)}
\KeywordTok{text}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\FloatTok{.2}\NormalTok{, }\DataTypeTok{cex =} \DecValTok{3}\NormalTok{, }\DataTypeTok{col =} \StringTok{'blue'}\NormalTok{,}
  \StringTok{'$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{phi(x)=}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{frac\{1\}\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{sqrt\{2}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{pi\}\}e^\{}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{frac\{-x^2\}\{2\}\}$'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{rmarkdown-cookbook_files/figure-latex/dev-tikz-1} 

}

\caption{A plot rendered via the tikz device.}\label{fig:dev-tikz}
\end{figure}

Note that base R actually supports math expressions, but they are not rendered via LaTeX (see \texttt{?plotmath} for details). There are several advanced options to tune the typesetting details of the \texttt{tikz} device. You may see \texttt{?tikzDevice::tikz} for the possibilities. For example, if your plot contains multibyte characters, you may want to set the option:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{tikzDefaultEngine =} \StringTok{"xetex"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

That is because \texttt{xetex} is usually better than the default engine \texttt{pdftex} in processing multibyte characters in LaTeX documents.

There are two major disadvantages of the \texttt{tikz} device. First, it requires a LaTeX installation, but this may not be too bad (see Section \ref{install-latex}). You also need a few LaTeX packages, which can be easily installed if you are using TinyTeX:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tinytex}\OperatorTok{::}\KeywordTok{tlmgr_install}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"pgf"}\NormalTok{, }\StringTok{"preview"}\NormalTok{, }\StringTok{"xcolor"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Second, it is often significantly slower to render the plots, because this device generates a LaTeX file and has to compile it to PDF. If you feel the code chunk is time-consuming, you may enable caching by the chunk option \texttt{cache\ =\ TRUE} (see Section \ref{cache}).

For Figure \ref{fig:dev-tikz}, we also used the chunk option \texttt{fig.process\ =\ pdf2png}, where the function \texttt{pdf2png} is defined in Section \ref{fig-process} to convert the PDF plot to PNG when the output format is not LaTeX. Without the conversion, you may not be able to view the PDF plot in the online version of this book in the web browser.

\hypertarget{low-plots}{%
\section{Step-by-step plots with low-level plotting functions (*)}\label{low-plots}}

For R graphics, there are two types of plotting functions: high-level plotting functions create new plots, and low-level functions add elements to existing plots. You may see Chapter 12 (Graphical procedures) of the R manual \href{https://cran.r-project.org/doc/manuals/r-release/R-intro.html}{``An Introduction to R''} for more information.

By default, \textbf{knitr} does not show the intermediate plots when a series of low-level plotting functions are used to modify a previous plot. Only the last plot on which all low-level plotting changes have been made is shown.

It can be useful to show the intermediate plots, especially for teaching purposes. You can set the chunk option \texttt{fig.keep\ =\ \textquotesingle{}low\textquotesingle{}} to keep low-level plotting changes. For example, Figure \ref{fig:low-plots-1} and Figure \ref{fig:low-plots-2} are from a single code chunk with the chunk option \texttt{fig.keep\ =\ \textquotesingle{}low\textquotesingle{}}, although they appear to be from two code chunks. We also assigned different figure captions to them with the chunk option \texttt{fig.cap\ =\ c(\textquotesingle{}A\ scatterplot\ ...\textquotesingle{},\ \textquotesingle{}Adding\ a\ regression\ line...\textquotesingle{})}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(cars)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{rmarkdown-cookbook_files/figure-latex/low-plots-1.pdf}
\caption{\label{fig:low-plots-1}A scatterplot of the cars data.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(dist }\OperatorTok{~}\StringTok{ }\NormalTok{speed, }\DataTypeTok{data =}\NormalTok{ cars)}
\KeywordTok{abline}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{rmarkdown-cookbook_files/figure-latex/low-plots-2.pdf}
\caption{\label{fig:low-plots-2}Adding a regression line to an existing scatterplot.}
\end{figure}

If you want to keep modifying a plot in a \emph{different} code chunk, please see Section \ref{global-device}.

\hypertarget{opts-render}{%
\section{Customize the printing of objects in chunks (*)}\label{opts-render}}

By default, objects in code chunks are printed through the \texttt{knitr::knit\_print()} function, which is by and large just \texttt{print()} in base R. The \texttt{knit\_print()} function is an S3 generic function, which means you can extend it by yourself by registering S3 methods on it. Below is an example that shows how to automatically print data frames as tables via \texttt{knitr::kable()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Use a custom }\BaseNTok{`knit_print`}\NormalTok{ method to print data frames}
\NormalTok{---}

\NormalTok{First, we define a }\BaseNTok{`knit_print`}\NormalTok{ method, and register it:}

\BaseNTok{```\{r\}}
\BaseNTok{knit_print.data.frame = function(x, ...) \{}
\BaseNTok{  res = paste(c("", "", knitr::kable(x)), collapse = "\textbackslash{}n")}
\BaseNTok{  knitr::asis_output(res)}
\BaseNTok{\}}

\BaseNTok{registerS3method(}
\BaseNTok{  "knit_print", "data.frame", knit_print.data.frame,}
\BaseNTok{  envir = asNamespace("knitr")}
\BaseNTok{)}
\BaseNTok{```}

\NormalTok{Now we can test this custom printing method on data frames.}
\NormalTok{Note that you no longer need to call }\BaseNTok{`knitr::kable()`}
\NormalTok{explicitly.}

\BaseNTok{```\{r\}}
\BaseNTok{head(iris)}
\BaseNTok{```}

\BaseNTok{```\{r\}}
\BaseNTok{head(mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can learn more about the \texttt{knit\_print()} function in the \textbf{knitr} package vignette:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\StringTok{"knit_print"}\NormalTok{, }\DataTypeTok{package =} \StringTok{"knitr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The \textbf{printr} package \citep{R-printr} has provided a few S3 methods to automatically print R objects as tables if possible. All you need is \texttt{library(printr)} in an R code chunk, and all methods will be automatically registered.

If you find this technique too advanced for you, some R Markdown output formats such as \texttt{html\_document} and \texttt{pdf\_document} also provide an option \texttt{df\_print}, which allows you to customize the printing behavior of data frames. For example, if you want to print data frames as tables via \texttt{knitr::kable()}, you may set the option:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{df_print}\KeywordTok{:}\AttributeTok{ kable}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Please see the help pages of the output format functions (e.g., \texttt{?rmarkdown::html\_document}) for the possible values for the option \texttt{df\_print}, or whether an output format supports the \texttt{df\_print} option.

In fact, you can completely replace the printing function \texttt{knit\_print()} through the chunk option \texttt{render}, which can take any function to print objects. For example, if you want to print objects using the \textbf{pander} package, you may set the chunk option \texttt{render} to the function \texttt{pander::pander()}:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, render=pander::pander\}}
\BaseNTok{iris}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The \texttt{render} option gives you complete freedom on how to print your R objects.

\hypertarget{option-hooks}{%
\section{Option hooks (*)}\label{option-hooks}}

Sometimes you may want to change certain chunk options dynamically according to the values of other chunk options, and you may use the object \texttt{opts\_hooks} to set up an \emph{option hook} to do it. An option hook is a function associated with the option and to be executed when a corresponding chunk option is not \texttt{NULL}. This function takes the list of options for the current chunk as the input argument, and should return the (potentially modified) list. For example, we can tweak the \texttt{fig.width} option so that it is always no smaller than \texttt{fig.height}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{fig.width =} \ControlFlowTok{function}\NormalTok{(options) \{}
  \ControlFlowTok{if}\NormalTok{ (options}\OperatorTok{$}\NormalTok{fig.width }\OperatorTok{<}\StringTok{ }\NormalTok{options}\OperatorTok{$}\NormalTok{fig.height) \{}
\NormalTok{    options}\OperatorTok{$}\NormalTok{fig.width <-}\StringTok{ }\NormalTok{options}\OperatorTok{$}\NormalTok{fig.height}
\NormalTok{  \}}
\NormalTok{  options}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Because \texttt{fig.width} will never be \texttt{NULL}, this hook function is always executed before a code chunk to update its chunk options. For the code chunk below, the actual value of \texttt{fig.width} will be 6 instead of the initial 5 if the above option hook has been set up:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r fig.width = 5, fig.height = 6\}}
\BaseNTok{plot(1:10)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

As another example, we rewrite the last example in Section \ref{opts-comment} so we can use a single chunk option \texttt{console\ =\ TRUE} to imply \texttt{comment\ =\ ""} and \texttt{prompt\ =\ TRUE}. Note that \texttt{console} is not a built-in \textbf{knitr} chunk option but a custom and arbitrary option name instead. Its default value will be \texttt{NULL}. Below is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{knitr::opts_hooks$set(console = function(options) \{}
\BaseNTok{  if (isTRUE(options$console)) \{}
\BaseNTok{    options$comment <- ''; options$prompt <- TRUE}
\BaseNTok{  \}}
\BaseNTok{  options}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{Default output:}

\BaseNTok{```\{r\}}
\BaseNTok{1 + 1}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  2 + 2}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{Output with }\BaseNTok{`console = TRUE`}\NormalTok{:}

\BaseNTok{```\{r, console=TRUE\}}
\BaseNTok{1 + 1}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  2 + 2}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The third example is about how to automatically add line numbers to any output blocks, including source code blocks, text output, messages, warnings, and errors. We have mentioned in Section \ref{number-lines} how to use chunk options such as \texttt{attr.source} and \texttt{attr.output} to add line numbers. Here we want to use a single chunk option (\texttt{numberLines} in this example) to control the blocks to which we want to add line numbers.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}
  \DataTypeTok{numberLines =} \ControlFlowTok{function}\NormalTok{(options) \{}
\NormalTok{    attrs <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"attr."}\NormalTok{, options}\OperatorTok{$}\NormalTok{numberLines)}
\NormalTok{    options[attrs] <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(options[attrs], c, }\StringTok{".numberLines"}\NormalTok{)}
\NormalTok{    options}
\NormalTok{  \}}
\NormalTok{)}

\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_chunk}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}
  \DataTypeTok{numberLines =} \KeywordTok{c}\NormalTok{(}
    \StringTok{"source"}\NormalTok{, }\StringTok{"output"}\NormalTok{, }\StringTok{"message"}\NormalTok{, }\StringTok{"warning"}\NormalTok{, }\StringTok{"error"}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Basically, the option hook \texttt{numberLines} appends the attribute \texttt{.numberLines} to output blocks, and the chunk option \texttt{numberLines} set via \texttt{opts\_chunk\$set()} makes sure that the option hook will be executed.

With the above setup, you can use the chunk option \texttt{numberLines} on a code chunk to decide which of its output blocks will have line numbers, e.g., \texttt{numberLines\ =\ c(\textquotesingle{}source\textquotesingle{},\ \textquotesingle{}output\textquotesingle{})}. Specifying \texttt{numberLines\ =\ NULL} removes line numbers completely.

You may wonder why not setting the chunk options directly, e.g., just \texttt{knitr::opts\_chunk\$set(attr.source\ =\ \textquotesingle{}.numberLines\textquotesingle{})} like we did in Section \ref{number-lines}. The advantage of using the option hooks here is that they only \emph{append} the attribute \texttt{.numberLines} to chunk options, which means they will not \emph{override} existing chunk option values, e.g., the source code block of the chunk below will be numbered (with the above setup), and the numbers start from the second line:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, attr.source='startFrom="2"'\}}
\BaseNTok{# this comment line will not be numbered}
\BaseNTok{1 + 1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

It is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, attr.source=c('startFrom="2"', '.numberLines'\}}
\BaseNTok{# this comment line will not be numbered}
\BaseNTok{1 + 1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{output-hooks}{%
\chapter{Output Hooks (*)}\label{output-hooks}}

With the \textbf{knitr} package, you have control over every piece of output from your code chunks, such as source code, text output, messages, and plots. The control is achieved through ``output hooks'', which are a series of functions that take a piece of output as the input (typically a character vector), and return a character vector to be written to the output document. This may not be easy to understand for now, but hopefully you can see the idea more clearly with a small example below explaining how the output of a simple code chunk is rendered through \textbf{knitr}'s output hooks.

Consider this code chunk with one line of code:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{1 + 1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

After \textbf{knitr} evaluates the code chunk, it gets two output elements, and both are stored as character strings: the source code \texttt{"1\ +\ 1"}, and the text output \texttt{"{[}1{]}\ 2"}. These character strings will be further processed by chunk hooks for the desired output format. For example, for Markdown documents, \textbf{knitr} will wrap the source code in a fenced code block with a language name. This is done through the \texttt{source} hook, which more or less looks like this function:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# for the above case, `x` is a character string '1 + 1'}
\ControlFlowTok{function}\NormalTok{(x, options) \{}
  \CommentTok{# the little 'r' here indicates the language name}
  \KeywordTok{paste}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"```r"}\NormalTok{, x, }\StringTok{"```"}\NormalTok{), }\DataTypeTok{collapse =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Similar, the text output is processed by the \texttt{output} hook that looks like this function:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{function}\NormalTok{(x, options) \{}
  \KeywordTok{paste}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"```"}\NormalTok{, x, }\StringTok{"```"}\NormalTok{), }\DataTypeTok{collapse =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

So the final output of the above code chunk is:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```r}
\BaseNTok{1 + 1}
\BaseNTok{```}

\BaseNTok{```}
\BaseNTok{[1] 2}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The actual hooks are more complicated than the two functions above, but the idea is the same. You may obtain the actual hooks from the object \texttt{knit\_hooks} via the \texttt{get()} method, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# for meaningful output, the code below should be executed *inside* a code chunk of a knitr document}
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{get}\NormalTok{(}\StringTok{"source"}\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{get}\NormalTok{(}\StringTok{"output"}\NormalTok{)}
\CommentTok{# or knitr::knit_hooks$get(c('source', 'output'))}
\end{Highlighting}
\end{Shaded}

Unless you are truly interested in making contributions to the \textbf{knitr} package, we do not recommend that you read the source code of these built-in hooks, which can be found in the scripts named in the form \texttt{hooks-*.R} at \url{https://github.com/yihui/knitr/tree/master/R} (e.g., \texttt{hooks-md.R} contains hooks for R Markdown documents). As a \textbf{knitr} user, it usually suffices if you know how to create custom output hooks by taking advantage of the built-in hooks. You will learn that in several examples in this chapter, and we show the basic idea below.

A custom output hook is registered through the \texttt{set()} method on \texttt{knit\_hooks}. Because this method will override the existing default hook, we recommend that you save a copy of existing hook, process the output elements in your own way, and pass the results to the default hook. The usual syntax is:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# using local() is optional here (we just want to avoid creating unnecessary global variables like `hook_old`)}
\KeywordTok{local}\NormalTok{(\{}
\NormalTok{  hook_old <-}\StringTok{ }\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{get}\NormalTok{(}\StringTok{"NAME"}\NormalTok{)  }\CommentTok{# save the old hook}
\NormalTok{  knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{NAME =} \ControlFlowTok{function}\NormalTok{(x, options) \{}
    \CommentTok{# now do whatever you want to do with x, and pass the new x to the old hook}
    \KeywordTok{hook_old}\NormalTok{(x, options)}
\NormalTok{  \})}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Here \texttt{NAME} is the name of the hook, which can be one of the following values:

\begin{itemize}
\item
  \texttt{source}: processing the source code.
\item
  \texttt{output}: processing text output.
\item
  \texttt{warning}: processing warnings (usually from \texttt{warning()}).
\item
  \texttt{message}: processing messages (usually from \texttt{message()}).
\item
  \texttt{error}: processing error messages (usually from \texttt{stop()}).
\item
  \texttt{plot}: processing plot file paths.
\item
  \texttt{inline}: processing output from inline R expressions.
\item
  \texttt{chunk}: processing output from the whole chunk.
\item
  \texttt{document}: processing the whole document.
\end{itemize}

The meaning of the argument \texttt{x} in the hook functions is explained in the above list. For the \texttt{options} argument of a hook, it denotes the chunk options (as a list) for the current code chunk. For example, if you set \texttt{foo\ =\ TRUE} on a chunk, you can obtain its value via \texttt{options\$foo} in the hook. The \texttt{options} argument is not available to the \texttt{inline} and \texttt{document} hooks.

Output hooks give you the ultimate control over every single piece of your chunk and document output. Compared with chunk options, which often have predefined purposes, output hooks can be much more powerful since they are user-defined functions, and you can do anything you want in functions.

\hypertarget{hook-hide}{%
\section{Redact source code}\label{hook-hide}}

Sometimes we may not want to fully display our source code in the report. For example, you may have a password in a certain line of code. We mentioned in Section \ref{hide-one} that you can use the chunk option \texttt{eval} to select which expressions in the R code to display (e.g., show the second expression via \texttt{echo\ =\ 2}). In this section, we provide a more flexible method that does not require you to specify the indices of expressions.

The basic idea is that you add a special comment to the code (e.g., \texttt{\#\ SECRET!!}). When this comment is detected in a line of code, you omit that line. Below is a full example using the \texttt{source} hook:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Using the }\BaseNTok{`source`}\NormalTok{ hook to hide certain lines of code}
\NormalTok{---}

\NormalTok{First, we set up a }\BaseNTok{`source`}\NormalTok{ hook to exclude the lines of code}
\NormalTok{that contain the string }\BaseNTok{`# SECRET!!`}\NormalTok{ at the end.}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{local(\{}
\BaseNTok{  hook_source <- knitr::knit_hooks$get('source')}
\BaseNTok{  knitr::knit_hooks$set(source = function(x, options) \{}
\BaseNTok{    x <- x[!grepl('# SECRET!!$', x)]}
\BaseNTok{    hook_source(x, options)}
\BaseNTok{  \})}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{Now we can test the new hook. When you knit this document, you}
\NormalTok{will not see the lines with the special comment }\BaseNTok{`# SECRET!!`}\NormalTok{.}

\BaseNTok{```\{r\}}
\BaseNTok{1 + 1  # normal code to be displayed}

\BaseNTok{# please use your real username and password}
\BaseNTok{auth <- httr::authenticate("user", "passwd")}
\BaseNTok{auth <- httr::authenticate("yihui", "horsebattery")  # SECRET!!}
\BaseNTok{httr::GET("http://httpbin.org/basic-auth/user/passwd", auth)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The key part in the above \texttt{source} hook is this line, which matches the trailing comment \texttt{\#\ SECRET!!} in the source code vector \texttt{x} via \texttt{grepl()} and exclude the matches:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{x[}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\StringTok{"# SECRET!!$"}\NormalTok{, x)]}
\end{Highlighting}
\end{Shaded}

Precisely speaking, the above hook will exclude whole \emph{expressions} containing the trailing comment \texttt{\#\ SECRET!!}, instead of individual lines, because \texttt{x} is actually a vector of R expressions. For example, for the code chunk below:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{}
  \CommentTok{# SECRET!!}
  \DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The value of \texttt{x} in the \texttt{source} hook is:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(}\StringTok{"1 + 1"}\NormalTok{, }\StringTok{"if (TRUE) \{ # SECRET!!}\CharTok{\textbackslash{}n}\StringTok{  1:10}\CharTok{\textbackslash{}n}\StringTok{\}"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to hide lines instead of expressions of R code, you will have to split \texttt{x} into individual lines. You may consider using the function \texttt{xfun::split\_lines()}. The body of the hook function will be:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{split_lines}\NormalTok{(x)  }\CommentTok{# split into individual lines}
\NormalTok{x <-}\StringTok{ }\NormalTok{x[}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\StringTok{"# SECRET!!$"}\NormalTok{, x)]}
\NormalTok{x <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(x, }\DataTypeTok{collapse =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)  }\CommentTok{# combine into a single string}
\KeywordTok{hook_source}\NormalTok{(x, options)}
\end{Highlighting}
\end{Shaded}

This example shows you how to manipulate the source code string, and \texttt{grepl()} is certainly not the only choice of string manipulation. In Section \ref{hook-number}, we will show another example.

\hypertarget{hook-number}{%
\section{Add line numbers to source code}\label{hook-number}}

In this section, we show an example of defining a \texttt{source} hook to add line numbers as comments to the source code. For example, for this code chunk:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  x <- 1:10}
\BaseNTok{  x + 1}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

We want the output to be:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{    }\CommentTok{# 1}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}    \CommentTok{# 2}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\DecValTok{1}        \CommentTok{# 3}
\NormalTok{\}              }\CommentTok{# 4}
\end{Highlighting}
\end{Shaded}

The full example is below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Add line numbers to source code}
\NormalTok{---}

\NormalTok{We set up a }\BaseNTok{`source`}\NormalTok{ hook to add line numbers to the source}
\NormalTok{code. The numbers appear in comments at the end of each line.}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{local(\{}
\BaseNTok{  hook_source <- knitr::knit_hooks$get('source')}
\BaseNTok{  knitr::knit_hooks$set(source = function(x, options) \{}
\BaseNTok{    x <- xfun::split_lines(x)}
\BaseNTok{    n <- nchar(x, 'width')}
\BaseNTok{    i <- seq_along(x)  # line numbers}
\BaseNTok{    n <- n + nchar(i)}
\BaseNTok{    s <- knitr:::v_spaces(max(n) - n)}
\BaseNTok{    x <- paste(x, s, '  # ', i, sep = '', collapse = '\textbackslash{}n')}
\BaseNTok{    hook_source(x, options)}
\BaseNTok{  \})}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{Now we can test the new hook. When you knit this document, you}
\NormalTok{will see line numbers in trailing comments.}

\BaseNTok{```\{r\}}
\BaseNTok{if (TRUE) \{}
\BaseNTok{  x <- 1:10}
\BaseNTok{  x + 1}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The main trick in the above example is to determine the number of spaces needed before the comment on each line, so the comments can align to the right. The number depends on the widths of each line of code. We leave it to readers to digest the code in the hook function. Note that an internal function \texttt{knitr:::v\_spaces()} is used to generate spaces of specified lengths, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{:::}\KeywordTok{v_spaces}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] " "      "   "    "      " ""
\end{verbatim}

The method introduced in Section \ref{number-lines} may be the actual way in which you want to add line numbers to source code. The syntax is cleaner, and it works both source code and text output blocks. The above \texttt{source} hook trick mainly aims to show you one possibility of manipulating the source code with a custom function.

\hypertarget{hook-scroll}{%
\section{Scrollable text output}\label{hook-scroll}}

In Section \ref{html-scroll}, we showed how to restrict the heights of code blocks and text output blocks via CSS. In fact, there is a simpler method with the chunk options \texttt{attr.source} and \texttt{attr.output} to add the \texttt{style} attribute to the fenced code blocks in the Markdown output. For example, for this code chunk with the \texttt{attr.output} option:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, attr.output='style="max-height: 100px;"'\}}
\BaseNTok{1:300}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Its Markdown output will be:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```r}
\BaseNTok{1:300}
\BaseNTok{```}

\BaseNTok{```\{style="max-height: 100px;"\}}
\BaseNTok{##   [1]   1   2   3   4   5   6   7   8   9  10}
\BaseNTok{##  [11]  11  12  13  14  15  16  17  18  19  20}
\BaseNTok{##  ... ...}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Then the text output block will be converted to HTML by Pandoc:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<pre}\OtherTok{ style=}\StringTok{"max-height: 100px;"}\KeywordTok{>}
\KeywordTok{<code>}\NormalTok{##   [1]   1   2   3   4   5   6   7   8   9  10}
\NormalTok{##  [11]  11  12  13  14  15  16  17  18  19  20}
\NormalTok{##  ... ...}\KeywordTok{</code>}
\KeywordTok{</pre>}
\end{Highlighting}
\end{Shaded}

To learn more about Pandoc's fenced code blocks, please read its manual at \url{https://pandoc.org/MANUAL.html\#fenced-code-blocks}.

The \texttt{attr.source} and \texttt{attr.output} options have made it possible for us to specify maximum heights for individual code chunks. However, the syntax is a little clunky, and requires a better understanding of CSS and Pandoc's Markdown syntax. Below we show an example of a custom \texttt{output} hook that works with a custom chunk option \texttt{max.height}, so you will only need to set the chunk option like \texttt{max.height\ =\ "100px"} instead of \texttt{attr.output\ =\ \textquotesingle{}style="max-height:\ 100px;"\textquotesingle{}}. In this example, we only manipulate the \texttt{options} argument, but not the \texttt{x} argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Scrollable code blocks}
\NormalTok{output: }
\NormalTok{  html_document: }
\BaseNTok{    highlight: tango}
\NormalTok{---}

\NormalTok{We set up an }\BaseNTok{`output`}\NormalTok{ hook to add a }\BaseNTok{`style`}\NormalTok{ attribute to the}
\NormalTok{text output when the chunk option }\BaseNTok{`max.height`}\NormalTok{ is set.}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{options(width = 60)}
\BaseNTok{local(\{}
\BaseNTok{  hook_output <- knitr::knit_hooks$get('output')}
\BaseNTok{  knitr::knit_hooks$set(output = function(x, options) \{}
\BaseNTok{    if (!is.null(options$max.height)) options$attr.output <- c(}
\BaseNTok{      options$attr.output,}
\BaseNTok{      sprintf('style="max-height: %s;"', options$max.height)}
\BaseNTok{    )}
\BaseNTok{    hook_output(x, options)}
\BaseNTok{  \})}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{Without the }\BaseNTok{`max.height`}\NormalTok{ option, you will see the full output,}
\NormalTok{e.g.,}

\BaseNTok{```\{r\}}
\BaseNTok{1:100}
\BaseNTok{```}

\NormalTok{Now we set }\BaseNTok{`max.height`}\NormalTok{ to }\BaseNTok{`100px`}\NormalTok{. You will see a scrollbar}
\NormalTok{in the text output because its height is larger than 100px.}

\BaseNTok{```\{r, max.height='100px'\}}
\BaseNTok{1:100}
\BaseNTok{```}

\NormalTok{Essentially the }\BaseNTok{`max.height`}\NormalTok{ option is converted to the}
\BaseNTok{`attr.output`}\NormalTok{ option. It works even if the }\BaseNTok{`attr.output`}
\NormalTok{option is present, i.e., it will not override the}
\BaseNTok{`attr.output`}\NormalTok{ option, e.g., we show line numbers on the left}
\NormalTok{side of the text output via the }\BaseNTok{`.numberLines`}\NormalTok{ attribute:}

\BaseNTok{```\{r, max.height='100px', attr.output='.numberLines'\}}
\BaseNTok{1:100}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Figure \ref{fig:hook-scroll} shows the output. Note that in the last code chunk with the chunk option \texttt{attr.output}, the option will not be overridden by \texttt{max.height} because we respect existing attributes by combining them with the \texttt{style} attribute generated by \texttt{max.height}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{options}\OperatorTok{$}\NormalTok{attr.output <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}
\NormalTok{  options}\OperatorTok{$}\NormalTok{attr.output,}
  \KeywordTok{sprintf}\NormalTok{(}\StringTok{'style="max-height: %s;"'}\NormalTok{, options}\OperatorTok{$}\NormalTok{max.height)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{images/hook-scroll.png}
\caption{\label{fig:hook-scroll}An example of scrollable text output, with its height specified in the chunk option max.height.}
\end{figure}

You can use the similar trick in the \texttt{source} hook to limit the height of source code blocks.

\hypertarget{hook-truncate}{%
\section{Truncate text output}\label{hook-truncate}}

When the text output from a code chunk is lengthy, you may want to only show the first few lines. For example, when printing a data frame of a few thousand rows, it may not be helpful to show the full data, and the first few lines may be enough. Below we redefine the \texttt{output} hook so that we can control the maximum number of lines via a custom chunk option \texttt{out.lines}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# save the built-in output hook}
\NormalTok{hook_output <-}\StringTok{ }\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{get}\NormalTok{(}\StringTok{"output"}\NormalTok{)}

\CommentTok{# set a new output hook to truncate text output}
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{output =} \ControlFlowTok{function}\NormalTok{(x, options) \{}
  \ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{is.null}\NormalTok{(n <-}\StringTok{ }\NormalTok{options}\OperatorTok{$}\NormalTok{out.lines)) \{}
\NormalTok{    x <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{split_lines}\NormalTok{(x)}
    \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(x) }\OperatorTok{>}\StringTok{ }\NormalTok{n) \{}
      \CommentTok{# truncate the output}
\NormalTok{      x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{head}\NormalTok{(x, n), }\StringTok{"....}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    x <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(x, }\DataTypeTok{collapse =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  \}}
  \KeywordTok{hook_output}\NormalTok{(x, options)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The basic idea of the above hook function is that if the number of lines of the text output is greater than the threshold set in the chunk option \texttt{out.lines} (stored in the variable \texttt{n} in the function body), we only keep the first \texttt{n} lines and add \texttt{....} to indicate the output is truncated.

Now we can test the new \texttt{output} hook by setting the chunk option \texttt{out.lines\ =\ 4} on the chunk below:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(cars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
....
\end{verbatim}

And you see four lines of output as expected. Since we have stored the original \texttt{output} hook in \texttt{hook\_output}, we can restore it by calling the \texttt{set()} method again:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{output =}\NormalTok{ hook_output)}
\end{Highlighting}
\end{Shaded}

As an exercise to readers, you may try to truncate the output in a different way: given the chunk option \texttt{out.lines} to determine the maximum number of lines, can you truncate the output in the middle instead of the end? For example, if \texttt{out.lines\ =\ 10}, you extract the first and last five lines, and add \texttt{....} in the middle like this:

\begin{verbatim}
##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
....
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85
\end{verbatim}

Please note that the last line in the output (i.e., the argument \texttt{x} of the hook function) might be an empty line, so you may need something like \texttt{c(head(x,\ n/2),\ \textquotesingle{}....\textquotesingle{},\ tail(x,\ n/2\ +\ 1))} (\texttt{+\ 1} to take the last empty line into account).

\hypertarget{hook-html5}{%
\section{Output figures in the HTML5 format}\label{hook-html5}}

By default, plots in R Markdown are included in the tag \texttt{\textless{}img\ src="..."\ /\textgreater{}} in a \texttt{\textless{}p\textgreater{}} or \texttt{\textless{}div\textgreater{}} tag in the HTML output. This example below shows how to use the HTML5 \texttt{\textless{}figure\textgreater{}} tag to display plots.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Output figures in }\BaseNTok{`<figure>`}\NormalTok{ tags}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{Given a plot file path }\BaseNTok{`x`}\NormalTok{ and a figure caption in the chunk}
\NormalTok{option }\BaseNTok{`options$fig.cap`}\NormalTok{, we want to write the plot in the}
\NormalTok{HTML5 tag in this form:}

\BaseNTok{```html}
\KeywordTok{<figure>}
\BaseNTok{  }\KeywordTok{<img}\OtherTok{ src=}\StringTok{"PATH"}\OtherTok{ alt=}\StringTok{"CAPTION"} \KeywordTok{/>}
\BaseNTok{  }\KeywordTok{<figcaption>}\BaseNTok{CAPTION}\KeywordTok{</figcaption>}
\KeywordTok{</figure>}
\BaseNTok{```}

\NormalTok{Now we redefine the }\BaseNTok{`plot`}\NormalTok{ hook (only when the output format}
\NormalTok{is HTML):}

\BaseNTok{```\{r\}}
\BaseNTok{if (knitr::is_html_output()) knitr::knit_hooks$set(}
\BaseNTok{  plot = function(x, options) \{}
\BaseNTok{    cap  <- options$fig.cap  # figure caption}
\BaseNTok{    tags <- htmltools::tags}
\BaseNTok{    as.character(tags$figure(}
\BaseNTok{      tags$img(src = x, alt = cap),}
\BaseNTok{      tags$figcaption(cap)}
\BaseNTok{    ))}
\BaseNTok{  \}}
\BaseNTok{)}
\BaseNTok{```}

\NormalTok{The plot from the code chunk below will be placed in the}
\BaseNTok{`<figure>`}\NormalTok{ tag:}

\BaseNTok{```\{r, fig.cap='A scatterplot for the cars data.'\}}
\BaseNTok{par(mar = c(4.5, 4.5, .2, .2))}
\BaseNTok{plot(cars, pch = 19, col = 'red')}
\BaseNTok{```}

\NormalTok{We add some CSS styles to "see" the }\BaseNTok{`<figure>`}\NormalTok{ and}
\BaseNTok{`<figcaption>`}\NormalTok{ tags better (the }\BaseNTok{`figure`}\NormalTok{ has a dashed}
\NormalTok{border, and the caption has a light pink background):}

\BaseNTok{```\{css, echo=FALSE\}}
\BaseNTok{figure \{}
\BaseNTok{  border: 2px dashed red;}
\BaseNTok{  margin: 1em 0;}
\BaseNTok{\}}
\BaseNTok{figcaption \{}
\BaseNTok{  padding: .5em;}
\BaseNTok{  background: lightpink;}
\BaseNTok{  font-size: 1.3em;}
\BaseNTok{  font-variant: small-caps;}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The figure output is shown in Figure \ref{fig:hook-html5}. Note that we actually overrode the default \texttt{plot} hook in this example, while most other examples in this chapter build custom hooks on top of the default hooks. You should completely override default hooks only when you are sure you want to ignore some built-in features of the default hooks. For example, the \texttt{plot} hook function in this case did not consider possible chunk options like \texttt{out.width\ =\ \textquotesingle{}100\%\textquotesingle{}} or \texttt{fig.show\ =\ \textquotesingle{}animate\textquotesingle{}}.

\begin{figure}
\centering
\includegraphics{images/hook-html5.png}
\caption{\label{fig:hook-html5}A figure in the HTML5 figure tag.}
\end{figure}

This example shows you what you can possibly do with the plot file path \texttt{x} in the \texttt{plot} hook. If all you need is to customize the style of figures, you do not have to use the HTML5 tags. Usually the default \texttt{plot} hook will output images in the HTML code like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<div}\OtherTok{ class=}\StringTok{"figure"}\KeywordTok{>}
  \KeywordTok{<img}\OtherTok{ src=}\StringTok{"PATH"} \KeywordTok{/>}
  \KeywordTok{<p}\OtherTok{ class=}\StringTok{"caption"}\KeywordTok{>}\NormalTok{CAPTION}\KeywordTok{</p>}
\KeywordTok{</div>}
\end{Highlighting}
\end{Shaded}

So you can just define css rules for \texttt{div.figure} and \texttt{p.caption}.

\hypertarget{chunk-hooks}{%
\chapter{Chunk Hooks (*)}\label{chunk-hooks}}

A chunk hook is a function that is triggered by a chunk option when the value of this chunk option is not \texttt{NULL}. Chunk hooks provide a way for you to execute additional tasks beyond running the code in a chunk. For example, you may want to post-process plots (e.g., Section \ref{crop-plot} and Section \ref{optipng}), or record the time taken by a code chunk (Section \ref{time-chunk}). Such tasks may not be essential to the computing or analysis in the report, but they can be useful for other purposes (e.g., enhance plots or help you identify the most time-consuming chunks).

You can use chunk hooks purely for their side-effects (e.g., only printing out certain information to the console), or for their returned values, which will be written to the output document if the value is a character value.

Like output hooks (see Chapter \ref{output-hooks}), chunk hooks are also registered via the object \texttt{knitr::knit\_hooks}. Please note that the names of output hooks are reserved by \textbf{knitr}, so you must not use these names for your custom chunk hooks:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(knitr}\OperatorTok{:::}\NormalTok{.default.hooks)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "source"          "output"          "warning"         "message"         "error"           "plot"           
##  [7] "inline"          "chunk"           "text"            "evaluate.inline" "evaluate"        "document"
\end{verbatim}

A chunk hook is associated with a chunk option of the same name. For example, you can register a chunk hook with the name \texttt{greet}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{greet =} \ControlFlowTok{function}\NormalTok{(before) \{}
  \ControlFlowTok{if}\NormalTok{ (before) }
    \StringTok{"Hello!"} \ControlFlowTok{else} \StringTok{"Bye!"}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

We will explain the arguments of the hook function in a moment. Now we set the chunk option \texttt{greet\ =\ TRUE} for the chunk below:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, greet=TRUE\}}
\BaseNTok{1 + 1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

And you will see that ``Hello!'' appears before the chunk, and ``Bye!'' appears after the chunk in the output below (which is because they are character values):

\begin{quote}
Hello!

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

Bye!
\end{quote}

A chunk hook function can possibly take four arguments: \texttt{before}, \texttt{options}, \texttt{envir}, and \texttt{name}. In other words, it can be of this form:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{function}\NormalTok{(before, options, envir, name) \{}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

All four arguments are optional. You can have four, three, two, one, or even no arguments. In the above example, we used one argument (i.e., \texttt{before}). The meanings of these arguments are:

\begin{itemize}
\item
  \texttt{before}: Whether the chunk hook is executed before or after the code chunk itself is executed. Note that a chunk hook is executed twice for every code chunk (once before with \texttt{hook(before\ =\ TRUE)} and once after with \texttt{hook(before\ =\ FALSE}).
\item
  \texttt{options}: The list of chunk options for the current code chunk, e.g., \texttt{list(fig.width\ =\ 5,\ echo\ =\ FALSE,\ ...)}.
\item
  \texttt{envir}: The environment in which the chunk hook is evaluated.
\item
  \texttt{name}: The name of the chunk option that triggered the chunk hook.
\end{itemize}

As we mentioned in the beginning of this chapter, non-character values returned by chunk hooks are silently ignored, and character values are written to the output document.

\hypertarget{crop-plot}{%
\section{Crop plots}\label{crop-plot}}

The chunk hook \texttt{knitr::hook\_pdfcrop()} can be used to crop PDF and other types of plot files, i.e., remove the extra margins in plots. To enable it, set this hook via \texttt{knit\_hooks\$set()} in a code chunk, and turn on the corresponding chunk option, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{crop =}\NormalTok{ knitr}\OperatorTok{::}\NormalTok{hook_pdfcrop)}
\end{Highlighting}
\end{Shaded}

Then you can use the chunk option \texttt{crop\ =\ TRUE} to crop plots in a code chunk.

The hook \texttt{hook\_pdfcrop()} calls the external program \texttt{pdfcrop} to crop PDF files. This program often comes with a LaTeX distribution (e.g., TeX Live or MiKTeX). You can check if it is available in your system via:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# if the returned value is not empty, it is available}
\KeywordTok{Sys.which}\NormalTok{(}\StringTok{"pdfcrop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                                pdfcrop 
## "C:\\Users\\emily\\AppData\\Roaming\\TinyTeX\\bin\\win32\\pdfcrop.exe"
\end{verbatim}

If you are using the LaTeX distribution TinyTeX (see Section \ref{install-latex}), and \texttt{pdfcrop} is not available in your system, you may install it via \texttt{tinytex::tlmgr\_install(\textquotesingle{}pdfcrop\textquotesingle{})}.

For non-PDF plot files such as PNG or JPEG files, this hook function calls the R package \textbf{magick} to crop them. You need to make sure this R package has been installed. Figure \ref{fig:crop-no} shows a plot that is not cropped, and Figure \ref{fig:crop-yes} shows the same plot but has been cropped.

\begin{figure}
\centering
\includegraphics{rmarkdown-cookbook_files/figure-latex/crop-no-1.pdf}
\caption{\label{fig:crop-no}A plot that is not cropped.}
\end{figure}

\begin{figure}
\centering
\includegraphics{rmarkdown-cookbook_files/figure-latex/crop-yes-1.pdf}
\caption{\label{fig:crop-yes}A plot that is cropped.}
\end{figure}

\hypertarget{optipng}{%
\section{Optimize PNG plots}\label{optipng}}

If you have installed the program OptiPNG (\url{http://optipng.sourceforge.net}), you may use the hook \texttt{knitr::hook\_optipng()} to optimize PNG plot files to a smaller size without losing the image quality.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{optipng =}\NormalTok{ knitr}\OperatorTok{::}\NormalTok{hook_optipng)}
\end{Highlighting}
\end{Shaded}

After you set up this hook, you can use the chunk option \texttt{optipng} to pass command-line arguments to OptiPNG, e.g., \texttt{optipng\ =\ \textquotesingle{}-o7\textquotesingle{}}. These command-line arguments are optional, which means you can just use \texttt{optipng\ =\ \textquotesingle{}\textquotesingle{}} to enable the hook for a code chunk. Please see the user manual on the website of OptiPNG to know the possible arguments.

Note that macOS users can easily install OptiPNG with Homebrew (\url{https://brew.sh}): \texttt{brew\ install\ optipng}.

\hypertarget{time-chunk}{%
\section{Report how much time each chunk takes to run}\label{time-chunk}}

By default, \textbf{knitr} provides a text-based progress bar to show you the knitting progress. If you want more precise timing information about the chunks, you may register a custom chunk hook to record the time for each chunk. Here is an example hook:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{time_it =} \KeywordTok{local}\NormalTok{(\{}
\NormalTok{  now <-}\StringTok{ }\OtherTok{NULL}
  \ControlFlowTok{function}\NormalTok{(before, options) \{}
    \ControlFlowTok{if}\NormalTok{ (before) \{}
      \CommentTok{# record the current time before each chunk}
\NormalTok{      now <<-}\StringTok{ }\KeywordTok{Sys.time}\NormalTok{()}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
      \CommentTok{# calculate the time difference after a chunk}
\NormalTok{      res <-}\StringTok{ }\KeywordTok{difftime}\NormalTok{(}\KeywordTok{Sys.time}\NormalTok{(), now)}
      \CommentTok{# return a character string to show the time}
      \KeywordTok{paste}\NormalTok{(}\StringTok{"Time for this code chunk to run:"}\NormalTok{, res)}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

Then you can time a chunk with the chunk option \texttt{time\_it}, e.g.,

\begin{verbatim}
```{r, time_it = TRUE}
Sys.sleep(2)
```
\end{verbatim}

If you want to time all code chunks, you can certainly set the option globally: \texttt{knitr::opts\_chunk\$set(time\_it\ =\ TRUE)}.

In the above hook function, you can also output more information from the chunk options (i.e., the \texttt{options} argument of the function). For example, you may print out the chunk label in the returned value:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{paste}\NormalTok{(}\StringTok{"Time for the chunk"}\NormalTok{, options}\OperatorTok{$}\NormalTok{label, }\StringTok{"to run:"}\NormalTok{, res)}
\end{Highlighting}
\end{Shaded}

Or you may record the time without printing it out in the hook:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all_times <-}\StringTok{ }\KeywordTok{list}\NormalTok{()  }\CommentTok{# store the time for each chunk}
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_hooks}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{time_it =} \KeywordTok{local}\NormalTok{(\{}
\NormalTok{  now <-}\StringTok{ }\OtherTok{NULL}
  \ControlFlowTok{function}\NormalTok{(before, options) \{}
    \ControlFlowTok{if}\NormalTok{ (before) \{}
\NormalTok{      now <<-}\StringTok{ }\KeywordTok{Sys.time}\NormalTok{()}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      res <-}\StringTok{ }\KeywordTok{difftime}\NormalTok{(}\KeywordTok{Sys.time}\NormalTok{(), now)}
\NormalTok{      all_times[[options}\OperatorTok{$}\NormalTok{label]] <<-}\StringTok{ }\NormalTok{res}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

Then you can access all the time information in the object \texttt{all\_times}, which is a named list with the names being chunk labels, and element values being the execution time for each chunk.

Lastly, as a technical note, we want to explain the use of the \texttt{local()} function in the previous hooks because some readers may not be familiar with it. This function allows you to run code in a ``local'' environment. The main benefit is that variables created in the code are local to that environment, so they will not pollute the outer environment (usually the global environment). For example, we created a variable \texttt{now} in \texttt{local()}, and used it in the \texttt{time\_it} hook function. In the hook function, we update the value of \texttt{now} via the double arrow \texttt{\textless{}\textless{}-} instead of the normal assignment operator \texttt{\textless{}-}, because \texttt{\textless{}\textless{}-} assigns a value to a variable in the parent environment (which is the environment in \texttt{local()} in this case), and \texttt{\textless{}-} can only assign values to variables in the current environment. Before each code chunk is evaluated, the local variable \texttt{now} records the current time. After each code chunk is evaluated, we calculate the time difference between the current time and \texttt{now}. Note that \texttt{local()} returns the last value in the expression passed to it, which is a (hook) function in this case. In short, \texttt{local()} can make your workspace cleaner by not exposing variables that are only used locally but unused in the global environment. If you do not mind creating a variable \texttt{now} in the global environment, you can choose not to use \texttt{local()}.

\hypertarget{show-header}{%
\section{Show the chunk header in the output}\label{show-header}}

Sometimes you may want to show the original code chunk header to your readers. For example, when you write an R Markdown tutorial, you may want to show both the chunk output and the chunk options that you used to generate the output, so your readers can learn how to do it by themselves.

The original chunk options are actually stored as a character string in the chunk option \texttt{params.src}. After you know this, you may write a chunk hook to add \texttt{params.src} to the output. Below is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Show chunk headers in the output}
\NormalTok{---}

\NormalTok{Set up a chunk hook named }\BaseNTok{`wrapper`}\NormalTok{ to wrap the chunk}
\NormalTok{output inside the original chunk header and footer.}

\BaseNTok{```\{r, setup, include=FALSE\}}
\BaseNTok{knitr::knit_hooks$set(wrapper = function(before, options) \{}
\BaseNTok{  # the original chunk might be indented}
\BaseNTok{  if (is.null(indent <- options$indent)) indent <- ''}
\BaseNTok{  }
\BaseNTok{  # hide the wrapper=TRUE option}
\BaseNTok{  opts <- gsub(', wrapper=TRUE', '', options$params.src)}
\BaseNTok{  }
\BaseNTok{  if (before) \{}
\BaseNTok{    # add the header}
\BaseNTok{    sprintf('\textbackslash{}n\textbackslash{}n%s````\textbackslash{}n```\{r,%s\}\textbackslash{}n````\textbackslash{}n', indent, opts)}
\BaseNTok{  \} else \{}
\BaseNTok{    # add the footer}
\BaseNTok{    sprintf('\textbackslash{}n\textbackslash{}n%s````\textbackslash{}n```\textbackslash{}n````\textbackslash{}n', indent)}
\BaseNTok{  \}}
\BaseNTok{\})}
\BaseNTok{```}

\NormalTok{Now we apply the hook via the chunk option }\BaseNTok{`wrapper=TRUE`}\NormalTok{.}
\NormalTok{Remember to put }\BaseNTok{`wrapper=TRUE`}\NormalTok{ at the end of the header, and}
\NormalTok{it has to be }\BaseNTok{`wrapper=TRUE`}\NormalTok{ precisely (e.g., not }\BaseNTok{`wrapper=T`}\NormalTok{),}
\NormalTok{following a comma and a space, unless you adjust the }\BaseNTok{`gsub()`}
\NormalTok{call in the above hook.}

\BaseNTok{```\{r, test-label, collapse=TRUE, wrapper=TRUE\}}
\BaseNTok{1 + 1}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\NormalTok{You should see the original chunk header appear in}
\NormalTok{the output. The hook should also work when the chunk}
\NormalTok{is indented, e.g.,}

\NormalTok{- }\StringTok{One bullet.}

  \BaseNTok{```\{r, eval=TRUE, wrapper=TRUE\}}
\BaseNTok{  2 + 2}
\BaseNTok{  ```}

\NormalTok{- }\StringTok{Another bullet.}
\end{Highlighting}
\end{Shaded}

Basically, we restored the chunk header from \texttt{options\$params.src} by putting this string inside \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r,\ \}}. Then we wrapped this line in a pair of four backticks, so it can be displayed verbatim in the output. Note that the original code chunk might be indented (e.g., when it is nested in a list item), so we also need to add the proper indentation, which is stored in the chunk option \texttt{options\$indent}.

The output of the bullet list at the end of the above example will be like this:

\begin{quote}
\begin{itemize}
\item
  One bullet.

\begin{verbatim}
```{r, eval=TRUE}
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{verbatim}
```
\end{verbatim}
\item
  Another bullet.
\end{itemize}
\end{quote}

You can see that the code chunk was evaluated, and the chunk header was also added.

\hypertarget{rgl-3d}{%
\section{Embed an interactive 3D plot with rgl}\label{rgl-3d}}

The \textbf{rgl} package can be used to generate interactive 3D plots. These plots can still be interactive if they are saved to the WebGL format, which can be done through a hook function \texttt{rgl::hook\_webgl()}. Below is an example that shows you how to set up \textbf{rgl} and \textbf{knitr} so 3D plots can be saved while preserving the interactivity:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Embed 3D plots with rgl}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{Set up a hook to save **rgl** plots:}

\BaseNTok{```\{r, setup\}}
\BaseNTok{library(rgl)}
\BaseNTok{knitr::knit_hooks$set(webgl = hook_webgl)}
\BaseNTok{```}

\NormalTok{See if it works for this 3D plot after we enable the hook}
\NormalTok{via the chunk option }\BaseNTok{`webgl = TRUE`}\NormalTok{:}

\BaseNTok{```\{r, test-rgl, webgl=TRUE\}}
\BaseNTok{x <- sort(rnorm(1000))}
\BaseNTok{y <- rnorm(1000)}
\BaseNTok{z <- rnorm(1000) + atan2(x,y)}
\BaseNTok{plot3d(x, y, z, col = rainbow(1000))}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You should get an interactive 3D scatterplot like Figure \ref{fig:rgl-3d} after you compile this example. Note that the interactive plots only work when the output format is HTML.

\begin{figure}

{\centering \includegraphics{images/rgl-3d} 

}

\caption{A 3D scatterplot generated from the rgl package.}\label{fig:rgl-3d}
\end{figure}

\hypertarget{knitr-misc}{%
\chapter{Miscellaneous knitr Tricks}\label{knitr-misc}}

Besides chunk options (Chapter \ref{chunk-options}), output hooks (Chapter \ref{output-hooks}), and chunk hooks (Chapter \ref{chunk-hooks}), there are other useful functions and tricks in \textbf{knitr}, which we will introduce in this chapter, such as how to reuse code chunks, exit knitting early, display a plot in a custom place, and so on.

\hypertarget{reuse-chunks}{%
\section{Reuse code chunks}\label{reuse-chunks}}

You can freely reuse code chunks anywhere in your source document without cut-and-paste. The key is to label your code chunks, so you can refer to them with labels in other places. There are three ways to reuse code chunks.

\hypertarget{embed-chunk}{%
\subsection{Embed one chunk in another chunk (*)}\label{embed-chunk}}

You can embed one code chunk in another code chunk by enclosing its label in \texttt{\textless{}\textless{}\textgreater{}\textgreater{}}, then \textbf{knitr} will automatically expand the string \texttt{\textless{}\textless{}label\textgreater{}\textgreater{}} to the actual code. For example, you can create an R function in this way:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{We define a function to convert Fahrenheit to Celsius.}

\BaseNTok{```\{r, f2c\}}
\BaseNTok{F2C <- function(x) \{}
\BaseNTok{  <<check-arg>>}
\BaseNTok{  <<convert>>}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{First, we check if the input value is numeric:}

\BaseNTok{```\{r, check-arg, eval=FALSE\}}
\BaseNTok{  if (!is.numeric(x)) stop("The input must be numeric!")}
\BaseNTok{```}

\NormalTok{Then we do the actual conversion:}

\BaseNTok{```\{r, convert, eval=FALSE\}}
\BaseNTok{  (x - 32) * 5/ 9}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

This is based on one of the main ideas of \href{https://en.wikipedia.org/wiki/Literate_programming}{Literate Programming,} which was brought forward by Donald Knuth. The advantage of this technique is that you can split (complex) code into smaller parts, write each part in a separate code chunk, and explain them with narratives. All parts can be composed into the main code chunk to be executed.

For the above example, the first code chunk (with the label \texttt{f2c}) will become:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, f2c\}}
\BaseNTok{F2C <- function(x) \{}
\BaseNTok{  if (!is.numeric(x)) stop("The input must be numeric!")}
\BaseNTok{  (x - 32) * 5/ 9}
\BaseNTok{\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can embed an arbitrary number of other code chunks in one code chunk. The embedding can also be recursive. For example, you may embed chunk A into chunk B, and chunk B into chunk C. Then chunk C will include code from chunk A via chunk B.

The marker \texttt{\textless{}\textless{}label\textgreater{}\textgreater{}} does not have to be on a separate line. It can be embedded anywhere in a code chunk.

\hypertarget{same-label}{%
\subsection{Use the same chunk label in another chunk}\label{same-label}}

If you want to use exactly the same code chunk twice or more times, you may define the chunk with a label, and create more code chunks with the same label but leave the chunk content empty, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Here is a code chunk that is not evaluated:}

\BaseNTok{```\{r, chunk-one, eval=FALSE\}}
\BaseNTok{1 + 1}
\BaseNTok{2 + 2}
\BaseNTok{```}

\NormalTok{Now we actually evaluate it:}

\BaseNTok{```\{r, chunk-one, eval=TRUE\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

We used the chunk label ``chunk-one'' twice in the above example, and the second chunk just reuses code from the first chunk.

We recommend that you do not use this method to run a code chunk more than once to generate plots (or other files), because plot files created from a latter chunk may overwrite files from a previous chunk. It is okay if only one of such chunks uses the chunk option \texttt{eval\ =\ TRUE}, and all other chunks use \texttt{eval\ =\ FALSE}.

\hypertarget{ref-label}{%
\subsection{Use reference labels (*)}\label{ref-label}}

The chunk option \texttt{ref.label} takes a vector of chunk labels to retrieve the content of these chunks. For example, the code chunk with the label \texttt{chunk-a} is the combination of \texttt{chunk-c} and \texttt{chunk-b} below:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r chunk-a, ref.label=c('chunk-c', 'chunk-b')\}}
\BaseNTok{```}

\BaseNTok{```\{r chunk-b\}}
\BaseNTok{# this is the chunk b}
\BaseNTok{1 + 1}
\BaseNTok{```}

\BaseNTok{```\{r chunk-c\}}
\BaseNTok{# this is the chunk c}
\BaseNTok{2 + 2}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

In other words, \texttt{chunk-a} is essentially this:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r chunk-a\}}
\BaseNTok{# this is the chunk c}
\BaseNTok{2 + 2}
\BaseNTok{# this is the chunk b}
\BaseNTok{1 + 1}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The chunk option \texttt{ref.label} has provided a very flexible way of reorganizing code chunks in a document without resorting to cut-and-paste. It does not matter if the code chunks referenced are before or after the code chunk that uses \texttt{ref.label}. An early code chunk can reference a later chunk.

There is an application of this chunk option in Section \ref{code-appendix}.

\hypertarget{load-cache}{%
\section{Use an object before it is created (*)}\label{load-cache}}

All code in a \textbf{knitr} document, including the code in code chunks and inline R expressions, is executed in the linear order from beginning to end. In theory, you cannot use a variable before it is assigned a value. However, in certain cases, we may want to mention the value of a variable earlier in the document. For example, it is common to present a result in the abstract of an article, but the result is actually computed later in the document. Below is an example that illustrates the idea but will not compile:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: An important report}
\NormalTok{abstract: >}
\NormalTok{  In this analysis, the average value of}
  \BaseNTok{`x`}\NormalTok{ is }\BaseNTok{`r mx`}\NormalTok{.}
\NormalTok{---}

\NormalTok{We create the object }\BaseNTok{`mx`}\NormalTok{ in the following chunk:}

\BaseNTok{```\{r\}}
\BaseNTok{x <- 1:100}
\BaseNTok{mx <- mean(x)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

To solve this problem, the value of the object has to be saved somewhere and loaded the next time when the document is compiled. Please note that this means the document has to be compiled at least twice. Below is one possible solution using the \texttt{saveRDS()} function:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{mx <- if (file.exists('mean.rds')) \{}
\BaseNTok{  readRDS('mean.rds')}
\BaseNTok{\} else \{}
\BaseNTok{  "The value of `mx` is not available yet"}
\BaseNTok{\}}
\BaseNTok{```}

\NormalTok{---}
\NormalTok{title: An important report}
\NormalTok{abstract: >}
\NormalTok{  In this analysis, the average value of}
  \BaseNTok{`x`}\NormalTok{ is }\BaseNTok{`r mx`}\NormalTok{.}
\NormalTok{---}

\NormalTok{We create the object }\BaseNTok{`mx`}\NormalTok{ in the following chunk:}

\BaseNTok{```\{r\}}
\BaseNTok{x <- 1:100}
\BaseNTok{mx <- mean(x)}
\BaseNTok{saveRDS(mx, 'mean.rds')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The first time when you compile this document, you will see the phrase ``The value of \texttt{mx} is not available yet'' in the abstract. Later when you compile it again, you will see the actual value of \texttt{mx}.

The function \texttt{knitr::load\_cache()} is an alternative solution, which allows you to load the value of an object from a specific code chunk after the chunk has been cached. The idea is similar to the above example, but it will save you the effort of manually saving and loading an object, because the object is automatically saved to the cache database, and you only need to load it via \texttt{load\_cache()}. Below is the simplified example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: An important report}
\NormalTok{abstract: >}
\NormalTok{  In this analysis, the average value of}
  \BaseNTok{`x`}\NormalTok{ is }\BaseNTok{`r knitr::load_cache('mean-x', 'mx')`}\NormalTok{.}
\NormalTok{---}

\NormalTok{We create the object }\BaseNTok{`mx`}\NormalTok{ in the following chunk:}

\BaseNTok{```\{r mean-x, cache=TRUE\}}
\BaseNTok{x <- 1:100}
\BaseNTok{mx <- mean(x)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

In this example, we added a chunk label \texttt{mean-x} to the R code chunk (which is passed to the \texttt{load\_cache()} function), and cached it using the chunk option \texttt{cache\ =\ TRUE}. All objects in this code chunk will be saved to the cache database. Again, you will have to compile this document at least twice, so the object \texttt{mx} can be correctly loaded from the cache database. If the value of \texttt{mx} is not going to be changed in the future, you do not need to compile the document one more time.

If you do not have to specify the object name in \texttt{load\_cache()} in the second argument, the whole cache database will be loaded into the current environment, and you can use any objects cache database before these objects are created later in the document, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{load_cache}\NormalTok{(}\StringTok{"mean-x"}\NormalTok{)}
\NormalTok{x  }\CommentTok{# the object `x`}
\NormalTok{mx  }\CommentTok{# the object `mx`}
\end{Highlighting}
\end{Shaded}

\hypertarget{knit-exit}{%
\section{Exit knitting early}\label{knit-exit}}

Sometimes we may want to exit knitting early and not at the end of the document. For example, we may be working on some analysis and only wish to share the first half of the results, or we may still be working on code at the bottom that is not yet complete. In these situations, we could consider using the \texttt{knit\_exit()} function in a code chunk, which will end the knitting process after that chunk.

Below is a simple example, where we have a very simple chunk followed by a more time-consuming one:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{1 + 1}
\BaseNTok{knitr::knit_exit()}
\BaseNTok{```}

\NormalTok{You will only see the above content in the output.}

\BaseNTok{```\{r\}}
\BaseNTok{Sys.sleep(100)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Normally you have to wait for 100 seconds, but since we have called \texttt{knit\_exit()}, the rest of the document will be ignored.

\hypertarget{fig-chunk}{%
\section{Generate a plot and display it elsewhere}\label{fig-chunk}}

Normally plots generated in a code chunk are displayed beneath the code chunk, but you can choose to show them elsewhere and (optionally) hide them in the code chunk. Below is an example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{We generate a plot in this code chunk but do not show it:}

\BaseNTok{```\{r cars-plot, dev='png', fig.show='hide'\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\NormalTok{After another paragraph, we introduce the plot:}

\NormalTok{![A nice plot.](}\BaseNTok{`r knitr::fig_chunk('cars-plot', 'png')`}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In the code chunk, we used the chunk option \texttt{fig.show=\textquotesingle{}hide\textquotesingle{}} to hide the plot temporarily. Then in another paragraph, we called the function \texttt{knitr::fig\_chunk()} to retrieve the path of the plot file, which is usually like \texttt{test\_files/figure-html/cars-plot-1.png}. You need to pass the chunk label and the graphical device name to \texttt{fig\_chunk()} for it to calculate the plot file path.

You may see \url{https://stackoverflow.com/a/46305297/559676} for an application of \texttt{fig\_chunk()} to \textbf{blogdown} websites. This function works for any R Markdown output formats. It can be particularly helpful for presenting plots on slides, because the screen space is often limited on slide pages. You may present code on a slide, and reveal the plot on a different slide.

\hypertarget{global-device}{%
\section{Modify a plot in a previous code chunk}\label{global-device}}

By default, \textbf{knitr} opens a new graphical device to record plots for each new code chunk. This brings a problem: you cannot easily modify a plot from a previous code chunk, because the previous graphical device has been closed. This is usually problematic for base R graphics (not so for grid graphics such as those created from \textbf{ggplot2} because plots can be saved to R objects). For example, if we draw a plot in one code chunk, and add a line to the plot in a later chunk, R will signal an error saying that a high-level plot has not been created, so it could not add the line.

If you want the graphical device to remain open for all code chunks, you may set a \textbf{knitr} package option in the beginning of your document:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_knit}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{global.device =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Please note that it is \texttt{opts\_knit} instead of the more frequently used \texttt{opts\_chunk}. You may see the Stack Overflow post \url{https://stackoverflow.com/q/17502050} for an example.

When you no longer need this global graphical device, you can set the option to \texttt{FALSE}. Here is a full example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Using a global graphical device to record plots"}
\NormalTok{---}

\NormalTok{First, turn on a global graphical device:}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{knitr::opts_knit$set(global.device = TRUE)}
\BaseNTok{```}

\NormalTok{Draw a plot:}

\BaseNTok{```\{r\}}
\BaseNTok{par(mar = c(4, 4, 0.1, 0.1))}
\BaseNTok{plot(cars)}
\BaseNTok{```}

\NormalTok{Add a line to the plot in the previous code chunk:}

\BaseNTok{```\{r\}}
\BaseNTok{fit <- lm(dist ~ speed, data = cars)}
\BaseNTok{abline(fit)}
\BaseNTok{```}

\NormalTok{No longer use the global device:}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{knitr::opts_knit$set(global.device = FALSE)}
\BaseNTok{```}

\NormalTok{Draw another plot:}

\BaseNTok{```\{r\}}
\BaseNTok{plot(pressure, type = 'b')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{opts-template}{%
\section{Save a group of chunk options and reuse them (*)}\label{opts-template}}

If you frequently use some chunk options, you may save them as a group and reuse them later only using the group name. This can be done with \texttt{knitr::opts\_template\$set(name\ =\ list(options))}, and then you can use the chunk option \texttt{opts.label} to refer to the group name. For example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, setup, include=FALSE\}}
\BaseNTok{knitr::opts_template$set(fullwidth = list(}
\BaseNTok{  fig.width = 10, fig.height = 6,}
\BaseNTok{  fig.retina = 2, out.width = '100%'}
\BaseNTok{))}
\BaseNTok{```}

\BaseNTok{```\{r, opts.label='fullwidth'\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

With \texttt{opts.label\ =\ \textquotesingle{}fullwidth\textquotesingle{}}, \textbf{knitr} will read chunk options from \texttt{knitr::opts\_template}, and apply them to the current chunk. This can save you some typing effort. If a chunk option is to be used globally in a document, you should consider setting it globally (see Chapter \ref{chunk-options}).

You can override options read from \texttt{opts.label}, e.g., if you set \texttt{fig.height\ =\ 7} in the chunk below, the actual \texttt{fig.height} will be \texttt{7} instead of \texttt{6}.

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, opts.label='fullwidth', fig.height=7\}}
\BaseNTok{plot(cars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can save an arbitrary number of grouped options, e.g., \texttt{knitr::opts\_template\$set(group1\ =\ list(...),\ group2\ =\ list(...))}.

\hypertarget{knit-expand}{%
\section{\texorpdfstring{Use \texttt{knitr::knit\_expand()} to generate Rmd source}{Use knitr::knit\_expand() to generate Rmd source}}\label{knit-expand}}

The function \texttt{knitr::knit\_expand()} ``expands'' an expression in \texttt{\{\{\ \}\}} (by default) to its value, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{knit_expand}\NormalTok{(}\DataTypeTok{text =} \StringTok{"The value of `pi` is \{\{pi\}\}."}\NormalTok{)}
\CommentTok{## [1] "The value of `pi` is 3.14159265358979."}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{knit_expand}\NormalTok{(}
  \DataTypeTok{text =} \StringTok{"The value of `a` is \{\{a\}\}, so `a + 1` is \{\{a+1\}\}."}\NormalTok{,}
  \DataTypeTok{a =} \KeywordTok{round}\NormalTok{(}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{), }\DecValTok{4}\NormalTok{)}
\NormalTok{)}
\CommentTok{## [1] "The value of `a` is -0.3005, so `a + 1` is 0.6995."}
\end{Highlighting}
\end{Shaded}

This means if have an Rmd document that contains some dynamic parts in \texttt{\{\{\ \}\}}, you may apply \texttt{knit\_expand()} on the document, and then call \texttt{knit()} to compile it. For example, here is a template document named \texttt{template.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Regression on \{\{i\}\}}

\BaseNTok{```\{r lm-\{\{i\}\}\}}
\BaseNTok{lm(mpg ~ \{\{i\}\}, data = mtcars)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

We can build linear regression models using \texttt{mpg} against all other variables one by one in the \texttt{mtcars} dataset:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, echo=FALSE, results='asis'\}}
\BaseNTok{src = lapply(setdiff(names(mtcars), 'mpg'), function(i) \{}
\BaseNTok{  knitr::knit_expand('template.Rmd')}
\BaseNTok{\})}
\BaseNTok{res = knitr::knit_child(text = unlist(src), quiet = TRUE)}
\BaseNTok{cat(res, sep = '\textbackslash{}n')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

If you find it difficult to understand this example, please see Section \ref{results-asis} for the meaning of the chunk option \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}}, and Section \ref{child-document} for the usage of \texttt{knitr::knit\_child()}.

\hypertarget{duplicate-label}{%
\section{Allow duplicate labels in code chunks (*)}\label{duplicate-label}}

By default, \textbf{knitr} does not allow duplicate code chunk labels in the document. Duplicate labels will result in an error when the document is knitted. This occurs most frequently when a code chunk is copied and pasted within a document. You may have seen an error message like this:

\begin{verbatim}
processing file: myfile.Rmd
Error in parse_block(g[-1], g[1], params.src, markdown_mode) :
  Duplicate chunk label 'cars'
Calls: <Anonymous> ... process_file -> split_file -> lapply ->
  FUN -> parse_block
Execution halted
\end{verbatim}

However, there are scenarios where we may wish to allow duplicate labels. For example, if we have one parent document \texttt{parent.Rmd} in which we knit the child document multiple times, it will fail:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# settings}
\NormalTok{settings <-}\StringTok{ }\KeywordTok{list}\NormalTok{(...)}

\CommentTok{# run once}
\KeywordTok{knit_child}\NormalTok{(}\StringTok{"useful_analysis.Rmd"}\NormalTok{)}

\CommentTok{# new settings}
\NormalTok{settings <-}\StringTok{ }\KeywordTok{list}\NormalTok{(...)}

\CommentTok{# run again}
\KeywordTok{knit_child}\NormalTok{(}\StringTok{"useful_analysis.Rmd"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In this scenario, we can allow duplicate labels by setting this global option in R \emph{before} the child document is knitted:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{knitr.duplicate.label =} \StringTok{"allow"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to allow duplicate labels in the main document instead of the child document, you have to set this option \emph{before} \texttt{knitr::knit()} is called. One possible way to achieve that is to set the option in your \texttt{\textasciitilde{}/.Rprofile} file (see the help page \texttt{?Rprofile} for more information).

You should set this option with caution. As with most error messages, they are there for a reason. Allowing duplicate chunks can create silent problems with figures and cross-references. For example, in theory, if two code chunks have the same label and both chunks generate plots, their plot files will overwrite each other (without error or warning messages), because the filenames of plots are determined by the chunk labels. With the option \texttt{knitr.duplicate.label\ =\ "allow"}, \textbf{knitr} will silently change the duplicate labels by adding numeric suffixes. For example, for the two code chunks:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, test\}}
\BaseNTok{plot(1:10)}
\BaseNTok{```}

\BaseNTok{```\{r, test\}}
\BaseNTok{plot(10:1)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The second label will be silently changed to \texttt{test-1}. This may avoid overwriting the plot from the chunk with the label \texttt{test}, but it also makes the chunk label unpredictable, so you may have difficulties in cross-referencing figures (see Section \ref{cross-ref}), because the cross-references are also based on chunk labels.

\hypertarget{cache-rds}{%
\section{A more transparent caching mechanism}\label{cache-rds}}

If you feel the caching mechanism of \textbf{knitr} introduced in Section \ref{cache} is too complicated (it is!), you may consider a simpler caching mechanism based on the function \texttt{xfun::cache\_rds()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \CommentTok{# write your time-consuming code in this expression}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The tricky thing about \textbf{knitr}'s caching is how it decides when to invalidate the cache. For \texttt{xfun::cache\_rds()}, it is much clearer: the first time you pass an R expression to this function, it evaluates the expression and save the result to a \texttt{.rds} file; the next time you run \texttt{cache\_rds()} again, it reads the \texttt{.rds} file and returns the result immediately without evaluating the expression again. The most obvious way to invalidate the cache is to delete the \texttt{.rds} file. If you do not want to manually delete it, you may call \texttt{xfun::cache\_rds()} with the argument \texttt{rerun\ =\ TRUE}.

When \texttt{xfun::cache\_rds()} is called inside a code chunk in a \textbf{knitr} source document, the path of the \texttt{.rds} file is determined by the chunk option \texttt{cache.path} and the chunk label. For example, for a code chunk with the chunk label \texttt{foo} in the Rmd document \texttt{input.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, foo\}}
\BaseNTok{res <- xfun::cache_rds(\{}
\BaseNTok{  Sys.sleep(3)}
\BaseNTok{  1:10}
\BaseNTok{\})}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The path of the \texttt{.rds} file will be of the form \texttt{input\_cache/FORMAT/foo\_HASH.rds}, where \texttt{FORMAT} is the Pandoc output format name (e.g., \texttt{html} or \texttt{latex}), and \texttt{HASH} is a MD5 hash that contains 32 hexadecimal digits (consisting a-z and 0-9), e.g., \texttt{input\_cache/html/foo\_7a3f22c4309d400eff95de0e8bddac71.rds}.

As documented on the help page \texttt{?xfun::cache\_rds}, there are two common cases in which you may want to invalidate the cache: 1) the code in the expression to be evaluated has changed; 2) the code uses an external variable, and the value of that variable has changed. Next we will explain how these two ways of cache invalidation work, as well as how to keep multiple copies of the cache corresponding to different versions of the code.

\hypertarget{invalidate-the-cache-by-changing-code-in-the-expression}{%
\subsection{Invalidate the cache by changing code in the expression}\label{invalidate-the-cache-by-changing-code-in-the-expression}}

When you change the code in \texttt{cache\_rds()} (e.g., from \texttt{cache\_rds(\{x\ +\ 1\})} to \texttt{cache\_rds(\{x\ +\ 2\})}), the cache will be automatically invalidated and the expression will be re-evaluated. However, please note that changes in white spaces or comments do not matter. Or generally speaking, as long as the change does not affect the parsed expression, the cache will not be invalidated. For example, the two expressions passed to \texttt{cache\_rds()} below are essentially identical:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \KeywordTok{Sys.sleep}\NormalTok{(}\DecValTok{3}\NormalTok{  );}
\NormalTok{  x<-}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{;  }\CommentTok{# semi-colons won't matter}
\NormalTok{  x}\OperatorTok{+}\DecValTok{1}\NormalTok{;}
\NormalTok{\})}

\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \KeywordTok{Sys.sleep}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}  \CommentTok{# a comment}
\NormalTok{  x }\OperatorTok{+}
\StringTok{    }\DecValTok{1}  \CommentTok{# feel free to make any changes in white spaces}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Hence if you have executed \texttt{cache\_rds()} on the first expression, the second expression will be able to take advantage of the cache. This feature is helpful because it allows you make cosmetic changes in your code without invalidating the cache.

If you are not sure if two versions of code are equivalent, you may try the \texttt{parse\_code()} below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{parse_code <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(expr) \{}
  \KeywordTok{deparse}\NormalTok{(}\KeywordTok{substitute}\NormalTok{(expr))}
\NormalTok{\}}
\CommentTok{# white spaces and semi-colons do not matter}
\KeywordTok{parse_code}\NormalTok{(\{x}\OperatorTok{+}\DecValTok{1}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "{"         "    x + 1" "}"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{parse_code}\NormalTok{(\{ x   }\OperatorTok{+}\StringTok{    }\DecValTok{1}\NormalTok{; \})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "{"         "    x + 1" "}"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# left arrow and right arrow are equivalent}
\KeywordTok{identical}\NormalTok{(}\KeywordTok{parse_code}\NormalTok{(\{x <-}\StringTok{ }\DecValTok{1}\NormalTok{\}), }\KeywordTok{parse_code}\NormalTok{(\{}\DecValTok{1}\NormalTok{ ->}\StringTok{ }\NormalTok{x\}))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\hypertarget{invalidate-the-cache-by-changes-in-global-variables}{%
\subsection{Invalidate the cache by changes in global variables}\label{invalidate-the-cache-by-changes-in-global-variables}}

There are two types of variables in an expression: global variables and local variables. Global variables are those created outside the expression, and local variables are those created inside the expression. If the value of a global variable in the expression has changed. For example, in the expression below, if \texttt{y} has changed, you are most likely to want to invalidate the cache and rerun the expression, otherwise you still get the result from the old value of \texttt{y}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y <-}\StringTok{ }\DecValTok{2}

\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\NormalTok{y}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

To invalidate the cache when \texttt{y} has changed, you may let \texttt{cache\_rds()} know through the \texttt{hash} argument that \texttt{y} needs to be considered when deciding if the cache should be invalidated:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\NormalTok{y}
\NormalTok{\}, }\DataTypeTok{hash =} \KeywordTok{list}\NormalTok{(y))}
\end{Highlighting}
\end{Shaded}

When the value of the \texttt{hash} argument is changed, the 32-digit hash in the cache filename (as mentioned earlier) will change accordingly, therefore the cache will be invalidated. This provides a way to specify the cache's dependency on other R objects. For example, if you want the cache to be dependent on the version of R, you may specify the dependency like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\NormalTok{y}
\NormalTok{\}, }\DataTypeTok{hash =} \KeywordTok{list}\NormalTok{(y, }\KeywordTok{getRversion}\NormalTok{()))}
\end{Highlighting}
\end{Shaded}

Or if you want the cache to depend on when a data file was last modified:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"data.csv"}\NormalTok{)}
\NormalTok{  x[[}\DecValTok{1}\NormalTok{]] }\OperatorTok{+}\StringTok{ }\NormalTok{y}
\NormalTok{\}, }\DataTypeTok{hash =} \KeywordTok{list}\NormalTok{(y, }\KeywordTok{file.mtime}\NormalTok{(}\StringTok{"data.csv"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

If you do not want to provide this list of global variables to the \texttt{hash} argument, you may try \texttt{hash\ =\ "auto"} instead, which tells \texttt{cache\_rds()} to try to figure out all global variables automatically and use a list of their values as the value for the \texttt{hash} argument, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\NormalTok{y }\OperatorTok{+}\StringTok{ }\NormalTok{z  }\CommentTok{# y and z are global variables}
\NormalTok{\}, }\DataTypeTok{hash =} \StringTok{"auto"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This is equivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
\NormalTok{  x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{  x }\OperatorTok{+}\StringTok{ }\NormalTok{y }\OperatorTok{+}\StringTok{ }\NormalTok{z  }\CommentTok{# y and z are global variables}
\NormalTok{\}, }\DataTypeTok{hash =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ y, }\DataTypeTok{z =}\NormalTok{ z))}
\end{Highlighting}
\end{Shaded}

The global variables are identified by \texttt{codetools::findGlobals()} when \texttt{hash\ =\ "auto"}, which may not be completely reliable. You know your own code the best, so we recommend that you specify the list of values explicitly in the \texttt{hash} argument if you want to be completely sure which variables can invalidate the cache.

\hypertarget{keep-multiple-copies-of-the-cache}{%
\subsection{Keep multiple copies of the cache}\label{keep-multiple-copies-of-the-cache}}

Since cache is typically used for time-consuming code, perhaps you should invalidate it conservatively. You might regret invalidating the cache too soon or aggressively, because in case you should need an older version of the cache again, you would have to wait for a long time for the computing to be redone.

The \texttt{clean} argument of \texttt{cache\_rds()} allows you to keep older copies of the cache if you set it to \texttt{FALSE}. You can also set the global R option \texttt{options(xfun.cache\_rds.clean\ =\ FALSE)} if you want this to be the default behavior throughout the entire R session. By default, \texttt{clean\ =\ TRUE} and \texttt{cache\_rds()} will try to delete the older cache every time. Setting \texttt{clean\ =\ FALSE} can be useful if you are still experimenting with the code. For example, you can cache two versions of a linear model:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \KeywordTok{lm}\NormalTok{(dist }\OperatorTok{~}\StringTok{ }\NormalTok{speed, }\DataTypeTok{data =}\NormalTok{ cars)}
\NormalTok{\}, }\DataTypeTok{clean =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{model <-}\StringTok{ }\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \KeywordTok{lm}\NormalTok{(dist }\OperatorTok{~}\StringTok{ }\NormalTok{speed }\OperatorTok{+}\StringTok{ }\KeywordTok{I}\NormalTok{(speed}\OperatorTok{^}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ cars)}
\NormalTok{\}, }\DataTypeTok{clean =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After you decide which model to use, you can set \texttt{clean\ =\ TRUE} again, or delete this argument (so the default \texttt{TRUE} is used).

\hypertarget{comparison-with-knitrs-caching}{%
\subsection{\texorpdfstring{Comparison with \textbf{knitr}'s caching}{Comparison with knitr's caching}}\label{comparison-with-knitrs-caching}}

You may wonder when to use \textbf{knitr}'s caching (i.e., set the chunk option \texttt{cache\ =\ TRUE}), and when to use \texttt{xfun::cache\_rds()} in a \textbf{knitr} source document. The biggest disadvantage of \texttt{xfun::cache\_rds()} is that it does not cache side-effects (but only the value of the expression), whereas \textbf{knitr} does. Some side-effects may be useful, such as printed output or plots. For example, the text output and the plot will be lost when \texttt{cache\_rds()} loads the cache the next time, and only the value \texttt{1:10} will be returned:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{cache_rds}\NormalTok{(\{}
  \KeywordTok{print}\NormalTok{(}\StringTok{"Hello world!"}\NormalTok{)}
  \KeywordTok{plot}\NormalTok{(cars)}
  \DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

By comparison, for a code chunk with the option \texttt{cache\ =\ TRUE}, everything will be cached:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, cache=TRUE\}}
\BaseNTok{print("Hello world!")}
\BaseNTok{plot(cars)}
\BaseNTok{1:10}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The biggest disadvantage of \textbf{knitr}'s caching (and also what users complain most frequently about) is that your cache might be inadvertently invalidated, because the cache is determined by too many factors. For example, any changes in chunk options can invalidate the cache,\footnote{This is the default behavior, and you can change it. See \url{https://yihui.org/knitr/demo/cache/} for how you can make the cache more granular, so not all chunk options affect the cache.} but some chunk options may not be relevant to the computing. In the code chunk below, changing the chunk option \texttt{fig.width\ =\ 6} to \texttt{fig.width\ =\ 10} should not invalidate the cache, but it will:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, cache=TRUE, fig.width=6\}}
\BaseNTok{# there are no plots in this chunk}
\BaseNTok{x <- rnorm(1000)}
\BaseNTok{mean(x)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Actually \textbf{knitr} caching is quite powerful and flexible, and its behavior can be tweaked in many ways. As its author, I often doubt if it is worth introducing these lesser-known features, because you may end up spending much more time on learning and understanding how the cache works than the time the actual computing takes.

In case it is not clear, \texttt{xfun::cache\_rds()} is a general way for caching the computing, and it works anywhere (not necessarily inside \textbf{knitr} documents). Apparently \textbf{knitr}'s caching only works in \textbf{knitr} documents.

\hypertarget{other-languages}{%
\chapter{Other Languages}\label{other-languages}}

Besides the R language, many other languages are supported in R Markdown through the \textbf{knitr} package. The language name is indicated by the first word in the curly braces after the three opening backticks. For example, the little \texttt{r} in \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}} indicates that the code chunk contains R code, and \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{python\}} is a Python code chunk. In this chapter, we show a few languages that you may not be familiar with.

In \textbf{knitr}, each language is supported through a language engine. Language engines are essentially functions that takes the source code and options of a chunk as the input, and returns a character string as the output. They are managed through the object \texttt{knitr::knit\_engines}. You may check the existing engines via:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(knitr}\OperatorTok{::}\NormalTok{knit_engines}\OperatorTok{$}\KeywordTok{get}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "awk"         "bash"        "coffee"      "gawk"        "groovy"      "haskell"     "lein"       
##  [8] "mysql"       "node"        "octave"      "perl"        "psql"        "Rscript"     "ruby"       
## [15] "sas"         "scala"       "sed"         "sh"          "stata"       "zsh"         "highlight"  
## [22] "Rcpp"        "tikz"        "dot"         "c"           "cc"          "fortran"     "fortran95"  
## [29] "asy"         "cat"         "asis"        "stan"        "block"       "block2"      "js"         
## [36] "css"         "sql"         "go"          "python"      "julia"       "sass"        "scss"       
## [43] "theorem"     "lemma"       "corollary"   "proposition" "conjecture"  "definition"  "example"    
## [50] "exercise"    "proof"       "remark"      "solution"    "upper"       "py"
\end{verbatim}

At the moment, most code chunks of non-R languages are executed independently. For example, all \texttt{bash} code chunks in the same document are executed separately in their own sessions, so a later \texttt{bash} code chunk cannot use variables created in a previous \texttt{bash} chunk, and the changed working directory (via \texttt{cd}) will not be persistent across different \texttt{bash} chunks. Only R, Python, and Julia code chunks are executed in the same session, but please note that all R code chunks are executed in the same R session, and all Python code chunks are executed in the same Python session, etc. The R session and the Python session are two different sessions, but it is possible to access or manipulate objects of one session from another session (see Section \ref{eng-python}).

\href{https://bookdown.org/yihui/rmarkdown/language-engines.html}{Section 2.7} of the R Markdown Definitive Guide \citep{rmarkdown2018} has shown examples of using Python, Shell, SQL, Rcpp, Stan, JavaScript, CSS, Julia, C, and Fortran code in R Markdown. In this chapter, we will show more language engines, and you may find more examples in the repository at \url{https://github.com/yihui/knitr-examples} (look for filenames that contain the word ``engine'').

First, let's reveal how a language engine works by registering a custom language engine.

\hypertarget{custom-engine}{%
\section{Register a custom language engine (*)}\label{custom-engine}}

You can register a custom language engine via the \texttt{knitr::knit\_engines\$set()} method, which accepts a function as its input, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_engines}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{foo =} \ControlFlowTok{function}\NormalTok{(options) \{}
  \CommentTok{# the source code is in options$code; just do whatever you want with it}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

This registers the \texttt{foo} engine, and you will be able to use a code chunk that starts with \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{foo\}}.

The engine function has one argument \texttt{options}, which is a list of chunk options of the code chunk, among which you can access the source code of the chunk as a character vector in \texttt{options\$code}. For example, for the code chunk:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{foo\}}
\BaseNTok{1 + 1}
\BaseNTok{2 + 2}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The \texttt{code} element of \texttt{options} would be a character vector \texttt{c(\textquotesingle{}1\ +\ 1\textquotesingle{},\ \textquotesingle{}2\ +\ 2\textquotesingle{})}.

Language engines do not really have to deal with computer languages, but can process any text in a code chunk. First, we show a simple example of an engine that converts the content of a code chunk to uppercase:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_engines}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{upper =} \ControlFlowTok{function}\NormalTok{(options) \{}
\NormalTok{  code <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(options}\OperatorTok{$}\NormalTok{code, }\DataTypeTok{collapse =} \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (options}\OperatorTok{$}\NormalTok{eval) }
    \KeywordTok{toupper}\NormalTok{(code) }\ControlFlowTok{else}\NormalTok{ code}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The key is that we apply the function \texttt{toupper} to the ``code'', and return the result as a single character string (by concatenating all lines of code by \texttt{\textbackslash{}n}). Note that \texttt{toupper()} is applied only when the chunk option \texttt{eval\ =\ TRUE}, otherwise the original string is returned. This shows you how to make use of chunk options like \texttt{eval} inside the engine function. Similarly, you may consider adding \texttt{if\ (options\$results\ ==\ \textquotesingle{}hide\textquotesingle{})\ return()} to the function body to hide the output when the chunk option \texttt{results\ =\ \textquotesingle{}hide\textquotesingle{}}. Below is an example chunk that uses the \texttt{upper} engine, with its output:

\begin{quote}
\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{upper\}}
\BaseNTok{Hello, **knitr** engines!}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

HELLO, \textbf{KNITR} ENGINES!
\end{quote}

Next we show an example of an alternative Python engine\footnote{In practice, you should use the built-in \texttt{python} engine instead, which is based on the \textbf{reticulate} package and supports Python code chunks much better (see \ref{eng-python}).} named \texttt{py} and implemented by simply calling the \texttt{python} command via \texttt{system2()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{knit_engines}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{py =} \ControlFlowTok{function}\NormalTok{(options) \{}
\NormalTok{  code <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(options}\OperatorTok{$}\NormalTok{code, }\DataTypeTok{collapse =} \StringTok{'}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{)}
\NormalTok{  out  <-}\StringTok{ }\KeywordTok{system2}\NormalTok{(}
    \StringTok{'python'}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{'-c'}\NormalTok{, }\KeywordTok{shQuote}\NormalTok{(code)), }\DataTypeTok{stdout =} \OtherTok{TRUE}
\NormalTok{  )}
\NormalTok{  knitr}\OperatorTok{::}\KeywordTok{engine_output}\NormalTok{(options, code, out)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

To fully understand the above engine function, you need to know that:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Given Python code as a character string (\texttt{code} in the above function), we can execute the code via a command-line call \texttt{python\ -c\ \textquotesingle{}code\textquotesingle{}}. That is what \texttt{system2()} does. We collect the (text) output by specifying \texttt{stdout\ =\ TRUE} in \texttt{system2()}.
\item
  You can pass the chunk options, source code, and text output to the function \texttt{knitr::engine\_output()} to generate the final output. This function deals with common chunk options like \texttt{echo\ =\ FALSE} and \texttt{results\ =\ \textquotesingle{}hide\textquotesingle{}}, so you do not need to take care of these cases.
\end{enumerate}

A lot of language engines in \textbf{knitr} are defined in this way (i.e., using \texttt{system2()} to execute commands corresponding to languages). If you are curious about the technical details, you may check out the source code of most language engines in the R source code here: \url{https://github.com/yihui/knitr/blob/master/R/engine.R}.

Now we can use the new engine \texttt{py}, e.g.,

\begin{quote}
\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{py\}}
\BaseNTok{print(1 + 1)}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2
\end{verbatim}
\end{quote}

You can even override existing language engines via \texttt{knitr::knit\_engines\$set()}, if you are sure that your versions are necessary or better than the existing ones. Usually we do not recommend that you do this because it may surprise users who are familiar with existing engines, but we want to make you aware of this possibility anyway.

\hypertarget{eng-python}{%
\section{Run Python code and interact with Python}\label{eng-python}}

TODO

\hypertarget{eng-asis}{%
\section{\texorpdfstring{Conditional content via the \texttt{asis} engine}{Conditional content via the asis engine}}\label{eng-asis}}

As its name indicates, the \texttt{asis} engine writes out the chunk content as is. The advantage of using this engine is that you can include some content conditionally---the display of the chunk content is decided by the chunk option \texttt{echo}. When \texttt{echo\ =\ FALSE}, the chunk will be hidden. Below is a simple example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r\}}
\BaseNTok{getRandomNumber <- function() \{}
\BaseNTok{  sample(1:6, 1)}
\BaseNTok{\}}
\BaseNTok{```}

\BaseNTok{```\{asis, echo = getRandomNumber() == 4\}}
\BaseNTok{According to https://xkcd.com/221/, we just generated}
\BaseNTok{a **true** random number!}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The text in the \texttt{asis} chunk will be displayed only if the condition \texttt{getRandomNumber()\ ==\ 4} is (randomly) true.

\hypertarget{eng-bash}{%
\section{Execute Shell scripts}\label{eng-bash}}

You can run Shell scripts via the \texttt{bash} or \texttt{sh} or \texttt{zsh} engine, depending on which shell you prefer. Below is a \texttt{bash} example, with the chunk header \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{bash\}}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ls}\NormalTok{ *.Rmd }\KeywordTok{|} \FunctionTok{head}\NormalTok{ -n 5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 00-authors.Rmd
## 01-installation.Rmd
## 02-overview.Rmd
## 03-basics.Rmd
## 04-content.Rmd
\end{verbatim}

Please note that \texttt{bash} is invoked with the R function \texttt{system2()}, and it will ignore profile files like \texttt{\textasciitilde{}/.bash\_profile} and \texttt{\textasciitilde{}/.bash\_login}, in which you may have defined command aliases or modified environment variables like the \texttt{PATH} variable. If you want these profile files to be executed just like when you use the terminal, you may pass the argument \texttt{-l} to \texttt{bash} via \texttt{engine.opts}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{bash, engine.opts='-l'\}}
\BaseNTok{echo $PATH}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

If you want to enable the \texttt{-l} argument globally for all \texttt{bash} chunks, you may set it in the global chunk option in the beginning of your document:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\NormalTok{opts_chunk}\OperatorTok{$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{engine.opts =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{bash =} \StringTok{"-l"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

You can also pass other arguments to \texttt{bash} by providing them as a character vector to the chunk option \texttt{engine.opts}.

\hypertarget{d3}{%
\section{Visualization with D3}\label{d3}}

The R package \textbf{r2d3} (\url{https://rstudio.github.io/r2d3/}) is an interface to D3 visualizations. This package can be used in R Markdown documents as well as other applications (e.g., Shiny). To use it in R Markdown, you can either call its function \texttt{r2d3()} in a code chunk, or use its \texttt{d3} engine. The latter requires you to understand the D3 library and JavaScript, which are beyond the scope of this book, and we will leave it to readers to learn them. Below is an example of using the \texttt{d3} engine to draw a bar chart:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Generate a chart with D3}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{First, load the package **r2d3** to set up the }\BaseNTok{`d3`}\NormalTok{ engine}
\NormalTok{for **knitr** automatically:}

\BaseNTok{```\{r setup\}}
\BaseNTok{library(r2d3)}
\BaseNTok{```}

\NormalTok{Now we can generate data in R, pass it to D3, and draw}
\NormalTok{the chart:}

\BaseNTok{```\{d3, data=runif(30), options=list(color='steelblue')\}}
\BaseNTok{svg.selectAll('rect')}
\BaseNTok{  .data(data)}
\BaseNTok{  .enter()}
\BaseNTok{    .append('rect')}
\BaseNTok{      .attr('width', function(d) \{ return d * 672; \})}
\BaseNTok{      .attr('height', '10px')}
\BaseNTok{      .attr('y', function(d, i) \{ return i * 16; \})}
\BaseNTok{      .attr('fill', options.color);}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{eng-cat}{%
\section{\texorpdfstring{Write the chunk content to a file via the \texttt{cat} engine}{Write the chunk content to a file via the cat engine}}\label{eng-cat}}

Sometimes it could be useful to write the content of a code chunk to an external file, and use this file later in other code chunks. Of course, you may do this via the R functions like \texttt{writeLines()}, but the problem is that when the content is relatively long, or contains special characters, the character string that you would pass to \texttt{writeLines()} may look awkward. Below is an example of writing a long character string to a file \texttt{my-file.txt}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{writeLines}\NormalTok{(}\StringTok{"This is a long character string.}
\StringTok{It has multiple lines. Remember to escape}
\StringTok{double quotes }\CharTok{\textbackslash{}"\textbackslash{}"}\StringTok{, but 'single quotes' are OK.}
\StringTok{I hope you not to lose your sanity when thinking}
\StringTok{about how many backslashes you need, e.g., is it}
\StringTok{'}\CharTok{\textbackslash{}t}\StringTok{' or '}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{t' or '}\CharTok{\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}}\StringTok{t'?"}\NormalTok{, }
  \DataTypeTok{con =} \StringTok{"my-file.txt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This problem has been greatly alleviated since R 4.0.0, because R started to support raw strings in \texttt{r"(\ )"} (see the help page \texttt{?Quotes}), and you do not need to remember all the rules about special characters. Even with raw strings, it can still be a little distracting for readers to see a long string written to a file explicitly in a code chunk.

The \texttt{cat} engine in \textbf{knitr} has provided a way for you to present text content in a code chunk and/or write it to an external file, without thinking about all the rules about R's character strings (e.g., you need double backslashes when you need a literal backslash).

To write the chunk content to a file, specify the file path in the chunk option \texttt{engine.opts}, e.g., \texttt{engine.opts\ =\ list(file\ =\ \textquotesingle{}path/to/file\textquotesingle{})}. Under the hood, the list of values specified in \texttt{engine.opts} will be passed to the function \texttt{base::cat()}, and \texttt{file} is one of the arguments of \texttt{base::cat()}.

Next we will present three examples to illustrate the use of the \texttt{cat} engine.

\hypertarget{write-to-a-css-file}{%
\subsection{Write to a CSS file}\label{write-to-a-css-file}}

As shown in Section \ref{chunk-styling}, you can embed a \texttt{css} code chunk in an Rmd document to style elements with CSS. An alternative way is to provide a custom CSS file to Pandoc via the \texttt{css} option of some R Markdown output formats such as \texttt{html\_document}. The \texttt{cat} engine can be used to write this CSS file from Rmd.

This example below shows how to generate a file \texttt{custom.css} from a chunk in the document, and pass the file path to the \texttt{css} option of the \texttt{html\_document} format:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Create a CSS file from a code chunk"}
\NormalTok{output: }
\NormalTok{  html_document:}
\BaseNTok{    css: custom.css}
\NormalTok{---}

\NormalTok{The chunk below will be written to }\BaseNTok{`custom.css`}\NormalTok{, which}
\NormalTok{will be used during the Pandoc conversion.}

\BaseNTok{```\{cat, engine.opts = list(file = "my_custom.css")\}}
\BaseNTok{h2 \{}
\BaseNTok{  color: blue;}
\BaseNTok{\}}
\BaseNTok{```}

\FunctionTok{## And this title will blue}
\end{Highlighting}
\end{Shaded}

The only difference between the \texttt{css} code chunk approach and this approach is that the former approach writes the CSS code in place (i.e., in the place of the code chunk), which is inside the \texttt{\textless{}body\textgreater{}} tag of the output document, and the latter approach writes CSS to the \texttt{\textless{}head\textgreater{}} area of the output document. There will not be any practical visual differences in the output document.

\hypertarget{include-latex-code-in-the-preamble}{%
\subsection{Include LaTeX code in the preamble}\label{include-latex-code-in-the-preamble}}

In Section \ref{latex-preamble}, we introduced how to add LaTeX code to the preamble, which requires an external \texttt{.tex} file. This file can also be generated from Rmd, and here is an example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Create a .tex file from a chunk"}
\NormalTok{author: "Jane Doe"}
\NormalTok{classoption: twoside}
\NormalTok{output: }
\NormalTok{  pdf_document:}
\BaseNTok{    includes:}
\BaseNTok{      in_header: preamble.tex}
\NormalTok{---}

\FunctionTok{# How it works}

\NormalTok{Write a code chunk to a file }\BaseNTok{`preamble.tex`}\NormalTok{ to define}
\NormalTok{the header and footer of the PDF output document:}

\BaseNTok{```\{cat, engine.opts=list(file = 'preamble.tex')\}}
\BaseNTok{\textbackslash{}usepackage\{fancyhdr\}}
\BaseNTok{\textbackslash{}usepackage\{lipsum\}}
\BaseNTok{\textbackslash{}pagestyle\{fancy\}}
\BaseNTok{\textbackslash{}fancyhead[CO,CE]\{This is fancy header\}}
\BaseNTok{\textbackslash{}fancyfoot[CO,CE]\{And this is a fancy footer\}}
\BaseNTok{\textbackslash{}fancyfoot[LE,RO]\{\textbackslash{}thepage\}}
\BaseNTok{\textbackslash{}fancypagestyle\{plain\}\{\textbackslash{}pagestyle\{fancy\}\}}
\BaseNTok{```}

\NormalTok{\textbackslash{}lipsum[1-15]}

\FunctionTok{# More random content}

\NormalTok{\textbackslash{}lipsum[16-30]}
\end{Highlighting}
\end{Shaded}

In the LaTeX code in the \texttt{cat} code chunk above, we have defined the header and footer of the PDF document. If we also want to show the author name in the footer, we can append the author information to \texttt{preamble.tex} in another \texttt{cat} code chunk with options \texttt{engine.opts\ =\ list(file\ =\ \textquotesingle{}preamble.tex\textquotesingle{},\ append\ =\ TRUE)} and \texttt{code\ =\ sprintf(\textquotesingle{}\textbackslash{}\textbackslash{}fancyfoot{[}LO,RE{]}\{\%s\}\textquotesingle{},\ rmarkdown::metadata\$author)}. To understand how this works, recall that we mentioned earlier in this section that \texttt{engine.opts} is passed to \texttt{base::cat()} (so \texttt{append\ =\ TRUE} is passed to \texttt{cat()}), and you may understand the chunk option \texttt{code} by reading Section \ref{option-code}.

\hypertarget{write-yaml-data-to-a-file-and-also-display-it}{%
\subsection{Write YAML data to a file and also display it}\label{write-yaml-data-to-a-file-and-also-display-it}}

By default, the content of the \texttt{cat} code chunk will not be displayed in the output document. If you also want to display it after writing it out, set the chunk option \texttt{class.source} to a language name. The language name is used for syntax highlighting. In the example below, we specify the language to be \texttt{yaml}:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{cat, engine.opts=list(file='demo.yml'), class.source='yaml'\}}
\BaseNTok{a:}
\BaseNTok{  aa: "something"}
\BaseNTok{  bb: 1}
\BaseNTok{b:}
\BaseNTok{  aa: "something else"}
\BaseNTok{  bb: 2}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Its output is displayed below, and it also generated a file \texttt{demo.yml}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{a}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{aa}\KeywordTok{:}\AttributeTok{ }\StringTok{"something"}
\AttributeTok{  }\FunctionTok{bb}\KeywordTok{:}\AttributeTok{ }\DecValTok{1}
\FunctionTok{b}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{aa}\KeywordTok{:}\AttributeTok{ }\StringTok{"something else"}
\AttributeTok{  }\FunctionTok{bb}\KeywordTok{:}\AttributeTok{ }\DecValTok{2}
\end{Highlighting}
\end{Shaded}

To show the file \texttt{demo.yml} is really generated, we can try to read it into R with the \textbf{yaml} package:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(yaml}\OperatorTok{::}\KeywordTok{read_yaml}\NormalTok{(}\StringTok{"demo.yml"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 2
##  $ a:List of 2
##   ..$ aa: chr "something"
##   ..$ bb: int 1
##  $ b:List of 2
##   ..$ aa: chr "something else"
##   ..$ bb: int 2
\end{verbatim}

\hypertarget{eng-sas}{%
\section{Run SAS code}\label{eng-sas}}

You may run SAS (\url{https://www.sas.com}) code using the \texttt{sas} engine. You need to either make sure the SAS executable is in your environment variable \texttt{PATH}, or (if you do not know what \texttt{PATH} means) provide the full path to the SAS executable via the chunk option \texttt{engine.path}, e.g., \texttt{engine.path\ =\ "C:\textbackslash{}\textbackslash{}Program\ Files\textbackslash{}\textbackslash{}SASHome\textbackslash{}\textbackslash{}x86\textbackslash{}\textbackslash{}SASFoundation\textbackslash{}\textbackslash{}9.3\textbackslash{}\textbackslash{}sas.exe"}. Below is an example to print out ``Hello World'':

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{sas\}}
\BaseNTok{data _null_;}
\BaseNTok{put 'Hello, world!';}
\BaseNTok{run;}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\hypertarget{eng-stata}{%
\section{Run Stata code}\label{eng-stata}}

You can run Stata (\url{https://www.stata.com}) code with the \texttt{stata} engine if you have installed Stata. Unless the \texttt{stata} executable can be found via the environment variable \texttt{PATH}, you need to specify the full path to the executable via the chunk option \texttt{engine.path}, e.g., \texttt{engine.path\ =\ "C:/Program\ Files\ (x86)/Stata15/StataSE-64.exe"}. Below is a quick example:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{stata\}}
\BaseNTok{sysuse auto}
\BaseNTok{summarize}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The \texttt{stata} engine in \textbf{knitr} is quite limited. Doug Hemken has substantially extended it in the \textbf{Statamarkdown} package, which is available on GitHub at \url{https://github.com/Hemken/Statamarkdown}. You may find tutorials about this package by searching online for ``Stata R Markdown''.

\hypertarget{eng-asy}{%
\section{Create graphics with Asymptote}\label{eng-asy}}

Asymptote (\url{https://asymptote.sourceforge.io}) is a powerful language for vector graphics. You may write and run Asymptote code in R Markdown with the \texttt{asy} engine if you have installed Asymptote (see its website for instructions on the installation). Below is an example copied from the repository \url{https://github.com/vectorgraphics/asymptote}, and its output is shown in Figure \ref{fig:elevation}:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{# }\ErrorTok{import graph3;}
\PreprocessorTok{# }\ErrorTok{import grid3;}
\PreprocessorTok{# }\ErrorTok{import palette;}
\PreprocessorTok{# }\ErrorTok{settings.prc = false;}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{currentprojection=orthographic(0.8,1,2);}
\PreprocessorTok{# }\ErrorTok{size(500,400,IgnoreAspect);}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{real f(pair z) \{return cos(2*pi*z.x)*sin(2*pi*z.y);\}}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{surface s=surface(f,(-1/2,-1/2),(1/2,1/2),50,Spline);}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{surface S=planeproject(unitsquare3)*s;}
\PreprocessorTok{# }\ErrorTok{S.colors(palette(s.map(zpart),Rainbow()));}
\PreprocessorTok{# }\ErrorTok{draw(S,nolight);}
\PreprocessorTok{# }\ErrorTok{draw(s,lightgray+opacity(0.7));}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{grid3(XYZgrid);}
\end{Highlighting}
\end{Shaded}

Note that for PDF output, you may need some additional LaTeX packages, otherwise you may get an error that looks like this:

\begin{verbatim}
! LaTeX Error: File `ocgbase.sty' not found.
\end{verbatim}

If such an error occurs, please see Section \ref{install-latex-pkgs} for how to install the missing LaTeX packages.

In the \texttt{asy} chunk above, we used the setting \texttt{settings.prc\ =\ false}. Without this setting, Asymptote generates an interactive 3D graph when the output format is PDF. However, the interactive graph can only be viewed in Acrobat Reader. If you use Acrobat Reader, you can interact with the graph. For example, you can rotate the 3D surface in Figure \ref{fig:elevation} with your mouse.

\hypertarget{generate-data-in-r-and-read-it-in-asymptote}{%
\subsection{Generate data in R and read it in Asymptote}\label{generate-data-in-r-and-read-it-in-asymptote}}

Now we show an example in which we first save data generated in R to a CSV file (below is an R code chunk):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DataTypeTok{l =} \DecValTok{100}\NormalTok{)}
\NormalTok{y <-}\StringTok{ }\KeywordTok{sin}\NormalTok{(x)}
\KeywordTok{writeLines}\NormalTok{(}\KeywordTok{paste}\NormalTok{(x, y, }\DataTypeTok{sep =} \StringTok{","}\NormalTok{), }\StringTok{"sine.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then read it in Asymptote, and draw a graph based on the data as shown in Figure \ref{fig:sine-curve} (below is an \texttt{asy} code chunk):

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{# }\ErrorTok{import graph;}
\PreprocessorTok{# }\ErrorTok{size(400,300,IgnoreAspect);}
\PreprocessorTok{# }\ErrorTok{settings.prc = false;}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{// import data from csv file}
\PreprocessorTok{# }\ErrorTok{file in=input("sine.csv").line().csv();}
\PreprocessorTok{# }\ErrorTok{real[][] a=in.dimension(0,0);}
\PreprocessorTok{# }\ErrorTok{a=transpose(a);}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{// generate a path}
\PreprocessorTok{# }\ErrorTok{path rpath = graph(a[0],a[1]);}
\PreprocessorTok{# }\ErrorTok{path lpath = (1,0)--(5,1);}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{// find intersection}
\PreprocessorTok{# }\ErrorTok{pair pA=intersectionpoint(rpath,lpath);}
\PreprocessorTok{#}\ErrorTok{ }
\PreprocessorTok{# }\ErrorTok{// draw all}
\PreprocessorTok{# }\ErrorTok{draw(rpath,red);}
\PreprocessorTok{# }\ErrorTok{draw(lpath,dashed + blue);}
\PreprocessorTok{# }\ErrorTok{dot("$\textbackslash{}delta$",pA,NE);}
\PreprocessorTok{# }\ErrorTok{xaxis("$x$",BottomTop,LeftTicks);}
\PreprocessorTok{# }\ErrorTok{yaxis("$y$",LeftRight,RightTicks);}
\end{Highlighting}
\end{Shaded}

\hypertarget{eng-sass}{%
\section{Style HTML pages with Sass/SCSS}\label{eng-sass}}

Sass (\url{https://sass-lang.com}) is a CSS extension language that allows you to create CSS rules in much more flexible ways than you'd do with plain CSS. Please see its official documentation if you are interested in learning it.

The R package \textbf{sass} \citep{R-sass} can be used to compile Sass to CSS. Based on the \textbf{sass} package, \href{https://github.com/yihui/knitr/pull/1666}{Emily Riederer contributed} two language engines to \textbf{knitr}, \texttt{sass} and \texttt{scss} (corresponding to the Sass and SCSS syntax, respectively), to compile code chunks to CSS. Below is a \texttt{scss} code chunk, with the chunk header \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{scss\}}:

\begin{verbatim}
$font-stack: "Comic Sans MS", cursive, sans-serif;
$primary-color: #00FF00;

.book.font-family-1 {
  font: 100% $font-stack;
  color: $primary-color;
}
\end{verbatim}

You can also use the \texttt{sass} engine, and the Sass syntax is slightly different with the SCSS syntax, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{sass\}}
\BaseNTok{$font-stack: "Comic Sans MS", cursive, sans-serif}
\BaseNTok{$primary-color: #00FF00}

\BaseNTok{.book.font-family-1}
\BaseNTok{  font: 100% $font-stack}
\BaseNTok{  color: $primary-color}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

If you are reading \href{https://bookdown.org/yihui/rmarkdown-cookbook/eng-sass.html}{the HTML version of this section,} you will notice that the font for this page has been changed to Comic Sans, which might be surprising, but please do not panic---\href{https://twitter.com/andrewheiss/status/1250438044542361600}{you are not having a stroke.}

The \texttt{sass}/\texttt{scss} code chunks are compiled through the \texttt{sass::sass()} function. Currently you can customize the output style for the CSS code via the chunk option \texttt{engine.opts}, e.g., \texttt{engine.opts\ =\ list(style\ =\ "expanded")}. The default style is ``compressed''. If you are not sure what this means, please refer to the help page \texttt{?sass::sass\_options} and look for the \texttt{output\_style} argument.

\hypertarget{managing-projects}{%
\chapter{Managing Projects}\label{managing-projects}}

When you work on larger projects or reports, you may not want to put all text and code in a single R Markdown document, but organize them in smaller units instead. In this chapter, we introduce tips on how to organize multiple files related to R Markdown.

\hypertarget{source-script}{%
\section{Source external R scripts}\label{source-script}}

If your R Markdown document has a large amount of code, you may consider putting some code in external R scripts, and run these scripts via \texttt{source()} or \texttt{sys.source()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{source("your-script.R", local = knitr::knit_global())}
\BaseNTok{# or sys.source("your-script.R", envir = knitr::knit_global())}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

We recommend that you use the argument \texttt{local} in \texttt{source()} or \texttt{envir} in \texttt{sys.source()} explicitly to make sure the code is evaluated in the correct environment, i.e., \texttt{knitr::knit\_global()}. The default values for them may not be the appropriate environment: you may end up creating variables in the wrong environment, and being surprised that why certain objects are not found in later code chunks.

Next in the R Markdown document, you can use objects created in these scripts (e.g., data objects or functions). This way will not only make your R Markdown document cleaner, but also make it more convenient for you to develop R code (e.g., debugging R code is often easier with pure R scripts than R Markdown).

Note that we used \texttt{include\ =\ FALSE} in the above example because we only want to execute the script without showing any output. If you do want output, you may remove this chunk option, or use the options in Section \ref{hide-one} to selectively hide or show different types of output.

\hypertarget{option-code}{%
\section{Read external scripts into a chunk}\label{option-code}}

There is a disadvantage of the \texttt{source()} method in Section \ref{source-script}. That is, you will not be able to see the source code by default. You can use \texttt{source(...,\ echo\ =\ TRUE)}, but the source code will not be properly syntax highlighted. Besides, you need to be careful about the \texttt{local} argument of \texttt{source()}, as mentioned in Section \ref{source-script}. In this section, we introduce an alternative method that does not have these problems.

Basically, when you have one or more external scripts, you may read them and pass the content to the \texttt{code} option of a chunk. The \texttt{code} option can take a character vector and treat it as the content of the code chunk. Below we show a few examples:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{The }\BaseNTok{`code`}\NormalTok{ option can take a character vector of source code.}
\NormalTok{For example:}

\BaseNTok{```\{r, code=c('1 + 1', 'if (TRUE) plot(cars)')\}}
\BaseNTok{```}

\NormalTok{You can also read an external file:}

\BaseNTok{```\{r, code=xfun::read_utf8('your-script.R')\}}
\BaseNTok{```}

\NormalTok{You can read as many scripts as you want:}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{read_files <- function(files) \{}
\BaseNTok{  unlist(lapply(files, xfun::read_utf8))}
\BaseNTok{\}}
\BaseNTok{```}

\BaseNTok{```\{r, code=read_files(c('one.R', 'two.R'))\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

You can read scripts of other languages, too. See Chapter \ref{other-languages} for how to use other languages in R Markdown. Here are a few more examples on non-R code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Read a Python script:}

\BaseNTok{```\{python, code=xfun::read_utf8('script.py')\}}
\BaseNTok{```}

\NormalTok{Read a C++ file:}

\BaseNTok{```\{Rcpp, code=xfun::read_utf8('file.cpp')\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

With the \texttt{code} option, you can develop complicated code in your favorite editor, and read it into a code chunk of an R Markdown document.

\hypertarget{read-chunk}{%
\section{Read multiple code chunks from an external script (*)}\label{read-chunk}}

In Section \ref{option-code}, we introduced a way to read code into a single code chunk. In this section, we introduce one method to read multiple code chunks from an external script. The key is that you need to label the code in the script, and you can use the same labels in the code chunks in your R Markdown document, so the code in the external script can be mapped to the code chunks via the function \texttt{knitr::read\_chunk()}. To label a block of code in a script, you write the label after \texttt{\#\#\ -\/-\/-\/-} (optionally, you can add a series of dashes to the end of this line). One script can contain multiple labeled code blocks, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## ---- test-a --------}
\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}

\CommentTok{## ---- test-b --------}
\ControlFlowTok{if}\NormalTok{ (}\OtherTok{TRUE}\NormalTok{) \{}
  \KeywordTok{plot}\NormalTok{(cars)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

We assume that the filename of the above script is \texttt{test.R}. In the R Markdown document, we can read it via \texttt{knitr::read\_chunk()}, and use the code in code chunks with the labels, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Read an external script:}

\BaseNTok{```\{r, include=FALSE, cache=FALSE\}}
\BaseNTok{knitr::read_chunk('test.R')}
\BaseNTok{```}

\NormalTok{Now we can use the code, e.g.,}

\BaseNTok{```\{r, test-a, echo=FALSE\}}
\BaseNTok{```}

\BaseNTok{```\{r, test-b, fig.height=4\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Note that we use \texttt{knitr::read\_chunk()} mainly for its side-effect, so please make sure the code chunk in which we call this function is not cached (see Section \ref{cache} for the explanation).

Like methods introduced in Section \ref{source-script} and Section \ref{option-code}, this method also gives you the flexibility of developing code in a separate environment.

\hypertarget{child-document}{%
\section{Child documents (*)}\label{child-document}}

When you feel an R Markdown document is too long, you may consider splitting it into shorter documents, and include them as child documents of the main document via the chunk option \texttt{child}. The \texttt{child} option takes a character vector of paths to the child documents, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, child=c('one.Rmd', 'two.Rmd')\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Since \textbf{knitr} chunk options can take values from arbitrary R expressions, one application of the \texttt{child} option is the conditional inclusion of a document. For example, if your report has an appendix containing technical details that your boss may not be interested in, you may use a variable to control whether this appendix is included in the report:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Change }\BaseNTok{`BOSS_MODE`}\NormalTok{ to }\BaseNTok{`TRUE`}\NormalTok{ if this report is to be read}
\NormalTok{by the boss:}

\BaseNTok{```\{r, include=FALSE\}}
\BaseNTok{BOSS_MODE <- FALSE}
\BaseNTok{```}

\NormalTok{Conditionally include the appendix:}

\BaseNTok{```\{r, child=if (!BOSS_MODE) 'appendix.Rmd'\}}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

Or if you are writing a news report on a football game that has not taken place yet, you may include different child documents depending on the outcome, e.g., \texttt{child\ =\ if\ (winner\ ==\ \textquotesingle{}brazil\textquotesingle{})\ \textquotesingle{}brazil.Rmd\textquotesingle{}\ else\ \textquotesingle{}germany.Rmd\textquotesingle{}}. Then as soon as the game (between Germany and Brazil) is finished, you can publish your report.

Another way to compile child documents is the function \texttt{knitr::knit\_child()}. You can call this function in an R code chunk or an inline R expression, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, echo=FALSE, results='asis'\}}
\BaseNTok{res <- knitr::knit_child('child.Rmd', quiet = TRUE)}
\BaseNTok{cat(res, sep = '\textbackslash{}n')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The function \texttt{knit\_child()} returns a character vector of the knitted output, which we can write back to the main document with \texttt{cat()} and the chunk option \texttt{results\ =\ \textquotesingle{}asis\textquotesingle{}}.

You can even use a child document as a template, and call \texttt{knit\_child()} on it repeatedly with different parameters. In the example below, we run a regression using \texttt{mpg} as the response variable and each of the rest of variables in the \texttt{mtcars} data as the explanatory variable.

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r, echo=FALSE, results='asis'\}}
\BaseNTok{res <- lapply(setdiff(names(mtcars), 'mpg'), function(x) \{}
\BaseNTok{  knitr::knit_child(text = c(}
\BaseNTok{    '## Regression on "`r x`"',}
\BaseNTok{    '',}
\BaseNTok{    '```\{r\}',}
\BaseNTok{    'lm(mpg ~ ., data = mtcars[, c("mpg", x)])',}
\BaseNTok{    '```',}
\BaseNTok{    ''}
\BaseNTok{  ), envir = environment(), quiet = TRUE)}
\BaseNTok{\})}
\BaseNTok{cat(unlist(res), sep = '\textbackslash{}n')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

To make the above example self-contained, we used the \texttt{text} argument of \texttt{knit\_child()} instead of a file input to pass the R Markdown content to be knitted. You can certainly write the content to a file, and pass a path to \texttt{knit\_child()} instead. For example, you can save the content below to a file named \texttt{template.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{## Regression on "`r x`"}

\BaseNTok{```\{r\}}
\BaseNTok{lm(mpg ~ ., data = mtcars[, c("mpg", x)])}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

And knit the file instead:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}\KeywordTok{setdiff}\NormalTok{(}\KeywordTok{names}\NormalTok{(mtcars), }\StringTok{'mpg'}\NormalTok{), }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  knitr}\OperatorTok{::}\KeywordTok{knit_child}\NormalTok{(}
    \StringTok{'template.Rmd'}\NormalTok{, }\DataTypeTok{envir =} \KeywordTok{environment}\NormalTok{(), }\DataTypeTok{quiet =} \OtherTok{TRUE}
\NormalTok{  )}
\NormalTok{\})}
\KeywordTok{cat}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(res), }\DataTypeTok{sep =} \StringTok{'}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{keep-files}{%
\section{Keep the plot files}\label{keep-files}}

Most R Markdown output formats use the option \texttt{self\_contained\ =\ TRUE} by default, which means R plots will be embedded in the output documents, so we do not need the intermediate plot files when viewing the output documents, and the plot folder (which typically has a suffix \texttt{\_files}) will be deleted after the Rmd document is rendered.

Sometimes you may want to keep the plot files. For example, some academic journals require authors to submit figures files separately. For R Markdown, there are three ways to avoid the automatic deletion of these files:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Use the option \texttt{self\_contained\ =\ FALSE} if the output format supports this option, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{html_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{self_contained}\KeywordTok{:}\AttributeTok{ }\CharTok{false}
\end{Highlighting}
\end{Shaded}

  However, this means the plot files will not be embedded in the output document. If this is not what you want, you may consider the next two methods.
\item
  Enable caching for at least one code chunk (see Section \ref{cache}). When caching is enabled, R Markdown will not delete the plot folder.
\item
  Use the option \texttt{keep\_md\ =\ TRUE} if the output format supports this option, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{output}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{word_document}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{keep_md}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\end{Highlighting}
\end{Shaded}

  When you ask R Markdown to preserve the intermediate Markdown output file, it will also preserve the plot folder.
\end{enumerate}

\hypertarget{working-directory}{%
\section{The working directory for R code chunks}\label{working-directory}}

By default, the working directory for R code chunks is the directory that contains the Rmd document. For example, if the path of an Rmd file is \texttt{\textasciitilde{}/Downloads/foo.Rmd}, the working directory under which R code chunks are evaluated is \texttt{\textasciitilde{}/Downloads/}. This means when you refer to external files with relative paths in code chunks, you need to know that these paths are relative to the directory of the Rmd file. With the aforementioned Rmd example file, \texttt{read.csv("data/iris.csv")} in a code chunk means reading the CSV file \texttt{\textasciitilde{}/Downloads/data/iris.csv}.

When in doubt, you can add \texttt{getwd()} to a code chunk, compile the document, and check the output from \texttt{getwd()}.

Sometimes you may want to use another directory as the working directory. The usual way to change the working directory is \texttt{setwd()}, but please note that \texttt{setwd()} is not persistent in R Markdown (or other types of \textbf{knitr} source documents), which means \texttt{setwd()} only works for the current code chunk, and the working directory will be restored after this code chunk has been evaluated.

If you want to change the working directory for all code chunks, you may set it via a \texttt{setup} code chunk in the beginning of your document:

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{setup, include=FALSE\}}
\BaseNTok{knitr::opts_knit$set(root.dir = '/tmp')}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

This will change the working directory of all subsequent code chunks.

If you use RStudio, you can also choose the working directory from the menu \texttt{Tools\ -\textgreater{}\ Global\ Options\ -\textgreater{}\ R\ Markdown} (see Figure \ref{fig:rmd-wd}).

\begin{figure}

{\centering \includegraphics{images/rmd-wd} 

}

\caption{Change the default working directory for R Markdown documents in RStudio.}\label{fig:rmd-wd}
\end{figure}

\hypertarget{package-vignette}{%
\section{R package vignettes}\label{package-vignette}}

If you have experience in developing R packages, or your project requires clear documentation and rigorous tests for custom functions written in the project, you may consider organizing the project as an R package. If you do not know how to create an R package, you can easily get started in the RStudio IDE by clicking the menu \texttt{File\ -\textgreater{}\ New\ Project}, and selecting the project type to be an R package.

There are a lot of benefits of using an R package to manage a project. For example, you can place datasets in the \texttt{data/} folder, write R code under \texttt{R/}, generate documentation (e.g., using \textbf{roxygen2}) to \texttt{man/}, and add unit tests to \texttt{test/}. When it comes to the R Markdown reports, you can write them as package vignettes under \texttt{vignettes/}. In the vignettes, you can load datasets and call functions in the package. When you build the package (via the command \texttt{R\ CMD\ build} or RStudio), vignettes will be automatically compiled.

To create a package vignette in R Markdown, the easiest way is through the RStudio menu \texttt{File\ -\textgreater{}\ New\ File\ -\textgreater{}\ R\ Markdown\ -\textgreater{}\ From\ Template} (see Figure \ref{fig:package-vignette}). Then you select ``Package Vignette'' from the \textbf{rmarkdown} package, and you will get a vignette template. After changing the title, author, and other metadata of the template, you can start writing the content of your report.

\begin{figure}
\centering
\includegraphics{images/package-vignette.png}
\caption{\label{fig:package-vignette}Create a package vignette in RStudio.}
\end{figure}

Alternatively, you can install the package \textbf{usethis} and use its function \texttt{usethis::use\_vignette()} to create a vignette skeleton. Below is what the YAML frontmatter of a package vignette typically looks like:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"Vignette Title"}
\FunctionTok{author}\KeywordTok{:}\AttributeTok{ }\StringTok{"Vignette Author"}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ rmarkdown::html_vignette}
\FunctionTok{vignette}\KeywordTok{: }\CharTok{>}
\NormalTok{  %\textbackslash{}VignetteIndexEntry\{Vignette Title\}}
\NormalTok{  %\textbackslash{}VignetteEngine\{knitr::rmarkdown\}}
\NormalTok{  %\textbackslash{}VignetteEncoding\{UTF-8\}}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Note that you need to change the vignette title in both the \texttt{title} field and the \texttt{\textbackslash{}VignetteIndexEntry\{\}} command. Besides the above information in the vignette, you also need to do two more things in your package \texttt{DESCRIPTION} file:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Specify \texttt{VignetteBuilder:\ knitr} in the \texttt{DESCRIPTION} file.
\item
  Add \texttt{Suggests:\ knitr,\ rmarkdown} in \texttt{DESCRIPTION}.
\end{enumerate}

The vignette output format does not have to be HTML. It can also be PDF, so you can use \texttt{output:\ pdf\_document}, too. Any other output formats that create HTML or PDF are also okay, such as \texttt{beamer\_presentation} and \texttt{tufte::tufte\_html}. However, currently R only recognizes HTML and PDF vignettes.

\hypertarget{package-template}{%
\section{R Markdown templates in R packages}\label{package-template}}

Figure \ref{fig:package-vignette} of Section \ref{package-vignette} illustrates the process of retrieving the editable ``Package Vignette (HTML)'' template from the \textbf{rmarkdown} package. This R Markdown file is pre-populated with the appropriate metadata for an R package vignette. Similarly, any package may include R Markdown templates that package users can access through the RStudio IDE (as shown in the figure) or across any platform with the \texttt{rmarkdown::draft()} function.

\hypertarget{template-use-cases}{%
\subsection{Template use-cases}\label{template-use-cases}}

Templates are a useful way to share custom structure, style, and content. There are many excellent examples of this ``in the wild''.

Many templates add structure and style by pre-populating the YAML metadata. We already saw an example of this with the \textbf{rmarkdown} package's ``Package Vignette (HTML)'' template. Similarly, the \textbf{rmdformats} package provides a number of templates that pass different custom styling functions to the \texttt{output} option.

Other templates demonstrate required document structures by the packages. For example, the \textbf{pagedown} package includes numerous templates for posters, resumes, and other page layouts. Similarly, the \textbf{xaringan} package's ``Ninja Presentation'' template demonstrates the syntax for many different slide formatting options.

Templates may also demonstrate package features and syntax. For example, both the \textbf{flexdashboard} package and the \textbf{learnr} package include templates with code chunks that call functions from the packages to create a sample dashboard or tutorial, respectively.

Similarly, templates may also include boilerplate content. For example, the \textbf{rticles} package provides many such templates to align R Markdown output to the required style and content guidelines of different academic journals. Boilerplate content is also useful in in organizational settings, such as a team generating a quarterly reports.

\hypertarget{template-set-up}{%
\subsection{Template set-up}\label{template-set-up}}

The \textbf{usethis} package has a helpful function for creating templates. Running \texttt{usethis::use\_rmarkdown\_template("Template\ Name")} will automatically create the required directory structure and files (you should provide your own ``Template Name'').

If you wish to set up your template manually instead, create a subdirectory of the \texttt{inst/rmarkdown/templates} directory. Within this directory, you need to save at least two files:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  A file named \texttt{template.yaml}, which gives the RStudio IDE basic metadata such as a human-readable name for the template. At the minimum, this file should have the \texttt{name} and \texttt{description} fields, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{name}\KeywordTok{:}\AttributeTok{ Example Template}
\FunctionTok{description}\KeywordTok{:}\AttributeTok{ What this template does}
\end{Highlighting}
\end{Shaded}

  You may include \texttt{create\_dir:\ true} if you want a new directory to be created when the template is selected. This is useful if your template relies upon additional resources. For example, the \href{https://github.com/rstudio/learnr/blob/master/inst/rmarkdown/templates/tutorial/template.yaml}{\textbf{learnr} package template} sets \texttt{create\_dir:\ true}, whereas the \href{https://github.com/rstudio/flexdashboard/blob/master/inst/rmarkdown/templates/flex_dashboard/template.yaml}{\textbf{flexdashboard} package template} uses the default \texttt{create\_dir:\ false}. You may attempt to open both of these templates in RStudio to notice the different user prompts.
\item
  An R Markdown document saved under \texttt{skeleton/skeleton.Rmd}. This may contain anything you wish to put in an R Markdown document.
\end{enumerate}

Optionally, the \texttt{skeleton} folder may also include additional resources like style sheets or images used by your template. These files will be loaded to the user's computer along with the template.

For more details on building custom R Markdown templates, please refer to the \href{https://rstudio.github.io/rstudio-extensions/rmarkdown_templates.html}{RStudio Extensions} website and the \href{https://bookdown.org/yihui/rmarkdown/document-templates.html}{Document Templates chapter} of the R Markdown Definitive Guide \citep{rmarkdown2018}.

\hypertarget{bookdown}{%
\section{\texorpdfstring{Write books and long-form reports with \textbf{bookdown}}{Write books and long-form reports with bookdown}}\label{bookdown}}

The \textbf{bookdown} package \citep{R-bookdown} is designed for creating long-form documents with multiple R Markdown documents. For example, if you want to write a book, you can put each chapter in its own Rmd file.

For RStudio users, the easiest way to get started is to create a \textbf{bookdown} project from \texttt{File\ -\textgreater{}\ New\ Project\ -\textgreater{}\ New\ Directory\ -\textgreater{}\ Book\ Project\ using\ bookdown}, as you can see from Figure \ref{fig:bookdown-project}. If you do not use RStudio, you may call the function \texttt{bookdown:::bookdown\_skeleton(\textquotesingle{}your-book-dir\textquotesingle{})}.

\begin{figure}
\centering
\includegraphics{images/bookdown-project.png}
\caption{\label{fig:bookdown-project}Create a bookdown project in RStudio.}
\end{figure}

To demonstrate the usage, we provide a minimal example consisting of three files within the same directory:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{directory}
\NormalTok{  |- index.Rmd}
\NormalTok{  |- 01-intro.Rmd}
\NormalTok{  |- 02-analysis.Rmd}
\end{Highlighting}
\end{Shaded}

Below we show the content of each file and explain their roles.

\begin{itemize}
\item
  \textbf{index.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "A Minimal bookdown Project"}
\NormalTok{site: bookdown::bookdown_site}
\NormalTok{output: bookdown::gitbook}
\NormalTok{---}

\FunctionTok{# Preface \{-\}}

\NormalTok{Some content}
\end{Highlighting}
\end{Shaded}
\end{itemize}

The first file is typically called \texttt{index.Rmd}. It should be the only Rmd file in which you provide the YAML frontmatter. It should also include a special YAML field \texttt{site:\ bookdown::bookdown\_site}, so that \textbf{rmarkdown} knows to use \textbf{bookdown} to build all Rmd files, instead of rendering a single Rmd file. You can use any \textbf{bookdown} output formats, such as \texttt{bookdown::gitbook}, \texttt{bookdown::pdf\_book}, \texttt{bookdown::word\_document2}, and \texttt{bookdown::epub\_book}.

The next two Rmd files are two chapters:

\begin{itemize}
\item
  \textbf{01-intro.Rmd:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Chapter 1}

\NormalTok{This is chapter 1.}
\end{Highlighting}
\end{Shaded}
\item
  \textbf{02-analysis.Rmd}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{# Chapter 2}

\NormalTok{This is chapter 2.}
\end{Highlighting}
\end{Shaded}
\end{itemize}

To render these Rmd files, you should call \texttt{bookdown::render\_book(\textquotesingle{}index.Rmd\textquotesingle{})} instead of \texttt{rmarkdown::render()}. Under the hood, \textbf{bookdown} merges all Rmd files into a single Rmd by default and compile it. Files are merged in the alphabetical order. That is why we added numeric prefixes to filenames in the above example.

There are a lot of settings that you can customize for a \textbf{bookdown} project. For a more comprehensive overview of \textbf{bookdown}, you may see Chapter 18 the \textbf{rmarkdown} book \citep{rmarkdown2018}. For the full documentation, see the \textbf{bookdown} book \citep{bookdown2016}.

\hypertarget{blogdown}{%
\section{\texorpdfstring{Build websites with \textbf{blogdown}}{Build websites with blogdown}}\label{blogdown}}

If you want build a website based on R Markdown, you may consider using the \textbf{blogdown} package. The easiest way to get started is to use the RStudio menu \texttt{File\ -\textgreater{}\ New\ Project\ -\textgreater{}\ New\ Directory\ -\textgreater{}\ Website\ using\ blogdown}, as you can see from Figure \ref{fig:bookdown-project}. If you have never used \textbf{blogdown} before, you may use the default settings in the dialog box, otherwise you can customize things like the website theme. If you do not use RStudio, you may call the function \texttt{blogdown::new\_site()} under an empty directory to create a new website.

A website project may contain any number of Rmd documents. They could either be normal pages or blog posts. R Markdown makes it easier for you to maintain your website because the results on your website are automatically and dynamically generated.

We recommend that you read \href{https://bookdown.org/yihui/blogdown/get-started.html}{Chapter 1} of the \textbf{blogdown} book \citep{blogdown2017} for an overview of this package as well as the basic workflow of maintaining a website.

\hypertarget{workflow}{%
\chapter{Workflow}\label{workflow}}

In this chapter, we introduce some tips on working with individual R Markdown documents as well as running your R Markdown projects. You may also check out \href{https://r4ds.had.co.nz/r-markdown-workflow.html}{Chapter 30} of the book ``R for Data Science'' \citep{wickham2016}, which briefly introduced some tips on using analysis notebooks (including R Markdown documents). Nicholas Tierney also discussed the workflow in the book \href{https://rmd4sci.njtierney.com/workflow.html}{``R Markdown for Scientists.''}

\hypertarget{rstudio-shortcuts}{%
\section{RStudio keyboard shortcuts}\label{rstudio-shortcuts}}

The R Markdown format can be used with any editor of your choice, as long as R, the \textbf{rmarkdown} package, and Pandoc are installed. However, RStudio has a deep integration with R Markdown so you can work with R Markdown smoothly.

Like any IDE (Integrated Development Environment), RStudio has keyboard shortcuts. A full list can be found under the menu \texttt{Tools\ -\textgreater{}\ Keyboard\ Shortcuts\ Help}. Some of the most useful shortcuts related to R Markdown are summarized in Table \ref{tab:shortcuts}.

\begin{table}

\caption{\label{tab:shortcuts}RStudio keyboard shortcuts related to R Markdown.}
\centering
\begin{tabular}[t]{lll}
\toprule
Task & Windows \& Linux & macOS\\
\midrule
Insert R chunk & Ctrl+Alt+I & Command+Option+I\\
Preview HTML & Ctrl+Shift+K & Command+Shift+K\\
Knitr document (knitr) & Ctrl+Shift+K & Command+Shift+K\\
Compile Notebook & Ctrl+Shift+K & Command+Shift+K\\
Compile PDF & Ctrl+Shift+K & Command+Shift+K\\
\addlinespace
Run all chunks above & Ctrl+Alt+P & Command+Option+P\\
Run current chunk & Ctrl+Alt+C & Command+Option+C\\
Run current chunk & Ctrl+Shift+Enter & Command+Shift+Enter\\
Run next chunk & Ctrl+Alt+N & Command+Option+N\\
Run all chunks & Ctrl+Alt+R & Command+Option+R\\
\addlinespace
Go to next chunk/title & Ctrl+PgDown & Command+PgDown\\
Go to previous chunk/title & Ctrl+PgUp & Command+PgUp\\
Show/hide document outline & Ctrl+Shift+O & Command+Shift+O\\
Build book, website, ... & Ctrl+Shift+B & Command+Shift+B\\
\bottomrule
\end{tabular}
\end{table}

Besides, you can press \texttt{F7} to spellcheck your document. You can also restart the R session by \texttt{Ctrl\ +\ Alt\ +\ F10} (or \texttt{Command\ +\ Option\ +\ F10} on macOS), which can be helpful for reproducibility, because results are more likely to be reproducible if they are computed from a new R session. This can also be done through the dropdown menu ``Restart R and Run All Chunks'' behind the ``Run'' button on the toolbar.

\hypertarget{spell-check}{%
\section{Spell check R Markdown}\label{spell-check}}

If you use the RStudio IDE, you can press the key \texttt{F7} or click the menu \texttt{Edit\ -\textgreater{}\ Check\ Spelling} to spell check an Rmd document. Real-time spell checking has become available in RStudio v1.3, so you no longer need to manually trigger spell checking with this version or a greater version of RStudio.

If you do not use RStudio, the \textbf{spelling} package (\url{https://github.com/ropensci/spelling}) has a function \texttt{spell\_check\_files()}, which can check the spelling of common document formats, including R Markdown. When spell checking Rmd documents, it will skip code chunks and only check ordinary text.

\hypertarget{rmarkdown-render}{%
\section{\texorpdfstring{Render R Markdown with \texttt{rmarkdown::render()}}{Render R Markdown with rmarkdown::render()}}\label{rmarkdown-render}}

If you do not use RStudio or any other IDEs, you need to know this fact: R Markdown documents are rendered through the function \texttt{rmarkdown::render()}. This means you can programmatically render an R Markdown document in any R script. For example, you could render a series of reports in a \texttt{for}-loop for each state of a country:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (state }\ControlFlowTok{in}\NormalTok{ state.name) \{}
\NormalTok{  rmarkdown}\OperatorTok{::}\KeywordTok{render}\NormalTok{(}
    \StringTok{'input.Rmd'}\NormalTok{, }\DataTypeTok{output_file =} \KeywordTok{paste0}\NormalTok{(state, }\StringTok{'.html'}\NormalTok{)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The output filename will be different for each state. You can also make use of the \texttt{state} variable in the document \texttt{input.Rmd}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "A report for }\BaseNTok{`r state`}\NormalTok{"}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{The area of }\BaseNTok{`r state`}\NormalTok{ is }\BaseNTok{`r state.area[state.name == state]`}
\NormalTok{square miles.}
\end{Highlighting}
\end{Shaded}

You may read the help page \texttt{?rmarkdown::render} to know other possible arguments. Here we just want to mention two of them, i.e., the \texttt{clean} and \texttt{envir} arguments. The former (\texttt{clean}) is particularly helpful for debugging when anything goes wrong with the Pandoc conversion. If you call \texttt{rmarkdown::render(...,\ clean\ =\ FALSE)}, all intermediate files will be preserved, including the intermediate \texttt{.md} file knitted from the \texttt{.Rmd} file. If Pandoc signals an error, you may start debugging from this \texttt{.md} file. The latter (\texttt{envir}) offers a way to render a document with the guarantee of an empty new environment when you call \texttt{rmarkdown::render(...,\ envir\ =\ new.env())}, so objects created in your code chunks will stay inside this environment, without polluting your current global environment. On the other hand, if you prefer rendering the Rmd document in a new R session so that objects in your current R session will not pollute your Rmd document, you may call \texttt{rmarkdown::render} in \texttt{xfun::Rscript\_call()}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\OperatorTok{::}\KeywordTok{Rscript_call}\NormalTok{(}
\NormalTok{  rmarkdown}\OperatorTok{::}\NormalTok{render,}
  \KeywordTok{list}\NormalTok{(}\DataTypeTok{input =} \StringTok{'my-file.Rmd'}\NormalTok{, }\DataTypeTok{output_format =} \StringTok{'pdf_document'}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This method is similar to clicking the \texttt{Knit} button in RStudio, which also renders the Rmd document in a new R session. In case you need to render an Rmd document inside another Rmd document, we strongly recommend that you used this method instead of directly calling \texttt{rmarkdown::render()} in a code chunk, because \texttt{rmarkdown::render()} creates and relies on a lot of side-effects internally, which may affect rendering other Rmd documents in the same R session.

The second argument of \texttt{xfun::Rscript\_call()} takes a list of arguments to be passed to \texttt{rmarkdown::render}(). In fact, \texttt{xfun::Rscript\_call} is a general-purpose function to call any R function (with arguments optionally) in a new R session. Please see its help page if you are interested.

\hypertarget{parameterized-reports}{%
\section{Parameterized reports}\label{parameterized-reports}}

In Section \ref{rmarkdown-render}, we mentioned one way to render a series of reports in a \texttt{for}-loop. In fact, \texttt{rmarkdown::render()} has an argument named \texttt{params} specifically designed for this task. You can parameterize your report through this argument. When you specify parameters for a report, you can use the variable \texttt{params} in your report. For example, if you call:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (state }\ControlFlowTok{in}\NormalTok{ state.name) \{}
\NormalTok{  rmarkdown}\OperatorTok{::}\KeywordTok{render}\NormalTok{(}\StringTok{'input.Rmd'}\NormalTok{, }\DataTypeTok{params =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{state =}\NormalTok{ state))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Then in \texttt{input.Rmd}, the object \texttt{params} will be a list that contains the \texttt{state} variable:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "A report for }\BaseNTok{`r params$state`}\NormalTok{"}
\NormalTok{output: html_document}
\NormalTok{---}

\NormalTok{The area of }\BaseNTok{`r params$state`}\NormalTok{ is}
\BaseNTok{`r state.area[state.name == params$state]`}
\NormalTok{square miles.}
\end{Highlighting}
\end{Shaded}

Another way to specify parameters for a report is to use the YAML field \texttt{params}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ Parameterized reports}
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html_document}
\FunctionTok{params}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{state}\KeywordTok{:}\AttributeTok{ Nebraska}
\AttributeTok{  }\FunctionTok{year}\KeywordTok{:}\AttributeTok{ }\DecValTok{2019}
\AttributeTok{  }\FunctionTok{midwest}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

Note that you can include as many parameters in the \texttt{params} YAML field or the \texttt{params} argument of \texttt{rmarkdown::render()}. If both the YAML field and the argument are present, the parameter values in the argument will override the corresponding parameters in YAML. For example, when we call \texttt{rmarkdown::render(...,\ params\ =\ list(state\ =\ \textquotesingle{}Iowa\textquotesingle{},\ year\ =\ 2018)} on the previous example that has the \texttt{params} field, \texttt{params\$state} will become \texttt{Iowa} (instead of \texttt{Nebraska}) and \texttt{params\$year} will become \texttt{2018} (instead of \texttt{2019}) in the R Markdown document.

When rendering the same R Markdown document to a series of reports, you need to adjust the \texttt{output\_file} argument of \texttt{rmarkdown::render()}, to make sure each report has its unique filename, so you will not accidentally override certain report files. For example, you can write a function to generate a report for each state and each year:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{render_one <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(state, year) \{}
  \CommentTok{# assuming the output format of input.Rmd is PDF}
\NormalTok{  rmarkdown}\OperatorTok{::}\KeywordTok{render}\NormalTok{(}
    \StringTok{'input.Rmd'}\NormalTok{,}
    \DataTypeTok{output_file =} \KeywordTok{paste0}\NormalTok{(state, }\StringTok{'-'}\NormalTok{, year, }\StringTok{'.pdf'}\NormalTok{),}
    \DataTypeTok{params =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{state =}\NormalTok{ state, }\DataTypeTok{year =}\NormalTok{ year),}
    \DataTypeTok{envir =} \KeywordTok{parent.frame}\NormalTok{()}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Then you can use nested \texttt{for}-loops to generate all reports:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (state }\ControlFlowTok{in}\NormalTok{ state.name) \{}
  \ControlFlowTok{for}\NormalTok{ (year }\ControlFlowTok{in} \DecValTok{2000}\OperatorTok{:}\DecValTok{2020}\NormalTok{) \{}
    \KeywordTok{render_one}\NormalTok{(state, year)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

At the end, you will get a series of report files like \texttt{Alabama-2000.pdf}, \texttt{Alabama-2001.pdf}, \ldots, \texttt{Wyoming-2019.pdf}, and \texttt{Wyoming-2020.pdf}.

For parameterized reports, you can also input parameters interactively through a graphical user interface (GUI) created from Shiny. This requires you to provide a \texttt{params} field in YAML, and \textbf{rmarkdown} will automatically create the GUI using the appropriate input widgets for each parameter (e.g., a checkbox will be provided for a boolean parameter).

To start the GUI, you can call \texttt{rmarkdown::render()} with \texttt{params\ =\ \textquotesingle{}ask\textquotesingle{}} if you do not use RStudio:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rmarkdown}\OperatorTok{::}\KeywordTok{render}\NormalTok{(}\StringTok{"input.Rmd"}\NormalTok{, }\DataTypeTok{params =} \StringTok{"ask"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you use RStudio, you can click the menu \texttt{Knit\ with\ Parameters} behind the \texttt{Knit} button. Figure \ref{fig:params-shiny} shows an example GUI for parameters.

\begin{figure}
\centering
\includegraphics{images/params-shiny.png}
\caption{\label{fig:params-shiny}Knit an R Markdown document with parameters that you can input from a GUI.}
\end{figure}

For more information on parameterized reports, you may read \href{https://bookdown.org/yihui/rmarkdown/parameterized-reports.html}{Chapter 15} of the R Markdown book \citep{rmarkdown2018}.

\hypertarget{custom-knit}{%
\section{\texorpdfstring{Customize the \texttt{Knit} button (*)}{Customize the Knit button (*)}}\label{custom-knit}}

When you click the \texttt{Knit} button in RStudio, it will call the \texttt{rmarkdown::render()} function in a new R session and output a file of the same base name as the input file in the same directory. For example, knitting \texttt{example.Rmd} with the output format \texttt{html\_document} will create an output file \texttt{example.html}.

There may be situations in which we want to customize how the document is rendered. For example, perhaps we would like the rendered document to contain the current date, or would like to output the compiled report into a different directory. Although we can achieve these goals by calling \texttt{rmarkdown::render()} (see Section \ref{rmarkdown-render}) with the appropriate \texttt{output\_file} argument, it can be inconvenient to have to rely on a custom call to `rmarkdown::render() to compile your report.

It is possible to control the behavior of the \texttt{Knit} button by providing the \texttt{knit} field within the YAML frontmatter of your document. The field takes a function with the main argument \texttt{input} (the path to the input Rmd document) and other arguments that are currently ignored. You can either write the source code of the function directly in the \texttt{knit} field, or put the function elsewhere (e.g., in an R package) and call the function in the \texttt{knit} field. If you routinely need the custom \texttt{knit} function, we would recommend that you put it in a package, instead of repeating its source code in every single R Markdown document.

If you store the code directly within YAML, you must wrap the entire function in parentheses. If the source code has multiple lines, you have to indent all lines (except the first line) by at least two spaces. For example, if we want the output filename to include the date on which it is rendered, we could use the following YAML code:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{knit}\KeywordTok{:}\AttributeTok{ (function(input, ...) \{}
\AttributeTok{    rmarkdown::render(}
\AttributeTok{      input,}
\AttributeTok{      output_file = paste0(}
\AttributeTok{        xfun::sans_ext(inputFile), '-', Sys.Date(), '.html'}
\AttributeTok{      ),}
\AttributeTok{      envir = globalenv()}
\AttributeTok{    )}
\AttributeTok{  \})}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

For example, if we knit \texttt{example.Rmd} on 2019-07-29, the output filename will be \texttt{example-2019-07-29.html}.

While the above approach looks simple and straightforward enough, embedding a function directly in your YAML may make it difficult for you to maintain it, unless the function is only to be used once with a single R Markdown document. In general, we would recommend using an R package to maintain such a function, e.g., you may create a function \texttt{knit\_with\_date()} in a package:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Custom Knit function for RStudio}
\CommentTok{#'}
\CommentTok{#' @export}
\NormalTok{knit_with_date <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(input, ...) \{}
\NormalTok{  rmarkdown}\OperatorTok{::}\KeywordTok{render}\NormalTok{(}
\NormalTok{    input,}
    \DataTypeTok{output_file =} \KeywordTok{paste0}\NormalTok{(}
\NormalTok{        xfun}\OperatorTok{::}\KeywordTok{sans_ext}\NormalTok{(inputFile), }\StringTok{'-'}\NormalTok{, }\KeywordTok{Sys.Date}\NormalTok{(), }\StringTok{'.'}\NormalTok{,}
\NormalTok{        xfun}\OperatorTok{::}\KeywordTok{file_ext}\NormalTok{(inputFile)}
\NormalTok{    ),}
    \DataTypeTok{envir =} \KeywordTok{globalenv}\NormalTok{()}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If you add the above code to a package named \textbf{myPackage}, you will be able to refer to your custom \texttt{knit} function using the following YAML setting:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{---}
\FunctionTok{knit}\KeywordTok{:}\AttributeTok{ myPackage::knit_with_date}
\PreprocessorTok{---}
\end{Highlighting}
\end{Shaded}

You may refer to the help page \texttt{?rmarkdown::render} to find out more ideas on how you could customize your \texttt{knit} function behind the \texttt{Knit} button in RStudio.

\hypertarget{google-drive}{%
\section{Collaborative editing of Rmd documents through Google Drive}\label{google-drive}}

Based on the \textbf{googledrive} package, Emily Kothe provided a few wrapper functions in the \textbf{rmdrive} package, which is currently available only on GitHub at \url{https://github.com/ekothe/rmdrive}. At the time of writing, it still lacks rich documentation, so I recommend that you try Janosch LinkersdÃ¶rfer's fork instead: \url{https://github.com/januz/rmdrive} (which is based on Ben Marwick's fork---if you still have not learned GIT, you may be motivated by these examples of freely forking and improving other people's GIT repositories).

The workflow with \textbf{rmdrive} is outlined below:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  We assume there is a main author or contributor of the project, who is capable of using version control tools like GIT. The main author writes the initial version of the Rmd document, and upload it to Google Drive via the \texttt{upload\_rmd()} function.
\item
  The Rmd document in Google Drive is shared with other collaborators, who can make or suggest changes in Google Document.
\item
  The main author can accept suggested changes, and download/preview the Rmd document locally via \texttt{render\_rmd()}. Other collaborators can also do this by themselves if they have modified code chunks and want to see the new results.
\item
  If satisfied, the main author can commit changes to the GIT repository.
\end{enumerate}

The collaborative editing can be either synchronous or asynchronous in Google Drive. Multiple people can edit the same document at the same time, or wait for other people to finish their editing first.

There is also a function \texttt{udpate\_rmd()} in the package, which allows you to edit the Rmd document locally, and upload the local Rmd document to Google Drive. You probably should never want to run this function, because it will completely overwrite the document in Google Drive. The main author may want to warn collaborators about this in advance. Ideally, all collaborators should only edit the document in Google Drive and not locally. It is okay to preview the edited document locally via \texttt{render\_rmd()}, though (note that \texttt{render\_rmd()} automatically downloads the document before rendering it).

\hypertarget{workflowr}{%
\section{\texorpdfstring{Organize an R Markdown project into a research website with \textbf{workflowr}}{Organize an R Markdown project into a research website with workflowr}}\label{workflowr}}

The \textbf{workflowr} package \citep{R-workflowr} (\url{https://github.com/jdblischak/workflowr}) can help you organize a (data analysis) project with a project template and the version control tool GIT. Every time you make a change to the project, you can log the change, and \textbf{workflowr} can build a website corresponding to that particular version of your project. This means that you will be able to view the full history of your analysis results. Although this package uses GIT as the backend for version control, you do not really have to be familiar with GIT, because it has provided R functions that do the GIT operations under the hood, and you only need to call these R functions. Please see the package documentation for how to get started and more information.

The main author of \textbf{workflowr}, John Blischak, has also put together a non-exhaustive list of R packages and guides related to the workflow of R projects, which can be found in this GitHub repo: \url{https://github.com/jdblischak/r-project-workflows}.

\hypertarget{blastula-email}{%
\section{Send Emails based on R Markdown}\label{blastula-email}}

With the \textbf{blastula} package (\url{https://github.com/rich-iannone/blastula}), you can render an Rmd document to the Email body and send the Email. To render an Rmd document to an Email, the document needs to use the output format \texttt{blastula::blastula\_email}, e.g.,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: Weekly Report}
\NormalTok{output: blastula::blastula_email}
\NormalTok{--- }

\NormalTok{Dear Boss,}

\NormalTok{Below is an analysis of the }\BaseNTok{`iris`}\NormalTok{ data:}

\BaseNTok{```\{r\}}
\BaseNTok{summary(iris)}
\BaseNTok{plot(iris[, -5])}
\BaseNTok{```}

\NormalTok{Please let me know if it is not boring enough.}

\NormalTok{Sincerely,  }
\NormalTok{John}
\end{Highlighting}
\end{Shaded}

This Rmd document should be rendered via the function \texttt{blastula::render\_email()}, and the output can be passed to \texttt{blastula::smtp\_send()}, which will send out the Email. Note that \texttt{smtp\_send()} needs an Email server as well as your credentials.

If you use RStudio Connect, you can find more examples at \url{https://solutions.rstudio.com/examples/blastula-overview/}, including automated, conditional, and parameterized emails.

\backmatter

  \bibliography{packages.bib,literature.bib}

\printindex

\end{document}
